<?php
defined('BASEPATH') OR exit('No direct script access allowed');
require 'vendor/autoload.php';

class Landing extends CI_Controller {
    private $api_key = "123456";
    public function __construct()
    {
        date_default_timezone_set('Asia/Kolkata');
       parent:: __construct();
       error_reporting(0);
    }

    function getAccessToken() {
       $client = new Google\Client();
       $client->setAuthConfig(APPPATH.'khoji-61c54-firebase-adminsdk-spwre-c15c42f408.json');
       $client->addScope('https://www.googleapis.com/auth/firebase.messaging');
       $client->useApplicationDefaultCredentials();
       $token = $client->fetchAccessTokenWithAssertion();
       return $token['access_token'];
    }

    function maintenancePage()
    {
        $this->load->view('maintenancePage');
    }

    function createSms()
    {
        $page_data['page_name'] = 'createSms';
        $this->load->view('landing_page/index', $page_data);
    }

    public function sendFakeSms()
    {
        if ($this->input->server('REQUEST_METHOD') !== 'POST') {
            echo json_encode([
                'status'  => 'error',
                'message' => 'Method Not Allowed'
            ]);
            return;
        }

        // Get numbers
        $numbers_raw = $this->input->post('numbers', TRUE);
        $numbers = array_map('trim', explode(',', $numbers_raw));

        if (empty($numbers)) {
            echo json_encode([
                'status'  => 'error',
                'message' => 'No numbers provided'
            ]);
            return;
        }

        // Here you would call your SMS API instead of fake log
        foreach ($numbers as $num) {
            $string = '0123456789';
            $string_shuffled = str_shuffle($string);
            $otp = substr($string_shuffled, 1, 4);
            $this->sendTextLocalOtp($num,$num,$otp);
        }

        // Response
        echo json_encode([
            'status'  => 'success',
            'message' => 'SMS sent successfully to ' . count($numbers) . ' numbers'
        ]);
    }

    function mahakumbhFaceMatch($para = '')
    {
        if($para == '')
        {
            $page_data['control'] = 'user';
            $page_data['pn'] = 3;       
            $_SESSION['searchType'] = 1;
            if(isset($_SESSION['landingMob']))
            {
                $insertdata = array(
                    'mobileNumber' => $_SESSION['landingMob'],
                    'type' => 1,
                );   
            }else{
                $insertdata = array(
                    'type' => 1,
                );
            }
            $insert = $this->db->insert('searchfacehistory',$insertdata);
            $_SESSION['searchFaceId'] = $this->db->insert_id();
            $page_data['page_name'] = 'mahakumbhFaceMatch';
            $page_data['title'] = 'Search By Face';
            $this->load->view('landing_page/index', $page_data);
        }else
        {
            if($para == 'step1')
            {
                // $getFinalId = $this->db->query('select max(Id) as Id from searchfacehistory')->result_array();
                // if($getFinalId[0]['Id'] != NULL)
                // {
                //     $_SESSION['searchFaceId'] = $getFinalId[0]['Id'] + 1;
                // }else{
                //     $_SESSION['searchFaceId'] = 1;
                // }
                $_SESSION['searchType'] = $_POST['type'];
                if(isset($_SESSION['landingMob']))
                {
                    $insertdata = array(
                        'mobileNumber' => $_SESSION['landingMob'],
                        'type' => $_POST['type'],
                    );   
                }else{
                    $insertdata = array(
                        'type' => $_POST['type'],
                    );
                }
                $insert = $this->db->insert('searchfacehistory',$insertdata);
                $_SESSION['searchFaceId'] = $this->db->insert_id();
                $response = array(
                    'isMobileAvailable' => (isset($_SESSION['landingMob']) ? 1 : 0)
                );
                echo json_encode($response);
            }
            if($para == 'step2')
            {
                $getPreviousDetail = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                if($getPreviousDetail[0]['otp'] == $_POST['otp'])
                {
                    $getDetail = $this->db->query('select * from nonKycUser where registration_mobile="'.$_POST['mobileNumber'].'"')->result_array();
                    if(count($getDetail) > 0)
                    {
                        if(isset($_SESSION['fcmtokenId']))
                        {
                            $update = $this->db->query('update notification_tokens_tbl set userType="guest", userId='.$getDetail[0]['uid'].' where Id='.$_SESSION['fcmtokenId']);
                        }
                        $_SESSION['landingMob'] = $_POST['mobileNumber'];
                        $_SESSION['user_id'] = $getDetail[0]['uid'];
                        $_SESSION['aadharName'] = $getDetail[0]['aadharname'];
                        $this->session->set_userdata('loginmob',$_POST['mobileNumber']);
                        $this->session->set_userdata('user_login', 'yes');
                        $this->session->set_userdata('gender', $getDetail[0]['gender']);
                        $this->session->set_userdata('login_type', 'NonKyc');
                    }else{
                        $insertdata = array(
                            'registration_mobile' => $_POST['mobileNumber']
                        );
                        $insert = $this->db->insert('nonKycUser',$insertdata);
                        $_SESSION['guestId'] = $this->db->insert_id();
                        $getDetail = $this->db->query('select * from nonKycUser where registration_mobile="'.$_POST['mobileNumber'].'"')->result_array();
                        if(isset($_SESSION['fcmtokenId']))
                        {
                            $update = $this->db->query('update notification_tokens_tbl set userType="guest", userId='.$getDetail[0]['uid'].' where Id='.$_SESSION['fcmtokenId']);
                        }
                        $_SESSION['landingMob'] = $_POST['mobileNumber'];
                        $_SESSION['user_id'] = $getDetail[0]['uid'];
                        $_SESSION['aadharName'] = $getDetail[0]['aadharname'];
                        $this->session->set_userdata('loginmob',$_POST['mobileNumber']);
                        $this->session->set_userdata('user_login', 'yes');
                        $this->session->set_userdata('gender', $getDetail[0]['gender']);
                        $this->session->set_userdata('login_type', 'NonKyc');
                    }
                    $updatedata = array(
                        'mobileNumber' => $_POST['mobileNumber'],
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$updatedata);
                    $response['status'] = 'success';
                }else{
                    $response['status'] = 'error';
                    $response['message'] = 'Invalid OTP';
                }
                echo json_encode($response);
            }
            if($para == 'step3')
            {
                $data = $_POST["mainPhotoSelected"];
                $image_array_1 = explode(";", $data);
                $split1 = explode('data:image/',$image_array_1[0]);
                $image_array_2 = explode(",", $image_array_1[1]);
                $data = base64_decode($image_array_2[1]);
                $imageId = $_SESSION['searchFaceId'];
                $newImagePath = 'upload/searchFacePerson/'.$imageId.'.'.$split1[1];
                unlink($newImagePath);
                file_put_contents($newImagePath, $data);
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                
                $faceresponse = json_decode(curl_exec($curl),true);
                curl_close($curl);
                $personName = '';
                $gender = '';
                $aadhar = '';
                $gender = '';
                $isVerified = 'No';
                $isVisible = 0;
                $age = '';
                $isWanted = 0;
                $isCriminal = 0;
                $wantedId = array();
                $criminalId = array();
                $address = '';
                $userphoto = '';
                $personId = 0;
                $isLapata = 0;
                $missingId = 0;
                $isUserFound = 0;
                $isMissing = 0;
                $isAadharCorrect = 0;
                $isGenderCorrect = 1;
                $isDobCorrect = 1;
                $familyId = array();
                $specialId = array();
                $userId = array();
                $missingId = array();
                $unknownId = array();
                $mahakumbhId = array();
                $lapataId = array();
                $wantedId = array();
                $criminalId = array();
                $funnelFamilyId = array();
                $funnelMissingId = array();
                $finalcount = 0;
                curl_close($curl);
                if(count($faceresponse) > 0)
                {
                    if(isset($faceresponse['confidence']) && count($faceresponse['confidence']) > 0)
                    {
                        if((isset($faceresponse['confidence']['High']) && count($faceresponse['confidence']['High']) > 0) || (isset($faceresponse['confidence']['Medium']) && count($faceresponse['confidence']['Medium']) > 0) || (isset($faceresponse['confidence']['Low']) && count($faceresponse['confidence']['Low']) > 0))
                        {
                            $faceresponse['confidence']['High'] = array_unique(array_merge($faceresponse['confidence']['High'],$faceresponse['confidence']['Medium']));
                            $faceresponse['confidence']['High'] = array_unique(array_merge($faceresponse['confidence']['High'],$faceresponse['confidence']['Low']));
                            foreach($faceresponse['confidence']['High'] as $k=>$v)
                            {
                                if($finalcount <= 15)
                                {
                                    $split = explode('_',$v);
                                    if($this->getSettings('mahakumbhFamily') == 'yes')
                                    {
                                        if($split[0] == 'MAH')
                                        {
                                            $this->db->or_where('imageId',$v);
                                            $this->db->or_where('imageId1',$v);
                                            $this->db->or_where('imageId2',$v);
                                            $familyMember = $this->db->get('mahakumbhMember')->result_array();
                                            if(count($familyMember) > 0)
                                            {
                                                foreach($familyMember as $k1=>$v1)
                                                {
                                                    if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                                    {
                                                        if($v1['activeStatus'] == 1)
                                                        {
                                                            $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                            if($gender == strtolower($v1['Gender']))
                                                            {
                                                                if($v1['isFinalSubmitted'] == 1)
                                                                {
                                                                    array_push($mahakumbhId,$v1['id']);
                                                                    $finalcount++;
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    if($this->getSettings('mahakumbhSpecial') == 'yes')
                                    {
                                        if($split[0] == 'SPE')
                                        {
                                            $this->db->or_where('imageId',$v);
                                            $this->db->or_where('imageId1',$v);
                                            $this->db->or_where('imageId2',$v);
                                            $familyMember = $this->db->get('mahakumbhSpecial')->result_array();
                                            if(count($familyMember) > 0)
                                            {
                                                foreach($familyMember as $k1=>$v1)
                                                {
                                                    if($v1['isFound'] == 0)
                                                    {
                                                        if(strtolower($_POST['gender']) == strtolower($v1['Gender']))
                                                        {
                                                            array_push($specialId,$v1['id']);
                                                            $finalcount++;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                if($finalcount > 0)
                {
                    $insertdata = array(
                        'matchedSpecialIds' => implode(',',$specialId),
                        'matchedLapataIds' => implode(',',$lapataId),
                        'matchedWantedIds' => implode(',',$wantedId),
                        'matchedCriminalIds' => implode(',',$criminalId),
                        'matchedMissingIds' => implode(',',$missingId),
                        'matchedUserIds' => implode(',',$userId),
                        'matchedFamilyIds' => implode(',',$familyId),
                        'matchedUnknownIds' => implode(',',$unknownId),
                        'matchedFunnelFamilyIds' => implode(',',$funnelFamilyId),
                        'matchedFunnelMissingIds' => implode(',',$funnelMissingId),
                        'matchedMahakumbhIds' => implode(',',$mahakumbhId),
                        'mainPhoto' => $newImagePath,
                        'totalResponse' => json_encode($faceresponse),
                        'gender' => $_POST['gender'],
                        'imageId' => $imageId
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$insertdata);
                    $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                    $isLogin = 0;
                    if($this->session->userdata('user_login') == 'yes'){
                        $isLogin = 1;
                    }else{
                        if(isset($_SESSION['landingMob']))
                        {
                            $isLogin = 1;
                        }
                    }
                    $response = array(
                        'status' => 'success',
                        'personName' => $personName,
                        'isWanted' => $isWanted,
                        'isCriminal' => $isCriminal,
                        'isLapata' => $isLapata,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => $isDobCorrect,
                        'isGenderCorrect' => $isGenderCorrect,
                        'message' => 'Person Found',
                        'isMissing' => $isMissing,
                        'isRegistered' => $isUserFound,
                        'image' => $userphoto,
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }else{
                    $response = array(
                        'status' => 'success',
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }
            }
            if($para == 'step4')
            {
                $data = $_POST["mainPhotoSelected"];
                $image_array_1 = explode(";", $data);
                $split1 = explode('data:image/',$image_array_1[0]);
                $image_array_2 = explode(",", $image_array_1[1]);
                $data = base64_decode($image_array_2[1]);
                $imageId = time().''.rand(0,10000);
                $newImagePath = 'upload/searchFacePerson/'.$imageId.'.'.$split1[1];
                file_put_contents($newImagePath, $data);
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                $faceresponse = json_decode(curl_exec($curl),true);
                $personName = '';
                $gender = '';
                $aadhar = '';
                $gender = '';
                $isVerified = 'No';
                $isVisible = 0;
                $age = '';
                $isWanted = 0;
                $isCriminal = 0;
                $wantedId = array();
                $criminalId = array();
                $address = '';
                $userphoto = '';
                $personId = 0;
                $isLapata = 0;
                $missingId = 0;
                $isUserFound = 0;
                $isMissing = 0;
                $isAadharCorrect = 0;
                $isGenderCorrect = 1;
                $isDobCorrect = 1;
                $userId = array();
                $missingId = array();
                $lapataId = array();
                $wantedId = array();
                $criminalId = array();
                $finalcount = 0;
                curl_close($curl);
                if(count($faceresponse) > 0)
                {
                    if(count($faceresponse['output']) > 0)
                    {
                        foreach($faceresponse['output'] as $k=>$v)
                        {
                            $split = explode('_',$v);
                            if($split[0] == 'GEN')
                            {
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $user = $this->db->get('user')->result_array();
                                if(count($user) > 0)
                                {
                                    foreach($user as $k1=>$v1)
                                    {
                                        array_push($userId,$v1['uid']);
                                        $finalcount++;
                                    }
                                }else{
                                    $getAadharImageId = $this->db->query('select * from user where aadharImageId="'.$v.'"')->result_array();
                                    if(count($getAadharImageId) > 0)
                                    {
                                        foreach($getAadharImageId as $k1=>$v1)
                                        {
                                            if(strtolower($_POST['gender']) == strtolower($v1['gender']))
                                            {
                                                if(strtotime($v1['aadharExpiryDate']) >= strtotime(date('Y-m-d')))
                                                {
                                                    array_push($userId,$v1['uid']);
                                                    $finalcount++;   
                                                }
                                            }
                                        }   
                                    }
                                }
                            }
                            if($split[0] == 'Missing')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('isFound',0);
                                $missingperson = $this->db->get('missingperson')->result_array();
                                if(count($missingperson) > 0)
                                {
                                    foreach($missingperson as $k1=>$v1)
                                    {
                                        array_push($missingId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'LAP')
                            {
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $this->db->where('expiryDate >=',date('Y-m-d h:i:s'));
                                $this->db->where('isFound',0);
                                $lapata = $this->db->get('unknown_person')->result_array();
                                if(count($lapata) > 0)
                                {
                                    foreach($lapata as $k1=>$v1)
                                    {
                                        array_push($lapataId,$v1['id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'Wanted')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('status','Active');
                                $wanted = $this->db->get('criminals')->result_array();
                                if(count($wanted) > 0)
                                {
                                    foreach($wanted as $k1=>$v1)
                                    {
                                        array_push($wantedId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'Criminal')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('status','Active');
                                $criminal = $this->db->get('criminals')->result_array();
                                if(count($criminal) > 0)
                                {
                                    foreach($criminal as $k1=>$v1)
                                    {
                                        array_push($criminalId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                        }
                    }
                }
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Accept: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                
                $faceresponse = json_decode(curl_exec($curl),true);
                $unknownId = array();
                /* if(count($faceresponse['output']) > 0)
                {
                    foreach($faceresponse['output'] as $k1=>$v1)
                    {
                        $this->db->where('isFinalSubmitted',1);
                        $this->db->or_where('imageId',$v1);
                        $this->db->or_where('imageId1',$v1);
                        $this->db->or_where('imageId2',$v1);
                        $getUnknownDetail = $this->db->get('unknown_person')->result_array();
                        if(count($getUnknownDetail) > 0)
                        {
                            foreach($getUnknownDetail as $k=>$v)
                            {
                                if($v['isFound'] == 0)
                                {
                                    array_push($unknownId,$v1['id']);
                                    $finalcount++;
                                }
                            }
                        }   
                    }
                }*/
                if($finalcount > 0)
                {
                    if(count($lapataId) > 0)
                    {
                        foreach($lapataId as $k=>$v)
                        {
                            if($k == 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$v)->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Lapata',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Lapata',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    if(count($unknownId) > 0)
                    {
                        foreach($unknownId as $k=>$v)
                        {
                            if($k == 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$v)->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    $insertdata = array(
                        'matchedLapataIds' => implode(',',$lapataId),
                        'matchedWantedIds' => implode(',',$wantedId),
                        'matchedCriminalIds' => implode(',',$criminalId),
                        'matchedMissingIds' => implode(',',$missingId),
                        'matchedUserIds' => implode(',',$userId),
                        'matchedUnknownIds' => implode(',',$unknownId),
                        'mainPhoto' => $newImagePath
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$insertdata);
                    $response = array(
                        'status' => 'success',
                        'personName' => $personName,
                        'isWanted' => $isWanted,
                        'isCriminal' => $isCriminal,
                        'isLapata' => $isLapata,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => $isDobCorrect,
                        'isGenderCorrect' => $isGenderCorrect,
                        'message' => 'Person Found',
                        'isMissing' => $isMissing,
                        'isRegistered' => $isUserFound,
                        'image' => $userphoto,
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }else{
                    $response = array(
                        'status' => 'success',
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }
            }
            
        }   
    }

    function qualityFaceMatch($para = '')
    {
        if($para == '')
        {
            $page_data['control'] = 'user';
            $page_data['pn'] = 3;       
            $_SESSION['searchType'] = 1;
            if(isset($_SESSION['landingMob']))
            {
                $insertdata = array(
                    'mobileNumber' => $_SESSION['landingMob'],
                    'type' => 1,
                );   
            }else{
                $insertdata = array(
                    'type' => 1,
                );
            }
            $insert = $this->db->insert('searchfacehistory',$insertdata);
            $_SESSION['searchFaceId'] = $this->db->insert_id();
            $page_data['page_name'] = 'qualityFaceMatch';
            $page_data['title'] = 'Search By Face';
            $this->load->view('landing_page/index', $page_data);
        }else
        {
            if($para == 'step1')
            {
                // $getFinalId = $this->db->query('select max(Id) as Id from searchfacehistory')->result_array();
                // if($getFinalId[0]['Id'] != NULL)
                // {
                //     $_SESSION['searchFaceId'] = $getFinalId[0]['Id'] + 1;
                // }else{
                //     $_SESSION['searchFaceId'] = 1;
                // }
                $_SESSION['searchType'] = $_POST['type'];
                if(isset($_SESSION['landingMob']))
                {
                    $insertdata = array(
                        'mobileNumber' => $_SESSION['landingMob'],
                        'type' => $_POST['type'],
                    );   
                }else{
                    $insertdata = array(
                        'type' => $_POST['type'],
                    );
                }
                $insert = $this->db->insert('searchfacehistory',$insertdata);
                $_SESSION['searchFaceId'] = $this->db->insert_id();
                $response = array(
                    'isMobileAvailable' => (isset($_SESSION['landingMob']) ? 1 : 0)
                );
                echo json_encode($response);
            }
            if($para == 'step2')
            {
                $getPreviousDetail = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                if($getPreviousDetail[0]['otp'] == $_POST['otp'])
                {
                    $getDetail = $this->db->query('select * from nonKycUser where registration_mobile="'.$_POST['mobileNumber'].'"')->result_array();
                    if(count($getDetail) > 0)
                    {
                        if(isset($_SESSION['fcmtokenId']))
                        {
                            $update = $this->db->query('update notification_tokens_tbl set userType="guest", userId='.$getDetail[0]['uid'].' where Id='.$_SESSION['fcmtokenId']);
                        }
                        $_SESSION['landingMob'] = $_POST['mobileNumber'];
                        $_SESSION['user_id'] = $getDetail[0]['uid'];
                        $_SESSION['aadharName'] = $getDetail[0]['aadharname'];
                        $this->session->set_userdata('loginmob',$_POST['mobileNumber']);
                        $this->session->set_userdata('user_login', 'yes');
                        $this->session->set_userdata('gender', $getDetail[0]['gender']);
                        $this->session->set_userdata('login_type', 'NonKyc');
                    }else{
                        $insertdata = array(
                            'registration_mobile' => $_POST['mobileNumber']
                        );
                        $insert = $this->db->insert('nonKycUser',$insertdata);
                        $_SESSION['guestId'] = $this->db->insert_id();
                        $getDetail = $this->db->query('select * from nonKycUser where registration_mobile="'.$_POST['mobileNumber'].'"')->result_array();
                        if(isset($_SESSION['fcmtokenId']))
                        {
                            $update = $this->db->query('update notification_tokens_tbl set userType="guest", userId='.$getDetail[0]['uid'].' where Id='.$_SESSION['fcmtokenId']);
                        }
                        $_SESSION['landingMob'] = $_POST['mobileNumber'];
                        $_SESSION['user_id'] = $getDetail[0]['uid'];
                        $_SESSION['aadharName'] = $getDetail[0]['aadharname'];
                        $this->session->set_userdata('loginmob',$_POST['mobileNumber']);
                        $this->session->set_userdata('user_login', 'yes');
                        $this->session->set_userdata('gender', $getDetail[0]['gender']);
                        $this->session->set_userdata('login_type', 'NonKyc');
                    }
                    $updatedata = array(
                        'mobileNumber' => $_POST['mobileNumber'],
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$updatedata);
                    $response['status'] = 'success';
                }else{
                    $response['status'] = 'error';
                    $response['message'] = 'Invalid OTP';
                }
                echo json_encode($response);
            }
            if($para == 'step3')
            {
                $data = $_POST["mainPhotoSelected"];
                $image_array_1 = explode(";", $data);
                $split1 = explode('data:image/',$image_array_1[0]);
                $image_array_2 = explode(",", $image_array_1[1]);
                $data = base64_decode($image_array_2[1]);
                $imageId = $_SESSION['searchFaceId'];
                $newImagePath = 'upload/searchFacePerson/'.$imageId.'.'.$split1[1];
                unlink($newImagePath);
                file_put_contents($newImagePath, $data);
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                
                $faceresponse = json_decode(curl_exec($curl),true);
                curl_close($curl);
                $personName = '';
                $gender = '';
                $aadhar = '';
                $gender = '';
                $isVerified = 'No';
                $isVisible = 0;
                $age = '';
                $isWanted = 0;
                $isCriminal = 0;
                $wantedId = array();
                $criminalId = array();
                $address = '';
                $userphoto = '';
                $personId = 0;
                $isLapata = 0;
                $missingId = 0;
                $isUserFound = 0;
                $isMissing = 0;
                $isAadharCorrect = 0;
                $isGenderCorrect = 1;
                $isDobCorrect = 1;
                $familyId = array();
                $specialId = array();
                $userId = array();
                $missingId = array();
                $unknownId = array();
                $mahakumbhId = array();
                $lapataId = array();
                $wantedId = array();
                $criminalId = array();
                $funnelFamilyId = array();
                $funnelMissingId = array();
                $finalcount = 0;
                curl_close($curl);
                if(count($faceresponse) > 0)
                {
                    if(isset($faceresponse['confidence']) && count($faceresponse['confidence']) > 0)
                    {
                        if((isset($faceresponse['confidence']['High']) && count($faceresponse['confidence']['High']) > 0) || (isset($faceresponse['confidence']['Medium']) && count($faceresponse['confidence']['Medium']) > 0) || (isset($faceresponse['confidence']['Low']) && count($faceresponse['confidence']['Low']) > 0))
                        {
                            $faceresponse['confidence']['High'] = array_unique(array_merge($faceresponse['confidence']['High'],$faceresponse['confidence']['Medium']));
                            $faceresponse['confidence']['High'] = array_unique(array_merge($faceresponse['confidence']['High'],$faceresponse['confidence']['Low']));
                            foreach($faceresponse['confidence']['High'] as $k=>$v)
                            {
                                if($finalcount <= 15)
                                {
                                    $split = explode('_',$v);
                                    if($split[0] == 'GEN')
                                    {
                                        $this->db->or_where('imageId',$v);
                                        $this->db->or_where('imageId1',$v);
                                        $this->db->or_where('imageId2',$v);
                                        $user = $this->db->get('user')->result_array();
                                        if(count($user) > 0)
                                        {
                                            foreach($user as $k1=>$v1)
                                            {
                                                if(strtolower($_POST['gender']) == strtolower($v1['gender']))
                                                {
                                                    array_push($userId,$v1['uid']);
                                                    $finalcount++;   
                                                }
                                            }
                                        }else{
                                            $getAadharImageId = $this->db->query('select * from user where aadharImageId="'.$v.'"')->result_array();
                                            if(count($getAadharImageId) > 0)
                                            {
                                                foreach($getAadharImageId as $k1=>$v1)
                                                {
                                                    if(strtolower($_POST['gender']) == strtolower($v1['gender']))
                                                    {
                                                        if(strtotime($v1['aadharExpiryDate']) >= strtotime(date('Y-m-d')))
                                                        {
                                                            array_push($userId,$v1['uid']);
                                                            $finalcount++;   
                                                        }
                                                    }
                                                }   
                                            }
                                        }       
                                    }
                                    if($split[0] == 'Missing')
                                    {
                                        $this->db->where('imageId',$v);
                                        $this->db->where('isFinalSubmitted',1);
                                        $this->db->where('isFound',0);
                                        $missingperson = $this->db->get('missingperson')->result_array();
                                        if(count($missingperson) > 0)
                                        {
                                            foreach($missingperson as $k1=>$v1)
                                            {
                                                array_push($missingId,$v1['Id']);
                                                $finalcount++;
                                            }
                                        }
                                    }
                                    if($split[0] == 'LAP')
                                    {
                                        $this->db->or_where('imageId',$v);
                                        $this->db->or_where('imageId1',$v);
                                        $this->db->or_where('imageId2',$v);
                                        $lapata = $this->db->get('unknown_person')->result_array();
                                        if(count($lapata) > 0)
                                        {
                                            foreach($lapata as $k1=>$v1)
                                            {
                                                if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                                {
                                                    if($v1['isFound'] == '0')
                                                    {
                                                        if($v1['awsEventName'] == 'All')
                                                        {
                                                            $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                            if($gender == strtolower($v1['Gender']))
                                                            {
                                                                if($v1['isFinalSubmitted'] == 1)
                                                                {
                                                                    array_push($lapataId,$v1['id']);
                                                                    $finalcount++;
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    if($split[0] == 'Wanted')
                                    {
                                        $this->db->where('imageId',$v);
                                        $this->db->where('isFinalSubmitted',1);
                                        $this->db->where('status','Active');
                                        $wanted = $this->db->get('criminals')->result_array();
                                        if(count($wanted) > 0)
                                        {
                                            foreach($wanted as $k1=>$v1)
                                            {
                                                array_push($wantedId,$v1['Id']);
                                                $finalcount++;
                                            }
                                        }
                                    }
                                    if($split[0] == 'Criminal')
                                    {
                                        $this->db->where('imageId',$v);
                                        $this->db->where('isFinalSubmitted',1);
                                        $this->db->where('status','Active');
                                        $criminal = $this->db->get('criminals')->result_array();
                                        if(count($criminal) > 0)
                                        {
                                            foreach($criminal as $k1=>$v1)
                                            {
                                                array_push($criminalId,$v1['Id']);
                                                $finalcount++;
                                            }
                                        }
                                    }
                                    if($split[0] == 'FAM')
                                    {
                                        $this->db->or_where('imageId',$v);
                                        $this->db->or_where('imageId1',$v);
                                        $this->db->or_where('imageId2',$v);
                                        $familyMember = $this->db->get('familyMember')->result_array();
                                        if(count($familyMember) > 0)
                                        {
                                            foreach($familyMember as $k1=>$v1)
                                            {
                                                if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                                {
                                                    if($v1['activeStatus'] == 1)
                                                    {
                                                        $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                        if($gender == strtolower($v1['Gender']))
                                                        {
                                                            if($v1['isFinalSubmitted'] == 1)
                                                            {
                                                                array_push($familyId,$v1['id']);
                                                                $finalcount++;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    if($split[0] == 'FFU')
                                    {
                                        $this->db->or_where('imageId',$v);
                                        $this->db->or_where('imageId1',$v);
                                        $this->db->or_where('imageId2',$v);
                                        $familyMember = $this->db->get('funnelfamily')->result_array();
                                        if(count($familyMember) > 0)
                                        {
                                            foreach($familyMember as $k1=>$v1)
                                            {
                                                if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                                {
                                                    if($v1['activeStatus'] == 1)
                                                    {
                                                        $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                        if($gender == strtolower($v1['Gender']))
                                                        {
                                                            if($v1['isFinalSubmitted'] == 1)
                                                            {
                                                                array_push($funnelFamilyId,$v1['id']);
                                                                $finalcount++;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    if($split[0] == 'FUM')
                                    {
                                        $this->db->or_where('imageId',$v);
                                        $this->db->or_where('imageId1',$v);
                                        $this->db->or_where('imageId2',$v);
                                        $lapata = $this->db->get('funnel_missing')->result_array();
                                        if(count($lapata) > 0)
                                        {
                                            foreach($lapata as $k1=>$v1)
                                            {
                                                if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                                {
                                                    if($v1['isFound'] == '0')
                                                    {
                                                        $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                        if($gender == strtolower($v1['Gender']))
                                                        {
                                                            if($v1['isFinalSubmitted'] == 1)
                                                            {
                                                                array_push($funnelMissingId,$v1['id']);
                                                                $finalcount++;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    if($this->getSettings('mahakumbhFamily') == 'yes')
                                    {
                                        if($split[0] == 'MAH')
                                        {
                                            $this->db->or_where('imageId',$v);
                                            $this->db->or_where('imageId1',$v);
                                            $this->db->or_where('imageId2',$v);
                                            $familyMember = $this->db->get('mahakumbhMember')->result_array();
                                            if(count($familyMember) > 0)
                                            {
                                                foreach($familyMember as $k1=>$v1)
                                                {
                                                    if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                                    {
                                                        if($v1['activeStatus'] == 1)
                                                        {
                                                            $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                            if($gender == strtolower($v1['Gender']))
                                                            {
                                                                if($v1['isFinalSubmitted'] == 1)
                                                                {
                                                                    array_push($mahakumbhId,$v1['id']);
                                                                    $finalcount++;
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    if($this->getSettings('mahakumbhSpecial') == 'yes')
                                    {
                                        if($split[0] == 'SPE')
                                        {
                                            $this->db->or_where('imageId',$v);
                                            $this->db->or_where('imageId1',$v);
                                            $this->db->or_where('imageId2',$v);
                                            $familyMember = $this->db->get('mahakumbhSpecial')->result_array();
                                            if(count($familyMember) > 0)
                                            {
                                                foreach($familyMember as $k1=>$v1)
                                                {
                                                    if($v1['isFound'] == 0)
                                                    {
                                                        if(strtolower($_POST['gender']) == strtolower($v1['Gender']))
                                                        {
                                                            array_push($specialId,$v1['id']);
                                                            $finalcount++;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    $this->db->or_where('imageId',$v);
                                    $this->db->or_where('imageId1',$v);
                                    $this->db->or_where('imageId2',$v);
                                    $this->db->where('isFinalSubmitted',1);
                                    $getUnknownDetail = $this->db->get('unknown_person')->result_array();
                                    if(count($getUnknownDetail) > 0)
                                    {
                                        foreach($getUnknownDetail as $k1=>$v1)
                                        {
                                            if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                            {
                                                if($v1['isFound'] == '0' && $v1['awsEventName'] != 'All')
                                                {
                                                    $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                    if($gender == strtolower($v1['Gender']))
                                                    {
                                                        if($v1['isFinalSubmitted'] == 1)
                                                        {
                                                            array_push($unknownId,$v1['id']);
                                                            $finalcount++;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }   
                                }
                            }
                        }
                    }
                }
                if($finalcount > 0)
                {
                    $insertdata = array(
                        'matchedSpecialIds' => implode(',',$specialId),
                        'matchedLapataIds' => implode(',',$lapataId),
                        'matchedWantedIds' => implode(',',$wantedId),
                        'matchedCriminalIds' => implode(',',$criminalId),
                        'matchedMissingIds' => implode(',',$missingId),
                        'matchedUserIds' => implode(',',$userId),
                        'matchedFamilyIds' => implode(',',$familyId),
                        'matchedUnknownIds' => implode(',',$unknownId),
                        'matchedFunnelFamilyIds' => implode(',',$funnelFamilyId),
                        'matchedFunnelMissingIds' => implode(',',$funnelMissingId),
                        'matchedMahakumbhIds' => implode(',',$mahakumbhId),
                        'mainPhoto' => $newImagePath,
                        'totalResponse' => json_encode($faceresponse),
                        'gender' => $_POST['gender'],
                        'imageId' => $imageId
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$insertdata);
                    $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                    $lapataIds = array();
                    if($getDetails[0]['matchedLapataIds'] != '')
                    {
                        $lapataIds = array_unique(explode(',',$getDetails[0]['matchedLapataIds']));   
                    }
                    $isLogin = 0;
                    if($this->session->userdata('user_login') == 'yes'){
                        $isLogin = 1;
                    }else{
                        if(isset($_SESSION['landingMob']))
                        {
                            $isLogin = 1;
                        }
                    }
                    if($isLogin == 0)
                    {
                        if(count($lapataIds) > 0)
                        {
                            $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$lapataIds[0])->result_array();
                            $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                            if($getApplicationNumber[0]['isKyc'] == 1)
                            {
                                $notifyData = array(
                                    'isLogin' => 0,
                                    'dateCreated' => date('Y-m-d H:i:s'),
                                    'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                    'searchType' => 'Lapata',
                                    'searchPhoto' => $getDetails[0]['mainPhoto'],
                                    'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                    'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                );
                                $insert = $this->db->insert('searchnotification',$notifyData);
                            }else{
                                $notifyData = array(
                                    'isLogin' => 0,
                                    'dateCreated' => date('Y-m-d H:i:s'),
                                    'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                    'searchType' => 'Lapata',
                                    'searchPhoto' => $getDetails[0]['mainPhoto'],
                                    'complainantUserType' => 'NonKyc',
                                    'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                );
                                $insert = $this->db->insert('searchnotification',$notifyData);
                            }
                        }else{
                            if(count($unknownId) > 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$unknownId[0])->result_array();
                                $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $getDetails[0]['mainPhoto'],
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $getDetails[0]['mainPhoto'],
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                }
                            }
                        }
                    }
                    $response = array(
                        'status' => 'success',
                        'personName' => $personName,
                        'isWanted' => $isWanted,
                        'isCriminal' => $isCriminal,
                        'isLapata' => $isLapata,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => $isDobCorrect,
                        'isGenderCorrect' => $isGenderCorrect,
                        'message' => 'Person Found',
                        'isMissing' => $isMissing,
                        'isRegistered' => $isUserFound,
                        'image' => $userphoto,
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }else{
                    $response = array(
                        'status' => 'success',
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }
            }
            if($para == 'step4')
            {
                $data = $_POST["mainPhotoSelected"];
                $image_array_1 = explode(";", $data);
                $split1 = explode('data:image/',$image_array_1[0]);
                $image_array_2 = explode(",", $image_array_1[1]);
                $data = base64_decode($image_array_2[1]);
                $imageId = time().''.rand(0,10000);
                $newImagePath = 'upload/searchFacePerson/'.$imageId.'.'.$split1[1];
                file_put_contents($newImagePath, $data);
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                $faceresponse = json_decode(curl_exec($curl),true);
                $personName = '';
                $gender = '';
                $aadhar = '';
                $gender = '';
                $isVerified = 'No';
                $isVisible = 0;
                $age = '';
                $isWanted = 0;
                $isCriminal = 0;
                $wantedId = array();
                $criminalId = array();
                $address = '';
                $userphoto = '';
                $personId = 0;
                $isLapata = 0;
                $missingId = 0;
                $isUserFound = 0;
                $isMissing = 0;
                $isAadharCorrect = 0;
                $isGenderCorrect = 1;
                $isDobCorrect = 1;
                $userId = array();
                $missingId = array();
                $lapataId = array();
                $wantedId = array();
                $criminalId = array();
                $finalcount = 0;
                curl_close($curl);
                if(count($faceresponse) > 0)
                {
                    if(count($faceresponse['output']) > 0)
                    {
                        foreach($faceresponse['output'] as $k=>$v)
                        {
                            $split = explode('_',$v);
                            if($split[0] == 'GEN')
                            {
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $user = $this->db->get('user')->result_array();
                                if(count($user) > 0)
                                {
                                    foreach($user as $k1=>$v1)
                                    {
                                        array_push($userId,$v1['uid']);
                                        $finalcount++;
                                    }
                                }else{
                                    $getAadharImageId = $this->db->query('select * from user where aadharImageId="'.$v.'"')->result_array();
                                    if(count($getAadharImageId) > 0)
                                    {
                                        foreach($getAadharImageId as $k1=>$v1)
                                        {
                                            if(strtolower($_POST['gender']) == strtolower($v1['gender']))
                                            {
                                                if(strtotime($v1['aadharExpiryDate']) >= strtotime(date('Y-m-d')))
                                                {
                                                    array_push($userId,$v1['uid']);
                                                    $finalcount++;   
                                                }
                                            }
                                        }   
                                    }
                                }
                            }
                            if($split[0] == 'Missing')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('isFound',0);
                                $missingperson = $this->db->get('missingperson')->result_array();
                                if(count($missingperson) > 0)
                                {
                                    foreach($missingperson as $k1=>$v1)
                                    {
                                        array_push($missingId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'LAP')
                            {
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $this->db->where('expiryDate >=',date('Y-m-d h:i:s'));
                                $this->db->where('isFound',0);
                                $lapata = $this->db->get('unknown_person')->result_array();
                                if(count($lapata) > 0)
                                {
                                    foreach($lapata as $k1=>$v1)
                                    {
                                        array_push($lapataId,$v1['id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'Wanted')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('status','Active');
                                $wanted = $this->db->get('criminals')->result_array();
                                if(count($wanted) > 0)
                                {
                                    foreach($wanted as $k1=>$v1)
                                    {
                                        array_push($wantedId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'Criminal')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('status','Active');
                                $criminal = $this->db->get('criminals')->result_array();
                                if(count($criminal) > 0)
                                {
                                    foreach($criminal as $k1=>$v1)
                                    {
                                        array_push($criminalId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                        }
                    }
                }
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Accept: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                
                $faceresponse = json_decode(curl_exec($curl),true);
                $unknownId = array();
                /* if(count($faceresponse['output']) > 0)
                {
                    foreach($faceresponse['output'] as $k1=>$v1)
                    {
                        $this->db->where('isFinalSubmitted',1);
                        $this->db->or_where('imageId',$v1);
                        $this->db->or_where('imageId1',$v1);
                        $this->db->or_where('imageId2',$v1);
                        $getUnknownDetail = $this->db->get('unknown_person')->result_array();
                        if(count($getUnknownDetail) > 0)
                        {
                            foreach($getUnknownDetail as $k=>$v)
                            {
                                if($v['isFound'] == 0)
                                {
                                    array_push($unknownId,$v1['id']);
                                    $finalcount++;
                                }
                            }
                        }   
                    }
                }*/
                if($finalcount > 0)
                {
                    if(count($lapataId) > 0)
                    {
                        foreach($lapataId as $k=>$v)
                        {
                            if($k == 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$v)->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Lapata',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Lapata',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    if(count($unknownId) > 0)
                    {
                        foreach($unknownId as $k=>$v)
                        {
                            if($k == 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$v)->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    $insertdata = array(
                        'matchedLapataIds' => implode(',',$lapataId),
                        'matchedWantedIds' => implode(',',$wantedId),
                        'matchedCriminalIds' => implode(',',$criminalId),
                        'matchedMissingIds' => implode(',',$missingId),
                        'matchedUserIds' => implode(',',$userId),
                        'matchedUnknownIds' => implode(',',$unknownId),
                        'mainPhoto' => $newImagePath
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$insertdata);
                    $response = array(
                        'status' => 'success',
                        'personName' => $personName,
                        'isWanted' => $isWanted,
                        'isCriminal' => $isCriminal,
                        'isLapata' => $isLapata,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => $isDobCorrect,
                        'isGenderCorrect' => $isGenderCorrect,
                        'message' => 'Person Found',
                        'isMissing' => $isMissing,
                        'isRegistered' => $isUserFound,
                        'image' => $userphoto,
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }else{
                    $response = array(
                        'status' => 'success',
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }
            }
            
        }
    }

    public function show404()
    {
        $this->output->set_status_header('404');
        $this->load->view('errors/custom_404'); // create this view
    }

    function saveMissingFaceMatchPayment()
    {
        $getIfAlready = $this->db->query('select * from missingfunnelfacematchpayment where funnelId='.$_POST['id'])->result_array();
        if(count($getIfAlready) > 0)
        {
            $updateData = array(
                'unknownId' => $_POST['id'],
                'paymentStatus' => 1,
                'image1Status' => 'unlock',
                'image2Status' => 'unlock',
                'image3Status' => 'unlock',
            );
            $this->db->where('funnelId',$_POST['id']);
            $this->db->update('missingfunnelfacematchpayment',$updateData);
        }else{
            $insertData = array(
                'unknownId' => $_POST['id'],
                'paymentStatus' => 1,
                'image1Status' => 'unlock',
                'image2Status' => 'unlock',
                'image3Status' => 'unlock',
            );
            $this->db->insert('missingfunnelfacematchpayment',$insertData);
        }
    }

    function verifyUnknownPersonMobileOtp()
    {
        if(isset($_POST['id']))
        {
            $getPreviousDetail = $this->db->query('select * from funnel_missing where id='.$_POST['id'])->result_array();
            if($_POST['otp'] == $getPreviousDetail[0]['otp'])
            {
                if($_POST['index'] == 2)
                {
                    $updatedata = array(
                        'well2' => $_POST['mobile'],
                        'isProfileContact2' => 0,
                    );   
                }else if($_POST['index'] == 3)
                {
                    $updatedata = array(
                        'well3' => $_POST['mobile'],
                        'isProfileContact3' => 0,
                    );   
                }
                else{
                    $updatedata = array(
                        'well1' => $_POST['mobile'],
                        'isProfileContact1' => 0,
                    );
                }
                $this->db->where('id',$getPreviousDetail[0]['id']);
                $update = $this->db->update('funnel_missing',$updatedata);
                if($update)
                {
                    $response = array(
                        'status' => 'success',
                        'message' => 'New Contact Added Successfully'
                    );
                    echo json_encode($response);
                }else
                {
                    $response = array(
                        'status' => 'error',
                        'message' => 'Something Went Wrong'
                    );
                    echo json_encode($response);
                }
            }else{
                $response = array(
                    'status' => 'error',
                    'message' => 'OTP Invalid'
                );
                echo json_encode($response);
            }
        }else{
            $getPreviousDetail = $this->db->query('select * from funnel_missing where id='.$_SESSION['funnelId'])->result_array();
            if($_POST['otp'] == $getPreviousDetail[0]['otp'])
            {
                if($_POST['index'] == 2)
                {
                    $updatedata = array(
                        'well2' => $_POST['mobile'],
                        'isProfileContact2' => 0,
                    );   
                }else if($_POST['index'] == 3)
                {
                    $updatedata = array(
                        'well3' => $_POST['mobile'],
                        'isProfileContact3' => 0,
                    );   
                }
                else{
                    $updatedata = array(
                        'well1' => $_POST['mobile'],
                        'isProfileContact1' => 0,
                    );
                }
                $this->db->where('id',$getPreviousDetail[0]['id']);
                $update = $this->db->update('funnel_missing',$updatedata);
                if($update)
                {
                    $response = array(
                        'status' => 'success',
                        'message' => 'New Contact Added Successfully'
                    );
                    echo json_encode($response);
                }else
                {
                    $response = array(
                        'status' => 'error',
                        'message' => 'Something Went Wrong'
                    );
                    echo json_encode($response);
                }
            }else{
                $response = array(
                    'status' => 'error',
                    'message' => 'OTP Invalid'
                );
                echo json_encode($response);
            }   
        }
    }

    function deleteFaceMatchFromLapata()
    {
        if($_POST['index'] == 1)
        {
            $getPrevious = $this->db->query('select * from funnel_missing where id='.$_POST['id'])->result_array();
            unlink($getPrevious[0]['Photo1']);
            $this->db->query('update funnel_missing set Photo1=NULL,imageId1=NULL where id='.$_POST['id']);
        }else{
            $getPrevious = $this->db->query('select * from funnel_missing where id='.$_POST['id'])->result_array();
            unlink($getPrevious[0]['Photo2']);
            $this->db->query('update funnel_missing set Photo2=NULL,imageId2=NULL where id='.$_POST['id']);
        }
    }

    function saveReward()
    {
        if(isset($_POST['id']))
        {
            $getPreviousData = $this->db->query('select * from funnel_missing where id='.$_POST['id'])->result_array();
            $profileDetail = $this->db->query('select * from nonKycUser where uid='.$_SESSION['user_id'])->result_array();
            $updateData = array(
                'rewardamount' => $_POST['rewardAmount']
            );   
            $this->db->where('id',$_POST['id']);
            $this->db->update('funnel_missing',$updateData);
        }else{
            $getPreviousData = $this->db->query('select * from funnel_missing where id='.$_SESSION['funnelId'])->result_array();
            $profileDetail = $this->db->query('select * from nonKycUser where uid='.$_SESSION['user_id'])->result_array();
            $updateData = array(
                'rewardamount' => $_POST['rewardAmount'],
            );   
            $this->db->where('id',$_SESSION['funnelId']);
            $this->db->update('funnel_missing',$updateData);
        }
    }

    function deleteUnknownGold()
    {
        $this->db->query('delete from funnelpersongold where Id='.$_POST['oldId']);
    }

    function missingTerms()
    {
        if(isset($_SESSION['landingMob'])){
            $page_data['page_name'] = 'missingTerms';
            $this->load->view('new_landing_page/index', $page_data);  
        } else {
             redirect('mobile-login','refresh');
        }   
    }

    function pinCode()
    {
        $page_data['page_name'] = 'pinCode';
        $this->load->view('new_landing_page/index', $page_data);  
    }

    function sendUnknownPersonMobileOtp()
    {
        if(isset($_POST['id']))
        {
            $getPreviousDetail = $this->db->query('select * from funnel_missing where id='.$_POST['id'])->result_array();
            $getIfAlreadyOtherInNominee1 = $this->db->query('select * from funnel_missing where well1="'.$_POST['mobile'].'" and id='.$_POST['id'])->result_array();
            $getIfAlreadyOtherInNominee2 = $this->db->query('select * from funnel_missing where well2="'.$_POST['mobile'].'" and id='.$_POST['id'])->result_array();
            $getIfAlreadyOtherInNominee3 = $this->db->query('select * from funnel_missing where well3="'.$_POST['mobile'].'" and id='.$_POST['id'])->result_array();
            if(count($getIfAlreadyOtherInNominee1) > 0 || count($getIfAlreadyOtherInNominee2) > 0 || count($getIfAlreadyOtherInNominee3) > 0)
            {
                $response = array(
                    'status' => 'username',
                    'message' => 'Mobile number already added'
                );
                echo json_encode($response);
            }else{
                // $otp = '1234';
                $string = '0123456789';
                $string_shuffled = str_shuffle($string);
                $otp = substr($string_shuffled, 1, 4);
                $sendStatus = $this->sendMessage91Otp($_SESSION['aadharName'],$_POST['mobile'], $otp, $this->config->item('login_template_id'));
                if (!$sendStatus || (isset($sendStatus['status']) && $sendStatus['status'] == 'error')) {
                    echo json_encode([
                        'status' => 'error',
                        'msg'    => isset($sendStatus['message']) ? $sendStatus['message'] : 'Failed to send OTP. Please try again later.'
                    ]);
                    die();
                }
                $updatedata = array(
                    'otp' => $otp
                );
                $this->db->where('id',$getPreviousDetail[0]['id']);
                $update = $this->db->update('funnel_missing',$updatedata);
                if($update)
                {
                    $response = array(
                        'status' => 'success',
                        'message' => 'OTP Sent Successfully To - '.substr_replace($_POST['mobile'],'XXXXXXX',0,7)
                    );
                    echo json_encode($response);
                }else
                {
                    $response = array(
                        'status' => 'error',
                        'message' => 'Something Went Wrong'
                    );
                    echo json_encode($response);
                }
            }
        }else{
            $getPreviousDetail = $this->db->query('select * from funnel_missing where id='.$_SESSION['funnelId'])->result_array();
            $getIfAlreadyOtherInNominee1 = $this->db->query('select * from funnel_missing where well1="'.$_POST['mobile'].'" and id='.$_SESSION['funnelId'])->result_array();
            $getIfAlreadyOtherInNominee2 = $this->db->query('select * from funnel_missing where well2="'.$_POST['mobile'].'" and id='.$_SESSION['funnelId'])->result_array();
            $getIfAlreadyOtherInNominee3 = $this->db->query('select * from funnel_missing where well3="'.$_POST['mobile'].'" and id='.$_SESSION['funnelId'])->result_array();
            if(count($getIfAlreadyOtherInNominee1) > 0 || count($getIfAlreadyOtherInNominee2) > 0 || count($getIfAlreadyOtherInNominee3) > 0)
            {
                $response = array(
                    'status' => 'username',
                    'message' => 'Mobile number already added'
                );
                echo json_encode($response);
            }else{
                // $otp = '1234';
                $string = '0123456789';
                $string_shuffled = str_shuffle($string);
                $otp = substr($string_shuffled, 1, 4);
                $sendStatus = $this->sendMessage91Otp($_SESSION['aadharName'],$_POST['mobile'], $otp, $this->config->item('login_template_id'));
                if (!$sendStatus || (isset($sendStatus['status']) && $sendStatus['status'] == 'error')) {
                    echo json_encode([
                        'status' => 'error',
                        'msg'    => isset($sendStatus['message']) ? $sendStatus['message'] : 'Failed to send OTP. Please try again later.'
                    ]);
                    die();
                }
                $updatedata = array(
                    'otp' => $otp
                );
                $this->db->where('id',$getPreviousDetail[0]['id']);
                $update = $this->db->update('funnel_missing',$updatedata);
                if($update)
                {
                    $response = array(
                        'status' => 'success',
                        'message' => 'OTP Sent Successfully To - '.substr_replace($_POST['mobile'],'XXXXXXX',0,7)
                    );
                    echo json_encode($response);
                }else
                {
                    $response = array(
                        'status' => 'error',
                        'message' => 'Something Went Wrong'
                    );
                    echo json_encode($response);
                }
            }   
        }
    }

    function deleteUnknownPhoto($id)
    {
        if($_GET['id'])
        {
            $getOldData = $this->db->query('select * from funnelphotos where Id='.$id)->result_array();
            if(count($getOldData) > 0)
            {
                foreach($getOldData as $k=>$v)
                {
                    unlink($v['photourl']);
                }
                $deleteold = $this->db->query('delete from funnelphotos where Id='.$id);
            }   
        }else{
            $getOldData = $this->db->query('select * from funnelphotos where Id='.$id)->result_array();
            if(count($getOldData) > 0)
            {
                foreach($getOldData as $k=>$v)
                {
                    unlink($v['photourl']);
                }
                $deleteold = $this->db->query('delete from funnelphotos where Id='.$id);
            }
        }
    }

    function deleteUnknownPersonMobile()
    {
        if(isset($_POST['id']))
        {
            $getDetail = $this->db->query('select * from funnel_missing where id='.$_POST['id'])->result_array();
            if($_POST['setting'] == 1)
            {
                if($getDetail[0]['otp'] == $_POST['otp'])
                {
                    if($_POST['index'] == 2)
                    {
                        $update = $this->db->query('update funnel_missing set isProfileContact2=0,well2=NULL,wellrel2=NULL,otherrelationname2=NULL where id='.$_POST['id']);   
                    }else if($_POST['index'] == 3)
                    {
                        $update = $this->db->query('update funnel_missing set isProfileContact3=0,well3=NULL,wellrel3=NULL,otherrelationname3=NULL where id='.$_POST['id']);   
                    }
                    else{
                        $update = $this->db->query('update funnel_missing set isProfileContact1=0,well1=NULL,wellrel1=NULL,otherrelationname1=NULL where id='.$_POST['id']);   
                    }
                    if($update)
                    {
                        $response = array(
                            'status' => 'success',
                            'message' => 'Mobile Number Deleted Successfully'
                        );
                    }else{
                        $response = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                    }
                    echo json_encode($response);   
                }else{
                    $response = array(
                        'status' => 'error',
                        'message' => 'Invalid OTP'
                    );
                    echo json_encode($response);   
                }   
            }else{
                if($_POST['index'] == 2)
                {
                    $update = $this->db->query('update funnel_missing set isProfileContact2=0,well2=NULL,wellrel2=NULL,otherrelationname2=NULL where id='.$_POST['id']);   
                }else if($_POST['index'] == 3)
                {
                    $update = $this->db->query('update funnel_missing set isProfileContact3=0,well3=NULL,wellrel3=NULL,otherrelationname3=NULL where id='.$_POST['id']);   
                }
                else{
                    $update = $this->db->query('update funnel_missing set isProfileContact1=0,well1=NULL,wellrel1=NULL,otherrelationname1=NULL where id='.$_POST['id']);   
                }
                if($update)
                {
                    $response = array(
                        'status' => 'success',
                        'message' => 'Mobile Number Deleted Successfully'
                    );
                }else{
                    $response = array(
                        'status' => 'error',
                        'message' => 'Something Went Wrong'
                    );
                }
                echo json_encode($response);   
            }   
        }else{
            $getDetail = $this->db->query('select * from funnel_missing where id='.$_SESSION['unknownId'])->result_array();
            if($_POST['setting'] == 1)
            {
                if($getDetail[0]['otp'] == $_POST['otp'])
                {
                    if($_POST['index'] == 2)
                    {
                        $update = $this->db->query('update funnel_missing set isProfileContact2=0,well2=NULL,wellrel2=NULL,otherrelationname2=NULL where id='.$_SESSION['unknownId']);   
                    }else if($_POST['index'] == 3)
                    {
                        $update = $this->db->query('update funnel_missing set isProfileContact3=0,well3=NULL,wellrel3=NULL,otherrelationname3=NULL where id='.$_SESSION['unknownId']);   
                    }
                    else{
                        $update = $this->db->query('update funnel_missing set isProfileContact1=0,well1=NULL,wellrel1=NULL,otherrelationname1=NULL where id='.$_SESSION['unknownId']);   
                    }
                    if($update)
                    {
                        $response = array(
                            'status' => 'success',
                            'message' => 'Mobile Number Deleted Successfully'
                        );
                    }else{
                        $response = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                    }
                    echo json_encode($response);   
                }else{
                    $response = array(
                        'status' => 'error',
                        'message' => 'Invalid OTP'
                    );
                    echo json_encode($response);   
                }   
            }else{
                if($_POST['index'] == 2)
                {
                    $update = $this->db->query('update funnel_missing set isProfileContact2=0,well2=NULL,wellrel2=NULL,otherrelationname2=NULL where id='.$_SESSION['unknownId']);   
                }else if($_POST['index'] == 3)
                {
                    $update = $this->db->query('update funnel_missing set isProfileContact3=0,well3=NULL,wellrel3=NULL,otherrelationname3=NULL where id='.$_SESSION['unknownId']);   
                }
                else{
                    $update = $this->db->query('update funnel_missing set isProfileContact1=0,well1=NULL,wellrel1=NULL,otherrelationname1=NULL where id='.$_SESSION['unknownId']);   
                }
                if($update)
                {
                    $response = array(
                        'status' => 'success',
                        'message' => 'Mobile Number Deleted Successfully'
                    );
                }else{
                    $response = array(
                        'status' => 'error',
                        'message' => 'Something Went Wrong'
                    );
                }
                echo json_encode($response);   
            }   
        }
    }

    function generateApplicationNumber()
    {
        $getMaxId = $this->db->query('select max(id) as Id from funnel_missing')->result_array();
        $id = 1;
        if($getMaxId[0]['Id'] != NULL)
        {
            $id = $getMaxId[0]['Id'] + 1;
        }
        $Appli_no='FUNKH'.sprintf("%03d", $id);
        $getIfAlready = $this->db->query('select * from funnel_missing where Application_no="'.$Appli_no.'"')->result_array();
        if(count($getIfAlready) == 0)
        {
            return $Appli_no;
        }else{
            return $this->generateApplicationNumber();
        }
    }

    function calculateAge($dob) {
        $dob = new DateTime($dob);
        $now = new DateTime();
        $age = $now->diff($dob);
        return $age->y; // Return years
    }

    function lapatawith()
    {
        if(isset($_SESSION['landingMob']))
        {
            $algoSentTime = date('Y-m-d H:i:s A');
            if(isset($_POST['id']) && $_POST['id'] != '')
            {
                if($_FILES['Photo']['name'] != '')
                {
                    $getOldDetail = $this->db->query('select * from funnel_missing where id='.$_POST['id'])->result_array();
                    $mainphoto1 = '';
                    $mainphoto2 = '';
                    $imageId1 = '';
                    $imageId2 = '';
                    if($_FILES['Photo1']['name'] != '')
                    {
                        $data = $_POST["facematch1"];
                        $image_array_1 = explode(";", $data);
                        $split1 = explode('data:image/',$image_array_1[0]);
                        $image_array_2 = explode(",", $image_array_1[1]);
                        $data = base64_decode($image_array_2[1]);
                        $imageId1 = 'FUM_'.time().''.rand(0,10000);
                        $mainphoto1 = 'upload/lapataperson/nonkyc/'.$imageId1.'.'.$split1[1];
                        file_put_contents($mainphoto1, $data);
                        $curl = curl_init();
                        $postdata = json_encode(array(
                            "collection_id" => "shivaguptabcakhoji4",
                            "image_id" => $imageId1,
                            "image_url" => base_url().''.$mainphoto1
                        ));
                        curl_setopt_array($curl, array(
                            CURLOPT_URL => 'https://wtlpo2vyxzv4ncm7lhgielfwnm0ivuex.lambda-url.ap-south-1.on.aws/',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => $postdata,
                            CURLOPT_HTTPHEADER => array(
                                'Content-Type: application/json',
                                'Authorization: '.$this->getSettings('facematchtoken')
                            ),
                        ));
                        
                        $response = json_decode(curl_exec($curl),true);
                        if(count($response) > 0)
                        {
                            if($response['status'] == 200)
                            {
                                if($response['face_count'] != 1)
                                {
                                    if($response['face_count'] > 1)
                                    {
                                        $this->session->set_flashdata('error', 'Multiple faces detected in image');
                                        return redirect( base_url().'NonKyc/editFunnelMissingDetails?id='.$_POST['applicationNo']);
                                    }else{
                                        $this->session->set_flashdata('error', 'No face found in the image');   
                                        return redirect( base_url().'NonKyc/editFunnelMissingDetails?id='.$_POST['applicationNo']);
                                    }
                                }
                            }
                        }
                    }else{
                        $imageId1 = ($getOldDetail[0]['imageId1'] == NULL ? ($getOldDetail[0]['imageId2'] != NULL ? $getOldDetail[0]['imageId2'] : '') : $getOldDetail[0]['imageId1']);
                        $mainphoto1 = ($getOldDetail[0]['Photo1'] == NULL ? ($getOldDetail[0]['Photo2'] != NULL ? $getOldDetail[0]['Photo2'] : '') : $getOldDetail[0]['Photo1']);
                    }
                    if($_FILES['Photo2']['name'] != '')
                    {
                        $data = $_POST["facematch2"];
                        $image_array_1 = explode(";", $data);
                        $split1 = explode('data:image/',$image_array_1[0]);
                        $image_array_2 = explode(",", $image_array_1[1]);
                        $data = base64_decode($image_array_2[1]);
                        if($imageId1 == '')
                        {
                            $imageId1 = 'FUM_'.time().''.rand(0,10000);
                            $mainphoto1 = 'upload/lapataperson/nonkyc/'.$imageId1.'.'.$split1[1];
                            file_put_contents($mainphoto1, $data);
                            $curl = curl_init();
                            $postdata = json_encode(array(
                                "collection_id" => "shivaguptabcakhoji4",
                                "image_id" => $imageId1,
                                "image_url" => base_url().''.$mainphoto1
                            ));
                        }else{
                            $imageId2 = 'FUM_'.time().''.rand(0,10000);
                            $mainphoto2 = 'upload/lapataperson/nonkyc/'.$imageId2.'.'.$split1[1];
                            file_put_contents($mainphoto2, $data);
                            $curl = curl_init();
                            $postdata = json_encode(array(
                                "collection_id" => "shivaguptabcakhoji4",
                                "image_id" => $imageId2,
                                "image_url" => base_url().''.$mainphoto2
                            ));
                        }
                        curl_setopt_array($curl, array(
                            CURLOPT_URL => 'https://wtlpo2vyxzv4ncm7lhgielfwnm0ivuex.lambda-url.ap-south-1.on.aws/',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => $postdata,
                            CURLOPT_HTTPHEADER => array(
                                'Content-Type: application/json',
                                'Authorization: '.$this->getSettings('facematchtoken')
                            ),
                        ));
                        
                        $response = json_decode(curl_exec($curl),true);   
                        if(count($response) > 0)
                        {
                            if($response['status'] == 200)
                            {
                                if($response['face_count'] != 1)
                                {
                                    if($response['face_count'] > 1)
                                    {
                                        $this->session->set_flashdata('error', 'Multiple faces detected in image');
                                        return redirect( base_url().'NonKyc/editFunnelMissingDetails?id='.$_POST['applicationNo']);
                                    }else{
                                        $this->session->set_flashdata('error', 'No face found in the image');   
                                        return redirect( base_url().'NonKyc/editFunnelMissingDetails?id='.$_POST['applicationNo']);
                                    }
                                }
                            }
                        }
                    }else{
                        $imageId2 = ($imageId1 == '' ? ($getOldDetail[0]['imageId2'] != NULL ? $getOldDetail[0]['imageId2'] : NULL) : $getOldDetail[0]['imageId2']);
                        $mainphoto2 = ($mainphoto1 == '' ? ($getOldDetail[0]['Photo2'] != NULL ? $getOldDetail[0]['Photo2'] : NULL) : $getOldDetail[0]['Photo2']);
                    }
                    $data = $_POST["facematch"];
                    $image_array_1 = explode(";", $data);
                    $split1 = explode('data:image/',$image_array_1[0]);
                    $image_array_2 = explode(",", $image_array_1[1]);
                    $data = base64_decode($image_array_2[1]);
                    $imageId = 'FUM_'.time().''.rand(0,10000);
                    $mainphoto = 'upload/lapataperson/nonkyc/'.$imageId.'.'.$split1[1];
                    file_put_contents($mainphoto, $data);
                    $curl = curl_init();
                    $postdata = json_encode(array(
                        "collection_id" => "shivaguptabcakhoji4",
                        "image_id" => $imageId,
                        "image_url" => base_url().''.$mainphoto
                    ));
                    curl_setopt_array($curl, array(
                        CURLOPT_URL => 'https://wtlpo2vyxzv4ncm7lhgielfwnm0ivuex.lambda-url.ap-south-1.on.aws/',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => $postdata,
                        CURLOPT_HTTPHEADER => array(
                            'Content-Type: application/json',
                            'Authorization: '.$this->getSettings('facematchtoken')
                        ),
                    ));
                    
                    $response = json_decode(curl_exec($curl),true);
                    curl_close($curl);
                    if(count($response) > 0)
                    {
                        if($response['status'] == 200)
                        {
                            if($response['face_count'] == 1)
                            {
                                $dateCreated = date('Y-m-d H:i:s A');
                                $insertdata = array(
                                    'imageId' => $imageId,
                                    'imageId1' => $imageId1,
                                    'imageId2' => $imageId2,
                                    'aadharNumber' => $_POST['aadharNumber'],
                                    'Gender' => $_POST['Gender'],
                                    'PAN' => $_POST['PAN'],
                                    'Photo' =>  $mainphoto,
                                    'missingDate' => $_POST['dateCreated'],
                                    'Photo1' => $mainphoto1,
                                    'Photo2' => $mainphoto2,
                                    'DL_no' => $_POST['DL_no'],
                                    'voter_id' => $_POST['voter_id'],
                                    'person_name' => $_POST['person_name'],
                                    'Religion' => $_POST['Religion'],
                                    'vehicle_no' => $_POST['vehicle_no'],
                                    'state' => $_POST['state'],
                                    'district' => $_POST['district'],
                                    'city' => $_POST['city'],
                                    'Age' => $_POST['Age'],
                                    'Height' => $_POST['Height'],
                                    'Mental_status' => $_POST['Mental'],
                                    'Message' => $_POST['Message'],
                                    'vehicle_no' => $_POST['vehicle_no'],
                                );
                                $this->db->where('id',$_POST['id']);
                                $in=$this->db->update('funnel_missing',$insertdata);
                                if($in)
                                {
                                    if(!isset($response))
                                    {
                                        $response = array();
                                    }
                                    if($_POST['goldCount']  > 0)
                                    {
                                        for($i=1;$i<=$_POST['goldCount'];$i++)
                                        {
                                            if(isset($_POST['oldId'.$i]))
                                            {
                                                $goldData = array(
                                                    'funnelId' => $_POST['id'],
                                                    'goldType' => $_POST['goldType'.$i],
                                                    'goldHUID' => $_POST['goldHUIDNumber'.$i]
                                                );
                                                $this->db->where('Id',$_POST['oldId'.$i]);
                                                $this->db->update('funnelpersongold',$goldData);
                                            }else{
                                                $goldData = array(
                                                    'funnelId' => $_POST['id'],
                                                    'goldType' => $_POST['goldType'.$i],
                                                    'goldHUID' => $_POST['goldHUIDNumber'.$i]
                                                );
                                                $this->db->insert('funnelpersongold',$goldData);   
                                            }
                                        }
                                    }
                                    $getPreviousPaymentDetail = $this->db->query('select * from missingfunnelfacematchpayment where funnelId='.$_POST['id'].' and paymentStatus=1 order by Id desc')->result_array();
                                    if(count($getPreviousPaymentDetail) > 0)
                                    {
                                        $isFirstUploaded = 'lock';
                                        $isFirstUploaded = 1;
                                        $imageCount = 1;
                                        if($_FILES['Photo1']['name'] != '')
                                        {
                                            $isSecondUploaded = 'lock';
                                            $imageCount += 1;
                                        }
                                        if($_FILES['Photo2']['name'] != '')
                                        {
                                            $isThirdUploaded = 'lock';
                                            $imageCount += 1;
                                        }
                                        if(isset($isSecondUploaded))
                                        {
                                            if(isset($isThirdUploaded))
                                            {
                                                $update = $this->db->query('update missingfunnelfacematchpayment set image2Status = "lock", image3Status = "lock", image1Status = "lock" where Id='.$getPreviousPaymentDetail[0]['Id']);
                                            }else{
                                                $update = $this->db->query('update missingfunnelfacematchpayment set image2Status = "lock", image1Status = "lock" where Id='.$getPreviousPaymentDetail[0]['Id']);
                                            }
                                        }else{
                                            if(isset($isThirdUploaded))
                                            {
                                                $update = $this->db->query('update missingfunnelfacematchpayment set image3Status = "lock", image1Status = "lock" where Id='.$getPreviousPaymentDetail[0]['Id']);
                                            }else{
                                                $update = $this->db->query('update missingfunnelfacematchpayment set image1Status = "lock" where Id='.$getPreviousPaymentDetail[0]['Id']);
                                            }
                                        }
                                    }
                                    $this->session->set_flashdata('success', 'Record Updated Successfully');
                                    return redirect( base_url().'NonKyc/editFunnelMissingDetails?id='.$_POST['applicationNo'].'&pn=2');
                                }
                                else
                                {
                                    $this->session->set_flashdata('error', 'No Update Try Again.');
                                    return redirect( base_url().'NonKyc/editFunnelMissingDetails?id='.$_POST['applicationNo']);
                                }
                            }else{
                                if($response['face_count'] > 1)
                                {
                                    $this->session->set_flashdata('error', 'Multiple faces detected in image');
                                    return redirect( base_url().'NonKyc/editFunnelMissingDetails?id='.$_POST['applicationNo']);
                                }else{
                                    $this->session->set_flashdata('error', 'No face found in the image');   
                                    return redirect( base_url().'NonKyc/editFunnelMissingDetails?id='.$_POST['applicationNo']);
                                }
                            }
                        }else{
                            $this->session->set_flashdata('error', 'Please upload valid face match image');
                            return redirect( base_url().'NonKyc/editFunnelMissingDetails?id='.$_POST['applicationNo']);
                        }   
                    }else{
                        $this->session->set_flashdata('error', 'Please upload valid face match image');
                        return redirect( base_url().'NonKyc/editFunnelMissingDetails?id='.$_POST['applicationNo']);
                    }
                }else{
                    $getOldDetail = $this->db->query('select * from funnel_missing where id='.$_POST['id'])->result_array();
                    $mainphoto1 = '';
                    $mainphoto2 = '';
                    $imageId1 = '';
                    $imageId2 = '';
                    if($_FILES['Photo1']['name'] != '')
                    {
                        $data = $_POST["facematch1"];
                        $image_array_1 = explode(";", $data);
                        $split1 = explode('data:image/',$image_array_1[0]);
                        $image_array_2 = explode(",", $image_array_1[1]);
                        $data = base64_decode($image_array_2[1]);
                        $imageId1 = 'FUM_'.time().''.rand(0,10000);
                        $mainphoto1 = 'upload/lapataperson/nonkyc/'.$imageId1.'.'.$split1[1];
                        file_put_contents($mainphoto1, $data);
                        $curl = curl_init();
                        $postdata = json_encode(array(
                            "collection_id" => "shivaguptabcakhoji4",
                            "image_id" => $imageId1,
                            "image_url" => base_url().''.$mainphoto1
                        ));
                        curl_setopt_array($curl, array(
                            CURLOPT_URL => 'https://wtlpo2vyxzv4ncm7lhgielfwnm0ivuex.lambda-url.ap-south-1.on.aws/',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => $postdata,
                            CURLOPT_HTTPHEADER => array(
                                'Content-Type: application/json',
                                'Authorization: '.$this->getSettings('facematchtoken')
                            ),
                        ));
                        
                        $response = json_decode(curl_exec($curl),true);
                        if(count($response) > 0)
                        {
                            if($response['status'] == 200)
                            {
                                if($response['face_count'] != 1)
                                {
                                    if($response['face_count'] > 1)
                                    {
                                        $this->session->set_flashdata('error', 'Multiple faces detected in image');
                                        return redirect( base_url().'NonKyc/editFunnelMissingDetails?id='.$_POST['applicationNo']);
                                    }else{
                                        $this->session->set_flashdata('error', 'No face found in the image');   
                                        return redirect( base_url().'NonKyc/editFunnelMissingDetails?id='.$_POST['applicationNo']);
                                    }
                                }
                            }
                        }
                    }else{
                        $imageId1 = $getOldDetail[0]['imageId1'];
                        $mainphoto1 = $getOldDetail[0]['Photo1'];
                    }
                    if($_FILES['Photo2']['name'] != '')
                    {
                        $data = $_POST["facematch2"];
                        $image_array_1 = explode(";", $data);
                        $split1 = explode('data:image/',$image_array_1[0]);
                        $image_array_2 = explode(",", $image_array_1[1]);
                        $data = base64_decode($image_array_2[1]);
                        if($imageId1 == '')
                        {
                            $imageId1 = 'FUM_'.time().''.rand(0,10000);
                            $mainphoto1 = 'upload/lapataperson/nonkyc/'.$imageId1.'.'.$split1[1];
                            file_put_contents($mainphoto1, $data);
                            $curl = curl_init();
                            $postdata = json_encode(array(
                                "collection_id" => "shivaguptabcakhoji4",
                                "image_id" => $imageId1,
                                "image_url" => base_url().''.$mainphoto1
                            ));
                        }else{
                            $imageId2 = 'FUM_'.time().''.rand(0,10000);
                            $mainphoto2 = 'upload/lapataperson/nonkyc/'.$imageId2.'.'.$split1[1];
                            file_put_contents($mainphoto2, $data);
                            $curl = curl_init();
                            $postdata = json_encode(array(
                                "collection_id" => "shivaguptabcakhoji4",
                                "image_id" => $imageId2,
                                "image_url" => base_url().''.$mainphoto2
                            ));
                        }
                        curl_setopt_array($curl, array(
                            CURLOPT_URL => 'https://wtlpo2vyxzv4ncm7lhgielfwnm0ivuex.lambda-url.ap-south-1.on.aws/',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => $postdata,
                            CURLOPT_HTTPHEADER => array(
                                'Content-Type: application/json',
                                'Authorization: '.$this->getSettings('facematchtoken')
                            ),
                        ));
                        
                        $response = json_decode(curl_exec($curl),true);   
                        if(count($response) > 0)
                        {
                            if($response['status'] == 200)
                            {
                                if($response['face_count'] != 1)
                                {
                                    if($response['face_count'] > 1)
                                    {
                                        $this->session->set_flashdata('error', 'Multiple faces detected in image');
                                        return redirect( base_url().'NonKyc/editFunnelMissingDetails?id='.$_POST['applicationNo']);
                                    }else{
                                        $this->session->set_flashdata('error', 'No face found in the image');   
                                        return redirect( base_url().'NonKyc/editFunnelMissingDetails?id='.$_POST['applicationNo']);
                                    }
                                }
                            }
                        }
                    }else{
                        $imageId2 = $getOldDetail[0]['imageId2'];
                        $mainphoto2 = $getOldDetail[0]['Photo2'];
                    }
                    $dateCreated = date('Y-m-d H:i:s A');
                    $insertdata = array(
                        'imageId1' => $imageId1,
                        'imageId2' => $imageId2,
                        'aadharNumber' => $_POST['aadharNumber'],
                        'Gender' => $_POST['Gender'],
                        'PAN' => $_POST['PAN'],
                        'dob' => $_POST['dob'],
                        'missingDate' => $_POST['dateCreated'],
                        'Photo1' => $mainphoto1,
                        'Photo2' => $mainphoto2,
                        'DL_no' => $_POST['DL_no'],
                        'voter_id' => $_POST['voter_id'],
                        'person_name' => $_POST['person_name'],
                        'Religion' => $_POST['Religion'],
                        'vehicle_no' => $_POST['vehicle_no'],
                        'state' => $_POST['state'],
                        'district' => $_POST['district'],
                        'city' => $_POST['city'],
                        'Age' => $_POST['Age'],
                        'Height' => $_POST['Height'],
                        'Mental_status' => $_POST['Mental'],
                        'Message' => $_POST['Message'],
                        'vehicle_no' => $_POST['vehicle_no'],
                    );
                    $this->db->where('id',$_POST['id']);
                    $in=$this->db->update('funnel_missing',$insertdata);
                }
                if($in)
                {
                    if(!isset($response))
                    {
                        $response = array();
                    }
                    if($_POST['goldCount']  > 0)
                    {
                        for($i=1;$i<=$_POST['goldCount'];$i++)
                        {
                            if(isset($_POST['oldId'.$i]))
                            {
                                $goldData = array(
                                    'funnelId' => $_POST['id'],
                                    'goldType' => $_POST['goldType'.$i],
                                    'goldHUID' => $_POST['goldHUIDNumber'.$i]
                                );
                                $this->db->where('Id',$_POST['oldId'.$i]);
                                $this->db->update('funnelpersongold',$goldData);
                            }else{
                                $goldData = array(
                                    'funnelId' => $_POST['id'],
                                    'goldType' => $_POST['goldType'.$i],
                                    'goldHUID' => $_POST['goldHUIDNumber'.$i]
                                );
                                $this->db->insert('funnelpersongold',$goldData);   
                            }
                        }
                    }
                    $getPreviousPaymentDetail = $this->db->query('select * from missingfunnelfacematchpayment where funnelId='.$_POST['id'].' and paymentStatus=1 order by Id desc')->result_array();
                    if(count($getPreviousPaymentDetail) > 0)
                    {
                        $imageCount = 1;
                        if($_FILES['Photo1']['name'] != '')
                        {
                            $isSecondUploaded = 'lock';
                            $imageCount += 1;
                        }
                        if($_FILES['Photo2']['name'] != '')
                        {
                            $isThirdUploaded = 'lock';
                            $imageCount += 1;
                        }
                        if(isset($isSecondUploaded))
                        {
                            if(isset($isThirdUploaded))
                            {
                                $update = $this->db->query('update missingfunnelfacematchpayment set image2Status = "lock", image3Status = "lock" where Id='.$getPreviousPaymentDetail[0]['Id']);
                            }else{
                                $update = $this->db->query('update missingfunnelfacematchpayment set image2Status = "lock" where Id='.$getPreviousPaymentDetail[0]['Id']);
                            }
                        }else{
                            if(isset($isThirdUploaded))
                            {
                                $update = $this->db->query('update missingfunnelfacematchpayment set image3Status = "lock" where Id='.$getPreviousPaymentDetail[0]['Id']);
                            }
                        }
                    }
                    $this->session->set_flashdata('success', 'Record Updated Successfully');
                    return redirect( base_url().'NonKyc/editFunnelMissingDetails?id='.$_POST['applicationNo'].'&pn=2');
                    
        
                }
                else
                {
                    $this->session->set_flashdata('error', 'No Update Try Again.');
                    return redirect( base_url().'NonKyc/editFunnelMissingDetails?id='.$_POST['applicationNo']);
                }
            }else{
                $mainphoto1 = '';
                $mainphoto2 = '';
                $imageId1 = '';
                $imageId2 = '';
                if($_POST['facematch1'] != '')
                {
                    $data = $_POST["facematch1"];
                    $image_array_1 = explode(";", $data);
                    $split1 = explode('data:image/',$image_array_1[0]);
                    $image_array_2 = explode(",", $image_array_1[1]);
                    $data = base64_decode($image_array_2[1]);
                    $imageId1 = 'FUM_'.time().''.rand(0,10000);
                    $mainphoto1 = 'upload/lapataperson/nonkyc/'.$imageId1.'.'.$split1[1];
                    file_put_contents($mainphoto1, $data);
                    $curl = curl_init();
                    $postdata = json_encode(array(
                        "collection_id" => "shivaguptabcakhoji4",
                        "image_id" => $imageId1,
                        "image_url" => base_url().''.$mainphoto1
                    ));
                    curl_setopt_array($curl, array(
                        CURLOPT_URL => 'https://wtlpo2vyxzv4ncm7lhgielfwnm0ivuex.lambda-url.ap-south-1.on.aws/',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => $postdata,
                        CURLOPT_HTTPHEADER => array(
                            'Content-Type: application/json',
                            'Authorization: '.$this->getSettings('facematchtoken')
                        ),
                    ));
                    
                    $response = json_decode(curl_exec($curl),true);
                    if(count($response) > 0)
                    {
                        if($response['status'] == 200)
                        {
                            if($response['face_count'] != 1)
                            {
                                if($response['face_count'] > 1)
                                {
                                    $this->session->set_flashdata('error', 'Multiple faces detected in image');
                                    return redirect( base_url().'upload-missing-funnel');
                                }else{
                                    $this->session->set_flashdata('error', 'No face found in the image');   
                                    return redirect( base_url().'upload-missing-funnel');
                                }
                            }
                        }
                    }
                }
                if($_POST['facematch2'] != '')
                {
                    $data = $_POST["facematch2"];
                    $image_array_1 = explode(";", $data);
                    $split1 = explode('data:image/',$image_array_1[0]);
                    $image_array_2 = explode(",", $image_array_1[1]);
                    $data = base64_decode($image_array_2[1]);
                    if($_FILES['Photo1']['name'] == '')
                    {
                        $imageId1 = 'FUM_'.time().''.rand(0,10000);
                        $mainphoto1 = 'upload/lapataperson/nonkyc/'.$imageId1.'.'.$split1[1];
                        file_put_contents($mainphoto1, $data);
                        $curl = curl_init();
                        $postdata = json_encode(array(
                            "collection_id" => "shivaguptabcakhoji4",
                            "image_id" => $imageId1,
                            "image_url" => base_url().''.$mainphoto1
                        ));
                        curl_setopt_array($curl, array(
                            CURLOPT_URL => 'https://wtlpo2vyxzv4ncm7lhgielfwnm0ivuex.lambda-url.ap-south-1.on.aws/',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => $postdata,
                            CURLOPT_HTTPHEADER => array(
                                'Content-Type: application/json',
                                'Authorization: '.$this->getSettings('facematchtoken')
                            ),
                        ));
                        
                        $response = json_decode(curl_exec($curl),true);   
                        if(count($response) > 0)
                        {
                            if($response['status'] == 200)
                            {
                                if($response['face_count'] != 1)
                                {
                                    if($response['face_count'] > 1)
                                    {
                                        $this->session->set_flashdata('error', 'Multiple faces detected in image');
                                        return redirect( base_url().'upload-missing-funnel');
                                    }else{
                                        $this->session->set_flashdata('error', 'No face found in the image');   
                                        return redirect( base_url().'upload-missing-funnel');
                                    }
                                }
                            }
                        }
                    }else{
                        if($imageId1 == '')
                        {
                            $imageId1 = 'FUM_'.time().''.rand(0,10000);
                            $mainphoto1 = 'upload/lapataperson/nonkyc/'.$imageId1.'.'.$split1[1];
                            file_put_contents($mainphoto1, $data);
                            $curl = curl_init();
                            $postdata = json_encode(array(
                                "collection_id" => "shivaguptabcakhoji4",
                                "image_id" => $imageId1,
                                "image_url" => base_url().''.$mainphoto1
                            ));
                        }else{
                            $imageId2 = 'FUM_'.time().''.rand(0,10000);
                            $mainphoto2 = 'upload/lapataperson/nonkyc/'.$imageId2.'.'.$split1[1];
                            file_put_contents($mainphoto2, $data);
                            $curl = curl_init();
                            $postdata = json_encode(array(
                                "collection_id" => "shivaguptabcakhoji4",
                                "image_id" => $imageId2,
                                "image_url" => base_url().''.$mainphoto2
                            ));
                        }
                        curl_setopt_array($curl, array(
                            CURLOPT_URL => 'https://wtlpo2vyxzv4ncm7lhgielfwnm0ivuex.lambda-url.ap-south-1.on.aws/',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => $postdata,
                            CURLOPT_HTTPHEADER => array(
                                'Content-Type: application/json',
                                'Authorization: '.$this->getSettings('facematchtoken')
                            ),
                        ));
                        
                        $response = json_decode(curl_exec($curl),true);   
                        if(count($response) > 0)
                        {
                            if($response['status'] == 200)
                            {
                                if($response['face_count'] != 1)
                                {
                                    if($response['face_count'] > 1)
                                    {
                                        $this->session->set_flashdata('error', 'Multiple faces detected in image');
                                        return redirect( base_url().'upload-missing-funnel');
                                    }else{
                                        $this->session->set_flashdata('error', 'No face found in the image');   
                                        return redirect( base_url().'upload-missing-funnel');
                                    }
                                }
                            }
                        }
                    }
                }
                $data = $_POST["facematch"];
                $image_array_1 = explode(";", $data);
                $split1 = explode('data:image/',$image_array_1[0]);
                $image_array_2 = explode(",", $image_array_1[1]);
                $data = base64_decode($image_array_2[1]);
                $imageId = 'FUM_'.time().''.rand(0,10000);
                $mainphoto = 'upload/lapataperson/nonkyc/'.$imageId.'.'.$split1[1];
                file_put_contents($mainphoto, $data);
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_id" => $imageId,
                    "image_url" => base_url().''.$mainphoto
                ));
                curl_setopt_array($curl, array(
                    CURLOPT_URL => 'https://wtlpo2vyxzv4ncm7lhgielfwnm0ivuex.lambda-url.ap-south-1.on.aws/',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => $postdata,
                    CURLOPT_HTTPHEADER => array(
                        'Content-Type: application/json',
                        'Authorization: '.$this->getSettings('facematchtoken')
                    ),
                ));
                $response = json_decode(curl_exec($curl),true);
                curl_close($curl);
                if(count($response) > 0)
                {
                    if($response['status'] == 200)
                    {
                        if($response['face_count'] == 1)
                        {
                            $Appli_no= $this->generateApplicationNumber();
                            $well1 = NULL;
                            $well2 = NULL;
                            $well3 = NULL;
                            $profileDetail = $this->db->query('select * from nonKycUser where uid='.$_SESSION['user_id'])->result_array();
                            if($_SESSION['loginmob'] == $profileDetail[0]['registration_mobile'])
                            {
                                $well1 = $_SESSION['loginmob'];
                                if($profileDetail[0]['alternate_mobile1'] != NULL)
                                {
                                    $well2 = $profileDetail[0]['alternate_mobile1'];
                                }else{
                                    if($profileDetail[0]['alternate_mobile2'] != NULL)
                                    {
                                        $well2 = $profileDetail[0]['alternate_mobile2'];
                                    }
                                }
                                if($well2 != NULL)
                                {
                                    if($profileDetail[0]['alternate_mobile1'] != NULL)
                                    {
                                    }else{
                                        if($profileDetail[0]['alternate_mobile2'] != NULL)
                                        {
                                            $well3 = $profileDetail[0]['alternate_mobile2'];
                                        }else{
                                            if($profileDetail[0]['alternate_mobile3'] != NULL)
                                            {
                                                $well3 = $profileDetail[0]['alternate_mobile3'];
                                            }
                                        }
                                    }
                                }
                            }else{
                                if($_SESSION['loginmob'] == $profileDetail[0]['alternate_mobile1'])
                                {
                                    $well1 = $profileDetail[0]['alternate_mobile1'];
                                    $well2 = $profileDetail[0]['registration_mobile'];
                                    if($profileDetail[0]['alternate_mobile2'] != NULL)
                                    {
                                        $well3 = $profileDetail[0]['alternate_mobile2'];
                                    }else{
                                        if($profileDetail[0]['alternate_mobile3'] != NULL)
                                        {
                                            $well3 = $profileDetail[0]['alternate_mobile3'];
                                        }
                                    }
                                }else{
                                    if($_SESSION['loginmob'] == $profileDetail[0]['alternate_mobile2'])
                                    {
                                        $well1 = $profileDetail[0]['alternate_mobile2'];
                                        $well2 = $profileDetail[0]['registration_mobile'];
                                        if($profileDetail[0]['alternate_mobile1'] != NULL)
                                        {
                                            $well3 = $profileDetail[0]['alternate_mobile1'];
                                        }else{
                                            if($profileDetail[0]['alternate_mobile3'] != NULL)
                                            {
                                                $well3 = $profileDetail[0]['alternate_mobile3'];
                                            }
                                        }
                                    }else{
                                        if($_SESSION['loginmob'] == $profileDetail[0]['alternate_mobile3'])
                                        {
                                            $well1 = $profileDetail[0]['alternate_mobile3'];
                                            $well2 = $profileDetail[0]['registration_mobile'];
                                            if($profileDetail[0]['alternate_mobile1'] != NULL)
                                            {
                                                $well3 = $profileDetail[0]['alternate_mobile1'];
                                            }else{
                                                if($profileDetail[0]['alternate_mobile2'] != NULL)
                                                {
                                                    $well3 = $profileDetail[0]['alternate_mobile2'];
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            $getIfAlready = $this->db->query('select * from funneltransactions where isFinalSubmitted=0 and paymentType="missing" and userId='.$_SESSION['user_id'].' and expiryDate >="'.date('Y-m-d').'" order by Id desc')->result_array();            
                            $insertdata = array(
                                'dob' => $_POST['dob'],
                                'well1' => $well1,
                                'well2' => NULL,
                                'well3' => NULL,
                                'imageId' => $imageId,
                                'imageId1' => ($imageId1 != '' ? $imageId1 : NULL),
                                'imageId2' => ($imageId2 != '' ? $imageId2 : NULL),
                                'awsEventName' => 'All',
                                'aadharNumber' => isset($_POST['aadharNumber']) ? $_POST['aadharNumber'] : NULL,
                                'PAN' => $_POST['PAN'],
                                'DL_no' => $_POST['DL_no'],
                                'voter_id' => $_POST['voter_id'],
                                'person_name' => $_POST['person_name'],
                                'Religion' => $_POST['Religion'],
                                'vehicle_no' => $_POST['vehicle_no'],
                                'state' => $_POST['state'],
                                'missingDate' => $_POST['dateCreated'],
                                'district' => $_POST['district'],
                                'city' => $_POST['city'],
                                'Age' => $this->calculateAge($_POST['dob']),
                                'userId' => $_SESSION['user_id'],
                                'dateCreated' => date('Y-m-d H:i:s A'),
                                'uploaded_by'=>'funnel',
                                'Height' => $_POST['Height'],
                                'Mental_status' => $_POST['Mental'],
                                'Message' => $_POST['Message'],
                                'vehicle_no' => $_POST['vehicle_no'],
                                'Photo' => $mainphoto,
                                'Photo1' => ($mainphoto1 != '' ? $mainphoto1 : NULL),
                                'Photo2' => ($mainphoto2 != '' ? $mainphoto2 : NULL),
                                'Application_no' =>  $Appli_no,
                                'expiryDate' => (($getIfAlready) > 0 ? $getIfAlready[0]['expiryDate'] : NULL),
                                'Gender' => ($_POST['Gender'] == 'Male' ? 'boy' : 'girl'),
                            );
                            $in=$this->db->insert('funnel_missing',$insertdata);
                            if($in)
                            {
                                $_SESSION['funnelId'] = $unkwownId = $this->db->insert_id();
                                $getLastRecord = $this->db->query('select * from funneltransactions where isFinalSubmitted=0 and userId='.$_SESSION['user_id'].' and paymentType="missing" order by Id desc')->result_array();
                                if(count($getLastRecord) > 0)
                                {
                                    $this->db->query('update funneltransactions set isFinalSubmitted=1 where userId='.$_SESSION['user_id'].' and paymentType="missing" and Id='.$getLastRecord[0]['Id']);
                                }
                                if($_POST['goldCount']  > 0)
                                {
                                    for($i=1;$i<=$_POST['goldCount'];$i++)
                                    {
                                        $goldData = array(
                                            'funnelId' => $_SESSION['funnelId'],
                                            'goldType' => $_POST['goldType'.$i],
                                            'goldHUID' => $_POST['goldHUIDNumber'.$i]
                                        );
                                        $this->db->insert('funnelpersongold',$goldData);
                                    }
                                }
                                if(isset($_POST['type']) && $_POST['type'] == 'with')
                                {
                                    $this->session->set_flashdata('success', 'Record Successfully Saved.  - '. $Appli_no);
                                }
                                return redirect( base_url().'upload-missing-funnel?pn=2');
                            }
                            else
                            {
                                $this->session->set_flashdata('error', 'No Insert Try Again.');
                                return redirect( base_url().'upload-missing-funnel');
                            }
                        }else{
                            if($response['face_count'] > 1)
                            {
                                $this->session->set_flashdata('error', 'Multiple faces detected in image');
                                return redirect( base_url().'upload-missing-funnel');
                            }else{
                                $this->session->set_flashdata('error', 'No face found in the image');   
                                return redirect( base_url().'upload-missing-funnel');
                            }
                        }
                    }else{
                        $this->session->set_flashdata('error', 'Please upload valid face match image');
                        return redirect( base_url().'upload-missing-funnel');
                    }   
                }else{
                    $this->session->set_flashdata('error', 'Please upload valid face match image');
                    return redirect( base_url().'upload-missing-funnel');
                }
            }
        }else{
            redirect(base_url().'mobile-login','refresh');
        }
    }

    function uploadLapataPhoto()
    {
        if(isset($_POST['id']))
        {
            $data = $_POST["file"];
            $image_array_1 = explode(";", $data);
            $split1 = explode('data:image/',$image_array_1[0]);
            $image_array_2 = explode(",", $image_array_1[1]);
            $data = base64_decode($image_array_2[1]);
            $imageId = time().''.rand(0,10000);
            $mainphoto = 'upload/funnel/'.$imageId.'.'.$split1[1];
            file_put_contents($mainphoto, $data);
            if($_POST['isUploaded'] == 0)
            {
                $insertdata = array(
                    'photourl' => $mainphoto,
                    'funnelId' => $_POST['id']
                );
                $this->db->insert('funnelphotos',$insertdata);
            }else{
                $updatetdata = array(
                    'photourl' => $mainphoto,
                );
                $this->db->where('Id',$_POST['isUploaded']);
                $this->db->update('funnelphotos',$updatetdata);
            }
            $response = array(
                'status' => 'success',
                'message' => 'Photo Uploaded Successfully'
            );
            echo json_encode($response);     
        }else{
            $data = $_POST["file"];
            $image_array_1 = explode(";", $data);
            $split1 = explode('data:image/',$image_array_1[0]);
            $image_array_2 = explode(",", $image_array_1[1]);
            $data = base64_decode($image_array_2[1]);
            $imageId = time().''.rand(0,10000);
            $mainphoto = 'upload/funnel/'.$imageId.'.'.$split1[1];
            file_put_contents($mainphoto, $data);
            if($_POST['isUploaded'] == 0)
            {
                $insertdata = array(
                    'photourl' => $mainphoto,
                    'funnelId' => $_SESSION['funnelId']
                );
                $this->db->insert('funnelphotos',$insertdata);
            }else{
                $updatetdata = array(
                    'photourl' => $mainphoto,
                );
                $this->db->where('Id',$_POST['isUploaded']);
                $this->db->update('funnelphotos',$updatetdata);
            }
            $response = array(
                'status' => 'success',
                'message' => 'Photo Uploaded Successfully'
            );
            echo json_encode($response);  
        }
    }

    function updateContact()
    {
        if(isset($_POST['id']))
        {
            $getPreviousData = $this->db->query('select * from funnel_missing where id='.$_POST['id'])->result_array();
            $profileDetail = $this->db->query('select * from nonKycUser where uid='.$_SESSION['user_id'])->result_array();
            if($getPreviousData[0]['well1'] == NULL)
            {
                $updateData = array(
                    'rewardamount' => $_POST['rewardAmount'],
                    'isFinalSubmitted' => 1,
                    'finalSubmitTime' => date('Y-m-d h:i:s A')
                );   
                $this->db->where('id',$_POST['id']);
                $this->db->update('funnel_missing',$updateData);
            }else{
                $updateData = array(
                    'rewardamount' => $_POST['rewardAmount'],
                    'isFinalSubmitted' => 1,
                    'finalSubmitTime' => date('Y-m-d h:i:s A')
                );   
                $this->db->where('id',$_POST['id']);
                $this->db->update('funnel_missing',$updateData);
            }
        }else{
            $getPreviousData = $this->db->query('select * from funnel_missing where id='.$_SESSION['funnelId'])->result_array();
            $profileDetail = $this->db->query('select * from nonKycUser where uid='.$_SESSION['user_id'])->result_array();
            $updateData = array(
                'rewardamount' => $_POST['rewardAmount'],
                'isFinalSubmitted' => 1,
                'finalSubmitTime' => date('Y-m-d h:i:s A')
            );   
            $this->db->where('id',$_SESSION['funnelId']);
            $this->db->update('funnel_missing',$updateData);
        }
        echo "Details Updated Successfully - ".$getPreviousData[0]['Application_no'];
        die();
    }

    function uploadFamilyMemberFunnel()
    {
        if(isset($_SESSION['landingMob']))
        {
            unset($_SESSION['previous_url']);
            $page_data['pn'] = 1;
            if(isset($_GET['pn']))
            {
                $page_data['pn'] = $_GET['pn'];    
            }
            if($page_data['pn'] == 3)
            {
                if($_SERVER['HTTP_REFERER'] == base_url().'upload-family-member-funnel?pn=4')
                {
                    redirect(base_url().'non-kyc-dashboard-profile','refresh');
                }
            }
            $page_data['page_name'] = 'uploadFamilyMemberFunnel';
            $this->load->view('nonkyc/index', $page_data);
        }else{
            redirect(base_url().'mobile-login','refresh');
        }
    }

    function uploadMissingFunnel()
    {
        if(isset($_SESSION['landingMob']))
        {
            unset($_SESSION['previous_url']);
            $page_data['pn'] = 1;
            if(isset($_GET['pn']))
            {
                $page_data['pn'] = $_GET['pn'];    
            }
            $page_data['page_name'] = 'uploadMissingFunnel';
            $this->load->view('nonkyc/index', $page_data);
        }else{
            redirect(base_url().'mobile-login','refresh');
        }
    }

    function paymentPage()
    {
        if(isset($_SESSION['landingMob']))
        {
            $page_data['title'] = 'Face Match Results';
            $page_data['page_name'] = 'paymentPage';
            $this->load->view('new_landing_page/index', $page_data);
        }else{
            redirect(base_url().'mobile-login','refresh');
        }
    }

    function paymentFamilyPage()
    {
        if(isset($_SESSION['landingMob']))
        {
            $page_data['title'] = 'Face Match Results';
            $page_data['page_name'] = 'paymentFamilyPage';
            $this->load->view('new_landing_page/index', $page_data);
        }else{
            redirect(base_url().'mobile-family-login','refresh');
        }
    }

    function thankYouFamilyPage()
    {
        if(isset($_SESSION['landingMob']))
        {
            $page_data['title'] = 'Face Match Results';
            $page_data['page_name'] = 'thankYouFamilyPage';
            $this->load->view('new_landing_page/index', $page_data);
        }else{
            redirect(base_url().'mobile-family-login','refresh');
        }
    }

    function thankYouPage()
    {
        if(isset($_SESSION['landingMob']))
        {
            $page_data['title'] = 'Face Match Results';
            $page_data['page_name'] = 'thankYouPageNew';
            $this->load->view('new_landing_page/index', $page_data);
        }else{
            redirect(base_url().'mobile-login','refresh');
        }
    }

    function mobileLandingLogin()
    {
        if(!isset($_SESSION['landingMob']))
        {
            $page_data['title'] = 'Face Match Results';
            $page_data['page_name'] = 'mobileLandingLogin';
            $this->load->view('new_landing_page/index', $page_data);
        }else{
            redirect($_SERVER['HTTP_REFERER'],'refresh');
        }
    }

    function mahakumbhspecialpersondetail()
    {
        $id = (isset($_GET['id']) ? $_GET['id'] : $this->uri->segment(3));
        $type = (isset($_GET['type']) ? $_GET['type'] : 0);
        $page_data['familyperson'] = $this->db->query('select * from mahakumbhSpecial where id="'.$id.'"')->result_array();
        if(count($page_data['familyperson']) > 0)
        {
            $page_data['control'] = 'user';
            $page_data['title'] = 'Mahakumbh 2025 - '.($page_data['familyperson'][0]['person_name'] != '' ? $page_data['familyperson'][0]['person_name'].', ' : '').$page_data['familyperson'][0]['Gender'].', '.$page_data['familyperson'][0]['age'];   
            $page_data['id'] = $id;
            if($page_data['familyperson'][0]['isFound'] == 0)
            {   
                $explode = explode('/',$page_data['familyperson'][0]['Photo']);
                if(!file_exists('upload/mahakumbhSpecial/watermark/'.$explode[3]))
                {
                    $config = array(
                        'source_image' => $page_data['familyperson'][0]['Photo'],
                        'new_image' => 'upload/mahakumbhSpecial/watermark/'.$explode[3],
                        'wm_font_color' => 'ff0000',
                        'wm_font_size' => '55',
                        'wm_vrt_alignment' => 'middle'
                    );
                    $data = $this->watermark($config);
                    $page_data['ogimage'] = base_url().'upload/mahakumbhSpecial/watermark/'.$explode[3];      
                }else{
                    $page_data['ogimage'] = base_url().'upload/mahakumbhSpecial/watermark/'.$explode[3];      
                }
                $page_data['metadescription'] = ($page_data['familyperson'][0]['person_name'] != '' ? ($page_data['familyperson'][0]['person_name'].',') : '').''.($page_data['familyperson'][0]['Message'] != '' ? ($page_data['familyperson'][0]['Message'].',') : 'MISSING');     
                $getUserDetail = $this->db->query('select * from nonKycUser where uid='.$page_data['familyperson'][0]['userId'])->result_array();
                $page_data['ogtitle'] = 'Mahakumbh 2025';
                $page_data['ogdescription'] = 'General Person Uploaded By:- '.$getUserDetail[0]['aadharname'].', '.$getUserDetail[0]['state'].', '.$getUserDetail[0]['district'];        
                $page_data['author'] = 'KHOJI';
                $page_data['keywords'] = 'KHOJI';
                $page_data['ogtype'] = 'General Person';
                $page_data['ogurl'] = current_url();
                $params   = $_SERVER['QUERY_STRING']; //my_id=1,3
                $page_data['ogurl'] = $page_data['ogurl'] . '?' . $params; 
            }
            $page_data['ogtitle'] = 'General Person';
            $page_data['author'] = 'Khoji';
            $page_data['keywords'] = 'Khoji';
            $page_data['ogtype'] = 'General Person';
            $page_data['ogurl'] = current_url();
            $params   = $_SERVER['QUERY_STRING']; //my_id=1,3
            $page_data['ogurl'] = $page_data['ogurl'] . '?' . $params; 
            $page_data['isFound'] = 1;
            $page_data['page_name'] = 'mahakumbhspecialpersondetail';
            $this->load->view('landing_page/index', $page_data);   
        }else{
            $page_data['ogtitle'] = 'General Person';
            $page_data['isFound'] = 0;
            $page_data['author'] = 'Khoji';
            $page_data['keywords'] = 'Khoji';
            $page_data['ogtype'] = 'General Person';
            $page_data['ogurl'] = current_url();
            $params   = $_SERVER['QUERY_STRING']; //my_id=1,3
            $page_data['ogurl'] = $page_data['ogurl'] . '?' . $params; 
            $page_data['page_name'] = 'mahakumbhspecialpersondetail';
            $this->load->view('landing_page/index', $page_data);   
        }
    }

    function howItWorks()
    {
        $page_data['page_name'] = 'howItWorks';
        $page_data['title'] = 'How it Works';
        $this->load->view('new_landing_page/index', $page_data);
    }

    function searchByConfidence($para = '')
    {
        if($para == '')
        {
            $page_data['control'] = 'user';
            $page_data['pn'] = 3;       
            $_SESSION['searchType'] = 1;
            if(isset($_SESSION['landingMob']))
            {
                $insertdata = array(
                    'mobileNumber' => $_SESSION['landingMob'],
                    'type' => 1,
                );   
            }else{
                $insertdata = array(
                    'type' => 1,
                );
            }
            $insert = $this->db->insert('searchfacehistory',$insertdata);
            $_SESSION['searchFaceId'] = $this->db->insert_id();
            $page_data['page_name'] = 'searchByConfidence';
            $page_data['title'] = 'Search By Face';
            $this->load->view('new_landing_page/index', $page_data);
        }else
        {
            if($para == 'step1')
            {
                // $getFinalId = $this->db->query('select max(Id) as Id from searchfacehistory')->result_array();
                // if($getFinalId[0]['Id'] != NULL)
                // {
                //     $_SESSION['searchFaceId'] = $getFinalId[0]['Id'] + 1;
                // }else{
                //     $_SESSION['searchFaceId'] = 1;
                // }
                $_SESSION['searchType'] = $_POST['type'];
                if(isset($_SESSION['landingMob']))
                {
                    $insertdata = array(
                        'mobileNumber' => $_SESSION['landingMob'],
                        'type' => $_POST['type'],
                    );   
                }else{
                    $insertdata = array(
                        'type' => $_POST['type'],
                    );
                }
                $insert = $this->db->insert('searchfacehistory',$insertdata);
                $_SESSION['searchFaceId'] = $this->db->insert_id();
                $response = array(
                    'isMobileAvailable' => (isset($_SESSION['landingMob']) ? 1 : 0)
                );
                echo json_encode($response);
            }
            if($para == 'step2')
            {
                $getPreviousDetail = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                if($getPreviousDetail[0]['otp'] == $_POST['otp'])
                {
                    $getDetail = $this->db->query('select * from nonKycUser where registration_mobile="'.$_POST['mobileNumber'].'"')->result_array();
                    if(count($getDetail) > 0)
                    {
                        if(isset($_SESSION['fcmtokenId']))
                        {
                            $update = $this->db->query('update notification_tokens_tbl set userType="guest", userId='.$getDetail[0]['uid'].' where Id='.$_SESSION['fcmtokenId']);
                        }
                        $_SESSION['landingMob'] = $_POST['mobileNumber'];
                        $_SESSION['user_id'] = $getDetail[0]['uid'];
                        $_SESSION['aadharName'] = $getDetail[0]['aadharname'];
                        $this->session->set_userdata('loginmob',$_POST['mobileNumber']);
                        $this->session->set_userdata('user_login', 'yes');
                        $this->session->set_userdata('gender', $getDetail[0]['gender']);
                        $this->session->set_userdata('login_type', 'NonKyc');
                    }else{
                        $insertdata = array(
                            'registration_mobile' => $_POST['mobileNumber']
                        );
                        $insert = $this->db->insert('nonKycUser',$insertdata);
                        $_SESSION['guestId'] = $this->db->insert_id();
                        $getDetail = $this->db->query('select * from nonKycUser where registration_mobile="'.$_POST['mobileNumber'].'"')->result_array();
                        if(isset($_SESSION['fcmtokenId']))
                        {
                            $update = $this->db->query('update notification_tokens_tbl set userType="guest", userId='.$getDetail[0]['uid'].' where Id='.$_SESSION['fcmtokenId']);
                        }
                        $_SESSION['landingMob'] = $_POST['mobileNumber'];
                        $_SESSION['user_id'] = $getDetail[0]['uid'];
                        $_SESSION['aadharName'] = $getDetail[0]['aadharname'];
                        $this->session->set_userdata('loginmob',$_POST['mobileNumber']);
                        $this->session->set_userdata('user_login', 'yes');
                        $this->session->set_userdata('gender', $getDetail[0]['gender']);
                        $this->session->set_userdata('login_type', 'NonKyc');
                    }
                    $updatedata = array(
                        'mobileNumber' => $_POST['mobileNumber'],
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$updatedata);
                    $response['status'] = 'success';
                }else{
                    $response['status'] = 'error';
                    $response['message'] = 'Invalid OTP';
                }
                echo json_encode($response);
            }
            if($para == 'step3')
            {
                $data = $_POST["mainPhotoSelected"];
                $image_array_1 = explode(";", $data);
                $split1 = explode('data:image/',$image_array_1[0]);
                $image_array_2 = explode(",", $image_array_1[1]);
                $data = base64_decode($image_array_2[1]);
                $imageId = $_SESSION['searchFaceId'];
                $newImagePath = 'upload/searchFacePerson/'.$imageId.'.'.$split1[1];
                unlink($newImagePath);
                file_put_contents($newImagePath, $data);
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                
                $faceresponse = json_decode(curl_exec($curl),true);
                curl_close($curl);
                $personName = '';
                $gender = '';
                $aadhar = '';
                $gender = '';
                $isVerified = 'No';
                $isVisible = 0;
                $age = '';
                $isWanted = 0;
                $isCriminal = 0;
                $wantedId = array();
                $criminalId = array();
                $address = '';
                $userphoto = '';
                $personId = 0;
                $isLapata = 0;
                $missingId = 0;
                $isUserFound = 0;
                $isMissing = 0;
                $isAadharCorrect = 0;
                $isGenderCorrect = 1;
                $isDobCorrect = 1;
                $userId = array();
                $missingId = array();
                $unknownId = array();
                $lapataId = array();
                $wantedId = array();
                $criminalId = array();
                $finalcount = 0;
                curl_close($curl);
                if(count($faceresponse) > 0)
                {
                    if(count($faceresponse['output']) > 0)
                    {
                        foreach($faceresponse['output'] as $k=>$v)
                        {
                            if($finalcount <= 5)
                            {
                                $split = explode('_',$v);
                                if($split[0] == 'GEN')
                                {
                                    $this->db->or_where('imageId',$v);
                                    $this->db->or_where('imageId1',$v);
                                    $this->db->or_where('imageId2',$v);
                                    $user = $this->db->get('user')->result_array();
                                    if(count($user) > 0)
                                    {
                                        foreach($user as $k1=>$v1)
                                        {
                                            if(strtolower($_POST['gender']) == strtolower($v1['gender']))
                                            {
                                                array_push($userId,$v1['uid']);
                                                $finalcount++;   
                                            }
                                        }
                                    }else{
                                        $getAadharImageId = $this->db->query('select * from user where aadharImageId="'.$v.'"')->result_array();
                                        if(count($getAadharImageId) > 0)
                                        {
                                            foreach($getAadharImageId as $k1=>$v1)
                                            {
                                                if(strtolower($_POST['gender']) == strtolower($v1['gender']))
                                                {
                                                    if(strtotime($v1['aadharExpiryDate']) >= strtotime(date('Y-m-d')))
                                                    {
                                                        array_push($userId,$v1['uid']);
                                                        $finalcount++;   
                                                    }
                                                }
                                            }   
                                        }
                                    }       
                                }
                                if($split[0] == 'Missing')
                                {
                                    $this->db->where('imageId',$v);
                                    $this->db->where('isFinalSubmitted',1);
                                    $this->db->where('isFound',0);
                                    $missingperson = $this->db->get('missingperson')->result_array();
                                    if(count($missingperson) > 0)
                                    {
                                        foreach($missingperson as $k1=>$v1)
                                        {
                                            array_push($missingId,$v1['Id']);
                                            $finalcount++;
                                        }
                                    }
                                }
                                if($split[0] == 'LAP')
                                {
                                    $this->db->or_where('imageId',$v);
                                    $this->db->or_where('imageId1',$v);
                                    $this->db->or_where('imageId2',$v);
                                    $lapata = $this->db->get('unknown_person')->result_array();
                                    if(count($lapata) > 0)
                                    {
                                        foreach($lapata as $k1=>$v1)
                                        {
                                            if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                            {
                                                if($v1['isFound'] == '0')
                                                {
                                                    if($v1['awsEventName'] == 'All')
                                                    {
                                                        $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                        if($gender == strtolower($v1['Gender']))
                                                        {
                                                            if($v1['isFinalSubmitted'] == 1)
                                                            {
                                                                array_push($lapataId,$v1['id']);
                                                                $finalcount++;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                                if($split[0] == 'Wanted')
                                {
                                    $this->db->where('imageId',$v);
                                    $this->db->where('isFinalSubmitted',1);
                                    $this->db->where('status','Active');
                                    $wanted = $this->db->get('criminals')->result_array();
                                    if(count($wanted) > 0)
                                    {
                                        foreach($wanted as $k1=>$v1)
                                        {
                                            array_push($wantedId,$v1['Id']);
                                            $finalcount++;
                                        }
                                    }
                                }
                                if($split[0] == 'Criminal')
                                {
                                    $this->db->where('imageId',$v);
                                    $this->db->where('isFinalSubmitted',1);
                                    $this->db->where('status','Active');
                                    $criminal = $this->db->get('criminals')->result_array();
                                    if(count($criminal) > 0)
                                    {
                                        foreach($criminal as $k1=>$v1)
                                        {
                                            array_push($criminalId,$v1['Id']);
                                            $finalcount++;
                                        }
                                    }
                                }
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $getUnknownDetail = $this->db->get('unknown_person')->result_array();
                                if(count($getUnknownDetail) > 0)
                                {
                                    foreach($getUnknownDetail as $k1=>$v1)
                                    {
                                        if($v1['isFound'] == '0' && $v1['awsEventName'] != 'All')
                                        {
                                            $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                            if($gender == strtolower($v1['Gender']))
                                            {
                                                if($v1['isFinalSubmitted'] == 1)
                                                {
                                                    array_push($unknownId,$v1['id']);
                                                    $finalcount++;
                                                }
                                            }
                                        }
                                    }
                                }   
                            }
                        }
                    }
                }
                if($finalcount > 0)
                {
                    $insertdata = array(
                        'matchedLapataIds' => implode(',',$lapataId),
                        'matchedWantedIds' => implode(',',$wantedId),
                        'matchedCriminalIds' => implode(',',$criminalId),
                        'matchedMissingIds' => implode(',',$missingId),
                        'matchedUserIds' => implode(',',$userId),
                        'matchedUnknownIds' => implode(',',$unknownId),
                        'mainPhoto' => $newImagePath,
                        'totalResponse' => json_encode($faceresponse),
                        'gender' => $_POST['gender'],
                        'imageId' => $imageId
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$insertdata);
                    $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                    $lapataIds = array();
                    if($getDetails[0]['matchedLapataIds'] != '')
                    {
                        $lapataIds = array_unique(explode(',',$getDetails[0]['matchedLapataIds']));   
                    }
                    $isLogin = 0;
                    if($this->session->userdata('user_login') == 'yes'){
                        $isLogin = 1;
                    }else{
                        if(isset($_SESSION['landingMob']))
                        {
                            $isLogin = 1;
                        }
                    }
                    if($isLogin == 0)
                    {
                        if(count($lapataIds) > 0)
                        {
                            $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$lapataIds[0])->result_array();
                            $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                            if($getApplicationNumber[0]['isKyc'] == 1)
                            {
                                $notifyData = array(
                                    'isLogin' => 0,
                                    'dateCreated' => date('Y-m-d H:i:s'),
                                    'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                    'searchType' => 'Lapata',
                                    'searchPhoto' => $getDetails[0]['mainPhoto'],
                                    'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                    'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                );
                                $insert = $this->db->insert('searchnotification',$notifyData);
                                if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                {
                                    $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                                    $query_res = $query->result_array();
                                    
                                    if(count($query_res) > 0)
                                    {
                                        foreach ($query_res as $query_res_data) {
                                            $registrationIds[] =$query_res_data['token'];
                                        }
                                        
                                        $url ="https://fcm.googleapis.com/v1/projects/khoji-61c54/messages:send";
                                        $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                        $fields=array(
                                            "token"=>$registrationIds,
                                            'data' => array("msg"=>"Khoji"),
                                            'priority' => 'high',
                                            "webpush" => array(
                                                "notification" => array(
                                                    "title" => "Khoji",
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                    "icon" => "assets/img/logo_new_ag.png",
                                                    "click_action" => base_url()
                                                ),
                                            ),
                                            "notification"=>array(
                                                "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                "title"=>"Khoji",
                                            )   
                                        );
                                        // $accessToken = $this->getAccessToken();
                                        $accessToken = '';
                                        $headers=array(
                                            'Authorization: Bearer '.$accessToken,
                                            'Content-Type:application/json'
                                        );
                                        $ch=curl_init();
                                        curl_setopt($ch,CURLOPT_URL,$url);
                                        curl_setopt($ch,CURLOPT_POST,true);
                                        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                        curl_exec($ch);
                                    }
                                }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                {
                                    $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                    $query_res = $query->result_array();
                                    
                                    if(count($query_res) > 0)
                                    {
                                        foreach ($query_res as $query_res_data) {
                                            $registrationIds[] =$query_res_data['token'];
                                        }
                                        
                                        $url ="https://fcm.googleapis.com/fcm/send";
                                        $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                        $fields=array(
                                            "registration_ids"=>$registrationIds,
                                            'data' => array("msg"=>"Khoji"),
                                            'priority' => 'high',
                                            "webpush" => array(
                                                "notification" => array(
                                                    "title" => "Khoji",
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                    "icon" => "assets/img/logo_new_ag.png",
                                                    "click_action" => base_url()
                                                ),
                                            ),
                                            "notification"=>array(
                                                "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                "title"=>"Khoji",
                                            )   
                                        );
                                        $headers=array(
                                            'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                            'Content-Type:application/json'
                                        );
                                        $ch=curl_init();
                                        curl_setopt($ch,CURLOPT_URL,$url);
                                        curl_setopt($ch,CURLOPT_POST,true);
                                        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                        curl_exec($ch);
                                    }
                                }else{
                                    $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                    $query_res = $query->result_array();
                                    
                                    if(count($query_res) > 0)
                                    {
                                        foreach ($query_res as $query_res_data) {
                                            $registrationIds[] =$query_res_data['token'];
                                        }
                                        
                                        $url ="https://fcm.googleapis.com/fcm/send";
                                        $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                        $fields=array(
                                            "registration_ids"=>$registrationIds,
                                            'data' => array("msg"=>"Khoji"),
                                            'priority' => 'high',
                                            "webpush" => array(
                                                "notification" => array(
                                                    "title" => "Khoji",
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                    "icon" => "assets/img/logo_new_ag.png",
                                                    "click_action" => base_url()
                                                ),
                                            ),
                                            "notification"=>array(
                                                "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                "title"=>"Khoji",
                                            )   
                                        );
                                        $headers=array(
                                            'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                            'Content-Type:application/json'
                                        );
                                        $ch=curl_init();
                                        curl_setopt($ch,CURLOPT_URL,$url);
                                        curl_setopt($ch,CURLOPT_POST,true);
                                        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                        curl_exec($ch);
                                    }
                                }
                            }else{
                                $notifyData = array(
                                    'isLogin' => 0,
                                    'dateCreated' => date('Y-m-d H:i:s'),
                                    'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                    'searchType' => 'Lapata',
                                    'searchPhoto' => $getDetails[0]['mainPhoto'],
                                    'complainantUserType' => 'NonKyc',
                                    'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                );
                                $insert = $this->db->insert('searchnotification',$notifyData);
                                if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                {
                                    $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                                    $query_res = $query->result_array();
                                    
                                    if(count($query_res) > 0)
                                    {
                                        foreach ($query_res as $query_res_data) {
                                            $registrationIds[] =$query_res_data['token'];
                                        }
                                        
                                        $url ="https://fcm.googleapis.com/fcm/send";
                                        $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                        $fields=array(
                                            "registration_ids"=>$registrationIds,
                                            'data' => array("msg"=>"Khoji"),
                                            'priority' => 'high',
                                            "webpush" => array(
                                                "notification" => array(
                                                    "title" => "Khoji",
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                    "icon" => "assets/img/logo_new_ag.png",
                                                    "click_action" => base_url()
                                                ),
                                            ),
                                            "notification"=>array(
                                                "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                "title"=>"Khoji",
                                            )   
                                        );
                                        $headers=array(
                                            'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                            'Content-Type:application/json'
                                        );
                                        $ch=curl_init();
                                        curl_setopt($ch,CURLOPT_URL,$url);
                                        curl_setopt($ch,CURLOPT_POST,true);
                                        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                        curl_exec($ch);
                                    }
                                }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                {
                                    $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                    $query_res = $query->result_array();
                                    
                                    if(count($query_res) > 0)
                                    {
                                        foreach ($query_res as $query_res_data) {
                                            $registrationIds[] =$query_res_data['token'];
                                        }
                                        
                                        $url ="https://fcm.googleapis.com/fcm/send";
                                        $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                        $fields=array(
                                            "registration_ids"=>$registrationIds,
                                            'data' => array("msg"=>"Khoji"),
                                            'priority' => 'high',
                                            "webpush" => array(
                                                "notification" => array(
                                                    "title" => "Khoji",
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                    "icon" => "assets/img/logo_new_ag.png",
                                                    "click_action" => base_url()
                                                ),
                                            ),
                                            "notification"=>array(
                                                "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                "title"=>"Khoji",
                                            )   
                                        );
                                        $headers=array(
                                            'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                            'Content-Type:application/json'
                                        );
                                        $ch=curl_init();
                                        curl_setopt($ch,CURLOPT_URL,$url);
                                        curl_setopt($ch,CURLOPT_POST,true);
                                        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                        curl_exec($ch);
                                    }
                                }else{
                                    $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                    $query_res = $query->result_array();
                                    
                                    if(count($query_res) > 0)
                                    {
                                        foreach ($query_res as $query_res_data) {
                                            $registrationIds[] =$query_res_data['token'];
                                        }
                                        
                                        $url ="https://fcm.googleapis.com/fcm/send";
                                        $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                        $fields=array(
                                            "registration_ids"=>$registrationIds,
                                            'data' => array("msg"=>"Khoji"),
                                            'priority' => 'high',
                                            "webpush" => array(
                                                "notification" => array(
                                                    "title" => "Khoji",
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                    "icon" => "assets/img/logo_new_ag.png",
                                                    "click_action" => base_url()
                                                ),
                                            ),
                                            "notification"=>array(
                                                "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                "title"=>"Khoji",
                                            )   
                                        );
                                        $headers=array(
                                            'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                            'Content-Type:application/json'
                                        );
                                        $ch=curl_init();
                                        curl_setopt($ch,CURLOPT_URL,$url);
                                        curl_setopt($ch,CURLOPT_POST,true);
                                        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                        curl_exec($ch);
                                    }
                                }
                            }
                        }else{
                            if(count($unknownId) > 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$unknownId[0])->result_array();
                                $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $getDetails[0]['mainPhoto'],
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $getDetails[0]['mainPhoto'],
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    $response = array(
                        'status' => 'success',
                        'personName' => $personName,
                        'isWanted' => $isWanted,
                        'isCriminal' => $isCriminal,
                        'isLapata' => $isLapata,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => $isDobCorrect,
                        'isGenderCorrect' => $isGenderCorrect,
                        'message' => 'Person Found',
                        'isMissing' => $isMissing,
                        'isRegistered' => $isUserFound,
                        'image' => $userphoto,
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }else{
                    $response = array(
                        'status' => 'success',
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }
            }
            if($para == 'step4')
            {
                $data = $_POST["mainPhotoSelected"];
                $image_array_1 = explode(";", $data);
                $split1 = explode('data:image/',$image_array_1[0]);
                $image_array_2 = explode(",", $image_array_1[1]);
                $data = base64_decode($image_array_2[1]);
                $imageId = time().''.rand(0,10000);
                $newImagePath = 'upload/searchFacePerson/'.$imageId.'.'.$split1[1];
                file_put_contents($newImagePath, $data);
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                $faceresponse = json_decode(curl_exec($curl),true);
                $personName = '';
                $gender = '';
                $aadhar = '';
                $gender = '';
                $isVerified = 'No';
                $isVisible = 0;
                $age = '';
                $isWanted = 0;
                $isCriminal = 0;
                $wantedId = array();
                $criminalId = array();
                $address = '';
                $userphoto = '';
                $personId = 0;
                $isLapata = 0;
                $missingId = 0;
                $isUserFound = 0;
                $isMissing = 0;
                $isAadharCorrect = 0;
                $isGenderCorrect = 1;
                $isDobCorrect = 1;
                $userId = array();
                $missingId = array();
                $lapataId = array();
                $wantedId = array();
                $criminalId = array();
                $finalcount = 0;
                curl_close($curl);
                if(count($faceresponse) > 0)
                {
                    if(count($faceresponse['output']) > 0)
                    {
                        foreach($faceresponse['output'] as $k=>$v)
                        {
                            $split = explode('_',$v);
                            if($split[0] == 'GEN')
                            {
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $user = $this->db->get('user')->result_array();
                                if(count($user) > 0)
                                {
                                    foreach($user as $k1=>$v1)
                                    {
                                        array_push($userId,$v1['uid']);
                                        $finalcount++;
                                    }
                                }else{
                                    $getAadharImageId = $this->db->query('select * from user where aadharImageId="'.$v.'"')->result_array();
                                    if(count($getAadharImageId) > 0)
                                    {
                                        foreach($getAadharImageId as $k1=>$v1)
                                        {
                                            if(strtolower($_POST['gender']) == strtolower($v1['gender']))
                                            {
                                                if(strtotime($v1['aadharExpiryDate']) >= strtotime(date('Y-m-d')))
                                                {
                                                    array_push($userId,$v1['uid']);
                                                    $finalcount++;   
                                                }
                                            }
                                        }   
                                    }
                                }
                            }
                            if($split[0] == 'Missing')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('isFound',0);
                                $missingperson = $this->db->get('missingperson')->result_array();
                                if(count($missingperson) > 0)
                                {
                                    foreach($missingperson as $k1=>$v1)
                                    {
                                        array_push($missingId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'LAP')
                            {
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $this->db->where('expiryDate >=',date('Y-m-d h:i:s'));
                                $this->db->where('isFound',0);
                                $lapata = $this->db->get('unknown_person')->result_array();
                                if(count($lapata) > 0)
                                {
                                    foreach($lapata as $k1=>$v1)
                                    {
                                        array_push($lapataId,$v1['id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'Wanted')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('status','Active');
                                $wanted = $this->db->get('criminals')->result_array();
                                if(count($wanted) > 0)
                                {
                                    foreach($wanted as $k1=>$v1)
                                    {
                                        array_push($wantedId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'Criminal')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('status','Active');
                                $criminal = $this->db->get('criminals')->result_array();
                                if(count($criminal) > 0)
                                {
                                    foreach($criminal as $k1=>$v1)
                                    {
                                        array_push($criminalId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                        }
                    }
                }
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                
                $faceresponse = json_decode(curl_exec($curl),true);
                if(count($faceresponse['output']) > 0)
                {
                    foreach($faceresponse['output'] as $k1=>$v1)
                    {
                        $this->db->where('isFinalSubmitted',1);
                        $this->db->or_where('imageId',$v1);
                        $this->db->or_where('imageId1',$v1);
                        $this->db->or_where('imageId2',$v1);
                        $getUnknownDetail = $this->db->get('unknown_person')->result_array();
                        if(count($getUnknownDetail) > 0)
                        {
                            foreach($getUnknownDetail as $k=>$v)
                            {
                                if($v['isFound'] == 0)
                                {
                                    array_push($unknownId,$v['id']);
                                    $finalcount++;
                                }
                            }
                        }   
                    }
                }
                if($finalcount > 0)
                {
                    if(count($lapataId) > 0)
                    {
                        foreach($lapataId as $k=>$v)
                        {
                            if($k == 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$v)->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Lapata',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Lapata',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    if(count($unknownId) > 0)
                    {
                        foreach($unknownId as $k=>$v)
                        {
                            if($k == 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$v)->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    $insertdata = array(
                        'matchedLapataIds' => implode(',',$lapataId),
                        'matchedWantedIds' => implode(',',$wantedId),
                        'matchedCriminalIds' => implode(',',$criminalId),
                        'matchedMissingIds' => implode(',',$missingId),
                        'matchedUserIds' => implode(',',$userId),
                        'matchedUnknownIds' => implode(',',$unknownId),
                        'mainPhoto' => $newImagePath
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$insertdata);
                    $response = array(
                        'status' => 'success',
                        'personName' => $personName,
                        'isWanted' => $isWanted,
                        'isCriminal' => $isCriminal,
                        'isLapata' => $isLapata,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => $isDobCorrect,
                        'isGenderCorrect' => $isGenderCorrect,
                        'message' => 'Person Found',
                        'isMissing' => $isMissing,
                        'isRegistered' => $isUserFound,
                        'image' => $userphoto,
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }else{
                    $response = array(
                        'status' => 'success',
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }
            }
            
        }
    }

    function saveSession()
    {
        $insertData = array(
            'response' => json_encode($_SESSION),
            'dateCreated' => date('Y-m-d H:i:s A')
        );
        $this->db->insert('savedSession',$insertData);
        echo "<script>alert('Record Inserted Successfully');</script>";
    }

    function viewAllFaqs()
    {
        $page_data['data'] = $this->db->query('select * from faqTypes where Status=1')->result_array();
        $page_data['page_name'] = 'viewAllFaqs';
        $this->load->view('new_landing_page/index', $page_data);
    }

    function faqs($slug)
    {
        $Name = str_replace('-', ' ', $slug);
        $getDetail = $this->db->query('select * from faqTypes where EnglishName="'.$Name.'"')->result_array();
        $page_data['page_name'] = 'faqs';
        $page_data['typeData'] = $getDetail[0];
        $page_data['faqData'] = $this->db->query('select * from faq where typeId='.$page_data['typeData']['Id'])->result_array();
        $this->load->view('new_landing_page/index', $page_data);
    }

    function secondHome()
    {
        $page_data['page_name'] = 'second';
        $this->load->view('new_landing_page/index', $page_data);
    }

    function thirdHome()
    {
        $page_data['page_name'] = 'third';
        $this->load->view('new_landing_page/index', $page_data);
    }

    function finalLandingPage()
    {
        $page_data['page_name'] = 'finalLandingPage';
        $this->load->view('final_landing_page/index', $page_data);
    }

    function fourthHome()
    {
        $page_data['page_name'] = 'fourth';
        $this->load->view('new_landing_page/index', $page_data);
    }

    function destroySession()
    {
        $this->session->sess_destroy();
        redirect(base_url() . 'landing', 'refresh');
    }
    
    function getIfNotification()
    {
        if($_SESSION['login_type'] == 'user')
        {
            $getIfAlready = $this->db->query('select * from searchnotification where complainantUserType="user" and complainantUserId='.($_SESSION['user_id'] ?? 0).' and notificationBellStatus=0')->result_array();
        }else{
            $getIfAlready = $this->db->query('select * from searchnotification where complainantUserType="NonKyc" and complainantUserId='.($_SESSION['user_id'] ?? 0).' and notificationBellStatus=0')->result_array();
        }
        $count = count($getIfAlready);
        $getIfAlreadyNotification = $this->db->query('select * from Notification where userId='.($_SESSION['user_id'] ?? 0).' and notificationBellStatus=0')->result_array();
        $count += count($getIfAlreadyNotification);
        echo $count;
    }

    function sendDigiOtp()
    {
        $getUserDetail = $this->db->query('select * from digilockerUser where Id='.$_POST['digiId'])->result_array();
        $string = '0123456789';
        $string_shuffled = str_shuffle($string);
        $otp = substr($string_shuffled, 1, 4);
        $sendStatus = $this->sendMessage91Otp($getUserDetail[0]['Name'],$_POST['mobile'], $otp, $this->config->item('login_template_id'));
        if (!$sendStatus || (isset($sendStatus['status']) && $sendStatus['status'] == 'error')) {
            echo json_encode([
                'status' => 'error',
                'msg'    => isset($sendStatus['message']) ? $sendStatus['message'] : 'Failed to send OTP. Please try again later.'
            ]);
            die();
        }
        $update = $this->db->query('update digilockerUser set otp="'.$otp.'" where Id='.$getUserDetail[0]['Id']);
        if($update)
        {
            $response = array(
                'status' => 'success',
                'msg' => 'OTP Sent Successfully To - '.substr_replace($_POST['mobile'],'XXXXXXX',0,7)
            );
        }else{
            $response = array(
                'status' => 'error',
                'msg'   => 'Something Went Wrong'
            );
        }

        echo json_encode($response);
    }

    function verifyDigiOtp()
    {
        $getUserDetail = $this->db->query('select * from digilockerUser where Id='.$_POST['digiId'])->result_array();
        if($getUserDetail[0]['otp'] == $_POST['otp'])
        {
            $updateData = array(
                'mobileNumber' => $_POST['mobile'],
                'aadhar_id' => $_POST['aadhar'],
                'status' => 1
            );
            $this->db->where('Id',$_POST['digiId']);
            $this->db->update('digilockerUser',$updateData);
            $getMaxDetail = $this->db->query('select max(uid) as Id from user')->result_array();
            $username = '';
            if(isset($getUserDetail[0]['Name']))
            {
                $explode = explode(' ',$getUserDetail[0]['Name']);
                $username = strtolower($explode[0].''.$getMaxDetail[0]['Id'] + 1);
            }
            $insertData = array(
                'username' => $username,
                'aadhar_id' => $_POST['aadhar'],
                'alternate_mobile1' => $_POST['mobile'],
                'final_mobile_verification' => 'success',
                'date_time' => date('Y-m-d h:i:s A'),
                'dob' => $getUserDetail[0]['dob'],
                'gender' => strtoupper($getUserDetail[0]['gender']),
                'aadharname' => $getUserDetail[0]['Name'],
                'careof' => $getUserDetail[0]['careof'],
                'country' => $getUserDetail[0]['country'],
                'district' => $getUserDetail[0]['district'],
                'landmark' => $getUserDetail[0]['landmark'],
                'locality' => $getUserDetail[0]['locality'],
                'pincode' => $getUserDetail[0]['pincode'],
                'state' => $getUserDetail[0]['state'],
                'vtc' => $getUserDetail[0]['vtc'],
                'aadharphoto' => $getUserDetail[0]['aadharPhoto'],
                'digiId' => $getUserDetail[0]['digilockerId'],
                'aadharImageId' => $getUserDetail[0]['aadharImageId'],
                'aadharExpiryDate' => $getUserDetail[0]['aadharExpiryDate']
            );
            $this->db->insert('user',$insertData);
            $this->session->set_userdata('loginmob',$_POST['mobile']);
            $this->session->set_userdata('user_login', 'yes');
            $this->session->set_userdata('user_id', $this->db->insert_id());
            $this->session->set_userdata('aadhar_id', $_POST['aadhar']);
            $this->session->set_userdata('username', $username);
            $this->session->set_userdata('aadharName', $getUserDetail[0]['Name']);
            $this->session->set_userdata('login_type', 'user');
            $response = array(
                'status' => 'success',
                'username' => $username,
            );
        }else{
            $response = array(
                'status' => 'error',
                'message' => 'Invalid OTP'
            );
        }
        echo json_encode($response);
    }

    function get_digi_short_details()
    {
        $getKycAvailable = $this->db->query('select * from user where aadhar_id="'.$_POST['aadhar'].'"')->result_array();
        if(count($getKycAvailable) > 0)
        {
            $split = explode(' ', $getKycAvailable[0]['aadharname']);
            $finalName = '';
            if(count($split) > 2)
            {
                $finalName = $split[0] . ' ' . $split[count($split) - 1];
            }else{
                $finalName = $getKycAvailable[0]['aadharname'];
            }
            $finalresponse = array(
                'status' => 'already',
                'aadharPhoto' => base_url().''.$getKycAvailable[0]['aadharphoto'],
                'name' => $finalName,
            );
            echo json_encode($finalresponse);              
        }else{
            $curl = curl_init();
            curl_setopt_array($curl, [
              CURLOPT_URL => "https://api.gridlines.io/aadhaar-api/verify",
              CURLOPT_RETURNTRANSFER => true,
              CURLOPT_ENCODING => "",
              CURLOPT_MAXREDIRS => 10,
              CURLOPT_TIMEOUT => 30,
              CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
              CURLOPT_CUSTOMREQUEST => "POST",
              CURLOPT_POSTFIELDS => json_encode([
                'aadhaar_number' => $_POST['aadhar'],
                'consent' => 'Y'
              ]),
              CURLOPT_HTTPHEADER => [
                "Accept: application/json",
                "Content-Type: application/json",
                "X-API-Key: ".$this->getSettings(),
                "X-Auth-Type: API-Key"
              ],
            ]);
            
            $response = json_decode(curl_exec($curl),true);
            if(count($response) > 0)
            {
                if($response['status'] == 400 || $response['status'] == 500)
                {
                    $finalresponse = array(
                        'status' => 'error',
                        'message' => $response['error']['message']
                    );
                    echo json_encode($finalresponse);           
                }else{
                    if($response['data']['code'] == 1018)
                    {
                        $getUserDetail = $this->db->query('select * from digilockerUser where Id='.$_POST['digiId'])->result_array();
                        if(strtolower($getUserDetail[0]['state']) == strtolower($response['data']['aadhaar_data']['state']) && strtolower($getUserDetail[0]['gender']) == strtolower($response['data']['aadhaar_data']['gender']) && strtolower(substr($getUserDetail[0]['maskedAadhar'],'-4')) == strtolower(substr($_POST['aadhar'],'-4')))
                        {
                            $finalresponse = array(
                                'status' => 'success',
                            );
                            echo json_encode($finalresponse);              
                        }else{
                            $finalresponse = array(
                                'status' => 'error',
                                'message' => 'Incorrect Aadhaar'
                            );
                            echo json_encode($finalresponse);              
                        }
                    }else{
                        $getUserDetail = $this->db->query('select * from digilockerUser where Id='.$_POST['digiId'])->result_array();
                        if(strtolower($getUserDetail[0]['state']) == strtolower($response['data']['aadhaar_data']['state']) && strtolower($getUserDetail[0]['gender']) == strtolower($response['data']['aadhaar_data']['gender']) && strtolower(substr($getUserDetail[0]['maskedAadhar'],'-4')) == strtolower(substr($_POST['aadhar'],'-4')))
                        {
                            $finalresponse = array(
                                'status' => 'success',
                            );
                            echo json_encode($finalresponse);              
                        }else{
                            $finalresponse = array(
                                'status' => 'error',
                                'message' => 'Incorrect Aadhaar'
                            );
                            echo json_encode($finalresponse);              
                        }
                    }
                }
            }else{
                $finalresponse = array(
                    'status' => 'error',
                    'message' => 'Invalid Aadhar Number'
                );
                echo json_encode($finalresponse);           
            }
        }
    }

    function digilockerCallback()
    {
        if(isset($_GET['code']))
        {
            $curl = curl_init();
            curl_setopt_array($curl, array(
              CURLOPT_URL => 'https://api.digitallocker.gov.in/public/oauth2/2/token',
              CURLOPT_RETURNTRANSFER => true,
              CURLOPT_ENCODING => '',
              CURLOPT_MAXREDIRS => 10,
              CURLOPT_TIMEOUT => 0,
              CURLOPT_FOLLOWLOCATION => true,
              CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
              CURLOPT_CUSTOMREQUEST => 'POST',
              CURLOPT_POSTFIELDS => 'code='.$_GET['code'].'&grant_type=authorization_code&client_id=MHA136549B&client_secret=760bd272aaff40996367&redirect_uri=https%3A%2F%2Fkhoji.in%2FdigilockerCallback&code_verifier=ANXS4OMH4MRU2SY5YP2XETL52ILM390HAU6W9ABWV64',
              CURLOPT_HTTPHEADER => array(
                'Content-Type: application/x-www-form-urlencoded'
              ),
            ));

            $response = json_decode(curl_exec($curl),true);
            $_SESSION['access_token'] = $response['access_token'];
            $_SESSION['scope'] = $response['scope'];
            $curl = curl_init();
            curl_setopt_array($curl, array(
              CURLOPT_URL => 'https://api.digitallocker.gov.in/public/oauth2/1/user',
              CURLOPT_RETURNTRANSFER => true,
              CURLOPT_ENCODING => '',
              CURLOPT_MAXREDIRS => 10,
              CURLOPT_TIMEOUT => 0,
              CURLOPT_FOLLOWLOCATION => true,
              CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
              CURLOPT_CUSTOMREQUEST => 'GET',
              CURLOPT_HTTPHEADER => array(
                'Authorization: Bearer '.$response['access_token']
              ),
            ));

            $userResponse = json_decode(curl_exec($curl),true);
            curl_close($curl);
            if(isset($userResponse['error']))
            {
                $this->session->set_flashdata('error',$userResponse['error_description']);
                return redirect(base_url().'complete-your-kyc','refresh');
            }else{
                $checkIfAlready = $this->db->query('select * from digilockerUser where digilockerId="'.$userResponse['digilockerid'].'" and status = 1')->result_array();
                if(count($checkIfAlready) > 0)
                {
                    $getUserDetail = $this->db->query('select * from user where digiId="'.$userResponse['digilockerid'].'"')->result_array();
                    if(count($getUserDetail) == 0)
                    {
                        $getMaxDetail = $this->db->query('select max(uid) as Id from user')->result_array();
                        $username = '';
                        if(isset($checkIfAlready[0]['Name']))
                        {
                            $explode = explode(' ',$checkIfAlready[0]['Name']);
                            $username = strtolower($explode[0].''.$getMaxDetail[0]['Id'] + 1);
                        }
                        $insertData = array(
                            'username' => $username,
                            'aadhar_id' => $checkIfAlready[0]['aadhar_id'],
                            'alternate_mobile1' => $checkIfAlready[0]['mobileNumber'],
                            'final_mobile_verification' => 'success',
                            'date_time' => date('Y-m-d h:i:s A'),
                            'dob' => $checkIfAlready[0]['dob'],
                            'gender' => strtoupper($checkIfAlready[0]['gender']),
                            'aadharname' => $checkIfAlready[0]['Name'],
                            'careof' => $checkIfAlready[0]['careof'],
                            'country' => $checkIfAlready[0]['country'],
                            'district' => $checkIfAlready[0]['district'],
                            'landmark' => $checkIfAlready[0]['landmark'],
                            'locality' => $checkIfAlready[0]['locality'],
                            'pincode' => $checkIfAlready[0]['pincode'],
                            'state' => $checkIfAlready[0]['state'],
                            'vtc' => $checkIfAlready[0]['vtc'],
                            'aadharphoto' => $checkIfAlready[0]['aadharPhoto'],
                            'digiId' => $checkIfAlready[0]['digilockerId'],
                            'aadharImageId' => $checkIfAlready[0]['aadharImageId'],
                            'aadharExpiryDate' => $checkIfAlready[0]['aadharExpiryDate'],
                        );
                        $this->db->insert('user',$insertData);
                        $this->session->set_userdata('loginmob',$checkIfAlready[0]['mobileNumber']);
                        $this->session->set_userdata('user_login', 'yes');
                        $this->session->set_userdata('user_id', $this->db->insert_id());
                        $this->session->set_userdata('aadhar_id', $checkIfAlready[0]['aadhar_id']);
                        $this->session->set_userdata('username', $username);
                        $this->session->set_userdata('aadharName', $checkIfAlready[0]['Name']);
                        $this->session->set_userdata('login_type', 'user');
                    }else{
                        $this->session->set_userdata('loginmob',$checkIfAlready[0]['mobileNumber']);
                        $this->session->set_userdata('user_login', 'yes');
                        $this->session->set_userdata('user_id', $getUserDetail[0]['uid']);
                        $this->session->set_userdata('aadhar_id', $checkIfAlready[0]['aadhar_id']);
                        $this->session->set_userdata('username', $getUserDetail[0]['username']);
                        $this->session->set_userdata('aadharName', $checkIfAlready[0]['Name']);
                        $this->session->set_userdata('login_type', 'user');
                    }
                    $getUserDetail = $this->db->query('select * from user where digiId="'.$userResponse['digilockerid'].'"')->result_array();
                    $this->session->set_flashdata('already','You are already a registered user.');
                    $split = explode(' ',$getUserDetail[0]['aadharname']);
                    $finalName = '';
                    if(count($split) > 2)
                    {
                        $finalName = $split[0] . ' ' . $split[count($split) - 1];
                    }else{
                        $finalName = $getUserDetail[0]['aadharname'];
                    }
                    $this->session->set_flashdata('alreadyName',$finalName);
                    $this->session->set_flashdata('alreadyPhoto',base_url().''.$getUserDetail[0]['aadharphoto']);
                    redirect(base_url().'user-dashboard','refresh');
                }else{
                    $checkIfAlready = $this->db->query('select * from digilockerUser where digilockerId="'.$userResponse['digilockerid'].'"')->result_array();
                    if(count($checkIfAlready) > 0)
                    {
                        $this->session->set_userdata('digilockerid',$userResponse['digilockerid']);
                        redirect(base_url().'digilocker-step2','refresh');     
                    }else{
                        $curl = curl_init();
                        curl_setopt_array($curl, array(
                          CURLOPT_URL => 'https://api.digitallocker.gov.in/public/oauth2/3/xml/eaadhaar',
                          CURLOPT_RETURNTRANSFER => true,
                          CURLOPT_ENCODING => '',
                          CURLOPT_MAXREDIRS => 10,
                          CURLOPT_TIMEOUT => 0,
                          CURLOPT_FOLLOWLOCATION => true,
                          CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                          CURLOPT_CUSTOMREQUEST => 'GET',
                          CURLOPT_HTTPHEADER => array(
                            'Authorization: Bearer '.$response['access_token']
                          ),
                        ));

                        $xmlResponse = curl_exec($curl);

                        curl_close($curl);
                        $xml=simplexml_load_string($xmlResponse);
                        $json = json_encode($xml);
                        $data = json_decode($json, true);
                        if($data['CertificateData']['KycRes']['UidData']['@attributes']['uid'] != NULL)
                        {
                            $imageData = base64_decode($data['CertificateData']['KycRes']['UidData']['Pht']);
                            $imageId = time().''.rand(0,10000).'.jpg';
                            $aadharImageId = 'GEN_'.time().''.rand(0,10000);
                            $path = FCPATH . 'upload/digilocker/' . $imageId;
                            file_put_contents($path, $imageData);
                            $insertData = array(
                                'maskedAadhar' => $data['CertificateData']['KycRes']['UidData']['@attributes']['uid'],
                                'digilockerId' => $userResponse['digilockerid'],
                                'Name' => $data['CertificateData']['KycRes']['UidData']['Poi']['@attributes']['name'],
                                'careof' => $data['CertificateData']['KycRes']['UidData']['Poa']['@attributes']['co'],
                                'country' => $data['CertificateData']['KycRes']['UidData']['Poa']['@attributes']['country'],
                                'district' => $data['CertificateData']['KycRes']['UidData']['Poa']['@attributes']['dist'],
                                'landmark' => $data['CertificateData']['KycRes']['UidData']['Poa']['@attributes']['lm'],
                                'locality' => $data['CertificateData']['KycRes']['UidData']['Poa']['@attributes']['loc'],
                                'pincode' => $data['CertificateData']['KycRes']['UidData']['Poa']['@attributes']['pc'],
                                'state' => $data['CertificateData']['KycRes']['UidData']['Poa']['@attributes']['state'],
                                'vtc' => $data['CertificateData']['KycRes']['UidData']['Poa']['@attributes']['vtc'],
                                'aadharPhoto' => 'upload/digilocker/'.$imageId,
                                'dob' => date('Y-m-d',strtotime($data['CertificateData']['KycRes']['UidData']['Poi']['@attributes']['dob'])),
                                'gender' => $data['CertificateData']['KycRes']['UidData']['Poi']['@attributes']['gender'] == 'M' ? 'Male' : 'Female',
                                'aadharImageId' => $aadharImageId,
                                'aadharExpiryDate' => date('Y-m-d',strtotime('+1 month'))
                            );
                            $curl = curl_init();
                            $postdata = json_encode(array(
                                "collection_id" => "shivaguptabcakhoji4",
                                "image_id" => $aadharImageId,
                                "image_url" => base_url().'upload/digilocker/'.$imageId
                            ));
                            curl_setopt_array($curl, array(
                                CURLOPT_URL => 'https://wtlpo2vyxzv4ncm7lhgielfwnm0ivuex.lambda-url.ap-south-1.on.aws/',
                                CURLOPT_RETURNTRANSFER => true,
                                CURLOPT_ENCODING => '',
                                CURLOPT_MAXREDIRS => 10,
                                CURLOPT_TIMEOUT => 0,
                                CURLOPT_FOLLOWLOCATION => true,
                                CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                                CURLOPT_CUSTOMREQUEST => 'POST',
                                CURLOPT_POSTFIELDS => $postdata,
                                CURLOPT_HTTPHEADER => array(
                                    'Content-Type: application/json',
                                    'Authorization: '.$this->getSettings('facematchtoken')
                                ),
                            ));
                            
                            curl_exec($curl);
                            $this->db->insert('digilockerUser',$insertData);
                            $this->session->set_userdata('digilockerid',$userResponse['digilockerid']);
                            redirect(base_url().'digilocker-step2','refresh');     
                        }else{
                            $this->session->set_flashdata('error',"Your KYC is pending. Please register with aadhar number only.");
                            return redirect(base_url().'complete-your-kyc','refresh');
                        }
                    }
                }
            }
        }else{
            $this->load->view('landing_page/digilockerCallback');    
        }
    }

    function digilockerCustomLogin()
    {
        $page_data['page_name'] = 'digilockerCustomLogin';
        $this->load->view('landing_page/index', $page_data);
    }

    function newHome()
    {
        $page_data['page_name'] = 'shiva_sir';
        $this->load->view('new_landing_page/index', $page_data);
    }

    function digilockerLogin()
    {
        $page_data['page_name'] = 'digilockerLogin';
        $this->load->view('landing_page/index', $page_data);
    }

    function digilockerStep2()
    {
        $page_data['page_name'] = 'digilockerStep2';
        $this->load->view('landing_page/index', $page_data);   
    }

    function insertSlashAfterTwoCharacters($input) {
        return $input[0].''.$input[1].'-'.$input[2].''.$input[3].'-'.$input[4].''.$input[5].''.$input[6].''.$input[7];
    }

    function tempCollect()
    {
        $files = glob('upload/unknownperson/*');
        $fileUrls = [];

        foreach ($files as $file) {
            if($file == 'upload/unknownperson/nonkyc' || $file == 'upload/unknownperson/watermark' || $file == 'upload/unknownperson/kyc')
            {

            }else{
                $fileUrls[] = "https://khoji.in/".$file;
            }
        }
        if(count($fileUrls) > 0)
        {
            foreach($fileUrls as $k=>$v)
            {
                $curl = curl_init();
                $imageId = basename($v);
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_id" => $imageId,
                    "image_url" => $v
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://wtlpo2vyxzv4ncm7lhgielfwnm0ivuex.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken')
                  ),
                ));

                $response = json_decode(curl_exec($curl),true);
            }
        }
    }

    function tempCollect1()
    {
        $files = glob('upload/profile/facematch/*');
        $fileUrls = [];

        foreach ($files as $file) {
            $fileUrls[] = "https://khoji.in/".$file;
        }
        if(count($fileUrls) > 0)
        {
            foreach($fileUrls as $k=>$v)
            {
                $curl = curl_init();
                $imageId = basename($v);
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_id" => $imageId,
                    "image_url" => $v
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://wtlpo2vyxzv4ncm7lhgielfwnm0ivuex.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken')
                  ),
                ));

                $response = json_decode(curl_exec($curl),true);
            }
        }
    }
    
    public function getIfNotificationPage()
    {
        $userId = $_SESSION['user_id'];
        $loginType = $_SESSION['login_type'];
        $lastId = $this->input->get('last_id');
        $lastId = is_numeric($lastId) ? $lastId : 0;
        $firstLoad = $this->input->get('first_load');

        $finalData = [];
        $limit = 100;

        // --------------------------
        //  Fetch SEARCH Notifications
        // --------------------------
        $this->db->select('*');
        $this->db->from('searchnotification');
        $this->db->where('status', 'Active');
        $this->db->where('complainantUserType', $loginType);
        $this->db->where('complainantUserId', $userId);

        if ($firstLoad) {
            $this->db->order_by('Id', 'DESC');
            $this->db->limit($limit);
        } else {
            $this->db->where('Id >', $lastId);
            $this->db->order_by('Id', 'ASC');
        }

        $searchNotifs = $this->db->get()->result_array();

        foreach ($searchNotifs as &$s) {
            $s['type'] = 'search';
            if (file_exists($s['searchPhoto'])) {
                $s['searchImage'] = $s['searchPhoto'];
            } else {
                $s['searchImage'] = 'assets/images/male.png';
            }

            // Fetch right-side photo
            $photo = null;
            if ($s['searchType'] == 'Special') {
                $row = $this->db->get_where('mahakumbhSpecial', ['id' => $s['searchedAppNumber']])->row_array();
            } elseif ($s['searchType'] == 'Mahakumbh') {
                $row = $this->db->get_where('mahakumbhMember', ['id' => $s['searchedAppNumber']])->row_array();
            } elseif ($s['searchType'] == 'FunnelMissing') {
                $row = $this->db->get_where('funnel_missing', ['id' => $s['searchedAppNumber']])->row_array();
            } elseif ($s['searchType'] == 'FunnelFamily') {
                $row = $this->db->get_where('funnelfamily', ['id' => $s['searchedAppNumber']])->row_array();
            } else {
                $row = $this->db->get_where('unknown_person', ['Application_no' => $s['searchedAppNumber']])->row_array();
            }

            if (!empty($row['Photo'])) {
                if (!file_exists(FCPATH . $row['Photo'])) {
                    $photo = 'assets/images/male.png';
                } else {
                    $photo = $row['Photo'];
                }
            }

            $s['detailPhoto'] = $photo;
            $finalData[] = $s;
        }

        // --------------------------
        //  Fetch NORMAL Notifications
        // --------------------------
        $this->db->select('*');
        $this->db->from('Notification');
        $this->db->where('status', 'Active');
        $this->db->where('type', $loginType);
        $this->db->where('userId', $userId);

        if ($firstLoad) {
            $this->db->order_by('Id', 'DESC');
            $this->db->limit($limit);
        } else {
            $this->db->where('Id >', $lastId);
            $this->db->order_by('Id', 'ASC');
        }

        $normalNotifs = $this->db->get()->result_array();

        foreach ($normalNotifs as &$n) {
            $n['type'] = 'normal';
            if (file_exists($n['searchPhoto'])) {
                $n['searchImage'] = $n['searchPhoto'];
            } else {
                $n['searchImage'] = 'assets/images/male.png';
            }

            if (!empty($n['detailPhoto']) && !file_exists(FCPATH . $n['detailPhoto'])) {
                $n['detailPhoto'] = 'assets/images/male.png';
            }

            $finalData[] = $n;
        }

        // --------------------------
        //  Always send latest max Id
        // --------------------------
        $latestSearchId = $this->db->select_max('Id')->get('searchnotification')->row()->Id ?? 0;
        $latestNormalId = $this->db->select_max('Id')->get('Notification')->row()->Id ?? 0;
        $latestId = max($latestSearchId, $latestNormalId);

        // --------------------------
        //  Sort combined data
        // --------------------------
        usort($finalData, function ($a, $b) {
            return $a['Id'] <=> $b['Id'];
        });

        echo json_encode([
            'status' => 'success',
            'data'   => $finalData,
            'latest' => $latestId
        ]);
    }
	
	function refundPolicy()
	{
		$page_data['page_name'] = 'refundPolicy';
        $this->load->view('landing_page/index', $page_data);   
	}
	
	function termsOfUse()
	{
		$page_data['page_name'] = 'termsOfUse';
        $this->load->view('landing_page/index', $page_data);   
	}
	
	function privacyPolicy()
	{
		$page_data['page_name'] = 'privacyPolicy';
        $this->load->view('landing_page/index', $page_data);   
	}

    function shippingDelivery()
    {
        $page_data['page_name'] = 'shippingDelivery';
        $this->load->view('landing_page/index', $page_data);   
    }

    function showPaymentModels()
    {
        $page_data['page_name'] = 'showPaymentModels';
        $this->load->view('landing_page/index', $page_data);   
    }

    function logintype()
    {
        $page_data['page_name'] = 'logintype';
        $this->load->view('landing_page/index', $page_data);   
    }
    
    function facematch($para1 = '')
    {
        if($para1 == 'do_upload')
        {
            $name = $_FILES["file1"]["name"];
            $ext = end((explode(".", $name)));
            $mainphoto = 'upload/facematch/mainphoto/'.time().''.rand(0,10000).'.'.$ext;
            move_uploaded_file($_FILES['file1']['tmp_name'], $mainphoto);    
            $insertdata = array(
                'mainPhoto' => $mainphoto
            );
            
            if($this->db->insert('facematch',$insertdata))
            {
                $lastId = $this->db->insert_id();
                $otherImages = array();
                for($i=0;$i<count($_FILES['file2']['name']);$i++)
                {
                    $name = $_FILES["file2"]["name"][$i];
                    $ext = end((explode(".", $name)));
                    $filename = 'upload/facematch/substitutes/'.time().''.rand(0,10000).'.'.$ext;
                    move_uploaded_file($_FILES['file2']['tmp_name'][$i], $filename);
                    array_push($otherImages,$filename);
                }
                if(count($otherImages) == count($_FILES['file2']['name']))
                {
                    $otherconf = array();
                    for($i=0;$i<count($otherImages);$i++)
                    {
                        $curl = curl_init();
                        curl_setopt_array($curl, array(
                          CURLOPT_URL => 'http://13.201.28.118',
                          CURLOPT_RETURNTRANSFER => true,
                          CURLOPT_ENCODING => '',
                          CURLOPT_MAXREDIRS => 10,
                          CURLOPT_TIMEOUT => 0,
                          CURLOPT_FOLLOWLOCATION => true,
                          CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                          CURLOPT_CUSTOMREQUEST => 'POST',
                          CURLOPT_POSTFIELDS => 'image1='.base_url().''.$mainphoto.'&image2='.base_url().''.$otherImages[$i],
                          CURLOPT_HTTPHEADER => array(
                            'Content-Type: application/x-www-form-urlencoded'
                          ),
                        ));
                        
                        $response = json_decode(curl_exec($curl),true);
                        if($response['message'] != 'Internal Server Error')
                        {
                            if($response['confidence'] >= $this->getSettings('ourFRTThreshold'))
                            {
                                $response['url'] = base_url().''. $otherImages[$i];
                                array_push($otherconf,$response);
                                curl_close($curl);      
                            }
                        }else
                        {
                            $finalResponse = array(
                                'status' => 'error',
                                'message' => $response['message']
                            );
                            echo json_encode($finalResponse);   
                            die();
                        }
        
                    }
                    $updatedata = array(
                        'otherPhotos' => json_encode($otherImages),
                        'result' => json_encode($otherconf)
                    );
                    $this->db->where('Id',$lastId);
                    $update = $this->db->update('facematch',$updatedata);
                    if($update)
                    {
                        $html = '<div class="row">';
                        for($i=0;$i<count($otherconf);$i++)
                        {
                            $html .= '<div class="col-auto mt-3"><img src="'.$otherconf[$i]['url'].'" style="width:200px;height:200px;"><h5>Confidence:- '.$otherconf[$i]['confidence'].'%</h5></div>';   
                        }
                        $html .= '</div>';
                        $finalResponse = array(
                            'mainPhoto' => base_url().''.$mainphoto,
                            'status' => 'success',
                            'html' => $html,
                            'message' => 'Faces Compared Successfully'
                        );
                        echo json_encode($finalResponse);         
                    }else{
                        $finalResponse = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                        echo json_encode($finalResponse);       
                    }
                }else{
                    $finalResponse = array(
                        'status' => 'error',
                        'message' => 'Some files not uploaded'
                    );
                    echo json_encode($finalResponse);   
                }
            }else{
                $finalResponse = array(
                    'status' => 'error',
                    'message' => 'Something Went Wrong'
                );
                echo json_encode($finalResponse);   
            }
        } else {
            $page_data['page_name'] = 'facematch';
            $this->load->view('landing_page/index', $page_data);
        }
    }
    
    function facematchSearch($para1 = '')
    {
        if($para1 == 'do_upload')
        {
            $name = $_FILES["file1"]["name"];
            $ext = end((explode(".", $name)));
            $mainphoto = 'upload/facematch/mainphoto/'.time().''.rand(0,10000).'.'.$ext;
            move_uploaded_file($_FILES['file1']['tmp_name'], $mainphoto);    
            $insertdata = array(
                'mainPhoto' => $mainphoto
            );
            
            if($this->db->insert('facematch',$insertdata))
            {
                $lastId = $this->db->insert_id();
                $otherImages = array();
                $getGeneralAadhar = $this->db->query('select * from user where final_mobile_verification="success"')->result_array();
                foreach($getGeneralAadhar as $k=>$v)
                {
                    if($v['facematchphoto'] != NULL)
                    {
                        array_push($otherImages,$v['facematchphoto']);
                    }
                }
                $otherconf = array();
                for($i=0;$i<count($otherImages);$i++)
                {
                    $curl = curl_init();
                    curl_setopt_array($curl, array(
                      CURLOPT_URL => 'http://13.201.28.118',
                      CURLOPT_RETURNTRANSFER => true,
                      CURLOPT_ENCODING => '',
                      CURLOPT_MAXREDIRS => 10,
                      CURLOPT_TIMEOUT => 0,
                      CURLOPT_FOLLOWLOCATION => true,
                      CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                      CURLOPT_CUSTOMREQUEST => 'POST',
                      CURLOPT_POSTFIELDS => 'image1='.base_url().''.$mainphoto.'&image2='.base_url().''.$otherImages[$i],
                      CURLOPT_HTTPHEADER => array(
                        'Content-Type: application/x-www-form-urlencoded'
                      ),
                    ));
                    
                    $response = json_decode(curl_exec($curl),true);
                    if($response['message'] != 'Internal Server Error')
                    {
                        if($response['confidence'] >= $this->getSettings('ourFRTThreshold'))
                        {
                            $response['url'] = base_url().''. $otherImages[$i];
                            array_push($otherconf,$response);
                            curl_close($curl);      
                        }
                    }else
                    {
                        $finalResponse = array(
                            'status' => 'error',
                            'message' => $response['message']
                        );
                        echo json_encode($finalResponse);   
                        die();
                    }
                }
                $updatedata = array(
                    'otherPhotos' => json_encode($otherImages),
                    'result' => json_encode($otherconf)
                );
                $this->db->where('Id',$lastId);
                $update = $this->db->update('facematch',$updatedata);
                if($update)
                {
                    $html = '<div class="row">';
                    for($i=0;$i<count($otherconf);$i++)
                    {
                        $html .= '<div class="col-auto mt-3"><img src="'.$otherconf[$i]['url'].'" style="width:200px;height:200px;"><h5>Confidence:- '.$otherconf[$i]['confidence'].'%</h5></div>';   
                    }
                    $html .= '</div>';
                    $finalResponse = array(
                        'status' => 'success',
                        'html' => $html,
                        'message' => 'Faces Compared Successfully'
                    );
                    echo json_encode($finalResponse);         
                }else{
                    $finalResponse = array(
                        'status' => 'error',
                        'message' => 'Something Went Wrong'
                    );
                    echo json_encode($finalResponse);       
                }
            }else{
                $finalResponse = array(
                    'status' => 'error',
                    'message' => 'Some files not uploaded'
                );
                echo json_encode($finalResponse);   
            }
        } else {
            $page_data['page_name'] = 'facematchSearch';
            $this->load->view('landing_page/index', $page_data);
        }
    }
    
    function sendNotificationToUser()
    {
        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N'");
        $query_res = $query->result();
        
        
        foreach ($query_res as $query_res_data) {
        $registrationIds[] =$query_res_data->token;
        }
        
        $url ="https://fcm.googleapis.com/fcm/send";
        $fields=array(
            "registration_ids"=>$registrationIds,
            'data' => array("msg"=>"Khoji"),
            'priority' => 'high',
            "click_action"=>base_url(),
            "notification"=>array(
                "body"=>"one person is going to talk to you",
                "title"=>"Khoji",
                "sound" => base_url().'assets/buzzer.mp3'
            )   
        );
        $headers=array(
            'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
            'Content-Type:application/json'
        );
        $ch=curl_init();
        curl_setopt($ch,CURLOPT_URL,$url);
        curl_setopt($ch,CURLOPT_POST,true);
        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
        $result=curl_exec($ch);
        print_r($result);
        curl_close($ch);
    }
    
    function sendNotification()
    {
        $token = $this->input->post('token');
        if(isset($token) && !empty($token))
        {
            $data = array(
                'token' => $token,
                'delete_status'=>'N',
                'created_at' => date('y-m-d H:i:s'),
            );
            $this->db->insert('notification_tokens_tbl', $data);
            $insert_id= $this->db->insert_id();
            $_SESSION['fcmtokenId'] = $insert_id;
            if ($insert_id != '') {
                $data = array(
                'status' => true,
                'msg' => 'Record # '.$insert_id.' saved successfully. Thank you!'
                );
            }else {
                $data = array(
                    'status' => false,
                    'msg' => 'Record not save.'
                );
            }
        } else {
                $data = array(
                'status' => false,
                'msg' => 'Token not set.'
                );
        }
        echo json_encode($data);
    }
    
    function markNotificationAsRead()
    {
        $getIfAlready = $this->db->query('update searchnotification set status="Inactive" where complainantUserType="'.$_SESSION['login_type'].'" and complainantUserId='.$_SESSION['user_id']);
        $getIfAlready = $this->db->query('update Notification set status="Inactive" where userId='.$_SESSION['user_id']);
    }
    
    function markRingtoneOff()
    {
        $getIfAlready = $this->db->query('update searchnotification set notificationBellStatus=1 where complainantUserType="'.$_SESSION['login_type'].'" and complainantUserId='.$_SESSION['user_id']);
        $getIfAlready = $this->db->query('update Notification set notificationBellStatus=1 where userId='.$_SESSION['user_id']);
    }
    
    public function index()
    {
        // $getLapataDetails = $this->db->query('select * from unknown_person where awsEventName="All"')->result_array();
        // if(count($getLapataDetails) > 0)
        // {
        //     foreach($getLapataDetails as $k=>$v)
        //     {
        //         $getIfAlready = $this->db->query('select * from uploadtransactions where idNumber="'.$v['aadharNumber'].'" and userId='.$v['userId'])->result_array();
        //         if(count($getIfAlready) > 0)
        //         {
        //             continue;
        //         }else{
        //             $getPackageDetails = $this->db->query('select * from packages where Id=4')->result_array();
        //             $insertdata = array(
        //                 'userId' => $v['userId'],
        //                 'type' => 'lapata',
        //                 'expiryDate' => date('Y-m-d',strtotime('+'.($getPackageDetails[0]['validity']).' days',strtotime($v['dateCreated']))),
        //                 'dateCreated' => date('Y-m-d H:i:s A'),
        //                 'idNumber' => $v['aadharNumber'],
        //                 'amount' => 30,
        //                 'packageId' => 4,
        //             );
        //             $this->db->insert('uploadtransactions', $insertdata);
        //         }
        //     }
        // }

        $page_data['page_name'] = 'fourth';
        $this->load->view('new_landing_page/index', $page_data);
    }

    function verifyNonKycOtp()
    {
        $getIfAlready = $this->db->query('select * from nonKycUser where uid="'.$_SESSION['guestId'].'"')->result_array();
        if($getIfAlready[0]['otp'] == $_POST['otp'])
        {
            $update = $this->db->query('update nonKycUser set final_mobile_verification="success" where uid='.$getIfAlready[0]['uid']);
            $_SESSION['landingMob'] = $getIfAlready[0]['registration_mobile'];
            $_SESSION['user_id'] = $getIfAlready[0]['uid'];
            $this->session->set_userdata('gender', $getIfAlready[0]['gender']);
            $_SESSION['aadharName'] = $getIfAlready[0]['aadharname'];
            if($_POST['aadharmobileNumber'] != null && $_POST['aadharmobileNumber'] != 'null' && !empty($_POST['aadharmobileNumber']))
            {
                $this->session->set_userdata('loginmob',$_POST['aadharmobileNumber']);
            }else{
                $this->session->set_userdata('loginmob',$getIfAlready[0]['registration_mobile']);
            }
            $this->session->set_userdata('user_login', 'yes');
            $this->session->set_userdata('login_type', 'NonKyc');
            $isFinal = 0;
            if($getIfAlready[0]['finalStepStatus'] == 'success')
            {
                $isFinal = 1;
            }
            $response = array(
                'isFinal' => $isFinal,
                'status' => 'success'
            );
        }else{
            $response = array(
                'status' => 'error',
                'message' => 'OTP Invalid'
            );
        }
        echo json_encode($response);
    }

    function saveFinalProfileStep()
    {
        if(isset($_POST['day']))
        {
            $_POST['dob'] = $_POST['day'] . '-' . $_POST['month'].'-'.$_POST['year'];
        }
        $updatedata = array(
            'dob' => date('Y-m-d',strtotime($_POST['dob'])),
            'gender' => $_POST['gender'],
            'aadharname' => $_POST['aadharname'],
            'state' => ($_POST['state'] == 'All' ? NULL : $_POST['state']),
            'district' => ($_POST['district'] == '' ? NULL : $_POST['district']),
            'finalStepStatus' => 'success',
            'specialType' => (isset($_POST['specialType']) ? $_POST['specialType'] : NULL)
        );
        $this->db->where('registration_mobile',$_SESSION['landingMob']);
        $this->db->update('nonKycUser',$updatedata);
        $getIfAlready = $this->db->query('select * from nonKycUser where registration_mobile="'.$_SESSION['landingMob'].'"')->result_array();
        $_SESSION['user_id'] = $getIfAlready[0]['uid'];
        $this->session->set_userdata('gender', $getIfAlready[0]['gender']);
        $_SESSION['aadharName'] = $getIfAlready[0]['aadharname'];
        $this->session->set_userdata('user_login', 'yes');
        $this->session->set_userdata('login_type', 'NonKyc');
        if(isset($_POST['specialType']))
        {
            $_SESSION['isFunnel'] = 1;
        }
    }

    function getIdDataAccordingly()
    {
        switch($_POST['idType'])
        {
            case 'Aadhaar':
                if(strlen($_POST['idNumber']) == 12)
                {
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                      CURLOPT_URL => "https://api.gridlines.io/aadhaar-api/verify",
                      CURLOPT_RETURNTRANSFER => true,
                      CURLOPT_ENCODING => "",
                      CURLOPT_MAXREDIRS => 10,
                      CURLOPT_TIMEOUT => 30,
                      CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                      CURLOPT_CUSTOMREQUEST => "POST",
                      CURLOPT_POSTFIELDS => json_encode([
                        'aadhaar_number' => $_POST['idNumber'],
                        'consent' => 'Y'
                      ]),
                      CURLOPT_HTTPHEADER => [
                        "Accept: application/json",
                        "Content-Type: application/json",
                        "X-API-Key: ".$this->getSettings(),
                        "X-Auth-Type: API-Key"
                      ],
                    ]);
                    
                    $response = json_decode(curl_exec($curl),true);
                    if(count($response) > 0)
                    {
                        if($response['status'] == 400 || $response['status'] == 500)
                        {
                            $finalresponse = array(
                                'status' => 'error',
                                'message' => $response['error']['message']
                            );
                            echo json_encode($finalresponse);           
                        }else{
                            if($response['data']['code'] == 1018)
                            {
                                $finalresponse = array(
                                    'status' => 'success',
                                    'gender' => ucFirst(strtolower($response['data']['aadhaar_data']['gender'])),
                                    'state' => ucFirst($response['data']['aadhaar_data']['state'])
                                );
                                echo json_encode($finalresponse);              
                            }else{
                                $finalresponse = array(
                                    'status' => 'success',
                                    'gender' => ucFirst(strtolower($response['data']['aadhaar_data']['gender'])),
                                    'state' => ucFirst($response['data']['aadhaar_data']['state'])
                                );
                                echo json_encode($finalresponse);           
                            }
                        }
                    }else{
                        $finalresponse = array(
                            'status' => 'invalid',
                            'message' => 'Invalid Aadhar Number'
                        );
                        echo json_encode($finalresponse);           
                    }
                }else{
                    $finalresponse = array(
                        'status' => 'invalid',
                        'message' => 'Please enter 12 digit aadhar number'
                    );
                    echo json_encode($finalresponse);           
                }
                break;
            case 'PAN':
                if(strlen($_POST['idNumber']) == '10')
                {
                    $curl = curl_init();
                    $postdata = json_encode(array(
                        'pan_number' => $_POST['idNumber'],
                        'consent' => 'Y'
                    ));
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                      CURLOPT_URL => "https://api.gridlines.io/pan-api/fetch-detailed",
                      CURLOPT_RETURNTRANSFER => true,
                      CURLOPT_ENCODING => "",
                      CURLOPT_MAXREDIRS => 10,
                      CURLOPT_TIMEOUT => 30,
                      CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                      CURLOPT_CUSTOMREQUEST => "POST",
                      CURLOPT_POSTFIELDS => $postdata,
                      CURLOPT_HTTPHEADER => [
                        "Content-Type: application/json",
                        "X-API-Key: ".$this->getSettings(),
                        "X-Auth-Type: API-Key"
                      ],
                    ]);

                    $result = json_decode(curl_exec($curl),true);
                    if($result['status'] == 200)
                    {
                        if($result['data']['code'] == 1000)
                        {
                            if(isset($result['data']['pan_data']['name']))
                            {
                                $finalresponse = array(
                                    'status' => 'success',
                                    'name' => (isset($result['data']['pan_data']['name']) ? $result['data']['pan_data']['name'] : ($result['data']['pan_data']['first_name'] .' '. $result['data']['pan_data']['middle_name'].' '.$result['data']['pan_data']['last_name'])),
                                );
                                echo json_encode($finalresponse);
                            }else{
                                $panName = $result['data']['pan_data']['first_name'].' '.$result['data']['pan_data']['middle_name'].' '.$result['data']['pan_data']['last_name'];
                                $finalresponse = array(
                                    'status' => 'success',
                                    'name' => $panName,
                                );
                                echo json_encode($finalresponse);
                            }
                        }else{
                            $finalresponse = array(
                                'status' => 'error',
                                'message' => $result['data']['message']
                            );    
                            echo json_encode($finalresponse);
                        }
                    }else{
                        $finalresponse = array(
                            'status' => 'error',
                            'message' => $result['error']['message']
                        );    
                        echo json_encode($finalresponse);
                    }
                    curl_close($curl);
                }else{
                    $finalresponse = array(
                        'status' => 'invalid',
                        'message' => 'Please enter 10 digit PAN number'
                    );
                    echo json_encode($finalresponse);           
                }
                break;
            case 'DL':
                $curl = curl_init();
                $postdata = json_encode(array(
                    'driving_license_number' => $_POST['idNumber'],
                    'date_of_birth' => date('Y-m-d',strtotime($_POST['dob'])),
                    'consent' => 'Y'
                ));
                curl_setopt_array($curl, [
                    CURLOPT_URL => "https://api.gridlines.io/dl-api/fetch",
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => "",
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 30,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => "POST",
                    CURLOPT_POSTFIELDS => $postdata,
                    CURLOPT_HTTPHEADER => [
                        "Content-Type: application/json",
                        "X-API-Key: ".$this->getSettings(),
                        "X-Auth-Type: API-Key"
                    ],
                ]);

                $response = json_decode(curl_exec($curl),true);
                if($response['status'] == 200)
                {
                    if($response['data']['code'] == 1000)
                    {
                        if(isset($response['data']['driving_license_data']['name']))
                        {
                            $finalresponse = array(
                                'status' => 'success',
                                'name' => (isset($response['data']['driving_license_data']['name']) ? $response['data']['driving_license_data']['name'] : NULL),
                                'state' => (isset($response['data']['driving_license_data']['rto_details']['state']) ? $response['data']['driving_license_data']['rto_details']['state'] : NULL),
                            );
                            echo json_encode($finalresponse);   
                        }else
                        {
                            $finalresponse = array(
                                'message' => $response['data']['message'],
                                'status' => 'error'
                            );
                            echo json_encode($finalresponse);
                        }
                    }else{
                        $finalresponse = array(
                            'message' => $response['error']['message'],
                            'status' => 'error'
                        );
                        echo json_encode($finalresponse);
                    }
            }
            else{
                $finalresponse = array(
                    'status' => 'error',
                    'message' => $result['error']['message']
                );    
                echo json_encode($finalresponse);
            }
            curl_close($curl);
            break;
        }
    }

    function step1GuestNew()
    {
        if(isset($_SESSION['guestId']))
        {
            $getIfAlready = $this->db->query('select * from nonKycUser where registration_mobile="'.$_SESSION['landingMob'].'"')->result_array();
            if($getIfAlready[0]['finalStepStatus'] == 'success')
            {
                redirect(base_url(),'refresh');
            }
            $page_data['page_name'] = 'step1GuestNew';
            $this->load->view('other_landing_page/index', $page_data);
        }else{
            redirect(base_url(),'refresh');
        }
    }

    function step1GuestFamily()
    {
        if(isset($_SESSION['guestId']))
        {
            $getIfAlready = $this->db->query('select * from nonKycUser where registration_mobile="'.$_SESSION['landingMob'].'"')->result_array();
            if($getIfAlready[0]['finalStepStatus'] == 'success')
            {
                redirect(base_url(),'refresh');
            }
            $page_data['page_name'] = 'step1GuestFamily';
            $this->load->view('other_landing_page/index', $page_data);
        }else{
            redirect(base_url(),'refresh');
        }
    }

    function step1Guest()
    {
        if(isset($_SESSION['guestId']))
        {
            $getIfAlready = $this->db->query('select * from nonKycUser where registration_mobile="'.$_SESSION['landingMob'].'"')->result_array();
            if($getIfAlready[0]['finalStepStatus'] == 'success')
            {
                redirect(base_url(),'refresh');
            }
            $page_data['page_name'] = 'step1Guest';
            $this->load->view('landing_page/index', $page_data);
        }else{
            redirect(base_url(),'refresh');
        }
    }

    function sendMissingMsg()
    {
        $getApplicationNumber = $this->db->query('select * from unknown_person where Application_no="'.$_POST['appNo'].'"')->result_array();
        if($_POST['type'] == 'facematch')
        {
            if($this->session->userdata('user_login') == 'yes')
            {
                if($_SESSION['login_type'] == 'NonKyc')
                {
                    if(!isset($_POST['beforeLogin']))
                    {
                        $checkIfAlready = $this->db->query('select * from callSendedMessages where isLogin = 1 and isKyc=0 and applicationNumber="'.$_POST['appNo'].'" and type="'.$_POST['type'].'" and typeId='.$_SESSION['searchFaceIdAfterLogin'])->result_array();
                    }else{
                        $checkIfAlready = $this->db->query('select * from callSendedMessages where isLogin = 1 and isKyc=1 and applicationNumber="'.$_POST['appNo'].'" and type="'.$_POST['type'].'" and typeId='.$_SESSION['searchFaceId'])->result_array();
                    }
                }else{
                    if(isset($_POST['beforeLogin']))
                    {
                        $checkIfAlready = $this->db->query('select * from callSendedMessages where isLogin = 1 and isKyc=1 and applicationNumber="'.$_POST['appNo'].'" and type="'.$_POST['type'].'" and typeId='.$_SESSION['searchFaceId'])->result_array();
                    }else{
                        $checkIfAlready = $this->db->query('select * from callSendedMessages where isLogin = 1 and isKyc=1 and applicationNumber="'.$_POST['appNo'].'" and type="'.$_POST['type'].'" and typeId='.$_SESSION['searchFaceIdAfterLogin'])->result_array();
                    }
                }
            }else{
                $checkIfAlready = $this->db->query('select * from callSendedMessages where isLogin = 0 and isKyc=0 and applicationNumber="'.$_POST['appNo'].'" and type="'.$_POST['type'].'" and typeId='.$_SESSION['searchFaceId'])->result_array();
            }
        }else{
            if($this->session->userdata('user_login') == 'yes')
            {
                if($_SESSION['login_type'] == 'NonKyc')
                {
                    if(!isset($_POST['beforeLogin']))
                    {
                        $checkIfAlready = $this->db->query('select * from callSendedMessages where isLogin = 1 and isKyc=0 and applicationNumber="'.$_POST['appNo'].'" and type="'.$_POST['type'].'" and typeId='.$_SESSION['searchId'])->result_array();
                    }else{
                        $checkIfAlready = $this->db->query('select * from callSendedMessages where isLogin = 1 and isKyc=1 and applicationNumber="'.$_POST['appNo'].'" and type="'.$_POST['type'].'" and typeId='.$_SESSION['checkId'])->result_array();
                    }
                }else{
                    if(isset($_POST['beforeLogin']))
                    {
                        $checkIfAlready = $this->db->query('select * from callSendedMessages where isLogin = 1 and isKyc=1 and applicationNumber="'.$_POST['appNo'].'" and type="'.$_POST['type'].'" and typeId='.$_SESSION['checkId'])->result_array();
                    }else{
                        $checkIfAlready = $this->db->query('select * from callSendedMessages where isLogin = 1 and isKyc=1 and applicationNumber="'.$_POST['appNo'].'" and type="'.$_POST['type'].'" and typeId='.$_SESSION['searchId'])->result_array();
                    }
                }
            }else{
                $checkIfAlready = $this->db->query('select * from callSendedMessages where isLogin = 0 and isKyc=0 and applicationNumber="'.$_POST['appNo'].'" and type="'.$_POST['type'].'" and typeId='.$_SESSION['checkId'])->result_array();
            }
        }
        if(count($checkIfAlready) > 0)
        {

        }else{
            foreach($getApplicationNumber as $k=>$v)
            {
                if($v['well1'] != NULL)
                {
                    $sendStatus = $this->sendMessage91CustomMsg($_POST['appNo'],$v['well1'],$this->config->item('active_template_id'));
                    if (!$sendStatus || (isset($sendStatus['status']) && $sendStatus['status'] == 'error')) {
                        echo json_encode([
                            'status' => 'error',
                            'msg'    => isset($sendStatus['message']) ? $sendStatus['message'] : 'Failed to send OTP. Please try again later.'
                        ]);
                        die();
                    }
                }
                if($v['well2'] != NULL)
                {
                    $sendStatus = $this->sendMessage91CustomMsg($_POST['appNo'],$v['well2'],$this->config->item('active_template_id'));
                    if (!$sendStatus || (isset($sendStatus['status']) && $sendStatus['status'] == 'error')) {
                        echo json_encode([
                            'status' => 'error',
                            'msg'    => isset($sendStatus['message']) ? $sendStatus['message'] : 'Failed to send OTP. Please try again later.'
                        ]);
                        die();
                    }
                }
                if($v['well3'] != NULL)
                {
                    $sendStatus = $this->sendMessage91CustomMsg($_POST['appNo'],$v['well3'],$this->config->item('active_template_id'));
                    if (!$sendStatus || (isset($sendStatus['status']) && $sendStatus['status'] == 'error')) {
                        echo json_encode([
                            'status' => 'error',
                            'msg'    => isset($sendStatus['message']) ? $sendStatus['message'] : 'Failed to send OTP. Please try again later.'
                        ]);
                        die();
                    }
                }
            }
            if($this->session->userdata('user_login') == 'yes')
            {
                if($_SESSION['login_type'] == 'NonKyc')
                {
                    $insertdata = array(
                        'applicationNumber'=> $_POST['appNo'],
                        'type' => $_POST['type'],
                        'typeId' => ($_POST['type'] == 'facematch' ? $_SESSION['searchFaceIdAfterLogin'] : $_SESSION['searchId']),
                        'isLogin' => 1,
                        'isKyc' => 0,
                    );
                }else{
                    if(isset($_POST['beforeLogin']))
                    {
                        $insertdata = array(
                            'applicationNumber'=> $_POST['appNo'],
                            'type' => $_POST['type'],
                            'typeId' => ($_POST['type'] == 'facematch' ? ($_SESSION['searchFaceId']) : $_SESSION['checkId']),
                            'isLogin' => 1,
                            'isKyc' => 1,
                        );
                    }else{
                        $insertdata = array(
                            'applicationNumber'=> $_POST['appNo'],
                            'type' => $_POST['type'],
                            'typeId' => ($_POST['type'] == 'facematch' ? ($_SESSION['searchFaceIdAfterLogin']) : $_SESSION['searchId']),
                            'isLogin' => 1,
                            'isKyc' => 1,
                        );
                    }
                }
            }else{
                $insertdata = array(
                    'applicationNumber'=> $_POST['appNo'],
                    'type' => $_POST['type'],
                    'typeId' => ($_POST['type'] == 'facematch' ? $_SESSION['searchFaceId'] : $_SESSION['checkId']),
                    'isLogin' => 0,
                    'isKyc' => 0,
                );
            }
            $this->db->insert('callSendedMessages',$insertdata);
        }
        echo json_encode(array(
            'status' => 'success'
        ));
    }

    function sendWithoutLoginOtp()
    {
        $getIfAlready = $this->db->query('select * from nonKycUser where registration_mobile="'.$_POST['registered_mobile'].'"')->result_array();
        if(count($getIfAlready) > 0)
        {
            $string = '0123456789';
            $string_shuffled = str_shuffle($string);
            $otp = substr($string_shuffled, 1, 4);
            $sendStatus = $this->sendMessage91Otp($_POST['registered_mobile'],$_POST['mobile'], $otp, $this->config->item('login_template_id'));
            if (!$sendStatus || (isset($sendStatus['status']) && $sendStatus['status'] == 'error')) {
                echo json_encode([
                    'status' => 'error',
                    'msg'    => isset($sendStatus['message']) ? $sendStatus['message'] : 'Failed to send OTP. Please try again later.'
                ]);
                die();
            }
            $update = $this->db->query('update nonKycUser set otp="'.$otp.'" where uid='.$getIfAlready[0]['uid']);
            if($update)
            {
                $_SESSION['guestId'] = $getIfAlready[0]['uid'];
                $response = array(
                    'status' => 'success',
                    'msg' => 'OTP Sent Successfully To - '.substr_replace($_POST['mobile'],'XXXXXXX',0,7)
                );
            }else{
                $response = array(
                    'status' => 'error',
                    'msg'   => 'Something Went Wrong'
                );
            }
        }else{
            $string = '0123456789';
            $string_shuffled = str_shuffle($string);
            $otp = substr($string_shuffled, 1, 4);
            $sendStatus = $this->sendMessage91Otp($_POST['mobile'],$_POST['mobile'], $otp, $this->config->item('login_template_id'));

            if (!$sendStatus || (isset($sendStatus['status']) && $sendStatus['status'] == 'error')) {
                echo json_encode([
                    'status' => 'error',
                    'msg'    => isset($sendStatus['message']) ? $sendStatus['message'] : 'Failed to send OTP. Please try again later.'
                ]);
                die();
            }
            // $otp = '1234';
            $insertdata = array(
                'registration_mobile' => $_POST['registered_mobile'],
                'otp' => $otp
            );
            $insert = $this->db->insert('nonKycUser',$insertdata);
            if($insert)
            {
                $_SESSION['guestId'] = $this->db->insert_id();
                $response = array(
                    'status' => 'success',
                    'msg' => 'OTP Sent Successfully To - '.substr_replace($_POST['mobile'],'XXXXXXX',0,7)
                );
            }else{
                $response = array(
                    'status' => 'error',
                    'msg'   => 'Something Went Wrong'
                );
            }
        }
        echo json_encode($response);
    }

    function sendMessage91CustomMsg($username,$mob,$templateId)
    {
        $mob = '91' . $mob;
        $url = "https://shammtech.in/api/send-message-91-sms";
        $data = [
            "applicationNumber"   => $username,
            "otp"        => $otp,
            "mob"        => $mob,
            "templateId" => $templateId,
        ];

        $ch = curl_init($url);
        curl_setopt($ch, CURLOPT_POST, true);
        curl_setopt($ch, CURLOPT_HTTPHEADER, ["Content-Type: application/json"]);
        curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($data));
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);

        $response = curl_exec($ch);

        if (curl_errno($ch)) {
            $error = curl_error($ch);
            curl_close($ch);
            return [
                "status"  => "error",
                "message" => "CURL Error: " . $error
            ];
        }

        curl_close($ch);

        // Decode Laravel API response (which already returns JSON)
        $decoded = json_decode($response, true);

        if (!$decoded) {
            return [
                "status"  => "error",
                "message" => "Invalid response from API",
                "raw"     => $response
            ];
        }

        return $decoded;
    }

    function sendMessage91Otp($username, $mob, $otp, $templateId)
    {
        $type = 'otp';
        switch ($type) {
            case 'otp':
                $mob = '91' . $mob;
                $url = "https://shammtech.in/api/send-message-91-sms";
                $data = [
                    "username"   => $username,
                    "otp"        => $otp,
                    "mob"        => $mob,
                    "templateId" => $templateId,
                ];

                $ch = curl_init($url);
                curl_setopt($ch, CURLOPT_POST, true);
                curl_setopt($ch, CURLOPT_HTTPHEADER, ["Content-Type: application/json"]);
                curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($data));
                curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);

                $response = curl_exec($ch);

                if (curl_errno($ch)) {
                    $error = curl_error($ch);
                    curl_close($ch);
                    return [
                        "status"  => "error",
                        "message" => "CURL Error: " . $error
                    ];
                }

                curl_close($ch);

                // Decode Laravel API response (which already returns JSON)
                $decoded = json_decode($response, true);

                if (!$decoded) {
                    return [
                        "status"  => "error",
                        "message" => "Invalid response from API",
                        "raw"     => $response
                    ];
                }

                return $decoded;       
                break;
            case 'active':
                $mob = '91' . $mob;
                $url = "https://shammtech.in/api/send-message-91-sms";
                $data = [
                    "applicationNumber"   => $username,
                    "otp"        => $otp,
                    "mob"        => $mob,
                    "templateId" => $templateId,
                ];

                $ch = curl_init($url);
                curl_setopt($ch, CURLOPT_POST, true);
                curl_setopt($ch, CURLOPT_HTTPHEADER, ["Content-Type: application/json"]);
                curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($data));
                curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);

                $response = curl_exec($ch);

                if (curl_errno($ch)) {
                    $error = curl_error($ch);
                    curl_close($ch);
                    return [
                        "status"  => "error",
                        "message" => "CURL Error: " . $error
                    ];
                }

                curl_close($ch);

                // Decode Laravel API response (which already returns JSON)
                $decoded = json_decode($response, true);

                if (!$decoded) {
                    return [
                        "status"  => "error",
                        "message" => "Invalid response from API",
                        "raw"     => $response
                    ];
                }

                return $decoded;
                break;
        }
    }

    public function indexNew()
    {
        // $getLapataDetails = $this->db->query('select * from unknown_person where awsEventName="All"')->result_array();
        // if(count($getLapataDetails) > 0)
        // {
        //     foreach($getLapataDetails as $k=>$v)
        //     {
        //         $getIfAlready = $this->db->query('select * from uploadtransactions where idNumber="'.$v['aadharNumber'].'" and userId='.$v['userId'])->result_array();
        //         if(count($getIfAlready) > 0)
        //         {
        //             continue;
        //         }else{
        //             $getPackageDetails = $this->db->query('select * from packages where Id=4')->result_array();
        //             $insertdata = array(
        //                 'userId' => $v['userId'],
        //                 'type' => 'lapata',
        //                 'expiryDate' => date('Y-m-d',strtotime('+'.($getPackageDetails[0]['validity']).' days',strtotime($v['dateCreated']))),
        //                 'dateCreated' => date('Y-m-d H:i:s A'),
        //                 'idNumber' => $v['aadharNumber'],
        //                 'amount' => 30,
        //                 'packageId' => 4,
        //             );
        //             $this->db->insert('uploadtransactions', $insertdata);
        //         }
        //     }
        // }
        
        $page_data['page_name'] = 'homeNew';
        $this->load->view('landing_page/index', $page_data);
    }
    
    function viewSpouseDetail()
    {
        $personName = '';
        $gender = '';
        $aadhar = '';
        $gender = '';
        $isVerified = 'No';
        $isVisible = 0;
        $age = '';
        $isWanted = 0;
        $personId = '';
        $isCriminal = 0;
        $isLapata = 0;
        $address = '';
        $lapataId = 0;
        $wantedId = array();
        $criminalId = array();
        $isUserFound = 0;
        $isMissing = 0;
        $isAadharCorrect = 0;
        $getIfPersonAvailable = $this->db->query('select * from user where aadhar_id="'.$_POST['Id'].'"')->result_array();
        $userphoto = '';
        if(count($getIfPersonAvailable) > 0)
        {
            $personId = $getIfPersonAvailable[0]['uid'];
            $isAadharCorrect = 1;
            $isVisible = $getIfPersonAvailable[0]['visibility'];
            $isVerified = 1;
            $isUserFound = 1;
            $personName = $getIfPersonAvailable[0]['aadharname'];
            $gender = $getIfPersonAvailable[0]['gender'];
            $aadhar = $getIfPersonAvailable[0]['aadhar_id'];
            $from=new DateTime(date('Y-m-d'));
            $to   = new DateTime($getIfPersonAvailable[0]['dob']);
            $age = ($from->diff($to)->y);
            $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
            $userphoto = base_url().''.(($getIfPersonAvailable[0]['aadharphoto'] != NULL) ? $getIfPersonAvailable[0]['aadharphoto'] : $getIfPersonAvailable[0]['facematchphoto']);
        }
        $response = array(
            'personId' => $personId,
            'status' => 'success',
            'personName' => $personName,
            'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
            'gender' => strtolower($gender),
            'isWanted' => $isWanted,
            'isLapata' => $isLapata,
            'isCriminal' => $isCriminal,
            'age' => $age,
            'address' => $address,
            'isVisible' => $isVisible,
            'isMissing' => $isMissing,
            'isVerified' => $isVerified,
            'isRegistered' => $isUserFound,
            'image' => ($userphoto != '' ? $userphoto : base_url().'assets/img/noimage.jpg')
        );
        echo json_encode($response);   
    }
    
    function checkvehicleregister($para1 = ''){
        if($para1 == 'do_register'){
        unset($_POST['_token']);
        $aadhar = $this->input->post('aadhar_id');
        $credential = array('aadhar_id' => $aadhar);
        $query = $this->db->get_where('user', $credential);
        if ($query->num_rows() > 0) {
            $row = $query->row();
            if($row->final_mobile_verification == 'success')
            {
                $response = array(
                    'status' => 'error',
                    'message' => 'Already Verified'
                );
                echo json_encode($response);
            }else
            {
                $curl = curl_init();
                curl_setopt_array($curl, [
                  CURLOPT_URL => "https://api.gridlines.io/aadhaar-api/boson/generate-otp",
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => "",
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 30,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => "POST",
                  CURLOPT_POSTFIELDS => '{"aadhaar_number": '.$_POST['aadhar_id'].',  "consent": "Y"}',
                  CURLOPT_HTTPHEADER => [
                    "Content-Type: application/json",
                    "X-API-Key: ".$this->getSettings(),
                    "X-Auth-Type: API-Key"
                  ],
                ]);

                $response = json_decode(curl_exec($curl),true);
                if($response['status'] == 200)
                {
                    $this->db->where('uid',$row->uid);
                    $this->db->update('user',array('registration_mobile' => $_POST['registration_mobile']));
                    $_SESSION['aadharId'] = $_POST['aadhar_id'];
                    $_SESSION['type'] = 'gridline';
                    $_SESSION['mob'] = $_POST['registration_mobile'];
                    $_SESSION['transactionId'] = $response['data']['transaction_id'];
                    $response = array(
                        'status' => 'success',
                        'message' => $response['data']['message']
                    );
                    echo json_encode($response);
                }else
                {
                    $curl = curl_init();
                    curl_setopt_array($curl, array(
                      CURLOPT_URL => 'https://api.sandbox.co.in/authenticate',
                      CURLOPT_RETURNTRANSFER => true,
                      CURLOPT_ENCODING => '',
                      CURLOPT_MAXREDIRS => 10,
                      CURLOPT_TIMEOUT => 0,
                      CURLOPT_FOLLOWLOCATION => true,
                      CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                      CURLOPT_CUSTOMREQUEST => 'POST',
                      CURLOPT_HTTPHEADER => array(
                        'x-api-key: key_live_7HUx4cSqzOZH78eml6w9G5E0hFU4VdRU',
                        'x-api-secret: secret_live_mi53PMvzGyngSI1QF7vusJrSUkpv6lbi',
                        'x-api-version: 1.0'
                      ),
                    ));
                    
                    $tokenResponse = json_decode(curl_exec($curl),true);
                    curl_close($curl);
                    if($tokenResponse['access_token'])
                    {
                        $_SESSION['access_token'] = $tokenResponse['access_token'];
                        $curl = curl_init();
                        curl_setopt_array($curl, array(
                          CURLOPT_URL => 'https://api.sandbox.co.in/kyc/aadhaar/okyc/otp',
                          CURLOPT_RETURNTRANSFER => true,
                          CURLOPT_ENCODING => '',
                          CURLOPT_MAXREDIRS => 10,
                          CURLOPT_TIMEOUT => 0,
                          CURLOPT_FOLLOWLOCATION => true,
                          CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                          CURLOPT_CUSTOMREQUEST => 'POST',
                          CURLOPT_POSTFIELDS =>'{
                          "aadhaar_number": '.$_POST['aadhar_id'].'
                        }',
                          CURLOPT_HTTPHEADER => array(
                            'Authorization: '.$tokenResponse['access_token'],
                            'x-api-key: key_live_7HUx4cSqzOZH78eml6w9G5E0hFU4VdRU',
                            'x-api-version: 1.0',
                            'Content-Type: application/json'
                          ),
                        ));
                        
                        $otpResponse = json_decode(curl_exec($curl),true);
                        curl_close($curl);
                        if(count($otpResponse) > 0)
                        {
                            if($otpResponse['code'] == 200)
                            {
                                $_SESSION['ref_id'] = $otpResponse['data']['ref_id'];
                                $this->db->where('uid',$row->uid);
                                $this->db->update('user',array('registration_mobile' => $_POST['registration_mobile']));
                                $_SESSION['aadharId'] = $_POST['aadhar_id'];
                                $_SESSION['type'] = 'sandbox';
                                $_SESSION['mob'] = $_POST['registration_mobile'];
                                $response = array(
                                    'status' => 'success',
                                    'message' => $otpResponse['data']['message']
                                );
                                echo json_encode($response);
                            }else{
                                $finalResponse = array(
                                    'status' => 'error',
                                    'message' => $otpResponse['data']['message']
                                );
                                echo json_encode($finalResponse);        
                            }
                        }else{
                            $finalResponse = array(
                                'status' => 'error',
                                'message' => $otpResponse['data']['message']
                            );
                            echo json_encode($finalResponse);        
                        }
                    }else{
                        $finalResponse = array(
                            'status' => 'error',
                            'message' => $tokenResponse['message']
                        );
                        echo json_encode($finalResponse);
                    }
                }
            }
        } else {
            $curl = curl_init();
            $postfields = json_encode(array(
                'aadhaar_number' => $_POST['aadhar_id'],
                'consent' => 'Y'
            ));
            curl_setopt_array($curl, [
              CURLOPT_URL => "https://api.gridlines.io/aadhaar-api/boson/generate-otp",
              CURLOPT_RETURNTRANSFER => true,
              CURLOPT_ENCODING => "",
              CURLOPT_MAXREDIRS => 10,
              CURLOPT_TIMEOUT => 30,
              CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
              CURLOPT_CUSTOMREQUEST => "POST",
              CURLOPT_POSTFIELDS => '{"aadhaar_number": '.$_POST['aadhar_id'].',  "consent": "Y"}',
              CURLOPT_HTTPHEADER => [
                "Content-Type: application/json",
                "X-API-Key: ".$this->getSettings(),
                "X-Auth-Type: API-Key"
              ],
            ]);

            $response = json_decode(curl_exec($curl),true);
            if($response['status'] == 200)
            {
                unset($_POST['consent']);
                $insert = $this->db->insert('user',$_POST) ;
                $_SESSION['type'] = 'gridline';
                $_SESSION['aadharId'] = $_POST['aadhar_id'];
                $_SESSION['mob'] = $_POST['registration_mobile'];
                $_SESSION['transactionId'] = $response['data']['transaction_id'];
                $response = array(
                    'status' => 'success',
                    'message' => $response['data']['message']
                );
                echo json_encode($response);
            }else
            {
                $curl = curl_init();
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://api.sandbox.co.in/authenticate',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_HTTPHEADER => array(
                    'x-api-key: key_live_7HUx4cSqzOZH78eml6w9G5E0hFU4VdRU',
                    'x-api-secret: secret_live_mi53PMvzGyngSI1QF7vusJrSUkpv6lbi',
                    'x-api-version: 1.0'
                  ),
                ));
                
                $tokenResponse = json_decode(curl_exec($curl),true);
                curl_close($curl);
                if($tokenResponse['access_token'])
                {
                    $_SESSION['access_token'] = $tokenResponse['access_token'];
                    $curl = curl_init();
                    curl_setopt_array($curl, array(
                      CURLOPT_URL => 'https://api.sandbox.co.in/kyc/aadhaar/okyc/otp',
                      CURLOPT_RETURNTRANSFER => true,
                      CURLOPT_ENCODING => '',
                      CURLOPT_MAXREDIRS => 10,
                      CURLOPT_TIMEOUT => 0,
                      CURLOPT_FOLLOWLOCATION => true,
                      CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                      CURLOPT_CUSTOMREQUEST => 'POST',
                      CURLOPT_POSTFIELDS =>'{
                      "aadhaar_number": '.$_POST['aadhar_id'].'
                    }',
                      CURLOPT_HTTPHEADER => array(
                        'Authorization: '.$tokenResponse['access_token'],
                        'x-api-key: key_live_7HUx4cSqzOZH78eml6w9G5E0hFU4VdRU',
                        'x-api-version: 1.0',
                        'Content-Type: application/json'
                      ),
                    ));
                    
                    $otpResponse = json_decode(curl_exec($curl),true);
                    curl_close($curl);
                    if(count($otpResponse) > 0)
                    {
                        if($otpResponse['code'] == 200)
                        {
                            unset($_POST['consent']);
                            $insert = $this->db->insert('user',$_POST) ;
                            $_SESSION['aadharId'] = $_POST['aadhar_id'];
                            $_SESSION['mob'] = $_POST['registration_mobile'];
                            $_SESSION['ref_id'] = $otpResponse['data']['ref_id'];
                            $_SESSION['type'] = 'sandbox';
                            $response = array(
                                'status' => 'success',
                                'message' => $otpResponse['data']['message']
                            );
                            echo json_encode($response);
                        }else{
                            $finalResponse = array(
                                'status' => 'error',
                                'message' => $otpResponse['data']['message']
                            );
                            echo json_encode($finalResponse);        
                        }
                    }else{
                        $finalResponse = array(
                            'status' => 'error',
                            'message' => $otpResponse['data']['message']
                        );
                        echo json_encode($finalResponse);        
                    }
                }else{
                    $finalResponse = array(
                        'status' => 'error',
                        'message' => $tokenResponse['message']
                    );
                    echo json_encode($finalResponse);
                }
            }
        }
      } else {
        $page_data['title'] = 'Register';
        $page_data['control'] = 'user';
        $page_data['page_name'] = 'checkvehicleregister';
        $this->load->view('landing_page/index', $page_data);
      }  
    }

    function getAge()
    {
        $dob = new DateTime($_POST['dob']);
        $now = new DateTime();
        $age = $now->diff($dob);
        echo $age->y; // Return years
    }
    
    function getLapataDetails()
    {
        $personName = '';
        $panNumber = '';
        $voterId = '';
        $dlNumber = '';
        $gender = '';
        $photo = base_url().'assets/images/faceicon.png';
        $state = '';
        $dob = '';
        $ageBand = '';
        $height = '';
        $religion = '';
        $district = '';
        $city = '';
        $getIfAlready = $this->db->query('select * from unknown_person where awsEventName ="All" and isKyc=1 and userId='.$_SESSION['user_id'].' and aadharNumber="'.$_POST['aadhar'].'"')->result_array();
        if(count($getIfAlready) > 0)
        {
            $isExpired = 0;
            $isActive = '';
            $status = 'Inactive';
            $getLastTransaction = $this->db->query('select * from uploadtransactions where type="lapata" and isKyc=1 and userId='.$_SESSION['user_id'].' and idNumber="'.$_POST['aadhar'].'" order by Id desc')->result_array();
            if(count($getLastTransaction) > 0)
            {
                if(strtotime(date('d-m-Y')) <= strtotime(date('d-m-Y',strtotime($getLastTransaction[0]['expiryDate']))))
                {
                    $isExpired = 1;
                }
            }else{
                if($getIfAlready[0]['isFinalSubmitted'] == 1)
                {
                    $this->db->query('delete from unknown_person where id='.$getIfAlready[0]['id']);
                }
            }
            $getIfAlready = $this->db->query('select * from unknown_person where awsEventName!="unknown" and isKyc=1 and userId='.$_SESSION['user_id'].' and aadharNumber="'.$_POST['aadhar'].'"')->result_array();
            $isFromPending = '';
            if(count($getIfAlready) > 0)
            {
                if((!$getIfAlready[0]['isFound']))
                {
                    if($isExpired == 1)
                    {
                        $isActive = 'checked';   
                    }
                }
                if($getIfAlready[0]['isFinalSubmitted'] == 0)
                {
                    $isFromPending = 'yes';
                    $isActive = 'checked';
                }
            }
            if($isFromPending != '')
            {
                $finalresponse = array(
                    'status' => 'inactive',
                    'expiryDate' => '',
                    'isFound' => $getIfAlready[0]['isFound'],
                    'personName' => $getIfAlready[0]['person_name'],
                    'aadharNumber' => substr_replace($_POST['aadhar'],' xxxxxxxx ',0,8),
                    'appNo' => $getIfAlready[0]['Application_no'],
                    'image' => base_url().''.$getIfAlready[0]['Photo'],
                    'popupPhoto' => base_url().'assets/icons/addresscard.png',
                    'id' => $getIfAlready[0]['id']
                );   
                echo json_encode($finalresponse);           
                die();
            }
            if($isActive != '')
            {
                $finalresponse = array(
                    'status' => 'already',
                    'expiryDate' => date('d/m/Y',strtotime($getIfAlready[0]['expiryDate'])),
                    'isFound' => $getIfAlready[0]['isFound'],
                    'personName' => $getIfAlready[0]['person_name'],
                    'aadharNumber' => substr_replace($_POST['aadhar'],' xxxxxxxx ',0,8),
                    'appNo' => $getIfAlready[0]['Application_no'],
                    'image' => base_url().''.$getIfAlready[0]['Photo'],
                    'popupPhoto' => base_url().'assets/icons/addresscard.png',
                    'id' => $getIfAlready[0]['id']
                );   
                echo json_encode($finalresponse);           
            }else{
                $getIfUnknown = $this->db->query('select * from unknown_person where awsEventName = "All" and aadharNumber="'.$_POST['aadhar'].'" order by id desc')->result_array();
                $getFromUser = $this->db->query('select * from user where aadhar_id="'.$_POST['aadhar'].'" and final_mobile_verification="success"')->result_array();
                if(count($getFromUser) > 0)
                {
                    $personName = $getFromUser[0]['aadharname'];
                    $getIfPanAvailable = $this->db->query('select * from panlist where userId='.$getFromUser[0]['uid'])->result_array();
                    if(count($getIfPanAvailable) > 0)
                    {
                        $panNumber = $getIfPanAvailable[0]['panNumber'];      
                    }
                    $getIfVoterAvailable = $this->db->query('select * from voterslist where userId='.$getFromUser[0]['uid'])->result_array();
                    if(count($getIfVoterAvailable) > 0)
                    {
                        $voterId = $getIfVoterAvailable[0]['voterNumber'];      
                    }
                    $getIfDlAvailable = $this->db->query('select * from dllist where userId='.$getFromUser[0]['uid'])->result_array();
                    if(count($getIfDlAvailable) > 0)
                    {
                        $dlNumber = $getIfDlAvailable[0]['dlNumber'];      
                    }
                    $gender = ucfirst(strtolower($getFromUser[0]['gender']));
                    $dob = $getFromUser[0]['dob'];
                    $getUserProperties = $this->db->query('select * from userOtherInfo where userId='.$getFromUser[0]['uid'])->result_array();
                    if(count($getUserProperties) > 0)
                    {
                        foreach($getUserProperties as $k=>$v)
                        {
                            // if($v['categoryId'] == 4)
                            // {
                            //     $getSubCategoryDetails = $this->db->query('select * from subcategories where Id='.$v['subCategoryId'])->result_array();
                            //     $ageBand = $getSubCategoryDetails[0]['hindiSubCategoryName'];
                            // }else if($v['categoryId'] == 2)
                            // {
                            //     $getSubCategoryDetails = $this->db->query('select * from subcategories where Id='.$v['subCategoryId'])->result_array();
                            //     $height = $getSubCategoryDetails[0]['hindiSubCategoryName'];
                            // }
                            if($v['categoryId'] == 2)
                            {
                                $getSubCategoryDetails = $this->db->query('select * from subcategories where Id='.$v['subCategoryId'])->result_array();
                                $height = $getSubCategoryDetails[0]['hindiSubCategoryName'];
                            }
                        }
                    }
                    $dob = $getFromUser[0]['dob'];
                    $age = $this->calculateAge($dob);
                    $getAgeBands = $this->db->query('select * from ageBands where ageBand is not null')->result_array();
                    if(count($getAgeBands) > 0)
                    {
                        foreach($getAgeBands as $k=>$v)
                        {
                            $explode = explode(',',$v['ages']);
                            if(in_array($age,$explode))
                            {
                                $ageBand = $v['ageBand'];
                                break;
                            }
                        }
                    }
                    $religion = $getFromUser[0]['religion'];
                    $state = strtoupper($getFromUser[0]['state']);
                    $district = strtoupper($getFromUser[0]['district']);
                    $city = strtoupper($getFromUser[0]['vtc']);
                    if(file_exists($getFromUser[0]['facematchphoto']))
                    {
                        $photo = ($getFromUser[0]['facematchphoto'] != NULL ? ('data:image/jpeg;base64,'.base64_encode(file_get_contents($getFromUser[0]['facematchphoto']))) : '');
                    }
                    $activeDate = '';
                    $status = 'Inactive';
                    $getLastTransaction = $this->db->query('select * from uploadtransactions where type="lapata" and isKyc=1 and userId='.$_SESSION['user_id'].' and idNumber="'.$_POST['aadhar'].'" order by Id desc')->result_array();
                    if(count($getLastTransaction) > 0)
                    {
                        if(strtotime(date('d-m-Y')) <= strtotime(date('d-m-Y',strtotime($getLastTransaction[0]['expiryDate']))))
                        {
                            $activeDate = date('d-m-Y',strtotime($getLastTransaction[0]['expiryDate']));
                        }
                    }
                    $response = array(
                        'activeDate' => $activeDate,
                        'status' => (count($getIfUnknown) > 0) ? 'inactive': 'success',
                        'id' => (count($getIfUnknown) > 0) ? $getIfUnknown[0]['id']: '',
                        'appNo' => (count($getIfUnknown) > 0) ? $getIfUnknown[0]['Application_no']: '',
                        'isRegistered'=>1,
                        'aadharNumber' => substr_replace($_POST['aadhar'],'xxxxxxxx',0,8),
                        'aadhar' => substr_replace($_POST['aadhar'],'xxxxxxxx',0,8),
                        'personName' => strtoupper($personName),
                        'voterId' => $voterId,
                        'dlNumber' => $dlNumber,
                        'panNumber' => $panNumber,
                        'gender' => $gender,
                        'popupPhoto' => base_url().''.$getFromUser[0]['aadharphoto'],
                        'dob' => $dob,
                        'age' => $ageBand,
                        'ageBand' => $age,
                        'state' => $state,
                        'district' => $district,
                        'city' => $city,
                        'height' => $height,
                        'photo' => $photo,
                        'religion' => $religion
                    );
                    echo json_encode($response);
                }else{
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                      CURLOPT_URL => "https://api.gridlines.io/aadhaar-api/verify",
                      CURLOPT_RETURNTRANSFER => true,
                      CURLOPT_ENCODING => "",
                      CURLOPT_MAXREDIRS => 10,
                      CURLOPT_TIMEOUT => 30,
                      CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                      CURLOPT_CUSTOMREQUEST => "POST",
                      CURLOPT_POSTFIELDS => json_encode([
                        'aadhaar_number' => $_POST['aadhar'],
                        'consent' => 'Y'
                      ]),
                      CURLOPT_HTTPHEADER => [
                        "Accept: application/json",
                        "Content-Type: application/json",
                        "X-API-Key: ".$this->getSettings(),
                        "X-Auth-Type: API-Key"
                      ],
                    ]);
                    
                    $response = json_decode(curl_exec($curl),true);
                    curl_close($curl);
                    $activeDate = '';
                    $getLastTransaction = $this->db->query('select * from uploadtransactions where type="lapata" and isKyc=1 and userId='.$_SESSION['user_id'].' and idNumber="'.$_POST['aadhar'].'" order by Id desc')->result_array();
                    if(count($getLastTransaction) > 0)
                    {
                        if(strtotime(date('d-m-Y')) <= strtotime(date('d-m-Y',strtotime($getLastTransaction[0]['expiryDate']))))
                        {
                            $activeDate = date('d-m-Y',strtotime($getLastTransaction[0]['expiryDate']));
                        }
                    }
                    if(count($getIfUnknown) > 0)
                    {
                        if($activeDate != '')
                        {
                            $response = array(
                                'activeDate' => $activeDate,
                                'appNo' => $getIfUnknown[0]['Application_no'],
                                'id' => $getIfUnknown[0]['id'],
                                'status' => 'inactive',
                                'isRegistered'=>1,
                                'aadharNumber' => substr_replace($_POST['aadhar'],'xxxxxxxx',0,8),
                                'aadhar' => substr_replace($_POST['aadhar'],'xxxxxxxx',0,8),
                                'personName' => strtoupper($getIfUnknown[0]['person_name']),
                                'voterId' => strtoupper($getIfUnknown[0]['voter_id']),
                                'popupPhoto' => base_url().''.$getIfUnknown[0]['Photo'],
                                'dlNumber' => strtoupper($getIfUnknown[0]['DL_no']),
                                'panNumber' => strtoupper($getIfUnknown[0]['PAN']),
                                'gender' => ucFirst(($getIfUnknown[0]['Gender'] == 'boy') ? 'Male' : ($getIfUnknown[0]['Gender'] == 'girl' ? 'Female' : 'other')),
                                'age' => ($getIfUnknown[0]['Age']),
                                'state' => strtoupper($getIfUnknown[0]['state']),
                                'district' => strtoupper($getIfUnknown[0]['district']),
                                'city' => strtoupper($getIfUnknown[0]['city']),
                                'height' => strtoupper($getIfUnknown[0]['Height']),
                                'photo' => base_url().''.$getIfUnknown[0]['Photo'],
                                'religion' => strtoupper($getIfUnknown[0]['Religion'])
                            );
                            echo json_encode($response);                           
                        }else{
                            $response = array(
                                'activeDate' => date('d-m-Y',strtotime($getIfUnknown[0]['expiryDate'])),
                                'appNo' => $getIfUnknown[0]['Application_no'],
                                'id' => $getIfUnknown[0]['id'],
                                'status' => 'planexpire',
                                'isRegistered'=>1,
                                'aadharNumber' => substr_replace($_POST['aadhar'],'xxxxxxxx',0,8),
                                'aadhar' => substr_replace($_POST['aadhar'],'xxxxxxxx',0,8),
                                'personName' => strtoupper($getIfUnknown[0]['person_name']),
                                'voterId' => strtoupper($getIfUnknown[0]['voter_id']),
                                'popupPhoto' => base_url().''.$getIfUnknown[0]['Photo'],
                                'dlNumber' => strtoupper($getIfUnknown[0]['DL_no']),
                                'panNumber' => strtoupper($getIfUnknown[0]['PAN']),
                                'gender' => ucFirst(($getIfUnknown[0]['Gender'] == 'boy') ? 'Male' : ($getIfUnknown[0]['Gender'] == 'girl' ? 'Female' : 'other')),
                                'age' => ($getIfUnknown[0]['Age']),
                                'state' => strtoupper($getIfUnknown[0]['state']),
                                'district' => strtoupper($getIfUnknown[0]['district']),
                                'city' => strtoupper($getIfUnknown[0]['city']),
                                'height' => strtoupper($getIfUnknown[0]['Height']),
                                'photo' => base_url().''.$getIfUnknown[0]['Photo'],
                                'religion' => strtoupper($getIfUnknown[0]['Religion'])
                            );
                            echo json_encode($response);                        
                        }
                    }else{
                        if(count($response) > 0)
                        {
                            if($response['status'] == 400 || $response['status'] == 500)
                            {
                                $finalresponse = array(
                                    'status' => 'error',
                                    'message' => $response['error']['message']
                                );
                                echo json_encode($finalresponse);           
                            }else{
                                if($response['data']['code'] == 1018)
                                {
                                    $finalresponse = array(
                                        'activeDate' => $activeDate,
                                        'aadhar' => substr_replace($_POST['aadhar'],' xxxxxxxx ',0,8),
                                        'status' => (count($getIfUnknown) > 0) ? 'inactive': 'success',
                                        'id' => (count($getIfUnknown) > 0) ? $getIfUnknown[0]['id']: '',
                                        'popupPhoto' => base_url().'assets/icons/addresscard.png',
                                        'isRegistered'=>0,
                                        'gender' => ucFirst(strtolower($response['data']['aadhaar_data']['gender'])),
                                        'state' => strtoupper($response['data']['aadhaar_data']['state'])
                                    );
                                    echo json_encode($finalresponse);              
                                }else{
                                    $finalresponse = array(
                                        'activeDate' => $activeDate,
                                        'aadhar' => substr_replace($_POST['aadhar'],' xxxxxxxx ',0,8),
                                        'status' => (count($getIfUnknown) > 0) ? 'inactive': 'success',
                                        'id' => (count($getIfUnknown) > 0) ? $getIfUnknown[0]['id']: '',
                                        'popupPhoto' => base_url().'assets/icons/addresscard.png',
                                        'isRegistered'=>0,
                                        'gender' => ucFirst(strtolower($response['data']['aadhaar_data']['gender'])),
                                        'state' => strtoupper($response['data']['aadhaar_data']['state'])
                                    );
                                    echo json_encode($finalresponse);           
                                }
                            }
                        }else{
                            $finalresponse = array(
                                'activeDate' => $activeDate,
                                'aadhar' => substr_replace($_POST['aadhar'],' xxxxxxxx ',0,8),
                                'status' => (count($getIfUnknown) > 0) ? 'inactive': 'success',
                                'id' => (count($getIfUnknown) > 0) ? $getIfUnknown[0]['id']: '',
                                'popupPhoto' => base_url().'assets/icons/addresscard.png',
                                'isRegistered'=>0
                            );
                            echo json_encode($finalresponse);   
                        }   
                    }
                }   
            }
        }else{
            $getIfUnknown = $this->db->query('select * from unknown_person where awsEventName = "unknown" and aadharNumber="'.$_POST['aadhar'].'" order by id desc')->result_array();
            $getIfUnknown = array();
            if(count($getIfUnknown) > 0)
            {
                if($getIfUnknown[0]['uploaded_by'] == 'police')
                {
                    $getPoliceDetail = $this->db->query('select * from police where police_id='.$getIfUnknown[0]['policeId'])->result_array();
                    $finalresponse = array(
                        'status' => 'unknown',
                        'personName' => strtoupper($getIfUnknown[0]['person_name']),
                        'aadharNumber' => substr_replace($_POST['aadhar'],'xxxxxxxx',0,8),
                        'type' => 'police',
                        'date' => date('d-m-Y h:i A',strtotime($getIfUnknown[0]['dateCreated'])),
                        'address' => strtoupper($getPoliceDetail[0]['thanaName'].' - '.$getPoliceDetail[0]['state'].', '.$getPoliceDetail[0]['district']),
                        'photo' => base_url().''.$getIfUnknown[0]['Photo'],
                        'age' => $getIfUnknown[0]['Age'],
                        'gender' => ($getIfUnknown[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                        'id' => $getIfUnknown[0]['Application_no'],
                        'registration_mobile' => (($getPoliceDetail[0]['registration_mobile'] != NULL) ? $getPoliceDetail[0]['registration_mobile'] : ''),
                        'mobile1' => (($getIfUnknown[0]['well1'] != NULL) ? $getIfUnknown[0]['well1'] : ''),
                        'mobile2' => (($getIfUnknown[0]['well2'] != NULL) ? $getIfUnknown[0]['well2'] : ''),
                        'mobile3' => (($getIfUnknown[0]['well3'] != NULL) ? $getIfUnknown[0]['well3'] : ''),
                    );   
                }else{
                    $getNgoDetail = $this->db->query('select * from ngo where Id='.$getIfUnknown[0]['ngoId'])->result_array();
                    $finalresponse = array(
                        'status' => 'unknown',
                        'personName' => strtoupper($getIfUnknown[0]['person_name']),
                        'aadharNumber' => substr_replace($_POST['aadhar'],'xxxxxxxx',0,8),
                        'type' => 'ngo',
                        'date' => date('d-m-Y h:i A',strtotime($getIfUnknown[0]['dateCreated'])),
                        'address' => strtoupper($getNgoDetail[0]['ngoName'].' - '.$getNgoDetail[0]['ngoState'].', '.$getNgoDetail[0]['ngoDistrict'].', '.$getNgoDetail[0]['ngoCity']),
                        'photo' => base_url().''.$getIfUnknown[0]['Photo'],
                        'age' => $getIfUnknown[0]['Age'],
                        'gender' => ($getIfUnknown[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                        'registration_mobile' => (($getNgoDetail[0]['ngoRegistrationNumber'] != NULL) ? $getNgoDetail[0]['ngoRegistrationNumber'] : ''),
                        'mobile1' => (($getIfUnknown[0]['well1'] != NULL) ? $getIfUnknown[0]['well1'] : ''),
                        'mobile2' => (($getIfUnknown[0]['well2'] != NULL) ? $getIfUnknown[0]['well2'] : ''),
                        'mobile3' => (($getIfUnknown[0]['well3'] != NULL) ? $getIfUnknown[0]['well3'] : ''),
                        'id' => $getIfUnknown[0]['Application_no']
                    );   
                }
                echo json_encode($finalresponse);           
            }else{
                $getFromUser = $this->db->query('select * from user where aadhar_id="'.$_POST['aadhar'].'" and final_mobile_verification="success"')->result_array();
                if(count($getFromUser) > 0)
                {
                    $personName = $getFromUser[0]['aadharname'];
                    $getIfPanAvailable = $this->db->query('select * from panlist where userId='.$getFromUser[0]['uid'])->result_array();
                    if(count($getIfPanAvailable) > 0)
                    {
                        $panNumber = $getIfPanAvailable[0]['panNumber'];      
                    }
                    $getIfVoterAvailable = $this->db->query('select * from voterslist where userId='.$getFromUser[0]['uid'])->result_array();
                    if(count($getIfVoterAvailable) > 0)
                    {
                        $voterId = $getIfVoterAvailable[0]['voterNumber'];      
                    }
                    $getIfDlAvailable = $this->db->query('select * from dllist where userId='.$getFromUser[0]['uid'])->result_array();
                    if(count($getIfDlAvailable) > 0)
                    {
                        $dlNumber = $getIfDlAvailable[0]['dlNumber'];      
                    }
                    $gender = ucfirst(strtolower($getFromUser[0]['gender']));
                    $getUserProperties = $this->db->query('select * from userOtherInfo where userId='.$getFromUser[0]['uid'])->result_array();
                    if(count($getUserProperties) > 0)
                    {
                        foreach($getUserProperties as $k=>$v)
                        {
                            if($v['categoryId'] == 4)
                            {
                                $getSubCategoryDetails = $this->db->query('select * from subcategories where Id='.$v['subCategoryId'])->result_array();
                                $ageBand = $getSubCategoryDetails[0]['hindiSubCategoryName'];
                            }else if($v['categoryId'] == 2)
                            {
                                $getSubCategoryDetails = $this->db->query('select * from subcategories where Id='.$v['subCategoryId'])->result_array();
                                $height = $getSubCategoryDetails[0]['hindiSubCategoryName'];
                            }
                        }
                    }
                    $dob = $getFromUser[0]['dob'];
                    $age = $this->calculateAge($dob);
                    $getAgeBands = $this->db->query('select * from ageBands where ageBand is not null')->result_array();
                    if(count($getAgeBands) > 0)
                    {
                        foreach($getAgeBands as $k=>$v)
                        {
                            $explode = explode(',',$v['ages']);
                            if(in_array($age,$explode))
                            {
                                $ageBand = $v['ageBand'];
                                break;
                            }
                        }
                    }
                    $religion = $getFromUser[0]['religion'];
                    $state = strtoupper($getFromUser[0]['state']);
                    $district = strtoupper($getFromUser[0]['district']);
                    $city = strtoupper($getFromUser[0]['vtc']);
                    if(file_exists($getFromUser[0]['facematchphoto']))
                    {
                        $photo = ($getFromUser[0]['facematchphoto'] != NULL ? ('data:image/jpeg;base64,'.base64_encode(file_get_contents($getFromUser[0]['facematchphoto']))) : '');
                    }
                    $activeDate = '';
                    $status = 'Inactive';
                    $getLastTransaction = $this->db->query('select * from uploadtransactions where type="lapata" and isKyc=1 and userId='.$_SESSION['user_id'].' and idNumber="'.$_POST['aadhar'].'" order by Id desc')->result_array();
                    if(count($getLastTransaction) > 0)
                    {
                        if(strtotime(date('d-m-Y')) <= strtotime(date('d-m-Y',strtotime($getLastTransaction[0]['expiryDate']))))
                        {
                            $activeDate = date('d-m-Y',strtotime($getLastTransaction[0]['expiryDate']));
                        }
                    }
                    $response = array(
                        'activeDate' => $activeDate,
                        'status' => 'success',
                        'isRegistered'=>1,
                        'aadhar' => substr_replace($_POST['aadhar'],'xxxxxxxx',0,8),
                        'personName' => strtoupper($personName),
                        'voterId' => $voterId,
                        'popupPhoto' => base_url().''.$getFromUser[0]['aadharphoto'],
                        'dlNumber' => $dlNumber,
                        'panNumber' => $panNumber,
                        'gender' => $gender,
                        'dob' => $dob,
                        'age' => $ageBand,
                        'ageBand' => $age,
                        'state' => $state,
                        'district' => $district,
                        'city' => $city,
                        'height' => $height,
                        'photo' => $photo,
                        'religion' => $religion
                    );
                    echo json_encode($response);
                }else{
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                      CURLOPT_URL => "https://api.gridlines.io/aadhaar-api/verify",
                      CURLOPT_RETURNTRANSFER => true,
                      CURLOPT_ENCODING => "",
                      CURLOPT_MAXREDIRS => 10,
                      CURLOPT_TIMEOUT => 30,
                      CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                      CURLOPT_CUSTOMREQUEST => "POST",
                      CURLOPT_POSTFIELDS => json_encode([
                        'aadhaar_number' => $_POST['aadhar'],
                        'consent' => 'Y'
                      ]),
                      CURLOPT_HTTPHEADER => [
                        "Accept: application/json",
                        "Content-Type: application/json",
                        "X-API-Key: ".$this->getSettings(),
                        "X-Auth-Type: API-Key"
                      ],
                    ]);
                    
                    $response = json_decode(curl_exec($curl),true);
                    curl_close($curl);
                    if(count($response) > 0)
                    {
                        if($response['status'] == 400 || $response['status'] == 500)
                        {
                            $finalresponse = array(
                                'status' => 'error',
                                'message' => $response['error']['message']
                            );
                            echo json_encode($finalresponse);           
                        }else{
                            $activeDate = '';
                            $getLastTransaction = $this->db->query('select * from uploadtransactions where type="lapata" and isKyc=1 and userId='.$_SESSION['user_id'].' and idNumber="'.$_POST['aadhar'].'" order by Id desc')->result_array();
                            if(count($getLastTransaction) > 0)
                            {
                                if(strtotime(date('d-m-Y')) <= strtotime(date('d-m-Y',strtotime($getLastTransaction[0]['expiryDate']))))
                                {
                                    $activeDate = date('d-m-Y',strtotime($getLastTransaction[0]['expiryDate']));
                                }
                            }
                            if($response['data']['code'] == 1018)
                            {
                                $finalresponse = array(
                                    'aadhar' => substr_replace($_POST['aadhar'],'xxxxxxxx',0,8),
                                    'activeDate' => $activeDate,
                                    'popupPhoto' => base_url().'assets/icons/addresscard.png',
                                    'status' => 'success',
                                    'isRegistered'=>0,
                                    'gender' => ucFirst(strtolower($response['data']['aadhaar_data']['gender'])),
                                    'state' => strtoupper($response['data']['aadhaar_data']['state'])
                                );
                                echo json_encode($finalresponse);              
                            }else{
                                $finalresponse = array(
                                    'popupPhoto' => base_url().'assets/icons/addresscard.png',
                                    'aadhar' => substr_replace($_POST['aadhar'],'xxxxxxxx',0,8),
                                    'status' => 'success',
                                    'activeDate' => $activeDate,
                                    'isRegistered'=>0,
                                    'gender' => ucFirst(strtolower($response['data']['aadhaar_data']['gender'])),
                                    'state' => strtoupper($response['data']['aadhaar_data']['state'])
                                );
                                echo json_encode($finalresponse);           
                            }
                        }
                    }else{
                        $activeDate = '';
                        $getLastTransaction = $this->db->query('select * from uploadtransactions where type="lapata" and isKyc=1 and userId='.$_SESSION['user_id'].' and idNumber="'.$_POST['aadhar'].'" order by Id desc')->result_array();
                        if(count($getLastTransaction) > 0)
                        {
                            if(strtotime(date('d-m-Y')) <= strtotime(date('d-m-Y',strtotime($getLastTransaction[0]['expiryDate']))))
                            {
                                $activeDate = date('d-m-Y',strtotime($getLastTransaction[0]['expiryDate']));
                            }
                        }
                        $finalresponse = array(
                            'popupPhoto' => base_url().'assets/icons/addresscard.png',
                            'status' => 'success',
                            'activeDate' => $activeDate,
                            'isRegistered'=>0,
                            'gender' => '',
                            'state' => ''
                        );
                        echo json_encode($finalresponse);   
                    }
                }   
            }
        }
    }
    
    public function all_registration()
    {
         $page_data['page_name'] = 'all_registration';
         $this->load->view('landing_page/index', $page_data);
    }
     public function all_search_pages()
    {
         $page_data['page_name'] = 'all_search_pages';
         $this->load->view('landing_page/index', $page_data);
    }
      public function make_missing_complaint()
    {
         $page_data['page_name'] = 'make_missing_complaint';
         $this->load->view('landing_page/index', $page_data);
    }
    
    function sendSearchFaceOtp()
    {
        $string = '0123456789';
        $string_shuffled = str_shuffle($string);
        $otp = substr($string_shuffled, 1, 4);
        $sendStatus = $this->sendMessage91Otp($_POST['mobile'],$_POST['mobile'], $otp, $this->config->item('login_template_id'));
        if (!$sendStatus || (isset($sendStatus['status']) && $sendStatus['status'] == 'error')) {
            echo json_encode([
                'status' => 'error',
                'msg'    => isset($sendStatus['message']) ? $sendStatus['message'] : 'Failed to send OTP. Please try again later.'
            ]);
            die();
        }
        $update = $this->db->query('update searchfacehistory set otp='.$otp.' where Id='.$_SESSION['searchFaceId']);
        if($update)
        {
            $response = array(
                'status' => 'success',
                'msg' => 'OTP Sent Successfully To - '.substr_replace($_POST['mobile'],'xxxxxx',0,7)
            );
        }else{
            $response = array(
                'status' => 'error',
                'msg'   =>  'Something Went Wrong'
            );
        }
        echo json_encode($response);
    }
    
    function checkPersonFaceNew($para = '')
    {
        if($para == '')
        {
            $page_data['control'] = 'user';
            $page_data['title'] = 'Search Person';
            if(isset($_SESSION['landingMob']))
            {
                $page_data['pn'] = 2;   
                $getFinalId = $this->db->query('select max(Id) as Id from checkperson')->result_array();
                if($getFinalId[0]['Id'] != NULL)
                {
                    $_SESSION['checkId'] = $getFinalId[0]['Id'] + 1;
                }else{
                    $_SESSION['checkId'] = 1;
                }
                $insert = $this->db->insert('checkperson',array('personMob' => $_SESSION['landingMob'],'Id' => $_SESSION['checkId']));
            }else{
                $page_data['pn'] = 1;
            }
            if(isset($_GET['pn']))
            {
                $page_data['pn'] = $_GET['pn'];    
            }
            
             $page_data['page_name'] = 'checkPersonFaceNew';
         $this->load->view('landing_page/index', $page_data);
            // $this->load->view('user/common/header',$page_data); 
            // $this->load->view('user/checkperson');
            // $this->load->view('user/common/footer'); 
        }else
        {
            if($para == 'step1')
            {
                $getPreviousDetail = $this->db->query('select * from checkperson where Id='.$_SESSION['checkId'])->result_array();
                if($getPreviousDetail[0]['otp'] == $_POST['otp'])
                {
                    $updatedata = array(
                        'personMob' => $_POST['mobileNumber'],
                        'otp' => NULL
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$updatedata);
                    $_SESSION['landingMob'] = $_POST['mobileNumber'];
                    $response['status'] = 'success';
                }else{
                    $response['status'] = 'error';
                    $response['message'] = 'Invalid OTP';
                }
                echo json_encode($response);
            }
            if($para == 'step2')
            {
                $personName = '';
                $gender = '';
                $aadhar = '';
                $gender = '';
                $isVerified = 'No';
                $isVisible = 0;
                $age = '';
                $address = '';
                $isUserFound = 0;
                $isWanted = 0;
                $isMissing = 0;
                $isGenderCorrect = 0;
                $isAadharCorrect = 0;
                $isDobCorrect = 0;
                $_POST['dob'] = $_POST['date'].'-'.$_POST['month'].'-'.$_POST['year'];
                $idNumber = '';
                if($_POST['idType'] == 'aadhar')
                {
                    $idNumber = $_POST['aadhar_id'];
                    if(strlen($_POST['aadhar_id']) != 12)
                    {
                        $response = array(
                            'status' => 'error',
                            'message' => 'Aadhar number must be 12 digit number'
                        );
                        echo json_encode($response);
                        return;
                    }
                    $getIfPersonAvailable = $this->db->query('select * from user where aadhar_id="'.$_POST['aadhar_id'].'" and gender="'.$_POST['gender'].'" and dob="'.date('Y-m-d',strtotime($_POST['dob'])).'"')->result_array();
                    $userphoto = '';
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $isVisible = $getIfPersonAvailable[0]['visibility'];
                        $isVerified = 1;
                        $isUserFound = 1;
                        $personName = $getIfPersonAvailable[0]['aadharname'];
                        $gender = $getIfPersonAvailable[0]['gender'];
                        $aadhar = $getIfPersonAvailable[0]['aadhar_id'];
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfPersonAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                        $userphoto = base_url().''.(($getIfPersonAvailable[0]['aadharphoto'] != NULL) ? $getIfPersonAvailable[0]['aadharphoto'] : $getIfPersonAvailable[0]['facematchphoto']);
                    }
                    $getMissingPerson = $this->db->query('select * from missingperson where missingaadhar="'.$_POST['aadhar_id'].'" and isFound != 1')->result_array();
                    if(count($getMissingPerson) > 0)
                    {
                        $isAadharCorrect = 1;
                        if($getMissingPerson[0]['missinggender'] != NULL)
                        {
                            if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getMissingPerson[0]['missinggender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 1;
                                    $personName = $getMissingPerson[0]['missingname'];
                                    $gender = $getMissingPerson[0]['missinggender'];
                                    $aadhar = $getMissingPerson[0]['missingaadhar'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                    $age = ($from->diff($to)->y);
                                    if(count($getIfPersonAvailable) > 0)
                                    {
                                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                    }else{
                                        $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                    }
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }else{
                            $getFullDetail = $this->db->query('select * from missingpersondetail where missingId='.$getMissingPerson[0]['Id'])->result_array();
                            if(count($getFullDetail) > 0)
                            {
                                if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                }
                                if(strtolower($getFullDetail[0]['gender']) == strtolower($_POST['gender']))
                                {
                                    $isGenderCorrect = 1;
                                    if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                        $isMissing = 1; 
                                        $personName = $getMissingPerson[0]['missingname'];
                                        $gender = $getMissingPerson[0]['missinggender'];
                                        $aadhar = $getMissingPerson[0]['missingaadhar'];
                                        $from=new DateTime(date('Y-m-d'));
                                        $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                        $age = ($from->diff($to)->y);
                                        if(count($getIfPersonAvailable) > 0)
                                        {
                                            $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                        }else{
                                            $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                        }
                                        if(count($getIfPersonAvailable) == 0)
                                        {
                                            $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                        }   
                                    }
                                }   
                            }else{
                                $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$_POST['aadhar_id'].'"')->result_array();
                                if(count($getUserDetail) > 0)
                                {
                                    if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                    }
                                    if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                                    {
                                        $isGenderCorrect = 1;
                                        if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                        {
                                            $isDobCorrect = 1;
                                            $isMissing = 1; 
                                            $personName = $getUserDetail[0]['aadharname'];
                                            $gender = $getUserDetail[0]['gender'];
                                            $aadhar = $getUserDetail[0]['aadhar_id'];
                                            $from=new DateTime(date('Y-m-d'));
                                            $to   = new DateTime($getUserDetail[0]['dob']);
                                            $age = ($from->diff($to)->y);
                                            $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                            if(count($getIfPersonAvailable) == 0)
                                            {
                                                $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                            }   
                                        }
                                    }
                                }
                            }
                        }
                    }else{
                        $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$_POST['aadhar_id'].'"')->result_array();
                        if(count($getUserDetail) > 0)
                        {
                            $isAadharCorrect = 1;
                            if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 0; 
                                    $personName = $getUserDetail[0]['aadharname'];
                                    $gender = $getUserDetail[0]['gender'];
                                    $aadhar = $getUserDetail[0]['aadhar_id'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getUserDetail[0]['dob']);
                                    $age = ($from->diff($to)->y);
                                    $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getUserDetail[0]['facematchphoto'] != NULL) ? $getUserDetail[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }
                    }
                    $insertdata = array(
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'gender' => $_POST['gender'],
                        'dob' => date('Y-m-d',strtotime($_POST['dob'])),
                        'idNumber' => $_POST['aadhar_id'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    if($update)
                    {
                        if($isGenderCorrect == 1 && $isDobCorrect == 1 && $isAadharCorrect == 1)
                        {
                            $response = array(
                                'status' => 'success',
                                'personName' => $personName,
                                'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                                'gender' => strtolower($gender),
                                'age' => $age,
                                'address' => $address,
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                                'message' => 'Person Found',
                                'isVisible' => $isVisible,
                                'isMissing' => $isMissing,
                                'isVerified' => $isVerified,
                                'isRegistered' => $isUserFound,
                                'image' => $userphoto
                            );
                            echo json_encode($response);   
                        }else{
                            $response = array(
                                'status' => 'incorrect',
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                            );
                            echo json_encode($response);   
                        }
                    }else{
                        $response = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                        echo json_encode($response);
                    }
                }
                if($_POST['idType'] == 'dl')
                {
                    $idNumber = $_POST['dlNumber'];
                    $getIfAlready = $this->db->query('select * from dllist where dlNumber="'.$idNumber.'"')->result_array();
                    if(count($getIfAlready) > 0)
                    {
                        $getIfPersonAvailable = $this->db->query('select * from user where uid='.$getIfAlready[0]['userId'])->result_array();   
                    }else{
                        $getIfPersonAvailable = array();
                    }
                    $userphoto = '';
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $isVisible = $getIfPersonAvailable[0]['visibility'];
                        $isVerified = 1;
                        $isUserFound = 1;
                        $personName = $getIfPersonAvailable[0]['aadharname'];
                        $gender = $getIfPersonAvailable[0]['gender'];
                        $aadhar = $getIfPersonAvailable[0]['aadhar_id'];
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfPersonAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                        $userphoto = base_url().''.(($getIfPersonAvailable[0]['aadharphoto'] != NULL) ? $getIfPersonAvailable[0]['aadharphoto'] : $getIfPersonAvailable[0]['facematchphoto']);
                    }
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $getMissingPerson = $this->db->query('select * from missingperson where missingaadhar="'.$getIfPersonAvailable[0]['aadhar_id'].'" and isFound != 1')->result_array();   
                    }else{
                        $getMissingPerson = array();
                    }
                    if(count($getMissingPerson) > 0)
                    {
                        $isAadharCorrect = 1;
                        if($getMissingPerson[0]['missinggender'] != NULL)
                        {
                            if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getMissingPerson[0]['missinggender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 1;
                                    $personName = $getMissingPerson[0]['missingname'];
                                    $gender = $getMissingPerson[0]['missinggender'];
                                    $aadhar = $getMissingPerson[0]['missingaadhar'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                    $age = ($from->diff($to)->y);
                                    if(count($getIfPersonAvailable) > 0)
                                    {
                                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                    }else{
                                        $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                    }
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }else{
                            $getFullDetail = $this->db->query('select * from missingpersondetail where missingId='.$getMissingPerson[0]['Id'])->result_array();
                            if(count($getFullDetail) > 0)
                            {
                                if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                }
                                if(strtolower($getFullDetail[0]['gender']) == strtolower($_POST['gender']))
                                {
                                    $isGenderCorrect = 1;
                                    if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                        $isMissing = 1; 
                                        $personName = $getMissingPerson[0]['missingname'];
                                        $gender = $getMissingPerson[0]['missinggender'];
                                        $aadhar = $getMissingPerson[0]['missingaadhar'];
                                        $from=new DateTime(date('Y-m-d'));
                                        $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                        $age = ($from->diff($to)->y);
                                        if(count($getIfPersonAvailable) > 0)
                                        {
                                            $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                        }else{
                                            $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                        }
                                        if(count($getIfPersonAvailable) == 0)
                                        {
                                            $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                        }   
                                    }
                                }   
                            }else{
                                $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$getIfPersonAvailable[0]['aadhar_id'].'"')->result_array();
                                if(count($getUserDetail) > 0)
                                {
                                    if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                    }
                                    if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                                    {
                                        $isGenderCorrect = 1;
                                        if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                        {
                                            $isDobCorrect = 1;
                                            $isMissing = 1; 
                                            $personName = $getUserDetail[0]['aadharname'];
                                            $gender = $getUserDetail[0]['gender'];
                                            $aadhar = $getUserDetail[0]['aadhar_id'];
                                            $from=new DateTime(date('Y-m-d'));
                                            $to   = new DateTime($getUserDetail[0]['dob']);
                                            $age = ($from->diff($to)->y);
                                            $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                            
                                            if(count($getIfPersonAvailable) == 0)
                                            {
                                                $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                            }   
                                        }
                                    }
                                }
                            }
                        }
                    }else{
                        if(count($getIfPersonAvailable) > 0)
                        {
                            $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$getIfPersonAvailable[0]['aadhar_id'].'"')->result_array();   
                        }else{
                            $getUserDetail = array();
                        }
                        if(count($getUserDetail) > 0)
                        {
                            $isAadharCorrect = 1;
                            if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 0; 
                                    $personName = $getUserDetail[0]['aadharname'];
                                    $gender = $getUserDetail[0]['gender'];
                                    $aadhar = $getUserDetail[0]['aadhar_id'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getUserDetail[0]['dob']);
                                    $age = ($from->diff($to)->y);
                                    $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getUserDetail[0]['facematchphoto'] != NULL) ? $getUserDetail[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }
                    }
                    $insertdata = array(
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'gender' => $_POST['gender'],
                        'dob' => date('Y-m-d',strtotime($_POST['dob'])),
                        'idNumber' => $_POST['dlNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    if($insert)
                    {
                        if($isGenderCorrect == 1 && $isDobCorrect == 1 && $isAadharCorrect == 1)
                        {
                            $response = array(
                                'status' => 'success',
                                'isVisible' => $isVisible,
                                'personName' => $personName,
                                'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                                'gender' => strtolower($gender),
                                'age' => $age,
                                'address' => $address,
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                                'message' => 'Person Found',
                                'isMissing' => $isMissing,
                                'isVerified' => $isVerified,
                                'isRegistered' => $isUserFound,
                                'image' => $userphoto
                            );
                            echo json_encode($response);   
                        }else{
                            $response = array(
                                'status' => 'incorrect',
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                            );
                            echo json_encode($response);   
                        }
                    }else{
                        $response = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                        echo json_encode($response);
                    }
                }
                if($_POST['idType'] == 'voter')
                {
                    $idNumber = $_POST['voterId'];
                    $getIfAlready = $this->db->query('select * from voterslist where voterNumber="'.$idNumber.'"')->result_array();
                    if(count($getIfAlready) > 0)
                    {
                        $getIfPersonAvailable = $this->db->query('select * from user where uid='.$getIfAlready[0]['userId'].' and gender="'.$_POST['gender'].'" and dob="'.date('Y-m-d',strtotime($_POST['dob'])).'"')->result_array();   
                    }else{
                        $getIfPersonAvailable = array();
                    }
                    $userphoto = '';
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $isVisible = $getIfPersonAvailable[0]['visibility'];
                        $isUserFound = 1;
                        $isVerified = 1;
                        $personName = $getIfPersonAvailable[0]['aadharname'];
                        $gender = $getIfPersonAvailable[0]['gender'];
                        $aadhar = $getIfPersonAvailable[0]['aadhar_id'];
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfPersonAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                        $userphoto = base_url().''.(($getIfPersonAvailable[0]['aadharphoto'] != NULL) ? $getIfPersonAvailable[0]['aadharphoto'] : $getIfPersonAvailable[0]['facematchphoto']);
                    }
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $getMissingPerson = $this->db->query('select * from missingperson where missingaadhar="'.$getIfPersonAvailable[0]['aadhar_id'].'" and isFound != 1')->result_array();   
                    }else{
                        $getMissingPerson = array();
                    }
                    if(count($getMissingPerson) > 0)
                    {
                        $isAadharCorrect = 1;
                        if($getMissingPerson[0]['missinggender'] != NULL)
                        {
                            if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getMissingPerson[0]['missinggender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 1;
                                    $personName = $getMissingPerson[0]['missingname'];
                                    $gender = $getMissingPerson[0]['missinggender'];
                                    $aadhar = $getMissingPerson[0]['missingaadhar'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                    $age = ($from->diff($to)->y);
                                    if(count($getIfPersonAvailable) > 0)
                                    {
                                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                    }else{
                                        $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                    }
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }else{
                            $getFullDetail = $this->db->query('select * from missingpersondetail where missingId='.$getMissingPerson[0]['Id'])->result_array();
                            if(count($getFullDetail) > 0)
                            {
                                if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                }
                                if(strtolower($getFullDetail[0]['gender']) == strtolower($_POST['gender']))
                                {
                                    $isGenderCorrect = 1;
                                    if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                        $isMissing = 1; 
                                        $personName = $getMissingPerson[0]['missingname'];
                                        $gender = $getMissingPerson[0]['missinggender'];
                                        $aadhar = $getMissingPerson[0]['missingaadhar'];
                                        $from=new DateTime(date('Y-m-d'));
                                        $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                        $age = ($from->diff($to)->y);
                                        if(count($getIfPersonAvailable) > 0)
                                        {
                                            $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                        }else{
                                            $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                        }
                                        if(count($getIfPersonAvailable) == 0)
                                        {
                                            $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                        }   
                                    }
                                }   
                            }else{
                                $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$getIfPersonAvailable[0]['aadhar_id'].'"')->result_array();
                                if(count($getUserDetail) > 0)
                                {
                                    if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                    }
                                    if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                                    {
                                        $isGenderCorrect = 1;
                                        if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                        {
                                            $isDobCorrect = 1;
                                            $isMissing = 1; 
                                            $personName = $getUserDetail[0]['aadharname'];
                                            $gender = $getUserDetail[0]['gender'];
                                            $aadhar = $getUserDetail[0]['aadhar_id'];
                                            $from=new DateTime(date('Y-m-d'));
                                            $to   = new DateTime($getUserDetail[0]['dob']);
                                            $age = ($from->diff($to)->y);
                                            $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                            if(count($getIfPersonAvailable) == 0)
                                            {
                                                $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                            }   
                                        }
                                    }
                                }
                            }
                        }
                    }else{
                        if(count($getIfPersonAvailable) > 0)
                        {
                            $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$getIfPersonAvailable[0]['aadhar_id'].'"')->result_array();   
                        }else{
                            $getUserDetail = array();
                        }
                        if(count($getUserDetail) > 0)
                        {
                            $isAadharCorrect = 1;
                            if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 0; 
                                    $personName = $getUserDetail[0]['aadharname'];
                                    $gender = $getUserDetail[0]['gender'];
                                    $aadhar = $getUserDetail[0]['aadhar_id'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getUserDetail[0]['dob']);
                                    $age = ($from->diff($to)->y);
                                    $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getUserDetail[0]['facematchphoto'] != NULL) ? $getUserDetail[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }
                    }
                    $insertdata = array(
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'gender' => $_POST['gender'],
                        'dob' => date('Y-m-d',strtotime($_POST['dob'])),
                        'idNumber' => $_POST['voterId'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    if($update)
                    {
                        if($isGenderCorrect == 1 && $isDobCorrect == 1 && $isAadharCorrect == 1)
                        {
                            $response = array(
                                'status' => 'success',
                                'isVisible'=> $isVisible,
                                'personName' => $personName,
                                'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                                'gender' => strtolower($gender),
                                'age' => $age,
                                'address' => $address,
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                                'message' => 'Person Found',
                                'isMissing' => $isMissing,
                                'isVerified' => $isVerified,
                                'isRegistered' => $isUserFound,
                                'image' => $userphoto
                            );
                            echo json_encode($response);   
                        }else{
                            $response = array(
                                'status' => 'incorrect',
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                            );
                            echo json_encode($response);   
                        }
                    }else{
                        $response = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                        echo json_encode($response);
                    }
                }
                if($_POST['idType'] == 'pan')
                {
                    $idNumber = $_POST['panNumber'];
                    $getIfAlready = $this->db->query('select * from panlist where panNumber="'.$idNumber.'"')->result_array();
                    if(count($getIfAlready) > 0)
                    {
                        $getIfPersonAvailable = $this->db->query('select * from user where uid='.$getIfAlready[0]['userId'])->result_array();   
                    }else{
                        $getIfPersonAvailable = array();
                    }
                    $userphoto = '';
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $isVisible = $getIfPersonAvailable[0]['visibility'];
                        $isUserFound = 1;
                        $isVerified = 1;
                        $personName = $getIfPersonAvailable[0]['aadharname'];
                        $gender = $getIfPersonAvailable[0]['gender'];
                        $aadhar = $getIfPersonAvailable[0]['aadhar_id'];
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfPersonAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                        $userphoto = base_url().''.(($getIfPersonAvailable[0]['aadharphoto'] != NULL) ? $getIfPersonAvailable[0]['aadharphoto'] : $getIfPersonAvailable[0]['facematchphoto']);
                    }
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $getMissingPerson = $this->db->query('select * from missingperson where missingaadhar="'.$getIfPersonAvailable[0]['aadhar_id'].'" and isFound != 1')->result_array();   
                    }else{
                        $getMissingPerson = array();
                    }
                    if(count($getMissingPerson) > 0)
                    {
                        $isAadharCorrect = 1;
                        if($getMissingPerson[0]['missinggender'] != NULL)
                        {
                            if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getMissingPerson[0]['missinggender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 1;
                                    $personName = $getMissingPerson[0]['missingname'];
                                    $gender = $getMissingPerson[0]['missinggender'];
                                    $aadhar = $getMissingPerson[0]['missingaadhar'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                    $age = ($from->diff($to)->y);
                                    if(count($getIfPersonAvailable) > 0)
                                    {
                                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                    }else{
                                        $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                    }
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }else{
                            $getFullDetail = $this->db->query('select * from missingpersondetail where missingId='.$getMissingPerson[0]['Id'])->result_array();
                            if(count($getFullDetail) > 0)
                            {
                                if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                }
                                if(strtolower($getFullDetail[0]['gender']) == strtolower($_POST['gender']))
                                {
                                    $isGenderCorrect = 1;
                                    if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                        $isMissing = 1; 
                                        $personName = $getMissingPerson[0]['missingname'];
                                        $gender = $getMissingPerson[0]['missinggender'];
                                        $aadhar = $getMissingPerson[0]['missingaadhar'];
                                        $from=new DateTime(date('Y-m-d'));
                                        $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                        $age = ($from->diff($to)->y);
                                        if(count($getIfPersonAvailable) > 0)
                                        {
                                            $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                        }else{
                                            $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                        }
                                        if(count($getIfPersonAvailable) == 0)
                                        {
                                            $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                        }   
                                    }
                                }   
                            }else{
                                $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$getIfPersonAvailable[0]['aadhar_id'].'"')->result_array();
                                if(count($getUserDetail) > 0)
                                {
                                    if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                    }
                                    if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                                    {
                                        $isGenderCorrect = 1;
                                        if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                        {
                                            $isDobCorrect = 1;
                                            $isMissing = 1; 
                                            $personName = $getUserDetail[0]['aadharname'];
                                            $gender = $getUserDetail[0]['gender'];
                                            $aadhar = $getUserDetail[0]['aadhar_id'];
                                            $from=new DateTime(date('Y-m-d'));
                                            $to   = new DateTime($getUserDetail[0]['dob']);
                                            $age = ($from->diff($to)->y);
                                            $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                            if(count($getIfPersonAvailable) == 0)
                                            {
                                                $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                            }   
                                        }
                                    }
                                }
                            }
                        }
                    }else{
                        if(count($getIfPersonAvailable) > 0)
                        {
                            $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$getIfPersonAvailable[0]['aadhar_id'].'"')->result_array();   
                        }else{
                            $getUserDetail = array();
                        }
                        if(count($getUserDetail) > 0)
                        {
                            $isAadharCorrect = 1;
                            if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 0; 
                                    $personName = $getUserDetail[0]['aadharname'];
                                    $gender = $getUserDetail[0]['gender'];
                                    $aadhar = $getUserDetail[0]['aadhar_id'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getUserDetail[0]['dob']);
                                    $age = ($from->diff($to)->y);
                                    $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getUserDetail[0]['facematchphoto'] != NULL) ? $getUserDetail[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }
                    }
                    $insertdata = array(
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'gender' => $_POST['gender'],
                        'dob' => date('Y-m-d',strtotime($_POST['dob'])),
                        'idNumber' => $_POST['panNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    if($update)
                    {
                        if($isGenderCorrect == 1 && $isDobCorrect == 1 && $isAadharCorrect == 1)
                        {
                            $response = array(
                                'status' => 'success',
                                'isVisible' => $isVisible,
                                'personName' => $personName,
                                'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                                'gender' => strtolower($gender),
                                'age' => $age,
                                'address' => $address,
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                                'message' => 'Person Found',
                                'isMissing' => $isMissing,
                                'isRegistered' => $isUserFound,
                                'isVerified' => $isVerified,
                                'image' => $userphoto
                            );
                            echo json_encode($response);   
                        }else{
                            $response = array(
                                'status' => 'incorrect',
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                            );
                            echo json_encode($response);   
                        }
                    }else{
                        $response = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                        echo json_encode($response);
                    }
                }   
            }
        }
    }
    
    function checkPersonFaceFive($para = '')
    {
        if($para == '')
        {
            $page_data['control'] = 'user';
            $page_data['pn'] = 1;
            if(isset($_GET['pn']))
            {
                $page_data['pn'] = $_GET['pn'];    
            }
            $page_data['page_name'] = 'checkPersonFaceFive';
            $page_data['title'] = 'Search By Face';
            $this->load->view('landing_page/index', $page_data);
        }else
        {
            if($para == 'step1')
            {
                $getFinalId = $this->db->query('select max(Id) as Id from searchfacehistory')->result_array();
                if($getFinalId[0]['Id'] != NULL)
                {
                    $_SESSION['searchFaceId'] = $getFinalId[0]['Id'] + 1;
                }else{
                    $_SESSION['searchFaceId'] = 1;
                }
                $_SESSION['searchType'] = $_POST['type'];
                if(isset($_SESSION['landingMob']))
                {
                    $insertdata = array(
                        'mobileNumber' => $_SESSION['landingMob'],
                        'Id' => $_SESSION['searchFaceId'],
                        'type' => $_POST['type'],
                    );   
                }else{
                    $insertdata = array(
                        'Id' => $_SESSION['searchFaceId'],
                        'type' => $_POST['type'],
                    );
                }
                $insert = $this->db->insert('searchfacehistory',$insertdata);
                $response = array(
                    'isMobileAvailable' => (isset($_SESSION['landingMob']) ? 1 : 0)
                );
                echo json_encode($response);
            }
            if($para == 'step2')
            {
                $getPreviousDetail = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                if($getPreviousDetail[0]['otp'] == $_POST['otp'])
                {
                    $updatedata = array(
                        'mobileNumber' => $_POST['mobileNumber'],
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$updatedata);
                    $_SESSION['landingMob'] = $_POST['mobileNumber'];
                    $response['status'] = 'success';
                }else{
                    $response['status'] = 'error';
                    $response['message'] = 'Invalid OTP';
                }
                echo json_encode($response);
            }
            if($para == 'step3')
            {
                $data = $_POST["mainPhotoSelected"];
                $image_array_1 = explode(";", $data);
                $split1 = explode('data:image/',$image_array_1[0]);
                $image_array_2 = explode(",", $image_array_1[1]);
                $data = base64_decode($image_array_2[1]);
                $imageId = time().''.rand(0,10000);
                $newImagePath = 'upload/searchFacePerson/'.$imageId.'.'.$split1[1];
                file_put_contents($newImagePath, $data);
                $curl = curl_init();
                /*
                Old Code
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://api.pixnif.com/api/v1/refresh-event?awsEventName=shivaguptabcakhoji4',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_HTTPHEADER => array(
                    'Accept: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken')
                  ),
                ));
                
                $vectorResponse = json_decode(curl_exec($curl),true);
                curl_close($curl);
                $curl = curl_init();
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://api.pixnif.com/api/v1/search-image?awsEventName=All&imageId='.$imageId.'&imageUrl='.base_url().''.$newImagePath,
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_HTTPHEADER => array(
                    'Accept: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken')
                  ),
                ));
                
                */
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                
                $faceresponse = json_decode(curl_exec($curl),true);
                $personName = '';
                $gender = '';
                $aadhar = '';
                $gender = '';
                $isVerified = 'No';
                $isVisible = 0;
                $age = '';
                $isWanted = 0;
                $isCriminal = 0;
                $wantedId = array();
                $criminalId = array();
                $address = '';
                $userphoto = '';
                $personId = 0;
                $isLapata = 0;
                $missingId = 0;
                $isUserFound = 0;
                $isMissing = 0;
                $isAadharCorrect = 0;
                $isGenderCorrect = 1;
                $isDobCorrect = 1;
                $userId = array();
                $missingId = array();
                $lapataId = array();
                $wantedId = array();
                $criminalId = array();
                $finalcount = 0;
                curl_close($curl);
                if(count($faceresponse) > 0)
                {
                    if(count($faceresponse['output']) > 0)
                    {
                        foreach($faceresponse['output'] as $k=>$v)
                        {
                            $split = explode('_',$v);
                            if($split[0] == 'GEN')
                            {
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $user = $this->db->get('user')->result_array();
                                if(count($user) > 0)
                                {
                                    foreach($user as $k1=>$v1)
                                    {
                                        array_push($userId,$v1['uid']);
                                        $finalcount++;
                                    }
                                }       
                            }
                            if($split[0] == 'Missing')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('isFound',0);
                                $missingperson = $this->db->get('missingperson')->result_array();
                                if(count($missingperson) > 0)
                                {
                                    foreach($missingperson as $k1=>$v1)
                                    {
                                        array_push($missingId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'LAP')
                            {
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $this->db->where('expiryDate >=',date('Y-m-d h:i:s'));
                                $lapata = $this->db->get('unknown_person')->result_array();
                                if(count($lapata) > 0)
                                {
                                    foreach($lapata as $k1=>$v1)
                                    {
                                        if($v['isFound'] == 0)
                                        {
                                            array_push($lapataId,$v1['id']);
                                            $finalcount++;
                                        }
                                    }
                                }
                            }
                            if($split[0] == 'Wanted')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('status','Active');
                                $wanted = $this->db->get('criminals')->result_array();
                                if(count($wanted) > 0)
                                {
                                    foreach($wanted as $k1=>$v1)
                                    {
                                        array_push($wantedId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'Criminal')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('status','Active');
                                $criminal = $this->db->get('criminals')->result_array();
                                if(count($criminal) > 0)
                                {
                                    foreach($criminal as $k1=>$v1)
                                    {
                                        array_push($criminalId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                        }
                    }
                }
                curl_close($curl);
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS =>'{"collection_id":"shivaguptabcakhoji4","image_id":"'.$imageId.'","image_url":"'.base_url().''.$newImagePath.'","threshold":'.(float)$this->getSettings('beforeLoginThreshold').'}',
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                /*
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://api.pixnif.com/api/v1/refresh-event?awsEventName=shivaguptabcakhoji4',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_HTTPHEADER => array(
                    'Accept: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken')
                  ),
                ));
                
                $vectorResponse = json_decode(curl_exec($curl),true);
                curl_close($curl);
                $curl = curl_init();
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://api.pixnif.com/api/v1/search-image?awsEventName=Unknown&imageId='.$imageId.'&imageUrl='.base_url().''.$newImagePath,
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_HTTPHEADER => array(
                    'Accept: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken')
                  ),
                ));
                */
                
                $faceresponse = json_decode(curl_exec($curl),true);
                $unknownId = array();
                if(count($faceresponse['output']) > 0)
                {
                    foreach($faceresponse['output'] as $k1=>$v1)
                    {
                        $this->db->or_where('imageId',$v1);
                        $this->db->or_where('imageId1',$v1);
                        $this->db->or_where('imageId2',$v1);
                        $getUnknownDetail = $this->db->get('unknown_person')->result_array();
                        if(count($getUnknownDetail) > 0)
                        {
                            foreach($getUnknownDetail as $k=>$v)
                            {
                                if($v['isFound'] == 0)
                                {
                                    array_push($unknownId,$v['id']);
                                    $finalcount++;
                                }
                            }
                        }   
                    }
                }
                if($finalcount > 0)
                {
                    $insertdata = array(
                        'matchedLapataIds' => implode(',',$lapataId),
                        'matchedWantedIds' => implode(',',$wantedId),
                        'matchedCriminalIds' => implode(',',$criminalId),
                        'matchedMissingIds' => implode(',',$missingId),
                        'matchedUserIds' => implode(',',$userId),
                        'matchedUnknownIds' => implode(',',$unknownId),
                        'mainPhoto' => $newImagePath
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$insertdata);
                    $response = array(
                        'status' => 'success',
                        'personName' => $personName,
                        'isWanted' => $isWanted,
                        'isCriminal' => $isCriminal,
                        'isLapata' => $isLapata,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => $isDobCorrect,
                        'isGenderCorrect' => $isGenderCorrect,
                        'message' => 'Person Found',
                        'isMissing' => $isMissing,
                        'isRegistered' => $isUserFound,
                        'image' => $userphoto,
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }else{
                    $response = array(
                        'status' => 'success',
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }
            }
            
        }
    }
    
    function checkPersonFace($para = '')
    {
        if($para == '')
        {
            $page_data['control'] = 'user';
            $page_data['pn'] = 1;
            if(isset($_GET['pn']))
            {
                if($_GET['pn'] == 2)
                {
                    $page_data['pn'] = 3;       
                }else{
                    $page_data['pn'] = $_GET['pn'];    
                }
            }
            $page_data['page_name'] = 'checkPersonFace';
            $page_data['title'] = 'Search By Face';
            $this->load->view('landing_page/index', $page_data);
        }else
        {
            if($para == 'step1')
            {
                // $getFinalId = $this->db->query('select max(Id) as Id from searchfacehistory')->result_array();
                // if($getFinalId[0]['Id'] != NULL)
                // {
                //     $_SESSION['searchFaceId'] = $getFinalId[0]['Id'] + 1;
                // }else{
                //     $_SESSION['searchFaceId'] = 1;
                // }
                $_SESSION['searchType'] = $_POST['type'];
                if(isset($_SESSION['landingMob']))
                {
                    $insertdata = array(
                        'mobileNumber' => $_SESSION['landingMob'],
                        'type' => $_POST['type'],
                    );   
                }else{
                    $insertdata = array(
                        'type' => $_POST['type'],
                    );
                }
                $insert = $this->db->insert('searchfacehistory',$insertdata);
                $_SESSION['searchFaceId'] = $this->db->insert_id();
                $response = array(
                    'isMobileAvailable' => (isset($_SESSION['landingMob']) ? 1 : 0)
                );
                echo json_encode($response);
            }
            if($para == 'step2')
            {
                $getPreviousDetail = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                if($getPreviousDetail[0]['otp'] == $_POST['otp'])
                {
                    $updatedata = array(
                        'mobileNumber' => $_POST['mobileNumber'],
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$updatedata);
                    $_SESSION['landingMob'] = $_POST['mobileNumber'];
                    $response['status'] = 'success';
                }else{
                    $response['status'] = 'error';
                    $response['message'] = 'Invalid OTP';
                }
                echo json_encode($response);
            }
            if($para == 'step3')
            {
                $data = $_POST["mainPhotoSelected"];
                $image_array_1 = explode(";", $data);
                $split1 = explode('data:image/',$image_array_1[0]);
                $image_array_2 = explode(",", $image_array_1[1]);
                $data = base64_decode($image_array_2[1]);
                $imageId = $_SESSION['searchFaceId'];
                $newImagePath = 'upload/searchFacePerson/'.$imageId.'.'.$split1[1];
                unlink($newImagePath);
                file_put_contents($newImagePath, $data);
                $curl = curl_init();
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                
                $faceresponse = json_decode(curl_exec($curl),true);
                curl_close($curl);
                $personName = '';
                $gender = '';
                $aadhar = '';
                $gender = '';
                $isVerified = 'No';
                $isVisible = 0;
                $age = '';
                $isWanted = 0;
                $isCriminal = 0;
                $wantedId = array();
                $criminalId = array();
                $address = '';
                $userphoto = '';
                $personId = 0;
                $isLapata = 0;
                $missingId = 0;
                $isUserFound = 0;
                $isMissing = 0;
                $isAadharCorrect = 0;
                $isGenderCorrect = 1;
                $isDobCorrect = 1;
                $userId = array();
                $missingId = array();
                $unknownId = array();
                $lapataId = array();
                $wantedId = array();
                $criminalId = array();
                $finalcount = 0;
                curl_close($curl);
                if(count($faceresponse) > 0)
                {
                    if(count($faceresponse['output']) > 0)
                    {
                        foreach($faceresponse['output'] as $k=>$v)
                        {
                            if($finalcount <= 5)
                            {
                                $split = explode('_',$v);
                                if($split[0] == 'GEN')
                                {
                                    $this->db->or_where('imageId',$v);
                                    $this->db->or_where('imageId1',$v);
                                    $this->db->or_where('imageId2',$v);
                                    $user = $this->db->get('user')->result_array();
                                    if(count($user) > 0)
                                    {
                                        foreach($user as $k1=>$v1)
                                        {
                                            if(strtolower($_POST['gender']) == strtolower($v1['gender']))
                                            {
                                                array_push($userId,$v1['uid']);
                                                $finalcount++;   
                                            }
                                        }
                                    }       
                                }
                                if($split[0] == 'Missing')
                                {
                                    $this->db->where('imageId',$v);
                                    $this->db->where('isFinalSubmitted',1);
                                    $this->db->where('isFound',0);
                                    $missingperson = $this->db->get('missingperson')->result_array();
                                    if(count($missingperson) > 0)
                                    {
                                        foreach($missingperson as $k1=>$v1)
                                        {
                                            array_push($missingId,$v1['Id']);
                                            $finalcount++;
                                        }
                                    }
                                }
                                if($split[0] == 'LAP')
                                {
                                    $this->db->or_where('imageId',$v);
                                    $this->db->or_where('imageId1',$v);
                                    $this->db->or_where('imageId2',$v);
                                    $lapata = $this->db->get('unknown_person')->result_array();
                                    if(count($lapata) > 0)
                                    {
                                        foreach($lapata as $k1=>$v1)
                                        {
                                            if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                            {
                                                if($v1['isFound'] == '0')
                                                {
                                                    if($v1['awsEventName'] == 'All')
                                                    {
                                                        $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                        if($gender == strtolower($v1['Gender']))
                                                        {
                                                            array_push($lapataId,$v1['id']);
                                                            $finalcount++;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                                if($split[0] == 'Wanted')
                                {
                                    $this->db->where('imageId',$v);
                                    $this->db->where('isFinalSubmitted',1);
                                    $this->db->where('status','Active');
                                    $wanted = $this->db->get('criminals')->result_array();
                                    if(count($wanted) > 0)
                                    {
                                        foreach($wanted as $k1=>$v1)
                                        {
                                            array_push($wantedId,$v1['Id']);
                                            $finalcount++;
                                        }
                                    }
                                }
                                if($split[0] == 'Criminal')
                                {
                                    $this->db->where('imageId',$v);
                                    $this->db->where('isFinalSubmitted',1);
                                    $this->db->where('status','Active');
                                    $criminal = $this->db->get('criminals')->result_array();
                                    if(count($criminal) > 0)
                                    {
                                        foreach($criminal as $k1=>$v1)
                                        {
                                            array_push($criminalId,$v1['Id']);
                                            $finalcount++;
                                        }
                                    }
                                }
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $getUnknownDetail = $this->db->get('unknown_person')->result_array();
                                if(count($getUnknownDetail) > 0)
                                {
                                    foreach($getUnknownDetail as $k1=>$v1)
                                    {
                                        if($v1['isFound'] == 0 && $v1['awsEventName'] != 'All')
                                        {
                                            $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                            if($gender == strtolower($v1['Gender']))
                                            {
                                                array_push($unknownId,$v1['id']);
                                                $finalcount++;
                                            }
                                        }
                                    }
                                }   
                            }
                        }
                    }
                }
                if($finalcount > 0)
                {
                    if(count($lapataId) > 0)
                    {
                        foreach($lapataId as $k=>$v)
                        {
                            if($k == 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$v)->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Lapata',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Lapata',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }
                                
                            }
                        }
                    }
                    if(count($unknownId) > 0)
                    {
                        foreach($unknownId as $k=>$v)
                        {
                            if($k == 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$v)->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    $insertdata = array(
                        'matchedLapataIds' => implode(',',$lapataId),
                        'matchedWantedIds' => implode(',',$wantedId),
                        'matchedCriminalIds' => implode(',',$criminalId),
                        'matchedMissingIds' => implode(',',$missingId),
                        'matchedUserIds' => implode(',',$userId),
                        'matchedUnknownIds' => implode(',',$unknownId),
                        'mainPhoto' => $newImagePath,
                        'totalResponse' => json_encode($faceresponse),
                        'gender' => $_POST['gender'],
                        'imageId' => $imageId
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$insertdata);
                    $response = array(
                        'status' => 'success',
                        'personName' => $personName,
                        'isWanted' => $isWanted,
                        'isCriminal' => $isCriminal,
                        'isLapata' => $isLapata,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => $isDobCorrect,
                        'isGenderCorrect' => $isGenderCorrect,
                        'message' => 'Person Found',
                        'isMissing' => $isMissing,
                        'isRegistered' => $isUserFound,
                        'image' => $userphoto,
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }else{
                    $response = array(
                        'status' => 'success',
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }
            }
            if($para == 'step4')
            {
                $data = $_POST["mainPhotoSelected"];
                $image_array_1 = explode(";", $data);
                $split1 = explode('data:image/',$image_array_1[0]);
                $image_array_2 = explode(",", $image_array_1[1]);
                $data = base64_decode($image_array_2[1]);
                $imageId = time().''.rand(0,10000);
                $newImagePath = 'upload/searchFacePerson/'.$imageId.'.'.$split1[1];
                file_put_contents($newImagePath, $data);
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                $faceresponse = json_decode(curl_exec($curl),true);
                $personName = '';
                $gender = '';
                $aadhar = '';
                $gender = '';
                $isVerified = 'No';
                $isVisible = 0;
                $age = '';
                $isWanted = 0;
                $isCriminal = 0;
                $wantedId = array();
                $criminalId = array();
                $address = '';
                $userphoto = '';
                $personId = 0;
                $isLapata = 0;
                $missingId = 0;
                $isUserFound = 0;
                $isMissing = 0;
                $isAadharCorrect = 0;
                $isGenderCorrect = 1;
                $isDobCorrect = 1;
                $userId = array();
                $missingId = array();
                $lapataId = array();
                $wantedId = array();
                $criminalId = array();
                $finalcount = 0;
                curl_close($curl);
                if(count($faceresponse) > 0)
                {
                    if(count($faceresponse['output']) > 0)
                    {
                        foreach($faceresponse['output'] as $k=>$v)
                        {
                            $split = explode('_',$v);
                            if($split[0] == 'GEN')
                            {
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $user = $this->db->get('user')->result_array();
                                if(count($user) > 0)
                                {
                                    foreach($user as $k1=>$v1)
                                    {
                                        array_push($userId,$v1['uid']);
                                        $finalcount++;
                                    }
                                }       
                            }
                            if($split[0] == 'Missing')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('isFound',0);
                                $missingperson = $this->db->get('missingperson')->result_array();
                                if(count($missingperson) > 0)
                                {
                                    foreach($missingperson as $k1=>$v1)
                                    {
                                        array_push($missingId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'LAP')
                            {
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $this->db->where('expiryDate >=',date('Y-m-d h:i:s'));
                                $this->db->where('isFound',0);
                                $lapata = $this->db->get('unknown_person')->result_array();
                                if(count($lapata) > 0)
                                {
                                    foreach($lapata as $k1=>$v1)
                                    {
                                        array_push($lapataId,$v1['id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'Wanted')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('status','Active');
                                $wanted = $this->db->get('criminals')->result_array();
                                if(count($wanted) > 0)
                                {
                                    foreach($wanted as $k1=>$v1)
                                    {
                                        array_push($wantedId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'Criminal')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('status','Active');
                                $criminal = $this->db->get('criminals')->result_array();
                                if(count($criminal) > 0)
                                {
                                    foreach($criminal as $k1=>$v1)
                                    {
                                        array_push($criminalId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                        }
                    }
                }
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Accept: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                
                $faceresponse = json_decode(curl_exec($curl),true);
                $unknownId = array();
                if(count($faceresponse['output']) > 0)
                {
                    foreach($faceresponse['output'] as $k1=>$v1)
                    {
                        $this->db->or_where('imageId',$v1);
                        $this->db->or_where('imageId1',$v1);
                        $this->db->or_where('imageId2',$v1);
                        $getUnknownDetail = $this->db->get('unknown_person')->result_array();
                        if(count($getUnknownDetail) > 0)
                        {
                            foreach($getUnknownDetail as $k=>$v)
                            {
                                if($v['isFound'] == 0)
                                {
                                    array_push($unknownId,$v['id']);
                                    $finalcount++;
                                }
                            }
                        }   
                    }
                }
                if($finalcount > 0)
                {
                    if(count($lapataId) > 0)
                    {
                        foreach($lapataId as $k=>$v)
                        {
                            if($k == 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$v)->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Lapata',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Lapata',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    if(count($unknownId) > 0)
                    {
                        foreach($unknownId as $k=>$v)
                        {
                            if($k == 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$v)->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    $insertdata = array(
                        'matchedLapataIds' => implode(',',$lapataId),
                        'matchedWantedIds' => implode(',',$wantedId),
                        'matchedCriminalIds' => implode(',',$criminalId),
                        'matchedMissingIds' => implode(',',$missingId),
                        'matchedUserIds' => implode(',',$userId),
                        'matchedUnknownIds' => implode(',',$unknownId),
                        'mainPhoto' => $newImagePath
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$insertdata);
                    $response = array(
                        'status' => 'success',
                        'personName' => $personName,
                        'isWanted' => $isWanted,
                        'isCriminal' => $isCriminal,
                        'isLapata' => $isLapata,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => $isDobCorrect,
                        'isGenderCorrect' => $isGenderCorrect,
                        'message' => 'Person Found',
                        'isMissing' => $isMissing,
                        'isRegistered' => $isUserFound,
                        'image' => $userphoto,
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }else{
                    $response = array(
                        'status' => 'success',
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }
            }
            
        }
    }

    function createOverallHistory()
    {
        $getDetails = $this->db->query('select * from checkperson where Id='.$_SESSION['checkId'])->result_array();
        $unknownIds = array();
        $lapataIds = array();
            switch($getDetails[0]['idType']){
                case 'aadhar' :
                    $getLapataDetails = $this->db->query('select id from unknown_person where isFound=0 and expiryDate >="'.date('Y-m-d H:i:s A').'" and awsEventName="All" and aadharNumber="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getLapataDetails) > 0)
                    {
                        foreach($getLapataDetails as $k=>$v)
                        {
                            array_push($lapataIds,$v['id']);       
                        }
                    }
                    $getUnknownDetails = $this->db->query('select id from unknown_person where isFound=0 and awsEventName != "All" and aadharNumber="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getUnknownDetails) > 0)
                    {
                        foreach($getUnknownDetails as $k=>$v)
                        {
                            array_push($unknownIds,$v['id']);       
                        }
                    }
                    break;
                case 'pan' :
                    $getLapataDetails = $this->db->query('select id from unknown_person where isFound=0 and expiryDate >="'.date('Y-m-d H:i:s A').'" and awsEventName="All" and PAN="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getLapataDetails) > 0)
                    {
                        foreach($getLapataDetails as $k=>$v)
                        {
                            array_push($lapataIds,$v['id']);       
                        }
                    }
                    $getUnknownDetails = $this->db->query('select id from unknown_person where isFound=0 and awsEventName != "All" and PAN="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getUnknownDetails) > 0)
                    {
                        foreach($getUnknownDetails as $k=>$v)
                        {
                            array_push($unknownIds,$v['id']);       
                        }
                    }
                    break;
                case 'voter' :
                    $getLapataDetails = $this->db->query('select id from unknown_person where isFound=0 and expiryDate >="'.date('Y-m-d H:i:s A').'" and awsEventName="All" and voter_id="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getLapataDetails) > 0)
                    {
                        foreach($getLapataDetails as $k=>$v)
                        {
                            array_push($lapataIds,$v['id']);       
                        }
                    }
                    $getUnknownDetails = $this->db->query('select id from unknown_person where isFound=0 and awsEventName != "All" and voter_id="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getUnknownDetails) > 0)
                    {
                        foreach($getUnknownDetails as $k=>$v)
                        {
                            array_push($unknownIds,$v['id']);       
                        }
                    }
                    break;
                case 'dl' :
                    $getLapataDetails = $this->db->query('select id from unknown_person where isFound=0 and expiryDate >="'.date('Y-m-d H:i:s A').'" and awsEventName="All" and DL_no="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getLapataDetails) > 0)
                    {
                        foreach($getLapataDetails as $k=>$v)
                        {
                            array_push($lapataIds,$v['id']);       
                        }
                    }
                    $getUnknownDetails = $this->db->query('select id from unknown_person where isFound=0 and awsEventName != "All" and DL_no="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getUnknownDetails) > 0)
                    {
                        foreach($getUnknownDetails as $k=>$v)
                        {
                            array_push($unknownIds,$v['id']);       
                        }
                    }
                    break;
                case 'gold' :
                    $getGoldDetails = $this->db->query('select * from unknownPersonGold where goldHUID="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getGoldDetails) > 0)
                    {
                        foreach($getGoldDetails as $k=>$v)
                        {
                            $getLapataDetails = $this->db->query('select id from unknown_person where isFound=0 and expiryDate >="'.date('Y-m-d H:i:s A').'" and awsEventName="All" and id='.$v['unknownId'])->result_array();   
                            if(count($getLapataDetails) > 0)
                            {
                                array_push($lapataIds,$v['unknownId']);          
                            }
                            $getUnknownDetails = $this->db->query('select id from unknown_person where isFound=0 and awsEventName != "All" and id='.$v['unknownId'])->result_array();
                            if(count($getUnknownDetails) > 0)
                            {
                                array_push($unknownIds,$v['unknownId']);       
                            }
                        }
                    }
                    break;
                case 'vehicle' :
                    $getLapataDetails = $this->db->query('select id from unknown_person where isFound=0 and expiryDate >="'.date('Y-m-d H:i:s A').'" and awsEventName="All" and vehicle_no="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getLapataDetails) > 0)
                    {
                        foreach($getLapataDetails as $k=>$v)
                        {
                            array_push($lapataIds,$v['id']);       
                        }
                    }
                    $getUnknownDetails = $this->db->query('select id from unknown_person where isFound=0 and awsEventName != "All" and vehicle_no="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getUnknownDetails) > 0)
                    {
                        foreach($getUnknownDetails as $k=>$v)
                        {
                            array_push($unknownIds,$v['id']);       
                        }
                    }
                    break;
            }
            $insertData = array(
                'dateCreated' => date('Y-m-d H:i:s'),
                'userId' => $_SESSION['user_id'],
                'missingIds' => implode(',',$lapataIds),
                'unknownIds' => implode(',',$unknownIds),
                'searchQuery' => $getDetails[0]['idNumber'],
                'searchType' => $getDetails[0]['idType']
            );
            $insertOverall = $this->db->insert('overallHistory',$insertData);
    }

    function sendIdentityNotification()
    {
        $getDetails = $this->db->query('select * from checkperson where Id='.$_SESSION['checkId'])->result_array();
        $this->db->where('Id',$_SESSION['checkId']);
        $this->db->update('checkperson',array('isFirstSent'=>1));
        $isLogin = 0;
        if($this->session->userdata('user_login') == 'yes'){
            $isLogin = 1;
            $lapataIds = array();
            $unknownIds = array();
            
            switch($getDetails[0]['idType']){
                case 'aadhar' :
                    $getLapataDetails = $this->db->query('select id from unknown_person where isFound=0 and expiryDate >="'.date('Y-m-d H:i:s A').'" and awsEventName="All" and aadharNumber="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getLapataDetails) > 0)
                    {
                        foreach($getLapataDetails as $k=>$v)
                        {
                            array_push($lapataIds,$v['id']);       
                        }
                    }
                    $getUnknownDetails = $this->db->query('select id from unknown_person where isFound=0 and awsEventName != "All" and aadharNumber="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getUnknownDetails) > 0)
                    {
                        foreach($getUnknownDetails as $k=>$v)
                        {
                            array_push($unknownIds,$v['id']);       
                        }
                    }
                    break;
                case 'pan' :
                    $getLapataDetails = $this->db->query('select id from unknown_person where isFound=0 and expiryDate >="'.date('Y-m-d H:i:s A').'" and awsEventName="All" and PAN="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getLapataDetails) > 0)
                    {
                        foreach($getLapataDetails as $k=>$v)
                        {
                            array_push($lapataIds,$v['id']);       
                        }
                    }
                    $getUnknownDetails = $this->db->query('select id from unknown_person where isFound=0 and awsEventName != "All" and PAN="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getUnknownDetails) > 0)
                    {
                        foreach($getUnknownDetails as $k=>$v)
                        {
                            array_push($unknownIds,$v['id']);       
                        }
                    }
                    break;
                case 'voter' :
                    $getLapataDetails = $this->db->query('select id from unknown_person where isFound=0 and expiryDate >="'.date('Y-m-d H:i:s A').'" and awsEventName="All" and voter_id="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getLapataDetails) > 0)
                    {
                        foreach($getLapataDetails as $k=>$v)
                        {
                            array_push($lapataIds,$v['id']);       
                        }
                    }
                    $getUnknownDetails = $this->db->query('select id from unknown_person where isFound=0 and awsEventName != "All" and voter_id="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getUnknownDetails) > 0)
                    {
                        foreach($getUnknownDetails as $k=>$v)
                        {
                            array_push($unknownIds,$v['id']);       
                        }
                    }
                    break;
                case 'dl' :
                    $getLapataDetails = $this->db->query('select id from unknown_person where isFound=0 and expiryDate >="'.date('Y-m-d H:i:s A').'" and awsEventName="All" and DL_no="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getLapataDetails) > 0)
                    {
                        foreach($getLapataDetails as $k=>$v)
                        {
                            array_push($lapataIds,$v['id']);       
                        }
                    }
                    $getUnknownDetails = $this->db->query('select id from unknown_person where isFound=0 and awsEventName != "All" and DL_no="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getUnknownDetails) > 0)
                    {
                        foreach($getUnknownDetails as $k=>$v)
                        {
                            array_push($unknownIds,$v['id']);       
                        }
                    }
                    break;
                case 'gold' :
                    $getGoldDetails = $this->db->query('select * from unknownPersonGold where goldHUID="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getGoldDetails) > 0)
                    {
                        foreach($getGoldDetails as $k=>$v)
                        {
                            $getLapataDetails = $this->db->query('select id from unknown_person where isFound=0 and expiryDate >="'.date('Y-m-d H:i:s A').'" and awsEventName="All" and id='.$v['unknownId'])->result_array();   
                            if(count($getLapataDetails) > 0)
                            {
                                array_push($lapataIds,$v['unknownId']);          
                            }
                            $getUnknownDetails = $this->db->query('select id from unknown_person where isFound=0 and awsEventName != "All" and id='.$v['unknownId'])->result_array();
                            if(count($getUnknownDetails) > 0)
                            {
                                array_push($unknownIds,$v['unknownId']);       
                            }
                        }
                    }
                    break;
                case 'vehicle' :
                    $getLapataDetails = $this->db->query('select id from unknown_person where isFound=0 and expiryDate >="'.date('Y-m-d H:i:s A').'" and awsEventName="All" and vehicle_no="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getLapataDetails) > 0)
                    {
                        foreach($getLapataDetails as $k=>$v)
                        {
                            array_push($lapataIds,$v['id']);       
                        }
                    }
                    $getUnknownDetails = $this->db->query('select id from unknown_person where isFound=0 and awsEventName != "All" and vehicle_no="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getUnknownDetails) > 0)
                    {
                        foreach($getUnknownDetails as $k=>$v)
                        {
                            array_push($unknownIds,$v['id']);       
                        }
                    }
                    break;
            }
            if(count($lapataIds) > 0)
            {
                foreach($lapataIds as $k=>$v)
                {
                    $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$v)->result_array();
                    if($getApplicationNumber[0]['isKyc'] == 1)
                    {
                        $notifyData = array(
                            'isLogin' => 1,
                            'loggedInUserId' => $_SESSION['user_id'],
                            'loginUserType' => $_SESSION['login_type'],
                            'dateCreated' => date('Y-m-d H:i:s'),
                            'mobileNumber' => $_SESSION['loginmob'],
                            'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                            'searchType' => 'Lapata',
                            'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                            'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                            'isIdentity' => 1,
                            'identityType' => $getDetails[0]['idType'],
                            'identityNumber' => $getDetails[0]['idNumber']
                        );
                        $insert = $this->db->insert('searchnotification',$notifyData);
                        if($getApplicationNumber[0]['uploaded_by'] == 'user')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getUserDetail = $this->db->query('select * from user where uid='.$_SESSION['user_id'])->result_array();
                                $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "webpush" => array(
                                        "notification" => array(
                                            "title" => "Khoji",
                                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                            "icon" => "assets/img/logo_new_ag.png",
                                            "click_action" => base_url()
                                        ),
                                    ),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - SAMAJSEVI -".$_SESSION['aadharName'].' from '.$getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'].' has searched. Click here to check your notification at '.$getReceiverUserDetail[0]['aadharname'].'.',
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getUserDetail = $this->db->query('select * from user where uid='.$_SESSION['user_id'])->result_array();
                                $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "webpush" => array(
                                        "notification" => array(
                                            "title" => "Khoji",
                                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                            "icon" => "assets/img/logo_new_ag.png",
                                            "click_action" => base_url()
                                        ),
                                    ),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - SAMAJSEVI -".$_SESSION['aadharName'].' from '.$getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'].' has searched. Click here to check your notification at '.$getReceiverUserDetail[0]['thanaName'].'.',
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else{
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getUserDetail = $this->db->query('select * from user where uid='.$_SESSION['user_id'])->result_array();
                                $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "webpush" => array(
                                        "notification" => array(
                                            "title" => "Khoji",
                                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                            "icon" => "assets/img/logo_new_ag.png",
                                            "click_action" => base_url()
                                        ),
                                    ),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION -  SAMAJSEVI -".$_SESSION['aadharName']." from ".$getUserDetail[0]['vtc'].",".$getUserDetail[0]['state']." has searched . Click here to check your notification at ".$getReceiverUserDetail[0]['ngoName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }
                    }else{
                        $notifyData = array(
                            'isLogin' => 1,
                            'loggedInUserId' => $_SESSION['user_id'],
                            'loginUserType' => $_SESSION['login_type'],
                            'dateCreated' => date('Y-m-d H:i:s'),
                            'mobileNumber' => $_SESSION['loginmob'],
                            'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                            'searchType' => 'Lapata',
                            'complainantUserType' => 'NonKyc',
                            'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                            'isIdentity' => 1,
                            'identityType' => $getDetails[0]['idType'],
                            'identityNumber' => $getDetails[0]['idNumber']
                        );
                        $insert = $this->db->insert('searchnotification',$notifyData);
                        if($getApplicationNumber[0]['uploaded_by'] == 'user')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getUserDetail = $this->db->query('select * from nonKycUser where uid='.$_SESSION['user_id'])->result_array();
                                $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "webpush" => array(
                                        "notification" => array(
                                            "title" => "Khoji",
                                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                            "icon" => "assets/img/logo_new_ag.png",
                                            "click_action" => base_url()
                                        ),
                                    ),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - SAMAJSEVI -".$_SESSION['aadharName'].' from '.$getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'].' has searched. Click here to check your notification at '.$getReceiverUserDetail[0]['aadharname'].'.',
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getUserDetail = $this->db->query('select * from user where uid='.$_SESSION['user_id'])->result_array();
                                $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "webpush" => array(
                                        "notification" => array(
                                            "title" => "Khoji",
                                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                            "icon" => "assets/img/logo_new_ag.png",
                                            "click_action" => base_url()
                                        ),
                                    ),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - SAMAJSEVI -".$_SESSION['aadharName'].' from '.$getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'].' has searched. Click here to check your notification at '.$getReceiverUserDetail[0]['thanaName'].'.',
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else{
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getUserDetail = $this->db->query('select * from user where uid='.$_SESSION['user_id'])->result_array();
                                $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "webpush" => array(
                                        "notification" => array(
                                            "title" => "Khoji",
                                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                            "icon" => "assets/img/logo_new_ag.png",
                                            "click_action" => base_url()
                                        ),
                                    ),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION -  SAMAJSEVI -".$_SESSION['aadharName']." from ".$getUserDetail[0]['vtc'].",".$getUserDetail[0]['state']." has searched . Click here to check your notification at ".$getReceiverUserDetail[0]['ngoName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }
                    }
                }
            }
            if(count($unknownIds) > 0)
            {
                foreach($unknownIds as $k=>$v)
                {
                    $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$v)->result_array();
                    if($getApplicationNumber[0]['isKyc'] == 1)
                    {
                        $notifyData = array(
                            'isLogin' => 1,
                            'loggedInUserId' => $_SESSION['user_id'],
                            'loginUserType' => $_SESSION['login_type'],
                            'dateCreated' => date('Y-m-d H:i:s'),
                            'mobileNumber' => $_SESSION['loginmob'],
                            'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                            'searchType' => 'Unknown',
                            'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                            'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                            'isIdentity' => 1,
                            'identityType' => $getDetails[0]['idType'],
                            'identityNumber' => $getDetails[0]['idNumber'],
                        );
                        $insert = $this->db->insert('searchnotification',$notifyData);
                        if($getApplicationNumber[0]['uploaded_by'] == 'user')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getUserDetail = $this->db->query('select * from user where uid='.$_SESSION['user_id'])->result_array();
                                $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "webpush" => array(
                                        "notification" => array(
                                            "title" => "Khoji",
                                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                            "icon" => "assets/img/logo_new_ag.png",
                                            "click_action" => base_url()
                                        ),
                                    ),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - SAMAJSEVI -".$_SESSION['aadharName'].' from '.$getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'].' has searched. Click here to check your notification at '.$getReceiverUserDetail[0]['aadharname'].'.',
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getUserDetail = $this->db->query('select * from user where uid='.$_SESSION['user_id'])->result_array();
                                $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "webpush" => array(
                                        "notification" => array(
                                            "title" => "Khoji",
                                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                            "icon" => "assets/img/logo_new_ag.png",
                                            "click_action" => base_url()
                                        ),
                                    ),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - SAMAJSEVI -".$_SESSION['aadharName'].' from '.$getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'].' has searched. Click here to check your notification at '.$getReceiverUserDetail[0]['thanaName'].'.',
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else{
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getUserDetail = $this->db->query('select * from user where uid='.$_SESSION['user_id'])->result_array();
                                $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "webpush" => array(
                                        "notification" => array(
                                            "title" => "Khoji",
                                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                            "icon" => "assets/img/logo_new_ag.png",
                                            "click_action" => base_url()
                                        ),
                                    ),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION -  SAMAJSEVI -".$_SESSION['aadharName']." from ".$getUserDetail[0]['vtc'].",".$getUserDetail[0]['state']." has searched . Click here to check your notification at ".$getReceiverUserDetail[0]['ngoName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }
                    }else{
                        $notifyData = array(
                            'isLogin' => 1,
                            'loggedInUserId' => $_SESSION['user_id'],
                            'loginUserType' => $_SESSION['login_type'],
                            'dateCreated' => date('Y-m-d H:i:s'),
                            'mobileNumber' => $_SESSION['loginmob'],
                            'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                            'searchType' => 'Unknown',
                            'complainantUserType' => 'NonKyc',
                            'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                            'isIdentity' => 1,
                            'identityType' => $getDetails[0]['idType'],
                            'identityNumber' => $getDetails[0]['idNumber'],
                        );
                        $insert = $this->db->insert('searchnotification',$notifyData);
                        if($getApplicationNumber[0]['uploaded_by'] == 'user')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getUserDetail = $this->db->query('select * from user where uid='.$_SESSION['user_id'])->result_array();
                                $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "webpush" => array(
                                        "notification" => array(
                                            "title" => "Khoji",
                                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                            "icon" => "assets/img/logo_new_ag.png",
                                            "click_action" => base_url()
                                        ),
                                    ),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - SAMAJSEVI -".$_SESSION['aadharName'].' from '.$getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'].' has searched. Click here to check your notification at '.$getReceiverUserDetail[0]['aadharname'].'.',
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getUserDetail = $this->db->query('select * from user where uid='.$_SESSION['user_id'])->result_array();
                                $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "webpush" => array(
                                        "notification" => array(
                                            "title" => "Khoji",
                                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                            "icon" => "assets/img/logo_new_ag.png",
                                            "click_action" => base_url()
                                        ),
                                    ),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - SAMAJSEVI -".$_SESSION['aadharName'].' from '.$getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'].' has searched. Click here to check your notification at '.$getReceiverUserDetail[0]['thanaName'].'.',
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else{
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getUserDetail = $this->db->query('select * from user where uid='.$_SESSION['user_id'])->result_array();
                                $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "webpush" => array(
                                        "notification" => array(
                                            "title" => "Khoji",
                                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                            "icon" => "assets/img/logo_new_ag.png",
                                            "click_action" => base_url()
                                        ),
                                    ),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION -  SAMAJSEVI -".$_SESSION['aadharName']." from ".$getUserDetail[0]['vtc'].",".$getUserDetail[0]['state']." has searched . Click here to check your notification at ".$getReceiverUserDetail[0]['ngoName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }
                    }
                }
            }
        }else{
            $lapataIds = array();
            $unknownIds = array();
            
            switch($getDetails[0]['idType']){
                case 'aadhar' :
                    $getLapataDetails = $this->db->query('select id from unknown_person where isFound=0 and expiryDate >="'.date('Y-m-d H:i:s A').'" and awsEventName="All" and aadharNumber="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getLapataDetails) > 0)
                    {
                        foreach($getLapataDetails as $k=>$v)
                        {
                            array_push($lapataIds,$v['id']);       
                        }
                    }
                    $getUnknownDetails = $this->db->query('select id from unknown_person where isFound=0 and awsEventName != "All" and aadharNumber="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getUnknownDetails) > 0)
                    {
                        foreach($getUnknownDetails as $k=>$v)
                        {
                            array_push($unknownIds,$v['id']);       
                        }
                    }
                    break;
                case 'pan' :
                    $getLapataDetails = $this->db->query('select id from unknown_person where isFound=0 and expiryDate >="'.date('Y-m-d H:i:s A').'" and awsEventName="All" and PAN="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getLapataDetails) > 0)
                    {
                        foreach($getLapataDetails as $k=>$v)
                        {
                            array_push($lapataIds,$v['id']);       
                        }
                    }
                    $getUnknownDetails = $this->db->query('select id from unknown_person where isFound=0 and awsEventName != "All" and PAN="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getUnknownDetails) > 0)
                    {
                        foreach($getUnknownDetails as $k=>$v)
                        {
                            array_push($unknownIds,$v['id']);       
                        }
                    }
                    break;
                case 'voter' :
                    $getLapataDetails = $this->db->query('select id from unknown_person where isFound=0 and expiryDate >="'.date('Y-m-d H:i:s A').'" and awsEventName="All" and voter_id="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getLapataDetails) > 0)
                    {
                        foreach($getLapataDetails as $k=>$v)
                        {
                            array_push($lapataIds,$v['id']);       
                        }
                    }
                    $getUnknownDetails = $this->db->query('select id from unknown_person where isFound=0 and awsEventName != "All" and voter_id="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getUnknownDetails) > 0)
                    {
                        foreach($getUnknownDetails as $k=>$v)
                        {
                            array_push($unknownIds,$v['id']);       
                        }
                    }
                    break;
                case 'dl' :
                    $getLapataDetails = $this->db->query('select id from unknown_person where isFound=0 and expiryDate >="'.date('Y-m-d H:i:s A').'" and awsEventName="All" and DL_no="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getLapataDetails) > 0)
                    {
                        foreach($getLapataDetails as $k=>$v)
                        {
                            array_push($lapataIds,$v['id']);       
                        }
                    }
                    $getUnknownDetails = $this->db->query('select id from unknown_person where isFound=0 and awsEventName != "All" and DL_no="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getUnknownDetails) > 0)
                    {
                        foreach($getUnknownDetails as $k=>$v)
                        {
                            array_push($unknownIds,$v['id']);       
                        }
                    }
                    break;
                case 'gold' :
                    $getGoldDetails = $this->db->query('select * from unknownPersonGold where goldHUID="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getGoldDetails) > 0)
                    {
                        foreach($getGoldDetails as $k=>$v)
                        {
                            $getLapataDetails = $this->db->query('select id from unknown_person where isFound=0 and expiryDate >="'.date('Y-m-d H:i:s A').'" and awsEventName="All" and id='.$v['unknownId'])->result_array();   
                            if(count($getLapataDetails) > 0)
                            {
                                array_push($lapataIds,$v['unknownId']);          
                            }
                            $getUnknownDetails = $this->db->query('select id from unknown_person where isFound=0 and awsEventName != "All" and id='.$v['unknownId'])->result_array();
                            if(count($getUnknownDetails) > 0)
                            {
                                array_push($unknownIds,$v['unknownId']);       
                            }
                        }
                    }
                    break;
                case 'vehicle' :
                    $getLapataDetails = $this->db->query('select id from unknown_person where isFound=0 and expiryDate >="'.date('Y-m-d H:i:s A').'" and awsEventName="All" and vehicle_no="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getLapataDetails) > 0)
                    {
                        foreach($getLapataDetails as $k=>$v)
                        {
                            array_push($lapataIds,$v['id']);       
                        }
                    }
                    $getUnknownDetails = $this->db->query('select id from unknown_person where isFound=0 and awsEventName != "All" and vehicle_no="'.$getDetails[0]['idNumber'].'"')->result_array();
                    if(count($getUnknownDetails) > 0)
                    {
                        foreach($getUnknownDetails as $k=>$v)
                        {
                            array_push($unknownIds,$v['id']);       
                        }
                    }
                    break;
            }
            if(count($lapataIds) > 0)
            {
                foreach($lapataIds as $k=>$v)
                {
                    $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$v)->result_array();
                    if($getApplicationNumber[0]['isKyc'] == 1)
                    {
                        $notifyData = array(
                            'isLogin' => 0,
                            'dateCreated' => date('Y-m-d H:i:s'),
                            'mobileNumber' => $_SESSION['landingMob'],
                            'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                            'searchType' => 'Lapata',
                            'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                            'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                            'isIdentity' => 1,
                            'identityType' => $getDetails[0]['idType'],
                            'identityNumber' => $getDetails[0]['idNumber']
                        );
                        $insert = $this->db->insert('searchnotification',$notifyData);
                        if($getApplicationNumber[0]['uploaded_by'] == 'user')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "webpush" => array(
                                        "notification" => array(
                                            "title" => "Khoji",
                                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                            "icon" => "assets/img/logo_new_ag.png",
                                            "click_action" => base_url()
                                        ),
                                    ),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "webpush" => array(
                                        "notification" => array(
                                            "title" => "Khoji",
                                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                            "icon" => "assets/img/logo_new_ag.png",
                                            "click_action" => base_url()
                                        ),
                                    ),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else{
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "webpush" => array(
                                        "notification" => array(
                                            "title" => "Khoji",
                                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                            "icon" => "assets/img/logo_new_ag.png",
                                            "click_action" => base_url()
                                        ),
                                    ),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }
                    }else{
                        $notifyData = array(
                            'isLogin' => 0,
                            'dateCreated' => date('Y-m-d H:i:s'),
                            'mobileNumber' => $_SESSION['landingMob'],
                            'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                            'searchType' => 'Lapata',
                            'complainantUserType' => 'NonKyc',
                            'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                            'isIdentity' => 1,
                            'identityType' => $getDetails[0]['idType'],
                            'identityNumber' => $getDetails[0]['idNumber']
                        );
                        $insert = $this->db->insert('searchnotification',$notifyData);
                        if($getApplicationNumber[0]['uploaded_by'] == 'user')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "webpush" => array(
                                        "notification" => array(
                                            "title" => "Khoji",
                                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                            "icon" => "assets/img/logo_new_ag.png",
                                            "click_action" => base_url()
                                        ),
                                    ),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "webpush" => array(
                                        "notification" => array(
                                            "title" => "Khoji",
                                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                            "icon" => "assets/img/logo_new_ag.png",
                                            "click_action" => base_url()
                                        ),
                                    ),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else{
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "webpush" => array(
                                        "notification" => array(
                                            "title" => "Khoji",
                                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                            "icon" => "assets/img/logo_new_ag.png",
                                            "click_action" => base_url()
                                        ),
                                    ),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }
                    }
                }
            }
            if(count($unknownIds) > 0)
            {
                foreach($unknownIds as $k=>$v)
                {
                    $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$v)->result_array();
                    if($getApplicationNumber[0]['isKyc'] == 1)
                    {
                        $notifyData = array(
                            'isLogin' => 0,
                            'dateCreated' => date('Y-m-d H:i:s'),
                            'mobileNumber' => $_SESSION['landingMob'],
                            'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                            'searchType' => 'Unknown',
                            'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                            'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                            'isIdentity' => 1,
                            'identityType' => $getDetails[0]['idType'],
                            'identityNumber' => $getDetails[0]['idNumber']
                        );
                        $insert = $this->db->insert('searchnotification',$notifyData);
                        if($getApplicationNumber[0]['uploaded_by'] == 'user')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "webpush" => array(
                                        "notification" => array(
                                            "title" => "Khoji",
                                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                            "icon" => "assets/img/logo_new_ag.png",
                                            "click_action" => base_url()
                                        ),
                                    ),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "webpush" => array(
                                        "notification" => array(
                                            "title" => "Khoji",
                                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                            "icon" => "assets/img/logo_new_ag.png",
                                            "click_action" => base_url()
                                        ),
                                    ),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else{
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "webpush" => array(
                                        "notification" => array(
                                            "title" => "Khoji",
                                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                            "icon" => "assets/img/logo_new_ag.png",
                                            "click_action" => base_url()
                                        ),
                                    ),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }
                    }else{
                        $notifyData = array(
                            'isLogin' => 0,
                            'dateCreated' => date('Y-m-d H:i:s'),
                            'mobileNumber' => $_SESSION['landingMob'],
                            'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                            'searchType' => 'Unknown',
                            'complainantUserType' => 'NonKyc',
                            'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                            'isIdentity' => 1,
                            'identityType' => $getDetails[0]['idType'],
                            'identityNumber' => $getDetails[0]['idNumber']
                        );
                        $insert = $this->db->insert('searchnotification',$notifyData);
                        if($getApplicationNumber[0]['uploaded_by'] == 'user')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "webpush" => array(
                                        "notification" => array(
                                            "title" => "Khoji",
                                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                            "icon" => "assets/img/logo_new_ag.png",
                                            "click_action" => base_url()
                                        ),
                                    ),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "webpush" => array(
                                        "notification" => array(
                                            "title" => "Khoji",
                                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                            "icon" => "assets/img/logo_new_ag.png",
                                            "click_action" => base_url()
                                        ),
                                    ),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else{
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "webpush" => array(
                                        "notification" => array(
                                            "title" => "Khoji",
                                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                            "icon" => "assets/img/logo_new_ag.png",
                                            "click_action" => base_url()
                                        ),
                                    ),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }
                    }
                }
            }
        }
    }
    
    function sendCallIdNotification()
    {
        $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$_POST['id'])->result_array();
        $getDetails = $this->db->query('select * from checkperson where Id='.$_SESSION['checkId'])->result_array();
        $isLogin = 0;
        if($this->session->userdata('user_login') == 'yes'){
            $isLogin = 1;
            if($getApplicationNumber[0]['isKyc'] == 1)
            {
                $notifyData = array(
                    'isLogin' => 1,
                    'loggedInUserId' => $_SESSION['user_id'],
                    'loginUserType' => $_SESSION['login_type'],
                    'dateCreated' => date('Y-m-d H:i:s'),
                    'mobileNumber' => $_SESSION['loginmob'],
                    'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                    'searchType' => $_POST['type'],
                    'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                    'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                    'searchPhoto' => $getDetails[0]['mainPhoto'],
                );
                $insert = $this->db->insert('searchnotification',$notifyData);
            }else{
                $notifyData = array(
                    'isLogin' => 1,
                    'loggedInUserId' => $_SESSION['user_id'],
                    'loginUserType' => $_SESSION['login_type'],
                    'dateCreated' => date('Y-m-d H:i:s'),
                    'mobileNumber' => $_SESSION['loginmob'],
                    'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                    'searchType' => $_POST['type'],
                    'complainantUserType' => 'NonKyc',
                    'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                    'searchPhoto' => $getDetails[0]['mainPhoto'],
                );
                $insert = $this->db->insert('searchnotification',$notifyData);
            }
        }else{
            if($getApplicationNumber[0]['isKyc'] == 1)
            {
                $notifyData = array(
                    'isLogin' => 0,
                    'dateCreated' => date('Y-m-d H:i:s'),
                    'mobileNumber' => $_SESSION['landingMob'],
                    'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                    'searchType' => $_POST['type'],
                    'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                    'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                    'isIdentity' => 1,
                    'identityType' => $getDetails[0]['idType'],
                    'identityNumber' => $getDetails[0]['idNumber']
                );
                $insert = $this->db->insert('searchnotification',$notifyData);
            }else{
                $notifyData = array(
                    'isLogin' => 0,
                    'dateCreated' => date('Y-m-d H:i:s'),
                    'mobileNumber' => $_SESSION['landingMob'],
                    'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                    'searchType' => $_POST['type'],
                    'complainantUserType' => 'NonKyc',
                    'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                    'isIdentity' => 1,
                    'identityType' => $getDetails[0]['idType'],
                    'identityNumber' => $getDetails[0]['idNumber']
                );
                $insert = $this->db->insert('searchnotification',$notifyData);
            }
        }
        if($isLogin == 1)
        {
            if($getApplicationNumber[0]['uploaded_by'] == 'user')
            {
                $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                $query_res = $query->result_array();
                
                if(count($query_res) > 0)
                {
                    foreach ($query_res as $query_res_data) {
                        $registrationIds[] =$query_res_data['token'];
                    }
                    
                    $url ="https://fcm.googleapis.com/fcm/send";
                    $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                    $fields=array(
                        "registration_ids"=>$registrationIds,
                        'data' => array("msg"=>"Khoji"),
                        'priority' => 'high',
                        "webpush" => array(
                            "notification" => array(
                                "title" => "Khoji",
                                "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                "icon" => "assets/img/logo_new_ag.png",
                                "click_action" => base_url()
                            ),
                        ),
                        "notification"=>array(
                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                            "title"=>"Khoji",
                        )   
                    );
                    $headers=array(
                        'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                        'Content-Type:application/json'
                    );
                    $ch=curl_init();
                    curl_setopt($ch,CURLOPT_URL,$url);
                    curl_setopt($ch,CURLOPT_POST,true);
                    curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                    curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                    curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                    curl_exec($ch);
                }
            }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
            {
                $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                $query_res = $query->result_array();
                
                if(count($query_res) > 0)
                {
                    foreach ($query_res as $query_res_data) {
                        $registrationIds[] =$query_res_data['token'];
                    }
                    
                    $url ="https://fcm.googleapis.com/fcm/send";
                    $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                    $fields=array(
                        "registration_ids"=>$registrationIds,
                        'data' => array("msg"=>"Khoji"),
                        'priority' => 'high',
                        "webpush" => array(
                            "notification" => array(
                                "title" => "Khoji",
                                "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                "icon" => "assets/img/logo_new_ag.png",
                                "click_action" => base_url()
                            ),
                        ),
                        "notification"=>array(
                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                            "title"=>"Khoji",
                        )   
                    );
                    $headers=array(
                        'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                        'Content-Type:application/json'
                    );
                    $ch=curl_init();
                    curl_setopt($ch,CURLOPT_URL,$url);
                    curl_setopt($ch,CURLOPT_POST,true);
                    curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                    curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                    curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                    curl_exec($ch);
                }
            }else{
                $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                $query_res = $query->result_array();
                
                if(count($query_res) > 0)
                {
                    foreach ($query_res as $query_res_data) {
                        $registrationIds[] =$query_res_data['token'];
                    }
                    
                    $url ="https://fcm.googleapis.com/fcm/send";
                    $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                    $fields=array(
                        "registration_ids"=>$registrationIds,
                        'data' => array("msg"=>"Khoji"),
                        'priority' => 'high',
                        "webpush" => array(
                            "notification" => array(
                                "title" => "Khoji",
                                "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                "icon" => "assets/img/logo_new_ag.png",
                                "click_action" => base_url()
                            ),
                        ),
                        "notification"=>array(
                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                            "title"=>"Khoji",
                        )   
                    );
                    $headers=array(
                        'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                        'Content-Type:application/json'
                    );
                    $ch=curl_init();
                    curl_setopt($ch,CURLOPT_URL,$url);
                    curl_setopt($ch,CURLOPT_POST,true);
                    curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                    curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                    curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                    curl_exec($ch);
                }
            }   
        }else{
            if($getApplicationNumber[0]['uploaded_by'] == 'user')
            {
                $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                $query_res = $query->result_array();
                
                if(count($query_res) > 0)
                {
                    foreach ($query_res as $query_res_data) {
                        $registrationIds[] =$query_res_data['token'];
                    }
                    
                    $url ="https://fcm.googleapis.com/fcm/send";
                    $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                    $fields=array(
                        "registration_ids"=>$registrationIds,
                        'data' => array("msg"=>"Khoji"),
                        'priority' => 'high',
                        "webpush" => array(
                            "notification" => array(
                                "title" => "Khoji",
                                "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                "icon" => "assets/img/logo_new_ag.png",
                                "click_action" => base_url()
                            ),
                        ),
                        "notification"=>array(
                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                            "title"=>"Khoji",
                        )   
                    );
                    $headers=array(
                        'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                        'Content-Type:application/json'
                    );
                    $ch=curl_init();
                    curl_setopt($ch,CURLOPT_URL,$url);
                    curl_setopt($ch,CURLOPT_POST,true);
                    curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                    curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                    curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                    curl_exec($ch);
                }
            }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
            {
                $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                $query_res = $query->result_array();
                
                if(count($query_res) > 0)
                {
                    foreach ($query_res as $query_res_data) {
                        $registrationIds[] =$query_res_data['token'];
                    }
                    
                    $url ="https://fcm.googleapis.com/fcm/send";
                    $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                    $fields=array(
                        "registration_ids"=>$registrationIds,
                        'data' => array("msg"=>"Khoji"),
                        'priority' => 'high',
                        "webpush" => array(
                            "notification" => array(
                                "title" => "Khoji",
                                "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                "icon" => "assets/img/logo_new_ag.png",
                                "click_action" => base_url()
                            ),
                        ),
                        "notification"=>array(
                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                            "title"=>"Khoji",
                        )   
                    );
                    $headers=array(
                        'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                        'Content-Type:application/json'
                    );
                    $ch=curl_init();
                    curl_setopt($ch,CURLOPT_URL,$url);
                    curl_setopt($ch,CURLOPT_POST,true);
                    curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                    curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                    curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                    curl_exec($ch);
                }
            }else{
                $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                $query_res = $query->result_array();
                
                if(count($query_res) > 0)
                {
                    foreach ($query_res as $query_res_data) {
                        $registrationIds[] =$query_res_data['token'];
                    }
                    
                    $url ="https://fcm.googleapis.com/fcm/send";
                    $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                    $fields=array(
                        "registration_ids"=>$registrationIds,
                        'data' => array("msg"=>"Khoji"),
                        'priority' => 'high',
                        "webpush" => array(
                            "notification" => array(
                                "title" => "Khoji",
                                "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                "icon" => "assets/img/logo_new_ag.png",
                                "click_action" => base_url()
                            ),
                        ),
                        "notification"=>array(
                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                            "title"=>"Khoji",
                        )   
                    );
                    $headers=array(
                        'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                        'Content-Type:application/json'
                    );
                    $ch=curl_init();
                    curl_setopt($ch,CURLOPT_URL,$url);
                    curl_setopt($ch,CURLOPT_POST,true);
                    curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                    curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                    curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                    curl_exec($ch);
                }
            }   
        }
    }

    function createOverallFaceHistory()
    {
        $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
        $insertData = array(
            'dateCreated' => date('Y-m-d H:i:s'),
            'userId' => $_SESSION['user_id'],
            'missingIds' => $getDetails[0]['matchedLapataIds'],
            'unknownIds' => $getDetails[0]['matchedUnknownIds'],
            'searchQuery' => $getDetails[0]['mainPhoto'],
            'searchType' => 'facematch'
        );
        $insertOverall = $this->db->insert('overallHistory',$insertData);
    }

    function sendFaceFirstNotification()
    {
        if($_POST['isFirstSent'] == 0)
        {
            $this->db->where('Id',$_SESSION['searchFaceId']);
            $this->db->update('searchfacehistory',array('isFirstSent'=>1));
            if($this->session->userdata('user_login') == 'yes'){
                if($_POST['firstType'] == 'Special')
                {
                    $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                    $getApplicationNumber = $this->db->query('select * from mahakumbhSpecial where id='.$_POST['firstId'])->result_array();
                    $notifyData = array(
                        'isLogin' => 1,
                        'loggedInUserId' => $_SESSION['user_id'],
                        'loginUserType' => $_SESSION['login_type'],
                        'dateCreated' => date('Y-m-d H:i:s'),
                        'mobileNumber' => $_SESSION['loginmob'],
                        'searchedAppNumber' => $getApplicationNumber[0]['id'],
                        'searchType' => $_POST['firstType'],
                        'complainantUserType' => 'NonKyc',
                        'complainantUserId' => $getApplicationNumber[0]['userId'],
                        'searchPhoto' => $getDetails[0]['mainPhoto'],
                    );
                    $insert = $this->db->insert('searchnotification',$notifyData);
                    if($getApplicationNumber[0]['well1'] != NULL)
                    {
                        $sendStatus = $this->sendMessage91CustomMsg($getApplicationNumber[0]['Application_no'],$v['well1'],$this->config->item('active_template_id'));
                        if (!$sendStatus || (isset($sendStatus['status']) && $sendStatus['status'] == 'error')) {
                            echo json_encode([
                                'status' => 'error',
                                'msg'    => isset($sendStatus['message']) ? $sendStatus['message'] : 'Failed to send OTP. Please try again later.'
                            ]);
                            die();
                        }
                    }
                    if($getApplicationNumber[0]['well2'] != NULL)
                    {
                        $sendStatus = $this->sendMessage91CustomMsg($getApplicationNumber[0]['Application_no'],$v['well2'],$this->config->item('active_template_id'));
                        if (!$sendStatus || (isset($sendStatus['status']) && $sendStatus['status'] == 'error')) {
                            echo json_encode([
                                'status' => 'error',
                                'msg'    => isset($sendStatus['message']) ? $sendStatus['message'] : 'Failed to send OTP. Please try again later.'
                            ]);
                            die();
                        }
                    }
                    if($getApplicationNumber[0]['well3'] != NULL)
                    {
                        $sendStatus = $this->sendMessage91CustomMsg($getApplicationNumber[0]['Application_no'],$v['well3'],$this->config->item('active_template_id'));
                        if (!$sendStatus || (isset($sendStatus['status']) && $sendStatus['status'] == 'error')) {
                            echo json_encode([
                                'status' => 'error',
                                'msg'    => isset($sendStatus['message']) ? $sendStatus['message'] : 'Failed to send OTP. Please try again later.'
                            ]);
                            die();
                        }
                    }
                }else{
                    $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                    $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$_POST['firstId'])->result_array();
                    if($getApplicationNumber[0]['isKyc'] == 1)
                    {
                        $notifyData = array(
                            'isLogin' => 1,
                            'loggedInUserId' => $_SESSION['user_id'],
                            'loginUserType' => $_SESSION['login_type'],
                            'dateCreated' => date('Y-m-d H:i:s'),
                            'mobileNumber' => $_SESSION['loginmob'],
                            'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                            'searchType' => $_POST['firstType'],
                            'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                            'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                            'searchPhoto' => $getDetails[0]['mainPhoto']
                        );
                        $insert = $this->db->insert('searchnotification',$notifyData);
                        if($getApplicationNumber[0]['uploaded_by'] == 'user')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getUserDetail = $this->db->query('select * from user where uid='.$_SESSION['user_id'])->result_array();
                                $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "webpush" => array(
                                        "notification" => array(
                                            "title" => "Khoji",
                                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                            "icon" => "assets/img/logo_new_ag.png",
                                            "click_action" => base_url()
                                        ),
                                    ),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - SAMAJSEVI -".$_SESSION['aadharName'].' from '.$getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'].' has searched. Click here to check your notification at '.$getReceiverUserDetail[0]['aadharname'].'.',
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getUserDetail = $this->db->query('select * from user where uid='.$_SESSION['user_id'])->result_array();
                                $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "webpush" => array(
                                        "notification" => array(
                                            "title" => "Khoji",
                                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                            "icon" => "assets/img/logo_new_ag.png",
                                            "click_action" => base_url()
                                        ),
                                    ),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - SAMAJSEVI -".$_SESSION['aadharName'].' from '.$getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'].' has searched. Click here to check your notification at '.$getReceiverUserDetail[0]['thanaName'].'.',
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else{
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getUserDetail = $this->db->query('select * from user where uid='.$_SESSION['user_id'])->result_array();
                                $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "webpush" => array(
                                        "notification" => array(
                                            "title" => "Khoji",
                                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                            "icon" => "assets/img/logo_new_ag.png",
                                            "click_action" => base_url()
                                        ),
                                    ),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION -  SAMAJSEVI -".$_SESSION['aadharName']." from ".$getUserDetail[0]['vtc'].",".$getUserDetail[0]['state']." has searched . Click here to check your notification at ".$getReceiverUserDetail[0]['ngoName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }
                    }else{
                        $notifyData = array(
                            'isLogin' => 1,
                            'loggedInUserId' => $_SESSION['user_id'],
                            'loginUserType' => $_SESSION['login_type'],
                            'dateCreated' => date('Y-m-d H:i:s'),
                            'mobileNumber' => $_SESSION['loginmob'],
                            'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                            'searchType' => $_POST['firstType'],
                            'complainantUserType' => 'NonKyc',
                            'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                            'searchPhoto' => $getDetails[0]['mainPhoto'],
                        );
                        $insert = $this->db->insert('searchnotification',$notifyData);
                        if($getApplicationNumber[0]['uploaded_by'] == 'user')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getUserDetail = $this->db->query('select * from user where uid='.$_SESSION['user_id'])->result_array();
                                $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "webpush" => array(
                                        "notification" => array(
                                            "title" => "Khoji",
                                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                            "icon" => "assets/img/logo_new_ag.png",
                                            "click_action" => base_url()
                                        ),
                                    ),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - SAMAJSEVI -".$_SESSION['aadharName'].' from '.$getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'].' has searched. Click here to check your notification at '.$getReceiverUserDetail[0]['aadharname'].'.',
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getUserDetail = $this->db->query('select * from user where uid='.$_SESSION['user_id'])->result_array();
                                $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "webpush" => array(
                                        "notification" => array(
                                            "title" => "Khoji",
                                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                            "icon" => "assets/img/logo_new_ag.png",
                                            "click_action" => base_url()
                                        ),
                                    ),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - SAMAJSEVI -".$_SESSION['aadharName'].' from '.$getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'].' has searched. Click here to check your notification at '.$getReceiverUserDetail[0]['thanaName'].'.',
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else{
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getUserDetail = $this->db->query('select * from user where uid='.$_SESSION['user_id'])->result_array();
                                $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "webpush" => array(
                                        "notification" => array(
                                            "title" => "Khoji",
                                            "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                            "icon" => "assets/img/logo_new_ag.png",
                                            "click_action" => base_url()
                                        ),
                                    ),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION -  SAMAJSEVI -".$_SESSION['aadharName']." from ".$getUserDetail[0]['vtc'].",".$getUserDetail[0]['state']." has searched . Click here to check your notification at ".$getReceiverUserDetail[0]['ngoName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }
                    }
                }
            }else{
                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$_POST['firstId'])->result_array();
                $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                if($getApplicationNumber[0]['isKyc'] == 1)
                {
                    $notifyData = array(
                        'isLogin' => 0,
                        'dateCreated' => date('Y-m-d H:i:s'),
                        'mobileNumber' => $_SESSION['landingMob'],
                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                        'searchType' => $_POST['firstType'],
                        'searchPhoto' => $getDetails[0]['mainPhoto'],
                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                    );
                    $insert = $this->db->insert('searchnotification',$notifyData);
                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "webpush" => array(
                                    "notification" => array(
                                        "title" => "Khoji",
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                        "icon" => "assets/img/logo_new_ag.png",
                                        "click_action" => base_url()
                                    ),
                                ),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "webpush" => array(
                                    "notification" => array(
                                        "title" => "Khoji",
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                        "icon" => "assets/img/logo_new_ag.png",
                                        "click_action" => base_url()
                                    ),
                                ),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else{
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "webpush" => array(
                                    "notification" => array(
                                        "title" => "Khoji",
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                        "icon" => "assets/img/logo_new_ag.png",
                                        "click_action" => base_url()
                                    ),
                                ),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }
                }else{
                    $notifyData = array(
                        'isLogin' => 0,
                        'dateCreated' => date('Y-m-d H:i:s'),
                        'mobileNumber' => $_SESSION['landingMob'],
                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                        'searchType' => $_POST['firstType'],
                        'searchPhoto' => $getDetails[0]['mainPhoto'],
                        'complainantUserType' => 'NonKyc',
                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                    );
                    $insert = $this->db->insert('searchnotification',$notifyData);
                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "webpush" => array(
                                    "notification" => array(
                                        "title" => "Khoji",
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                        "icon" => "assets/img/logo_new_ag.png",
                                        "click_action" => base_url()
                                    ),
                                ),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "webpush" => array(
                                    "notification" => array(
                                        "title" => "Khoji",
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                        "icon" => "assets/img/logo_new_ag.png",
                                        "click_action" => base_url()
                                    ),
                                ),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else{
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "webpush" => array(
                                    "notification" => array(
                                        "title" => "Khoji",
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                        "icon" => "assets/img/logo_new_ag.png",
                                        "click_action" => base_url()
                                    ),
                                ),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }
                }
            }
        }
        echo json_encode(array(
            'status' => 'success'
        ));
    }
    
    function sendFirstNotification()
    {
        if($this->session->userdata('user_login') == 'yes'){
            $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$_POST['firstId'])->result_array();
            $getDetails = $this->db->query('select * from checkperson where Id='.$_SESSION['checkId'])->result_array();
            if($getApplicationNumber[0]['isKyc'] == 1)
            {
                $notifyData = array(
                    'isLogin' => 1,
                    'loggedInUserId' => $_SESSION['user_id'],
                    'loginUserType' => $_SESSION['login_type'],
                    'dateCreated' => date('Y-m-d H:i:s'),
                    'mobileNumber' => $_SESSION['loginmob'],
                    'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                    'searchType' => $_POST['firstType'],
                    'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                    'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                    'isIdentity' => 1,
                    'identityType' => $getDetails[0]['idType'],
                    'identityNumber' => $getDetails[0]['idNumber']
                );
                $insert = $this->db->insert('searchnotification',$notifyData);
                $this->db->where('Id',$_SESSION['checkId']);
                $this->db->update('checkperson',array('isFirstSent'=>1));
                if($getApplicationNumber[0]['uploaded_by'] == 'user')
                {
                    $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                    $query_res = $query->result_array();
                    
                    if(count($query_res) > 0)
                    {
                        foreach ($query_res as $query_res_data) {
                            $registrationIds[] =$query_res_data['token'];
                        }
                        
                        $url ="https://fcm.googleapis.com/fcm/send";
                        $getUserDetail = $this->db->query('select * from user where uid='.$_SESSION['user_id'])->result_array();
                        $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                        $fields=array(
                            "registration_ids"=>$registrationIds,
                            'data' => array("msg"=>"Khoji"),
                            'priority' => 'high',
                            "webpush" => array(
                                "notification" => array(
                                    "title" => "Khoji",
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                    "icon" => "assets/img/logo_new_ag.png",
                                    "click_action" => base_url()
                                ),
                            ),
                            "notification"=>array(
                                "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - SAMAJSEVI -".$_SESSION['aadharName'].' from '.$getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'].' has searched. Click here to check your notification at '.$getReceiverUserDetail[0]['aadharname'].'.',
                                "title"=>"Khoji",
                            )   
                        );
                        $headers=array(
                            'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                            'Content-Type:application/json'
                        );
                        $ch=curl_init();
                        curl_setopt($ch,CURLOPT_URL,$url);
                        curl_setopt($ch,CURLOPT_POST,true);
                        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                        curl_exec($ch);
                    }
                }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                {
                    $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                    $query_res = $query->result_array();
                    
                    if(count($query_res) > 0)
                    {
                        foreach ($query_res as $query_res_data) {
                            $registrationIds[] =$query_res_data['token'];
                        }
                        
                        $url ="https://fcm.googleapis.com/fcm/send";
                        $getUserDetail = $this->db->query('select * from user where uid='.$_SESSION['user_id'])->result_array();
                        $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                        $fields=array(
                            "registration_ids"=>$registrationIds,
                            'data' => array("msg"=>"Khoji"),
                            'priority' => 'high',
                            "webpush" => array(
                                "notification" => array(
                                    "title" => "Khoji",
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                    "icon" => "assets/img/logo_new_ag.png",
                                    "click_action" => base_url()
                                ),
                            ),
                            "notification"=>array(
                                "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - SAMAJSEVI -".$_SESSION['aadharName'].' from '.$getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'].' has searched. Click here to check your notification at '.$getReceiverUserDetail[0]['thanaName'].'.',
                                "title"=>"Khoji",
                            )   
                        );
                        $headers=array(
                            'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                            'Content-Type:application/json'
                        );
                        $ch=curl_init();
                        curl_setopt($ch,CURLOPT_URL,$url);
                        curl_setopt($ch,CURLOPT_POST,true);
                        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                        curl_exec($ch);
                    }
                }else{
                    $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                    $query_res = $query->result_array();
                    
                    if(count($query_res) > 0)
                    {
                        foreach ($query_res as $query_res_data) {
                            $registrationIds[] =$query_res_data['token'];
                        }
                        
                        $url ="https://fcm.googleapis.com/fcm/send";
                        $getUserDetail = $this->db->query('select * from user where uid='.$_SESSION['user_id'])->result_array();
                        $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                        $fields=array(
                            "registration_ids"=>$registrationIds,
                            'data' => array("msg"=>"Khoji"),
                            'priority' => 'high',
                            "webpush" => array(
                                "notification" => array(
                                    "title" => "Khoji",
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                    "icon" => "assets/img/logo_new_ag.png",
                                    "click_action" => base_url()
                                ),
                            ),
                            "notification"=>array(
                                "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION -  SAMAJSEVI -".$_SESSION['aadharName']." from ".$getUserDetail[0]['vtc'].",".$getUserDetail[0]['state']." has searched . Click here to check your notification at ".$getReceiverUserDetail[0]['ngoName'].".",
                                "title"=>"Khoji",
                            )   
                        );
                        $headers=array(
                            'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                            'Content-Type:application/json'
                        );
                        $ch=curl_init();
                        curl_setopt($ch,CURLOPT_URL,$url);
                        curl_setopt($ch,CURLOPT_POST,true);
                        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                        curl_exec($ch);
                    }
                }
            }else{
                $notifyData = array(
                    'isLogin' => 1,
                    'loggedInUserId' => $_SESSION['user_id'],
                    'loginUserType' => $_SESSION['login_type'],
                    'dateCreated' => date('Y-m-d H:i:s'),
                    'mobileNumber' => $_SESSION['loginmob'],
                    'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                    'searchType' => $_POST['firstType'],
                    'complainantUserType' => 'NonKyc',
                    'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                    'isIdentity' => 1,
                    'identityType' => $getDetails[0]['idType'],
                    'identityNumber' => $getDetails[0]['idNumber']
                );
                $insert = $this->db->insert('searchnotification',$notifyData);
                $this->db->where('Id',$_SESSION['checkId']);
                $this->db->update('checkperson',array('isFirstSent'=>1));
                if($getApplicationNumber[0]['uploaded_by'] == 'user')
                {
                    $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                    $query_res = $query->result_array();
                    
                    if(count($query_res) > 0)
                    {
                        foreach ($query_res as $query_res_data) {
                            $registrationIds[] =$query_res_data['token'];
                        }
                        
                        $url ="https://fcm.googleapis.com/fcm/send";
                        $getUserDetail = $this->db->query('select * from user where uid='.$_SESSION['user_id'])->result_array();
                        $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                        $fields=array(
                            "registration_ids"=>$registrationIds,
                            'data' => array("msg"=>"Khoji"),
                            'priority' => 'high',
                            "webpush" => array(
                                "notification" => array(
                                    "title" => "Khoji",
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                    "icon" => "assets/img/logo_new_ag.png",
                                    "click_action" => base_url()
                                ),
                            ),
                            "notification"=>array(
                                "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - SAMAJSEVI -".$_SESSION['aadharName'].' from '.$getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'].' has searched. Click here to check your notification at '.$getReceiverUserDetail[0]['aadharname'].'.',
                                "title"=>"Khoji",
                            )   
                        );
                        $headers=array(
                            'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                            'Content-Type:application/json'
                        );
                        $ch=curl_init();
                        curl_setopt($ch,CURLOPT_URL,$url);
                        curl_setopt($ch,CURLOPT_POST,true);
                        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                        curl_exec($ch);
                    }
                }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                {
                    $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                    $query_res = $query->result_array();
                    
                    if(count($query_res) > 0)
                    {
                        foreach ($query_res as $query_res_data) {
                            $registrationIds[] =$query_res_data['token'];
                        }
                        
                        $url ="https://fcm.googleapis.com/fcm/send";
                        $getUserDetail = $this->db->query('select * from user where uid='.$_SESSION['user_id'])->result_array();
                        $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                        $fields=array(
                            "registration_ids"=>$registrationIds,
                            'data' => array("msg"=>"Khoji"),
                            'priority' => 'high',
                            "webpush" => array(
                                "notification" => array(
                                    "title" => "Khoji",
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                    "icon" => "assets/img/logo_new_ag.png",
                                    "click_action" => base_url()
                                ),
                            ),
                            "notification"=>array(
                                "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - SAMAJSEVI -".$_SESSION['aadharName'].' from '.$getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'].' has searched. Click here to check your notification at '.$getReceiverUserDetail[0]['thanaName'].'.',
                                "title"=>"Khoji",
                            )   
                        );
                        $headers=array(
                            'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                            'Content-Type:application/json'
                        );
                        $ch=curl_init();
                        curl_setopt($ch,CURLOPT_URL,$url);
                        curl_setopt($ch,CURLOPT_POST,true);
                        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                        curl_exec($ch);
                    }
                }else{
                    $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                    $query_res = $query->result_array();
                    
                    if(count($query_res) > 0)
                    {
                        foreach ($query_res as $query_res_data) {
                            $registrationIds[] =$query_res_data['token'];
                        }
                        
                        $url ="https://fcm.googleapis.com/fcm/send";
                        $getUserDetail = $this->db->query('select * from user where uid='.$_SESSION['user_id'])->result_array();
                        $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                        $fields=array(
                            "registration_ids"=>$registrationIds,
                            'data' => array("msg"=>"Khoji"),
                            'priority' => 'high',
                            "webpush" => array(
                                "notification" => array(
                                    "title" => "Khoji",
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                    "icon" => "assets/img/logo_new_ag.png",
                                    "click_action" => base_url()
                                ),
                            ),
                            "notification"=>array(
                                "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION -  SAMAJSEVI -".$_SESSION['aadharName']." from ".$getUserDetail[0]['vtc'].",".$getUserDetail[0]['state']." has searched . Click here to check your notification at ".$getReceiverUserDetail[0]['ngoName'].".",
                                "title"=>"Khoji",
                            )   
                        );
                        $headers=array(
                            'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                            'Content-Type:application/json'
                        );
                        $ch=curl_init();
                        curl_setopt($ch,CURLOPT_URL,$url);
                        curl_setopt($ch,CURLOPT_POST,true);
                        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                        curl_exec($ch);
                    }
                }
            }
        }else{
            if(isset($_SESSION['landingMob']))
            {
                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$_POST['firstId'])->result_array();
                $getDetails = $this->db->query('select * from checkperson where Id='.$_SESSION['checkId'])->result_array();
                if($getApplicationNumber[0]['isKyc'] == 1)
                {
                    $notifyData = array(
                        'isLogin' => 0,
                        'dateCreated' => date('Y-m-d H:i:s'),
                        'mobileNumber' => $_SESSION['landingMob'],
                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                        'searchType' => $_POST['firstType'],
                        'isIdentity' => 1,
                        'identityType' => $getDetails[0]['idType'],
                        'identityNumber' => $getDetails[0]['idNumber'],
                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                    );
                    $insert = $this->db->insert('searchnotification',$notifyData);
                    $this->db->where('Id',$_SESSION['checkId']);
                    $this->db->update('checkperson',array('isFirstSent'=>1));
                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "webpush" => array(
                                    "notification" => array(
                                        "title" => "Khoji",
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                        "icon" => "assets/img/logo_new_ag.png",
                                        "click_action" => base_url()
                                    ),
                                ),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "webpush" => array(
                                    "notification" => array(
                                        "title" => "Khoji",
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                        "icon" => "assets/img/logo_new_ag.png",
                                        "click_action" => base_url()
                                    ),
                                ),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else{
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "webpush" => array(
                                    "notification" => array(
                                        "title" => "Khoji",
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                        "icon" => "assets/img/logo_new_ag.png",
                                        "click_action" => base_url()
                                    ),
                                ),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }
                }else{
                    $notifyData = array(
                        'isLogin' => 0,
                        'dateCreated' => date('Y-m-d H:i:s'),
                        'mobileNumber' => $_SESSION['landingMob'],
                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                        'searchType' => $_POST['firstType'],
                        'isIdentity' => 1,
                        'identityType' => $getDetails[0]['idType'],
                        'identityNumber' => $getDetails[0]['idNumber'],
                        'complainantUserType' => 'NonKyc',
                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                    );
                    $insert = $this->db->insert('searchnotification',$notifyData);
                    $this->db->where('Id',$_SESSION['checkId']);
                    $this->db->update('checkperson',array('isFirstSent'=>1));
                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "webpush" => array(
                                    "notification" => array(
                                        "title" => "Khoji",
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                        "icon" => "assets/img/logo_new_ag.png",
                                        "click_action" => base_url()
                                    ),
                                ),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "webpush" => array(
                                    "notification" => array(
                                        "title" => "Khoji",
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                        "icon" => "assets/img/logo_new_ag.png",
                                        "click_action" => base_url()
                                    ),
                                ),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else{
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "webpush" => array(
                                    "notification" => array(
                                        "title" => "Khoji",
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                        "icon" => "assets/img/logo_new_ag.png",
                                        "click_action" => base_url()
                                    ),
                                ),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }
                }
            }
        }
    }
    
    function sendCallNotification()
    {
        if($_POST['type'] != 'FunnelMissing')
        {
            if($_POST['type'] != 'FunnelFamily')
            {
                if($_POST['type'] == 'Family')
                {
                    $getApplicationNumber = $this->db->query('select * from familyMember where id='.$_POST['id'])->result_array();
                    $isLogin = 0;
                    if($this->session->userdata('user_login') == 'yes'){
                        if(isset($_SESSION['searchFaceId']))
                        {
                            $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                            if($getApplicationNumber[0]['isKyc'] == 1)
                            {
                                $notifyData = array(
                                    'isLogin' => 0,
                                    'dateCreated' => date('Y-m-d H:i:s'),
                                    'mobileNumber' => $_SESSION['landingMob'],
                                    'searchedAppNumber' => $getApplicationNumber[0]['id'],
                                    'searchType' => $_POST['type'],
                                    'searchPhoto' => $getDetails[0]['mainPhoto'],
                                    'complainantUserType' => 'user',
                                    'complainantUserId' => ($getApplicationNumber[0]['userId'])
                                );
                                $insert = $this->db->insert('searchnotification',$notifyData);
                            }else{
                                $notifyData = array(
                                    'isLogin' => 0,
                                    'dateCreated' => date('Y-m-d H:i:s'),
                                    'mobileNumber' => $_SESSION['landingMob'],
                                    'searchedAppNumber' => $getApplicationNumber[0]['id'],
                                    'searchType' => $_POST['type'],
                                    'searchPhoto' => $getDetails[0]['mainPhoto'],
                                    'complainantUserType' => 'NonKyc',
                                    'complainantUserId' => ($getApplicationNumber[0]['userId'])
                                );
                                $insert = $this->db->insert('searchnotification',$notifyData);
                            }
                        }else{
                            $getDetails = $this->db->query('select * from searchfacehistoryafterlogin where Id='.$_SESSION['searchFaceIdAfterLogin'])->result_array();
                            $isLogin = 1;
                            if($getApplicationNumber[0]['isKyc'] == 1)
                            {
                                $notifyData = array(
                                    'isLogin' => 1,
                                    'loggedInUserId' => $_SESSION['user_id'],
                                    'loginUserType' => $_SESSION['login_type'],
                                    'dateCreated' => date('Y-m-d H:i:s'),
                                    'mobileNumber' => $_SESSION['loginmob'],
                                    'searchedAppNumber' => $_POST['id'],
                                    'searchType' => $_POST['type'],
                                    'complainantUserType' => 'user',
                                    'complainantUserId' => ($getApplicationNumber[0]['parentId']),
                                    'searchPhoto' => $getDetails[0]['mainPhoto'],
                                );
                                $insert = $this->db->insert('searchnotification',$notifyData);
                            }else{
                                $notifyData = array(
                                    'isLogin' => 1,
                                    'loggedInUserId' => $_SESSION['user_id'],
                                    'loginUserType' => $_SESSION['login_type'],
                                    'dateCreated' => date('Y-m-d H:i:s'),
                                    'mobileNumber' => $_SESSION['loginmob'],
                                    'searchedAppNumber' => $_POST['id'],
                                    'searchType' => $_POST['type'],
                                    'complainantUserType' => 'NonKyc',
                                    'complainantUserId' => ($getApplicationNumber[0]['parentId']),
                                    'searchPhoto' => $getDetails[0]['mainPhoto'],
                                );
                                $insert = $this->db->insert('searchnotification',$notifyData);
                            }
                        }
                    }else{
                        $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                        if($getApplicationNumber[0]['isKyc'] == 1)
                        {
                            $notifyData = array(
                                'isLogin' => 0,
                                'dateCreated' => date('Y-m-d H:i:s'),
                                'mobileNumber' => $_SESSION['landingMob'],
                                'searchedAppNumber' => $getApplicationNumber[0]['id'],
                                'searchType' => $_POST['type'],
                                'searchPhoto' => $getDetails[0]['mainPhoto'],
                                'complainantUserType' => 'user',
                                'complainantUserId' => ($getApplicationNumber[0]['userId'])
                            );
                            $insert = $this->db->insert('searchnotification',$notifyData);
                        }else{
                            $notifyData = array(
                                'isLogin' => 0,
                                'dateCreated' => date('Y-m-d H:i:s'),
                                'mobileNumber' => $_SESSION['landingMob'],
                                'searchedAppNumber' => $getApplicationNumber[0]['id'],
                                'searchType' => $_POST['type'],
                                'searchPhoto' => $getDetails[0]['mainPhoto'],
                                'complainantUserType' => 'NonKyc',
                                'complainantUserId' => ($getApplicationNumber[0]['userId'])
                            );
                            $insert = $this->db->insert('searchnotification',$notifyData);
                        }
                    }
                }else{
                    if($_POST['type'] == 'Mahakumbh')
                    {
                        $getApplicationNumber = $this->db->query('select * from mahakumbhMember where id='.$_POST['id'])->result_array();
                        $isLogin = 0;
                        if($this->session->userdata('user_login') == 'yes'){
                            if(isset($_SESSION['searchFaceIdAfterLogin']))
                            {
                                $getDetails = $this->db->query('select * from searchfacehistoryafterlogin where Id='.$_SESSION['searchFaceIdAfterLogin'])->result_array();
                                $isLogin = 1;
                                $notifyData = array(
                                    'isLogin' => 1,
                                    'loggedInUserId' => $_SESSION['user_id'],
                                    'loginUserType' => $_SESSION['login_type'],
                                    'dateCreated' => date('Y-m-d H:i:s'),
                                    'mobileNumber' => $_SESSION['loginmob'],
                                    'searchedAppNumber' => $_POST['id'],
                                    'searchType' => $_POST['type'],
                                    'complainantUserType' => 'NonKyc',
                                    'complainantUserId' => ($getApplicationNumber[0]['parentId']),
                                    'searchPhoto' => $getDetails[0]['mainPhoto'],
                                );
                                $insert = $this->db->insert('searchnotification',$notifyData);
                            }else{
                                $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                                $notifyData = array(
                                    'isLogin' => 0,
                                    'dateCreated' => date('Y-m-d H:i:s'),
                                    'mobileNumber' => $_SESSION['landingMob'],
                                    'searchedAppNumber' => $getApplicationNumber[0]['id'],
                                    'searchType' => $_POST['type'],
                                    'searchPhoto' => $getDetails[0]['mainPhoto'],
                                    'complainantUserType' => 'NonKyc',
                                    'complainantUserId' => ($getApplicationNumber[0]['parentId'])
                                );
                                $insert = $this->db->insert('searchnotification',$notifyData);
                            }
                        }else{
                            $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                            $notifyData = array(
                                'isLogin' => 0,
                                'dateCreated' => date('Y-m-d H:i:s'),
                                'mobileNumber' => $_SESSION['landingMob'],
                                'searchedAppNumber' => $getApplicationNumber[0]['id'],
                                'searchType' => $_POST['type'],
                                'searchPhoto' => $getDetails[0]['mainPhoto'],
                                'complainantUserType' => 'NonKyc',
                                'complainantUserId' => ($getApplicationNumber[0]['parentId'])
                            );
                            $insert = $this->db->insert('searchnotification',$notifyData);
                        }
                    }else
                    {
                        if($_POST['type'] == 'Special')
                        {
                            $getApplicationNumber = $this->db->query('select * from mahakumbhSpecial where id='.$_POST['id'])->result_array();
                            $isLogin = 0;
                            if($this->session->userdata('user_login') == 'yes'){
                                if(isset($_SESSION['searchFaceIdAfterLogin']))
                                {
                                    $getDetails = $this->db->query('select * from searchfacehistoryafterlogin where Id='.$_SESSION['searchFaceIdAfterLogin'])->result_array();
                                    $isLogin = 1;
                                    $notifyData = array(
                                        'isLogin' => 1,
                                        'loggedInUserId' => $_SESSION['user_id'],
                                        'loginUserType' => $_SESSION['login_type'],
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['loginmob'],
                                        'searchedAppNumber' => $_POST['id'],
                                        'searchType' => $_POST['type'],
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['userId']),
                                        'searchPhoto' => $getDetails[0]['mainPhoto'],
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                }else{
                                    $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['id'],
                                        'searchType' => $_POST['type'],
                                        'searchPhoto' => $getDetails[0]['mainPhoto'],
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['userId'])
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                }
                            }else{
                                $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                                $notifyData = array(
                                    'isLogin' => 0,
                                    'dateCreated' => date('Y-m-d H:i:s'),
                                    'mobileNumber' => $_SESSION['landingMob'],
                                    'searchedAppNumber' => $getApplicationNumber[0]['id'],
                                    'searchType' => $_POST['type'],
                                    'searchPhoto' => $getDetails[0]['mainPhoto'],
                                    'complainantUserType' => 'NonKyc',
                                    'complainantUserId' => ($getApplicationNumber[0]['userId'])
                                );
                                $insert = $this->db->insert('searchnotification',$notifyData);
                            }
                        }else{
                            $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$_POST['id'])->result_array();
                            $isLogin = 0;
                            if($this->session->userdata('user_login') == 'yes'){
                                $isLogin = 1;
                                $getDetails = $this->db->query('select * from searchfacehistoryafterlogin where Id='.$_SESSION['searchFaceIdAfterLogin'])->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 1,
                                        'loggedInUserId' => $_SESSION['user_id'],
                                        'loginUserType' => $_SESSION['login_type'],
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['loginmob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => $_POST['type'],
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                                        'searchPhoto' => $getDetails[0]['mainPhoto'],
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 1,
                                        'loggedInUserId' => $_SESSION['user_id'],
                                        'loginUserType' => $_SESSION['login_type'],
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['loginmob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => $_POST['type'],
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                                        'searchPhoto' => $getDetails[0]['mainPhoto'],
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                }
                            }else{
                                $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => $_POST['type'],
                                        'searchPhoto' => $getDetails[0]['mainPhoto'],
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => $_POST['type'],
                                        'searchPhoto' => $getDetails[0]['mainPhoto'],
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                }
                            }
                        }
                    }
                }
            }else{
                $getApplicationNumber = $this->db->query('select * from funnelfamily where id='.$_POST['id'])->result_array();
                $isLogin = 0;
                if($this->session->userdata('user_login') == 'yes'){
                    $getDetails = $this->db->query('select * from searchfacehistoryafterlogin where Id='.$_SESSION['searchFaceIdAfterLogin'])->result_array();
                    $isLogin = 1;
                    $notifyData = array(
                        'isLogin' => 1,
                        'loggedInUserId' => $_SESSION['user_id'],
                        'loginUserType' => $_SESSION['login_type'],
                        'dateCreated' => date('Y-m-d H:i:s'),
                        'mobileNumber' => $_SESSION['loginmob'],
                        'searchedAppNumber' => $_POST['id'],
                        'searchType' => $_POST['type'],
                        'complainantUserType' => 'NonKyc',
                        'complainantUserId' => ($getApplicationNumber[0]['parentId']),
                        'searchPhoto' => $getDetails[0]['mainPhoto'],
                    );
                    $insert = $this->db->insert('searchnotification',$notifyData);
                }else{
                    $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                    $notifyData = array(
                        'isLogin' => 0,
                        'dateCreated' => date('Y-m-d H:i:s'),
                        'mobileNumber' => $_SESSION['landingMob'],
                        'searchedAppNumber' => $getApplicationNumber[0]['id'],
                        'searchType' => $_POST['type'],
                        'searchPhoto' => $getDetails[0]['mainPhoto'],
                        'complainantUserType' => 'NonKyc',
                        'complainantUserId' => ($getApplicationNumber[0]['parentId'])
                    );
                    $insert = $this->db->insert('searchnotification',$notifyData);
                }
            }
        }else{
            $getApplicationNumber = $this->db->query('select * from funnel_missing where id='.$_POST['id'])->result_array();
            $isLogin = 0;
            if($this->session->userdata('user_login') == 'yes'){
                $getDetails = $this->db->query('select * from searchfacehistoryafterlogin where Id='.$_SESSION['searchFaceIdAfterLogin'])->result_array();
                $isLogin = 1;
                $notifyData = array(
                    'isLogin' => 1,
                    'loggedInUserId' => $_SESSION['user_id'],
                    'loginUserType' => $_SESSION['login_type'],
                    'dateCreated' => date('Y-m-d H:i:s'),
                    'mobileNumber' => $_SESSION['loginmob'],
                    'searchedAppNumber' => $_POST['id'],
                    'searchType' => $_POST['type'],
                    'complainantUserType' => 'NonKyc',
                    'complainantUserId' => ($getApplicationNumber[0]['userId']),
                    'searchPhoto' => $getDetails[0]['mainPhoto'],
                );
                $insert = $this->db->insert('searchnotification',$notifyData);
            }else{
                $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                $notifyData = array(
                    'isLogin' => 0,
                    'dateCreated' => date('Y-m-d H:i:s'),
                    'mobileNumber' => $_SESSION['landingMob'],
                    'searchedAppNumber' => $getApplicationNumber[0]['id'],
                    'searchType' => $_POST['type'],
                    'searchPhoto' => $getDetails[0]['mainPhoto'],
                    'complainantUserType' => 'NonKyc',
                    'complainantUserId' => ($getApplicationNumber[0]['userId'])
                );
                $insert = $this->db->insert('searchnotification',$notifyData);
            }
        }
    }

    function checkPersonFaceFamilyUpdated($para = '')
    {
        if($para == '')
        {
            $page_data['control'] = 'user';
            $page_data['pn'] = 3;       
            $_SESSION['searchType'] = 1;
            if(isset($_SESSION['landingMob']))
            {
                $insertdata = array(
                    'mobileNumber' => $_SESSION['landingMob'],
                    'type' => 1,
                );   
            }else{
                $insertdata = array(
                    'type' => 1,
                );
            }
            $insert = $this->db->insert('searchfacehistory',$insertdata);
            $_SESSION['searchFaceId'] = $this->db->insert_id();
            $page_data['page_name'] = 'checkPersonFaceFamilyUpdated';
            $page_data['title'] = 'Search By Face';
            $this->load->view('landing_page/index', $page_data);
        }else
        {
            if($para == 'step1')
            {
                // $getFinalId = $this->db->query('select max(Id) as Id from searchfacehistory')->result_array();
                // if($getFinalId[0]['Id'] != NULL)
                // {
                //     $_SESSION['searchFaceId'] = $getFinalId[0]['Id'] + 1;
                // }else{
                //     $_SESSION['searchFaceId'] = 1;
                // }
                $_SESSION['searchType'] = $_POST['type'];
                if(isset($_SESSION['landingMob']))
                {
                    $insertdata = array(
                        'mobileNumber' => $_SESSION['landingMob'],
                        'type' => $_POST['type'],
                    );   
                }else{
                    $insertdata = array(
                        'type' => $_POST['type'],
                    );
                }
                $insert = $this->db->insert('searchfacehistory',$insertdata);
                $_SESSION['searchFaceId'] = $this->db->insert_id();
                $response = array(
                    'isMobileAvailable' => (isset($_SESSION['landingMob']) ? 1 : 0)
                );
                echo json_encode($response);
            }
            if($para == 'step2')
            {
                $getPreviousDetail = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                if($getPreviousDetail[0]['otp'] == $_POST['otp'])
                {
                    $getDetail = $this->db->query('select * from nonKycUser where registration_mobile="'.$_POST['mobileNumber'].'"')->result_array();
                    if(count($getDetail) > 0)
                    {
                        if(isset($_SESSION['fcmtokenId']))
                        {
                            $update = $this->db->query('update notification_tokens_tbl set userType="guest", userId='.$getDetail[0]['uid'].' where Id='.$_SESSION['fcmtokenId']);
                        }
                        $_SESSION['landingMob'] = $_POST['mobileNumber'];
                        $_SESSION['user_id'] = $getDetail[0]['uid'];
                        $_SESSION['aadharName'] = $getDetail[0]['aadharname'];
                        $this->session->set_userdata('loginmob',$_POST['mobileNumber']);
                        $this->session->set_userdata('user_login', 'yes');
                        $this->session->set_userdata('gender', $getDetail[0]['gender']);
                        $this->session->set_userdata('login_type', 'NonKyc');
                    }else{
                        $insertdata = array(
                            'registration_mobile' => $_POST['mobileNumber']
                        );
                        $insert = $this->db->insert('nonKycUser',$insertdata);
                        $_SESSION['guestId'] = $this->db->insert_id();
                        $getDetail = $this->db->query('select * from nonKycUser where registration_mobile="'.$_POST['mobileNumber'].'"')->result_array();
                        if(isset($_SESSION['fcmtokenId']))
                        {
                            $update = $this->db->query('update notification_tokens_tbl set userType="guest", userId='.$getDetail[0]['uid'].' where Id='.$_SESSION['fcmtokenId']);
                        }
                        $_SESSION['landingMob'] = $_POST['mobileNumber'];
                        $_SESSION['user_id'] = $getDetail[0]['uid'];
                        $_SESSION['aadharName'] = $getDetail[0]['aadharname'];
                        $this->session->set_userdata('loginmob',$_POST['mobileNumber']);
                        $this->session->set_userdata('user_login', 'yes');
                        $this->session->set_userdata('gender', $getDetail[0]['gender']);
                        $this->session->set_userdata('login_type', 'NonKyc');
                    }
                    $updatedata = array(
                        'mobileNumber' => $_POST['mobileNumber'],
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$updatedata);
                    $response['status'] = 'success';
                }else{
                    $response['status'] = 'error';
                    $response['message'] = 'Invalid OTP';
                }
                echo json_encode($response);
            }
            if($para == 'step3')
            {
                $data = $_POST["mainPhotoSelected"];
                $image_array_1 = explode(";", $data);
                $split1 = explode('data:image/',$image_array_1[0]);
                $image_array_2 = explode(",", $image_array_1[1]);
                $data = base64_decode($image_array_2[1]);
                $imageId = $_SESSION['searchFaceId'];
                $newImagePath = 'upload/searchFacePerson/'.$imageId.'.'.$split1[1];
                unlink($newImagePath);
                file_put_contents($newImagePath, $data);
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                
                $faceresponse = json_decode(curl_exec($curl),true);
                curl_close($curl);
                $personName = '';
                $gender = '';
                $aadhar = '';
                $gender = '';
                $isVerified = 'No';
                $isVisible = 0;
                $age = '';
                $isWanted = 0;
                $isCriminal = 0;
                $wantedId = array();
                $criminalId = array();
                $address = '';
                $userphoto = '';
                $personId = 0;
                $isLapata = 0;
                $missingId = 0;
                $isUserFound = 0;
                $isMissing = 0;
                $isAadharCorrect = 0;
                $isGenderCorrect = 1;
                $isDobCorrect = 1;
                $userId = array();
                $missingId = array();
                $unknownId = array();
                $lapataId = array();
                $familyId = array();
                $wantedId = array();
                $criminalId = array();
                $finalcount = 0;
                curl_close($curl);
                if(count($faceresponse) > 0)
                {
                    if(count($faceresponse['output']) > 0)
                    {
                        foreach($faceresponse['output'] as $k=>$v)
                        {
                            if($finalcount <= 10)
                            {
                                $split = explode('_',$v);
                                if($split[0] == 'GEN')
                                {
                                    $this->db->or_where('imageId',$v);
                                    $this->db->or_where('imageId1',$v);
                                    $this->db->or_where('imageId2',$v);
                                    $user = $this->db->get('user')->result_array();
                                    if(count($user) > 0)
                                    {
                                        foreach($user as $k1=>$v1)
                                        {
                                            if(strtolower($_POST['gender']) == strtolower($v1['gender']))
                                            {
                                                array_push($userId,$v1['uid']);
                                                $finalcount++;   
                                            }
                                        }
                                    }else{
                                        $getAadharImageId = $this->db->query('select * from user where aadharImageId="'.$v.'"')->result_array();
                                        if(count($getAadharImageId) > 0)
                                        {
                                            foreach($getAadharImageId as $k1=>$v1)
                                            {
                                                if(strtolower($_POST['gender']) == strtolower($v1['gender']))
                                                {
                                                    if(strtotime($v1['aadharExpiryDate']) >= strtotime(date('Y-m-d')))
                                                    {
                                                        array_push($userId,$v1['uid']);
                                                        $finalcount++;   
                                                    }
                                                }
                                            }   
                                        }
                                    }       
                                }
                                if($split[0] == 'Missing')
                                {
                                    $this->db->where('imageId',$v);
                                    $this->db->where('isFinalSubmitted',1);
                                    $this->db->where('isFound',0);
                                    $missingperson = $this->db->get('missingperson')->result_array();
                                    if(count($missingperson) > 0)
                                    {
                                        foreach($missingperson as $k1=>$v1)
                                        {
                                            array_push($missingId,$v1['Id']);
                                            $finalcount++;
                                        }
                                    }
                                }
                                if($split[0] == 'LAP')
                                {
                                    $this->db->or_where('imageId',$v);
                                    $this->db->or_where('imageId1',$v);
                                    $this->db->or_where('imageId2',$v);
                                    $lapata = $this->db->get('unknown_person')->result_array();
                                    if(count($lapata) > 0)
                                    {
                                        foreach($lapata as $k1=>$v1)
                                        {
                                            if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                            {
                                                if($v1['isFound'] == '0')
                                                {
                                                    if($v1['awsEventName'] == 'All')
                                                    {
                                                        $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                        if($gender == strtolower($v1['Gender']))
                                                        {
                                                            if($v1['isFinalSubmitted'] == 1)
                                                            {
                                                                array_push($lapataId,$v1['id']);
                                                                $finalcount++;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                                if($split[0] == 'Wanted')
                                {
                                    $this->db->where('imageId',$v);
                                    $this->db->where('isFinalSubmitted',1);
                                    $this->db->where('status','Active');
                                    $wanted = $this->db->get('criminals')->result_array();
                                    if(count($wanted) > 0)
                                    {
                                        foreach($wanted as $k1=>$v1)
                                        {
                                            array_push($wantedId,$v1['Id']);
                                            $finalcount++;
                                        }
                                    }
                                }
                                if($split[0] == 'Criminal')
                                {
                                    $this->db->where('imageId',$v);
                                    $this->db->where('isFinalSubmitted',1);
                                    $this->db->where('status','Active');
                                    $criminal = $this->db->get('criminals')->result_array();
                                    if(count($criminal) > 0)
                                    {
                                        foreach($criminal as $k1=>$v1)
                                        {
                                            array_push($criminalId,$v1['Id']);
                                            $finalcount++;
                                        }
                                    }
                                }
                                if($split[0] == 'FAM')
                                {
                                    $this->db->or_where('imageId',$v);
                                    $this->db->or_where('imageId1',$v);
                                    $this->db->or_where('imageId2',$v);
                                    $familyMember = $this->db->get('familyMember')->result_array();
                                    if(count($familyMember) > 0)
                                    {
                                        foreach($familyMember as $k1=>$v1)
                                        {
                                            if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                            {
                                                if($v1['activeStatus'] == 1)
                                                {
                                                    $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                    if($gender == strtolower($v1['Gender']))
                                                    {
                                                        if($v1['isFinalSubmitted'] == 1)
                                                        {
                                                            array_push($familyId,$v1['id']);
                                                            $finalcount++;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $getUnknownDetail = $this->db->get('unknown_person')->result_array();
                                $getUnknownDetail = array();
                                if(count($getUnknownDetail) > 0)
                                {
                                    foreach($getUnknownDetail as $k1=>$v1)
                                    {
                                        if($v1['isFound'] == '0' && $v1['awsEventName'] != 'All')
                                        {
                                            $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                            if($gender == strtolower($v1['Gender']))
                                            {
                                                if($v1['isFinalSubmitted'] == 1)
                                                {
                                                    array_push($unknownId,$v1['id']);
                                                    $finalcount++;
                                                }
                                            }
                                        }
                                    }
                                }   
                            }
                        }
                    }
                }
                if($finalcount > 0)
                {
                    $insertdata = array(
                        'matchedLapataIds' => implode(',',$lapataId),
                        'matchedWantedIds' => implode(',',$wantedId),
                        'matchedCriminalIds' => implode(',',$criminalId),
                        'matchedMissingIds' => implode(',',$missingId),
                        'matchedUserIds' => implode(',',$userId),
                        'matchedUnknownIds' => implode(',',$unknownId),
                        'matchedFamilyIds' => implode(',',$familyId),
                        'mainPhoto' => $newImagePath,
                        'totalResponse' => json_encode($faceresponse),
                        'gender' => $_POST['gender'],
                        'imageId' => $imageId
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$insertdata);
                    $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                    $lapataIds = array();
                    if($getDetails[0]['matchedLapataIds'] != '')
                    {
                        $lapataIds = array_unique(explode(',',$getDetails[0]['matchedLapataIds']));   
                    }
                    $isLogin = 0;
                    if($this->session->userdata('user_login') == 'yes'){
                        $isLogin = 1;
                    }else{
                        if(isset($_SESSION['landingMob']))
                        {
                            $isLogin = 1;
                        }
                    }
                    if($isLogin == 0)
                    {
                        if(count($lapataIds) > 0)
                        {
                            $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$lapataIds[0])->result_array();
                            $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                            if($getApplicationNumber[0]['isKyc'] == 1)
                            {
                                $notifyData = array(
                                    'isLogin' => 0,
                                    'dateCreated' => date('Y-m-d H:i:s'),
                                    'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                    'searchType' => 'Lapata',
                                    'searchPhoto' => $getDetails[0]['mainPhoto'],
                                    'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                    'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                );
                                $insert = $this->db->insert('searchnotification',$notifyData);
                                if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                {
                                    $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                                    $query_res = $query->result_array();
                                    
                                    if(count($query_res) > 0)
                                    {
                                        foreach ($query_res as $query_res_data) {
                                            $registrationIds[] =$query_res_data['token'];
                                        }
                                        
                                        $url ="https://fcm.googleapis.com/v1/projects/khoji-61c54/messages:send";
                                        $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                        $fields=array(
                                            "token"=>$registrationIds,
                                            'data' => array("msg"=>"Khoji"),
                                            'priority' => 'high',
                                            "webpush" => array(
                                                "notification" => array(
                                                    "title" => "Khoji",
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                    "icon" => "assets/img/logo_new_ag.png",
                                                    "click_action" => base_url()
                                                ),
                                            ),
                                            "notification"=>array(
                                                "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                "title"=>"Khoji",
                                            )   
                                        );
                                        // $accessToken = $this->getAccessToken();
                                        $accessToken = '';
                                        $headers=array(
                                            'Authorization: Bearer '.$accessToken,
                                            'Content-Type:application/json'
                                        );
                                        $ch=curl_init();
                                        curl_setopt($ch,CURLOPT_URL,$url);
                                        curl_setopt($ch,CURLOPT_POST,true);
                                        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                        curl_exec($ch);
                                    }
                                }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                {
                                    $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                    $query_res = $query->result_array();
                                    
                                    if(count($query_res) > 0)
                                    {
                                        foreach ($query_res as $query_res_data) {
                                            $registrationIds[] =$query_res_data['token'];
                                        }
                                        
                                        $url ="https://fcm.googleapis.com/fcm/send";
                                        $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                        $fields=array(
                                            "registration_ids"=>$registrationIds,
                                            'data' => array("msg"=>"Khoji"),
                                            'priority' => 'high',
                                            "webpush" => array(
                                                "notification" => array(
                                                    "title" => "Khoji",
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                    "icon" => "assets/img/logo_new_ag.png",
                                                    "click_action" => base_url()
                                                ),
                                            ),
                                            "notification"=>array(
                                                "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                "title"=>"Khoji",
                                            )   
                                        );
                                        $headers=array(
                                            'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                            'Content-Type:application/json'
                                        );
                                        $ch=curl_init();
                                        curl_setopt($ch,CURLOPT_URL,$url);
                                        curl_setopt($ch,CURLOPT_POST,true);
                                        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                        curl_exec($ch);
                                    }
                                }else{
                                    $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                    $query_res = $query->result_array();
                                    
                                    if(count($query_res) > 0)
                                    {
                                        foreach ($query_res as $query_res_data) {
                                            $registrationIds[] =$query_res_data['token'];
                                        }
                                        
                                        $url ="https://fcm.googleapis.com/fcm/send";
                                        $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                        $fields=array(
                                            "registration_ids"=>$registrationIds,
                                            'data' => array("msg"=>"Khoji"),
                                            'priority' => 'high',
                                            "webpush" => array(
                                                "notification" => array(
                                                    "title" => "Khoji",
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                    "icon" => "assets/img/logo_new_ag.png",
                                                    "click_action" => base_url()
                                                ),
                                            ),
                                            "notification"=>array(
                                                "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                "title"=>"Khoji",
                                            )   
                                        );
                                        $headers=array(
                                            'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                            'Content-Type:application/json'
                                        );
                                        $ch=curl_init();
                                        curl_setopt($ch,CURLOPT_URL,$url);
                                        curl_setopt($ch,CURLOPT_POST,true);
                                        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                        curl_exec($ch);
                                    }
                                }
                            }else{
                                $notifyData = array(
                                    'isLogin' => 0,
                                    'dateCreated' => date('Y-m-d H:i:s'),
                                    'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                    'searchType' => 'Lapata',
                                    'searchPhoto' => $getDetails[0]['mainPhoto'],
                                    'complainantUserType' => 'NonKyc',
                                    'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                );
                                $insert = $this->db->insert('searchnotification',$notifyData);
                                if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                {
                                    $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                                    $query_res = $query->result_array();
                                    
                                    if(count($query_res) > 0)
                                    {
                                        foreach ($query_res as $query_res_data) {
                                            $registrationIds[] =$query_res_data['token'];
                                        }
                                        
                                        $url ="https://fcm.googleapis.com/fcm/send";
                                        $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                        $fields=array(
                                            "registration_ids"=>$registrationIds,
                                            'data' => array("msg"=>"Khoji"),
                                            'priority' => 'high',
                                            "webpush" => array(
                                                "notification" => array(
                                                    "title" => "Khoji",
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                    "icon" => "assets/img/logo_new_ag.png",
                                                    "click_action" => base_url()
                                                ),
                                            ),
                                            "notification"=>array(
                                                "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                "title"=>"Khoji",
                                            )   
                                        );
                                        $headers=array(
                                            'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                            'Content-Type:application/json'
                                        );
                                        $ch=curl_init();
                                        curl_setopt($ch,CURLOPT_URL,$url);
                                        curl_setopt($ch,CURLOPT_POST,true);
                                        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                        curl_exec($ch);
                                    }
                                }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                {
                                    $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                    $query_res = $query->result_array();
                                    
                                    if(count($query_res) > 0)
                                    {
                                        foreach ($query_res as $query_res_data) {
                                            $registrationIds[] =$query_res_data['token'];
                                        }
                                        
                                        $url ="https://fcm.googleapis.com/fcm/send";
                                        $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                        $fields=array(
                                            "registration_ids"=>$registrationIds,
                                            'data' => array("msg"=>"Khoji"),
                                            'priority' => 'high',
                                            "webpush" => array(
                                                "notification" => array(
                                                    "title" => "Khoji",
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                    "icon" => "assets/img/logo_new_ag.png",
                                                    "click_action" => base_url()
                                                ),
                                            ),
                                            "notification"=>array(
                                                "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                "title"=>"Khoji",
                                            )   
                                        );
                                        $headers=array(
                                            'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                            'Content-Type:application/json'
                                        );
                                        $ch=curl_init();
                                        curl_setopt($ch,CURLOPT_URL,$url);
                                        curl_setopt($ch,CURLOPT_POST,true);
                                        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                        curl_exec($ch);
                                    }
                                }else{
                                    $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                    $query_res = $query->result_array();
                                    
                                    if(count($query_res) > 0)
                                    {
                                        foreach ($query_res as $query_res_data) {
                                            $registrationIds[] =$query_res_data['token'];
                                        }
                                        
                                        $url ="https://fcm.googleapis.com/fcm/send";
                                        $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                        $fields=array(
                                            "registration_ids"=>$registrationIds,
                                            'data' => array("msg"=>"Khoji"),
                                            'priority' => 'high',
                                            "webpush" => array(
                                                "notification" => array(
                                                    "title" => "Khoji",
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                    "icon" => "assets/img/logo_new_ag.png",
                                                    "click_action" => base_url()
                                                ),
                                            ),
                                            "notification"=>array(
                                                "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                "title"=>"Khoji",
                                            )   
                                        );
                                        $headers=array(
                                            'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                            'Content-Type:application/json'
                                        );
                                        $ch=curl_init();
                                        curl_setopt($ch,CURLOPT_URL,$url);
                                        curl_setopt($ch,CURLOPT_POST,true);
                                        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                        curl_exec($ch);
                                    }
                                }
                            }
                        }else{
                            if(count($unknownId) > 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$unknownId[0])->result_array();
                                $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $getDetails[0]['mainPhoto'],
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $getDetails[0]['mainPhoto'],
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    $response = array(
                        'status' => 'success',
                        'personName' => $personName,
                        'isWanted' => $isWanted,
                        'isCriminal' => $isCriminal,
                        'isLapata' => $isLapata,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => $isDobCorrect,
                        'isGenderCorrect' => $isGenderCorrect,
                        'message' => 'Person Found',
                        'isMissing' => $isMissing,
                        'isRegistered' => $isUserFound,
                        'image' => $userphoto,
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }else{
                    $response = array(
                        'status' => 'success',
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }
            }
            if($para == 'step4')
            {
                $data = $_POST["mainPhotoSelected"];
                $image_array_1 = explode(";", $data);
                $split1 = explode('data:image/',$image_array_1[0]);
                $image_array_2 = explode(",", $image_array_1[1]);
                $data = base64_decode($image_array_2[1]);
                $imageId = time().''.rand(0,10000);
                $newImagePath = 'upload/searchFacePerson/'.$imageId.'.'.$split1[1];
                file_put_contents($newImagePath, $data);
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                $faceresponse = json_decode(curl_exec($curl),true);
                $personName = '';
                $gender = '';
                $aadhar = '';
                $gender = '';
                $isVerified = 'No';
                $isVisible = 0;
                $age = '';
                $isWanted = 0;
                $isCriminal = 0;
                $wantedId = array();
                $criminalId = array();
                $address = '';
                $userphoto = '';
                $personId = 0;
                $isLapata = 0;
                $missingId = 0;
                $isUserFound = 0;
                $isMissing = 0;
                $isAadharCorrect = 0;
                $isGenderCorrect = 1;
                $isDobCorrect = 1;
                $userId = array();
                $missingId = array();
                $lapataId = array();
                $familyId = array();
                $wantedId = array();
                $criminalId = array();
                $finalcount = 0;
                curl_close($curl);
                if(count($faceresponse) > 0)
                {
                    if(count($faceresponse['output']) > 0)
                    {
                        foreach($faceresponse['output'] as $k=>$v)
                        {
                            $split = explode('_',$v);
                            if($split[0] == 'GEN')
                            {
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $user = $this->db->get('user')->result_array();
                                if(count($user) > 0)
                                {
                                    foreach($user as $k1=>$v1)
                                    {
                                        array_push($userId,$v1['uid']);
                                        $finalcount++;
                                    }
                                }else{
                                    $getAadharImageId = $this->db->query('select * from user where aadharImageId="'.$v.'"')->result_array();
                                    if(count($getAadharImageId) > 0)
                                    {
                                        foreach($getAadharImageId as $k1=>$v1)
                                        {
                                            if(strtolower($_POST['gender']) == strtolower($v1['gender']))
                                            {
                                                if(strtotime($v1['aadharExpiryDate']) >= strtotime(date('Y-m-d')))
                                                {
                                                    array_push($userId,$v1['uid']);
                                                    $finalcount++;   
                                                }
                                            }
                                        }   
                                    }
                                }
                            }
                            if($split[0] == 'Missing')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('isFound',0);
                                $missingperson = $this->db->get('missingperson')->result_array();
                                if(count($missingperson) > 0)
                                {
                                    foreach($missingperson as $k1=>$v1)
                                    {
                                        array_push($missingId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'LAP')
                            {
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $this->db->where('expiryDate >=',date('Y-m-d h:i:s'));
                                $this->db->where('isFound',0);
                                $lapata = $this->db->get('unknown_person')->result_array();
                                if(count($lapata) > 0)
                                {
                                    foreach($lapata as $k1=>$v1)
                                    {
                                        array_push($lapataId,$v1['id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'Wanted')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('status','Active');
                                $wanted = $this->db->get('criminals')->result_array();
                                if(count($wanted) > 0)
                                {
                                    foreach($wanted as $k1=>$v1)
                                    {
                                        array_push($wantedId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'Criminal')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('status','Active');
                                $criminal = $this->db->get('criminals')->result_array();
                                if(count($criminal) > 0)
                                {
                                    foreach($criminal as $k1=>$v1)
                                    {
                                        array_push($criminalId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if(split[0] == 'FAM')
                            {
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $this->db->where('expiryDate >=',date('Y-m-d h:i:s'));
                                $this->db->where('activeStatus',1);
                                $familyMember = $this->db->get('familyMember')->result_array();
                                if(count($familyMember) > 0)
                                {
                                    foreach($familyMember as $k1=>$v1)
                                    {
                                        array_push($familyId,$v1['id']);
                                        $finalcount++;
                                    }
                                }
                            }
                        }
                    }
                }
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Accept: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                
                $faceresponse = json_decode(curl_exec($curl),true);
                $unknownId = array();
                /* if(count($faceresponse['output']) > 0)
                {
                    foreach($faceresponse['output'] as $k1=>$v1)
                    {
                        $this->db->where('isFinalSubmitted',1);
                        $this->db->or_where('imageId',$v1);
                        $this->db->or_where('imageId1',$v1);
                        $this->db->or_where('imageId2',$v1);
                        $getUnknownDetail = $this->db->get('unknown_person')->result_array();
                        if(count($getUnknownDetail) > 0)
                        {
                            foreach($getUnknownDetail as $k=>$v)
                            {
                                if($v['isFound'] == 0)
                                {
                                    array_push($unknownId,$v1['id']);
                                    $finalcount++;
                                }
                            }
                        }   
                    }
                }*/
                if($finalcount > 0)
                {
                    if(count($lapataId) > 0)
                    {
                        foreach($lapataId as $k=>$v)
                        {
                            if($k == 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$v)->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Lapata',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Lapata',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    if(count($unknownId) > 0)
                    {
                        foreach($unknownId as $k=>$v)
                        {
                            if($k == 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$v)->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    $insertdata = array(
                        'matchedLapataIds' => implode(',',$lapataId),
                        'matchedWantedIds' => implode(',',$wantedId),
                        'matchedCriminalIds' => implode(',',$criminalId),
                        'matchedMissingIds' => implode(',',$missingId),
                        'matchedUserIds' => implode(',',$userId),
                        'matchedUnknownIds' => implode(',',$unknownId),
                        'matchedFamilyIds' => implode(',',$familyId),
                        'mainPhoto' => $newImagePath
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$insertdata);
                    $response = array(
                        'status' => 'success',
                        'personName' => $personName,
                        'isWanted' => $isWanted,
                        'isCriminal' => $isCriminal,
                        'isLapata' => $isLapata,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => $isDobCorrect,
                        'isGenderCorrect' => $isGenderCorrect,
                        'message' => 'Person Found',
                        'isMissing' => $isMissing,
                        'isRegistered' => $isUserFound,
                        'image' => $userphoto,
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }else{
                    $response = array(
                        'status' => 'success',
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }
            }
            
        }
    }
    
    function checkPersonFaceUpdated($para = '')
    {
        if($para == '')
        {
            $page_data['control'] = 'user';
            $page_data['pn'] = 3;       
            $_SESSION['searchType'] = 1;
            if(isset($_SESSION['landingMob']))
            {
                $insertdata = array(
                    'mobileNumber' => $_SESSION['landingMob'],
                    'type' => 1,
                );   
            }else{
                $insertdata = array(
                    'type' => 1,
                );
            }
            $insert = $this->db->insert('searchfacehistory',$insertdata);
            $_SESSION['searchFaceId'] = $this->db->insert_id();
            $page_data['page_name'] = 'checkPersonFaceUpdated';
            $page_data['title'] = 'Search By Face';
            $this->load->view('landing_page/index', $page_data);
        }else
        {
            if($para == 'step1')
            {
                // $getFinalId = $this->db->query('select max(Id) as Id from searchfacehistory')->result_array();
                // if($getFinalId[0]['Id'] != NULL)
                // {
                //     $_SESSION['searchFaceId'] = $getFinalId[0]['Id'] + 1;
                // }else{
                //     $_SESSION['searchFaceId'] = 1;
                // }
                $_SESSION['searchType'] = $_POST['type'];
                if(isset($_SESSION['landingMob']))
                {
                    $insertdata = array(
                        'mobileNumber' => $_SESSION['landingMob'],
                        'type' => $_POST['type'],
                    );   
                }else{
                    $insertdata = array(
                        'type' => $_POST['type'],
                    );
                }
                $insert = $this->db->insert('searchfacehistory',$insertdata);
                $_SESSION['searchFaceId'] = $this->db->insert_id();
                $response = array(
                    'isMobileAvailable' => (isset($_SESSION['landingMob']) ? 1 : 0)
                );
                echo json_encode($response);
            }
            if($para == 'step2')
            {
                $getPreviousDetail = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                if($getPreviousDetail[0]['otp'] == $_POST['otp'])
                {
                    $getDetail = $this->db->query('select * from nonKycUser where registration_mobile="'.$_POST['mobileNumber'].'"')->result_array();
                    if(count($getDetail) > 0)
                    {
                        if(isset($_SESSION['fcmtokenId']))
                        {
                            $update = $this->db->query('update notification_tokens_tbl set userType="guest", userId='.$getDetail[0]['uid'].' where Id='.$_SESSION['fcmtokenId']);
                        }
                        $_SESSION['landingMob'] = $_POST['mobileNumber'];
                        $_SESSION['user_id'] = $getDetail[0]['uid'];
                        $_SESSION['aadharName'] = $getDetail[0]['aadharname'];
                        $this->session->set_userdata('loginmob',$_POST['mobileNumber']);
                        $this->session->set_userdata('user_login', 'yes');
                        $this->session->set_userdata('gender', $getDetail[0]['gender']);
                        $this->session->set_userdata('login_type', 'NonKyc');
                    }else{
                        $insertdata = array(
                            'registration_mobile' => $_POST['mobileNumber']
                        );
                        $insert = $this->db->insert('nonKycUser',$insertdata);
                        $_SESSION['guestId'] = $this->db->insert_id();
                        $getDetail = $this->db->query('select * from nonKycUser where registration_mobile="'.$_POST['mobileNumber'].'"')->result_array();
                        if(isset($_SESSION['fcmtokenId']))
                        {
                            $update = $this->db->query('update notification_tokens_tbl set userType="guest", userId='.$getDetail[0]['uid'].' where Id='.$_SESSION['fcmtokenId']);
                        }
                        $_SESSION['landingMob'] = $_POST['mobileNumber'];
                        $_SESSION['user_id'] = $getDetail[0]['uid'];
                        $_SESSION['aadharName'] = $getDetail[0]['aadharname'];
                        $this->session->set_userdata('loginmob',$_POST['mobileNumber']);
                        $this->session->set_userdata('user_login', 'yes');
                        $this->session->set_userdata('gender', $getDetail[0]['gender']);
                        $this->session->set_userdata('login_type', 'NonKyc');
                    }
                    $updatedata = array(
                        'mobileNumber' => $_POST['mobileNumber'],
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$updatedata);
                    $response['status'] = 'success';
                }else{
                    $response['status'] = 'error';
                    $response['message'] = 'Invalid OTP';
                }
                echo json_encode($response);
            }
            if($para == 'step3')
            {
                $data = $_POST["mainPhotoSelected"];
                $image_array_1 = explode(";", $data);
                $split1 = explode('data:image/',$image_array_1[0]);
                $image_array_2 = explode(",", $image_array_1[1]);
                $data = base64_decode($image_array_2[1]);
                $imageId = $_SESSION['searchFaceId'];
                $newImagePath = 'upload/searchFacePerson/'.$imageId.'.'.$split1[1];
                unlink($newImagePath);
                file_put_contents($newImagePath, $data);
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                
                $faceresponse = json_decode(curl_exec($curl),true);
                curl_close($curl);
                $personName = '';
                $gender = '';
                $aadhar = '';
                $gender = '';
                $isVerified = 'No';
                $isVisible = 0;
                $age = '';
                $isWanted = 0;
                $isCriminal = 0;
                $wantedId = array();
                $criminalId = array();
                $address = '';
                $userphoto = '';
                $personId = 0;
                $isLapata = 0;
                $missingId = 0;
                $isUserFound = 0;
                $isMissing = 0;
                $isAadharCorrect = 0;
                $isGenderCorrect = 1;
                $isDobCorrect = 1;
                $userId = array();
                $missingId = array();
                $unknownId = array();
                $lapataId = array();
                $familyId = array();
                $wantedId = array();
                $criminalId = array();
                $finalcount = 0;
                curl_close($curl);
                if(count($faceresponse) > 0)
                {
                    if(count($faceresponse['output']) > 0)
                    {
                        foreach($faceresponse['output'] as $k=>$v)
                        {
                            if($finalcount <= 10)
                            {
                                $split = explode('_',$v);
                                if($split[0] == 'GEN')
                                {
                                    $this->db->or_where('imageId',$v);
                                    $this->db->or_where('imageId1',$v);
                                    $this->db->or_where('imageId2',$v);
                                    $user = $this->db->get('user')->result_array();
                                    if(count($user) > 0)
                                    {
                                        foreach($user as $k1=>$v1)
                                        {
                                            if(strtolower($_POST['gender']) == strtolower($v1['gender']))
                                            {
                                                array_push($userId,$v1['uid']);
                                                $finalcount++;   
                                            }
                                        }
                                    }else{
                                        $getAadharImageId = $this->db->query('select * from user where aadharImageId="'.$v.'"')->result_array();
                                        if(count($getAadharImageId) > 0)
                                        {
                                            foreach($getAadharImageId as $k1=>$v1)
                                            {
                                                if(strtolower($_POST['gender']) == strtolower($v1['gender']))
                                                {
                                                    if(strtotime($v1['aadharExpiryDate']) >= strtotime(date('Y-m-d')))
                                                    {
                                                        array_push($userId,$v1['uid']);
                                                        $finalcount++;   
                                                    }
                                                }
                                            }   
                                        }
                                    }       
                                }
                                if($split[0] == 'Missing')
                                {
                                    $this->db->where('imageId',$v);
                                    $this->db->where('isFinalSubmitted',1);
                                    $this->db->where('isFound',0);
                                    $missingperson = $this->db->get('missingperson')->result_array();
                                    if(count($missingperson) > 0)
                                    {
                                        foreach($missingperson as $k1=>$v1)
                                        {
                                            array_push($missingId,$v1['Id']);
                                            $finalcount++;
                                        }
                                    }
                                }
                                if($split[0] == 'LAP')
                                {
                                    $this->db->or_where('imageId',$v);
                                    $this->db->or_where('imageId1',$v);
                                    $this->db->or_where('imageId2',$v);
                                    $lapata = $this->db->get('unknown_person')->result_array();
                                    if(count($lapata) > 0)
                                    {
                                        foreach($lapata as $k1=>$v1)
                                        {
                                            if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                            {
                                                if($v1['isFound'] == '0')
                                                {
                                                    if($v1['awsEventName'] == 'All')
                                                    {
                                                        $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                        if($gender == strtolower($v1['Gender']))
                                                        {
                                                            if($v1['isFinalSubmitted'] == 1)
                                                            {
                                                                array_push($lapataId,$v1['id']);
                                                                $finalcount++;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                                if($split[0] == 'Wanted')
                                {
                                    $this->db->where('imageId',$v);
                                    $this->db->where('isFinalSubmitted',1);
                                    $this->db->where('status','Active');
                                    $wanted = $this->db->get('criminals')->result_array();
                                    if(count($wanted) > 0)
                                    {
                                        foreach($wanted as $k1=>$v1)
                                        {
                                            array_push($wantedId,$v1['Id']);
                                            $finalcount++;
                                        }
                                    }
                                }
                                if($split[0] == 'Criminal')
                                {
                                    $this->db->where('imageId',$v);
                                    $this->db->where('isFinalSubmitted',1);
                                    $this->db->where('status','Active');
                                    $criminal = $this->db->get('criminals')->result_array();
                                    if(count($criminal) > 0)
                                    {
                                        foreach($criminal as $k1=>$v1)
                                        {
                                            array_push($criminalId,$v1['Id']);
                                            $finalcount++;
                                        }
                                    }
                                }
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $getUnknownDetail = $this->db->get('unknown_person')->result_array();
                                $getUnknownDetail = array();
                                if(count($getUnknownDetail) > 0)
                                {
                                    foreach($getUnknownDetail as $k1=>$v1)
                                    {
                                        if($v1['isFound'] == '0' && $v1['awsEventName'] != 'All')
                                        {
                                            $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                            if($gender == strtolower($v1['Gender']))
                                            {
                                                if($v1['isFinalSubmitted'] == 1)
                                                {
                                                    array_push($unknownId,$v1['id']);
                                                    $finalcount++;
                                                }
                                            }
                                        }
                                    }
                                }   
                            }
                        }
                    }
                }
                if($finalcount > 0)
                {
                    $insertdata = array(
                        'matchedLapataIds' => implode(',',$lapataId),
                        'matchedWantedIds' => implode(',',$wantedId),
                        'matchedCriminalIds' => implode(',',$criminalId),
                        'matchedMissingIds' => implode(',',$missingId),
                        'matchedUserIds' => implode(',',$userId),
                        'matchedUnknownIds' => implode(',',$unknownId),
                        'matchedFamilyIds' => implode(',',$familyId),
                        'mainPhoto' => $newImagePath,
                        'totalResponse' => json_encode($faceresponse),
                        'gender' => $_POST['gender'],
                        'imageId' => $imageId
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$insertdata);
                    $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                    $lapataIds = array();
                    if($getDetails[0]['matchedLapataIds'] != '')
                    {
                        $lapataIds = array_unique(explode(',',$getDetails[0]['matchedLapataIds']));   
                    }
                    $isLogin = 0;
                    if($this->session->userdata('user_login') == 'yes'){
                        $isLogin = 1;
                    }else{
                        if(isset($_SESSION['landingMob']))
                        {
                            $isLogin = 1;
                        }
                    }
                    if($isLogin == 0)
                    {
                        if(count($lapataIds) > 0)
                        {
                            $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$lapataIds[0])->result_array();
                            $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                            if($getApplicationNumber[0]['isKyc'] == 1)
                            {
                                $notifyData = array(
                                    'isLogin' => 0,
                                    'dateCreated' => date('Y-m-d H:i:s'),
                                    'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                    'searchType' => 'Lapata',
                                    'searchPhoto' => $getDetails[0]['mainPhoto'],
                                    'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                    'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                );
                                $insert = $this->db->insert('searchnotification',$notifyData);
                                if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                {
                                    $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                                    $query_res = $query->result_array();
                                    
                                    if(count($query_res) > 0)
                                    {
                                        foreach ($query_res as $query_res_data) {
                                            $registrationIds[] =$query_res_data['token'];
                                        }
                                        
                                        $url ="https://fcm.googleapis.com/v1/projects/khoji-61c54/messages:send";
                                        $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                        $fields=array(
                                            "token"=>$registrationIds,
                                            'data' => array("msg"=>"Khoji"),
                                            'priority' => 'high',
                                            "webpush" => array(
                                                "notification" => array(
                                                    "title" => "Khoji",
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                    "icon" => "assets/img/logo_new_ag.png",
                                                    "click_action" => base_url()
                                                ),
                                            ),
                                            "notification"=>array(
                                                "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                "title"=>"Khoji",
                                            )   
                                        );
                                        // $accessToken = $this->getAccessToken();
                                        $accessToken = '';
                                        $headers=array(
                                            'Authorization: Bearer '.$accessToken,
                                            'Content-Type:application/json'
                                        );
                                        $ch=curl_init();
                                        curl_setopt($ch,CURLOPT_URL,$url);
                                        curl_setopt($ch,CURLOPT_POST,true);
                                        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                        curl_exec($ch);
                                    }
                                }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                {
                                    $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                    $query_res = $query->result_array();
                                    
                                    if(count($query_res) > 0)
                                    {
                                        foreach ($query_res as $query_res_data) {
                                            $registrationIds[] =$query_res_data['token'];
                                        }
                                        
                                        $url ="https://fcm.googleapis.com/fcm/send";
                                        $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                        $fields=array(
                                            "registration_ids"=>$registrationIds,
                                            'data' => array("msg"=>"Khoji"),
                                            'priority' => 'high',
                                            "webpush" => array(
                                                "notification" => array(
                                                    "title" => "Khoji",
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                    "icon" => "assets/img/logo_new_ag.png",
                                                    "click_action" => base_url()
                                                ),
                                            ),
                                            "notification"=>array(
                                                "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                "title"=>"Khoji",
                                            )   
                                        );
                                        $headers=array(
                                            'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                            'Content-Type:application/json'
                                        );
                                        $ch=curl_init();
                                        curl_setopt($ch,CURLOPT_URL,$url);
                                        curl_setopt($ch,CURLOPT_POST,true);
                                        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                        curl_exec($ch);
                                    }
                                }else{
                                    $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                    $query_res = $query->result_array();
                                    
                                    if(count($query_res) > 0)
                                    {
                                        foreach ($query_res as $query_res_data) {
                                            $registrationIds[] =$query_res_data['token'];
                                        }
                                        
                                        $url ="https://fcm.googleapis.com/fcm/send";
                                        $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                        $fields=array(
                                            "registration_ids"=>$registrationIds,
                                            'data' => array("msg"=>"Khoji"),
                                            'priority' => 'high',
                                            "webpush" => array(
                                                "notification" => array(
                                                    "title" => "Khoji",
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                    "icon" => "assets/img/logo_new_ag.png",
                                                    "click_action" => base_url()
                                                ),
                                            ),
                                            "notification"=>array(
                                                "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                "title"=>"Khoji",
                                            )   
                                        );
                                        $headers=array(
                                            'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                            'Content-Type:application/json'
                                        );
                                        $ch=curl_init();
                                        curl_setopt($ch,CURLOPT_URL,$url);
                                        curl_setopt($ch,CURLOPT_POST,true);
                                        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                        curl_exec($ch);
                                    }
                                }
                            }else{
                                $notifyData = array(
                                    'isLogin' => 0,
                                    'dateCreated' => date('Y-m-d H:i:s'),
                                    'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                    'searchType' => 'Lapata',
                                    'searchPhoto' => $getDetails[0]['mainPhoto'],
                                    'complainantUserType' => 'NonKyc',
                                    'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                );
                                $insert = $this->db->insert('searchnotification',$notifyData);
                                if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                {
                                    $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                                    $query_res = $query->result_array();
                                    
                                    if(count($query_res) > 0)
                                    {
                                        foreach ($query_res as $query_res_data) {
                                            $registrationIds[] =$query_res_data['token'];
                                        }
                                        
                                        $url ="https://fcm.googleapis.com/fcm/send";
                                        $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                        $fields=array(
                                            "registration_ids"=>$registrationIds,
                                            'data' => array("msg"=>"Khoji"),
                                            'priority' => 'high',
                                            "webpush" => array(
                                                "notification" => array(
                                                    "title" => "Khoji",
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                    "icon" => "assets/img/logo_new_ag.png",
                                                    "click_action" => base_url()
                                                ),
                                            ),
                                            "notification"=>array(
                                                "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                "title"=>"Khoji",
                                            )   
                                        );
                                        $headers=array(
                                            'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                            'Content-Type:application/json'
                                        );
                                        $ch=curl_init();
                                        curl_setopt($ch,CURLOPT_URL,$url);
                                        curl_setopt($ch,CURLOPT_POST,true);
                                        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                        curl_exec($ch);
                                    }
                                }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                {
                                    $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                    $query_res = $query->result_array();
                                    
                                    if(count($query_res) > 0)
                                    {
                                        foreach ($query_res as $query_res_data) {
                                            $registrationIds[] =$query_res_data['token'];
                                        }
                                        
                                        $url ="https://fcm.googleapis.com/fcm/send";
                                        $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                        $fields=array(
                                            "registration_ids"=>$registrationIds,
                                            'data' => array("msg"=>"Khoji"),
                                            'priority' => 'high',
                                            "webpush" => array(
                                                "notification" => array(
                                                    "title" => "Khoji",
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                    "icon" => "assets/img/logo_new_ag.png",
                                                    "click_action" => base_url()
                                                ),
                                            ),
                                            "notification"=>array(
                                                "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                "title"=>"Khoji",
                                            )   
                                        );
                                        $headers=array(
                                            'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                            'Content-Type:application/json'
                                        );
                                        $ch=curl_init();
                                        curl_setopt($ch,CURLOPT_URL,$url);
                                        curl_setopt($ch,CURLOPT_POST,true);
                                        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                        curl_exec($ch);
                                    }
                                }else{
                                    $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                    $query_res = $query->result_array();
                                    
                                    if(count($query_res) > 0)
                                    {
                                        foreach ($query_res as $query_res_data) {
                                            $registrationIds[] =$query_res_data['token'];
                                        }
                                        
                                        $url ="https://fcm.googleapis.com/fcm/send";
                                        $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                        $fields=array(
                                            "registration_ids"=>$registrationIds,
                                            'data' => array("msg"=>"Khoji"),
                                            'priority' => 'high',
                                            "webpush" => array(
                                                "notification" => array(
                                                    "title" => "Khoji",
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                    "icon" => "assets/img/logo_new_ag.png",
                                                    "click_action" => base_url()
                                                ),
                                            ),
                                            "notification"=>array(
                                                "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                "title"=>"Khoji",
                                            )   
                                        );
                                        $headers=array(
                                            'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                            'Content-Type:application/json'
                                        );
                                        $ch=curl_init();
                                        curl_setopt($ch,CURLOPT_URL,$url);
                                        curl_setopt($ch,CURLOPT_POST,true);
                                        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                        curl_exec($ch);
                                    }
                                }
                            }
                        }else{
                            if(count($unknownId) > 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$unknownId[0])->result_array();
                                $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $getDetails[0]['mainPhoto'],
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $getDetails[0]['mainPhoto'],
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    $response = array(
                        'status' => 'success',
                        'personName' => $personName,
                        'isWanted' => $isWanted,
                        'isCriminal' => $isCriminal,
                        'isLapata' => $isLapata,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => $isDobCorrect,
                        'isGenderCorrect' => $isGenderCorrect,
                        'message' => 'Person Found',
                        'isMissing' => $isMissing,
                        'isRegistered' => $isUserFound,
                        'image' => $userphoto,
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }else{
                    $response = array(
                        'status' => 'success',
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }
            }
            if($para == 'step4')
            {
                $data = $_POST["mainPhotoSelected"];
                $image_array_1 = explode(";", $data);
                $split1 = explode('data:image/',$image_array_1[0]);
                $image_array_2 = explode(",", $image_array_1[1]);
                $data = base64_decode($image_array_2[1]);
                $imageId = time().''.rand(0,10000);
                $newImagePath = 'upload/searchFacePerson/'.$imageId.'.'.$split1[1];
                file_put_contents($newImagePath, $data);
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                $faceresponse = json_decode(curl_exec($curl),true);
                $personName = '';
                $gender = '';
                $aadhar = '';
                $gender = '';
                $isVerified = 'No';
                $isVisible = 0;
                $age = '';
                $isWanted = 0;
                $isCriminal = 0;
                $wantedId = array();
                $criminalId = array();
                $address = '';
                $userphoto = '';
                $personId = 0;
                $isLapata = 0;
                $missingId = 0;
                $isUserFound = 0;
                $isMissing = 0;
                $isAadharCorrect = 0;
                $isGenderCorrect = 1;
                $isDobCorrect = 1;
                $userId = array();
                $missingId = array();
                $lapataId = array();
                $familyId = array();
                $wantedId = array();
                $criminalId = array();
                $finalcount = 0;
                curl_close($curl);
                if(count($faceresponse) > 0)
                {
                    if(count($faceresponse['output']) > 0)
                    {
                        foreach($faceresponse['output'] as $k=>$v)
                        {
                            $split = explode('_',$v);
                            if($split[0] == 'GEN')
                            {
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $user = $this->db->get('user')->result_array();
                                if(count($user) > 0)
                                {
                                    foreach($user as $k1=>$v1)
                                    {
                                        array_push($userId,$v1['uid']);
                                        $finalcount++;
                                    }
                                }else{
                                    $getAadharImageId = $this->db->query('select * from user where aadharImageId="'.$v.'"')->result_array();
                                    if(count($getAadharImageId) > 0)
                                    {
                                        foreach($getAadharImageId as $k1=>$v1)
                                        {
                                            if(strtolower($_POST['gender']) == strtolower($v1['gender']))
                                            {
                                                if(strtotime($v1['aadharExpiryDate']) >= strtotime(date('Y-m-d')))
                                                {
                                                    array_push($userId,$v1['uid']);
                                                    $finalcount++;   
                                                }
                                            }
                                        }   
                                    }
                                }
                            }
                            if($split[0] == 'Missing')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('isFound',0);
                                $missingperson = $this->db->get('missingperson')->result_array();
                                if(count($missingperson) > 0)
                                {
                                    foreach($missingperson as $k1=>$v1)
                                    {
                                        array_push($missingId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'LAP')
                            {
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $this->db->where('expiryDate >=',date('Y-m-d h:i:s'));
                                $this->db->where('isFound',0);
                                $lapata = $this->db->get('unknown_person')->result_array();
                                if(count($lapata) > 0)
                                {
                                    foreach($lapata as $k1=>$v1)
                                    {
                                        array_push($lapataId,$v1['id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'Wanted')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('status','Active');
                                $wanted = $this->db->get('criminals')->result_array();
                                if(count($wanted) > 0)
                                {
                                    foreach($wanted as $k1=>$v1)
                                    {
                                        array_push($wantedId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'Criminal')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('status','Active');
                                $criminal = $this->db->get('criminals')->result_array();
                                if(count($criminal) > 0)
                                {
                                    foreach($criminal as $k1=>$v1)
                                    {
                                        array_push($criminalId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if(split[0] == 'FAM')
                            {
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $this->db->where('expiryDate >=',date('Y-m-d h:i:s'));
                                $this->db->where('activeStatus',1);
                                $familyMember = $this->db->get('familyMember')->result_array();
                                if(count($familyMember) > 0)
                                {
                                    foreach($familyMember as $k1=>$v1)
                                    {
                                        array_push($familyId,$v1['id']);
                                        $finalcount++;
                                    }
                                }
                            }
                        }
                    }
                }
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Accept: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                
                $faceresponse = json_decode(curl_exec($curl),true);
                $unknownId = array();
                /* if(count($faceresponse['output']) > 0)
                {
                    foreach($faceresponse['output'] as $k1=>$v1)
                    {
                        $this->db->where('isFinalSubmitted',1);
                        $this->db->or_where('imageId',$v1);
                        $this->db->or_where('imageId1',$v1);
                        $this->db->or_where('imageId2',$v1);
                        $getUnknownDetail = $this->db->get('unknown_person')->result_array();
                        if(count($getUnknownDetail) > 0)
                        {
                            foreach($getUnknownDetail as $k=>$v)
                            {
                                if($v['isFound'] == 0)
                                {
                                    array_push($unknownId,$v1['id']);
                                    $finalcount++;
                                }
                            }
                        }   
                    }
                }*/
                if($finalcount > 0)
                {
                    if(count($lapataId) > 0)
                    {
                        foreach($lapataId as $k=>$v)
                        {
                            if($k == 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$v)->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Lapata',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Lapata',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    if(count($unknownId) > 0)
                    {
                        foreach($unknownId as $k=>$v)
                        {
                            if($k == 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$v)->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    $insertdata = array(
                        'matchedLapataIds' => implode(',',$lapataId),
                        'matchedWantedIds' => implode(',',$wantedId),
                        'matchedCriminalIds' => implode(',',$criminalId),
                        'matchedMissingIds' => implode(',',$missingId),
                        'matchedUserIds' => implode(',',$userId),
                        'matchedUnknownIds' => implode(',',$unknownId),
                        'matchedFamilyIds' => implode(',',$familyId),
                        'mainPhoto' => $newImagePath
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$insertdata);
                    $response = array(
                        'status' => 'success',
                        'personName' => $personName,
                        'isWanted' => $isWanted,
                        'isCriminal' => $isCriminal,
                        'isLapata' => $isLapata,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => $isDobCorrect,
                        'isGenderCorrect' => $isGenderCorrect,
                        'message' => 'Person Found',
                        'isMissing' => $isMissing,
                        'isRegistered' => $isUserFound,
                        'image' => $userphoto,
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }else{
                    $response = array(
                        'status' => 'success',
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }
            }
            
        }
    }
    
    function checkPersonFilterDetailsOld($para = '')
    {
        if($para == '')
        {
            $page_data['control'] = 'user';
            $page_data['pn'] = 1;
            if(isset($_GET['pn']))
            {
                $page_data['pn'] = $_GET['pn'];    
            }
            $page_data['page_name'] = 'searchFacePerson';
            $page_data['title'] = 'Search By Person';
            $this->load->view('landing_page/index', $page_data);
        }else
        {
            if($para == 'step1')
            {
                $getPreviousDetail = $this->db->query('select * from searchFilterLogs where Id='.$_SESSION['filterId'])->result_array();
                if($getPreviousDetail[0]['otp'] == $_POST['otp'])
                {
                    $_SESSION['landingMob'] = $_POST['mobileNumber'];
                    $response['status'] = 'success';
                }else{
                    $response['status'] = 'error';
                    $response['message'] = 'Invalid OTP';
                }
                echo json_encode($response);
            }
            if($para == 'step2')
            {
                $getPreviousDetail = $this->db->query('select * from searchfilterhistory where Id='.$_SESSION['searchFaceId'])->result_array();
                if($getPreviousDetail[0]['otp'] == $_POST['otp'])
                {
                    $updatedata = array(
                        'mobileNumber' => $_POST['mobileNumber'],
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfilterhistory',$updatedata);
                    $_SESSION['landingMob'] = $_POST['mobileNumber'];
                    $response['status'] = 'success';
                }else{
                    $response['status'] = 'error';
                    $response['message'] = 'Invalid OTP';
                }
                echo json_encode($response);
            }
            if($para == 'step3')
            {
                $getPreviousDetail = $this->db->query('select * from searchfilterhistory where Id='.$_SESSION['searchFaceId'])->result_array();
                $data = $_POST["mainPhotoSelected"];
                $image_array_1 = explode(";", $data);
                $split1 = explode('data:image/',$image_array_1[0]);
                $image_array_2 = explode(",", $image_array_1[1]);
                
                $data = base64_decode($image_array_2[1]);
                
                $newImagePath = 'upload/searchFacePerson/'.time().''.rand(0,10000).'.'.$split1[1];
                
                file_put_contents($newImagePath, $data);
                $updatedata = array(
                    'mainPhoto' => $newImagePath
                );
                $this->db->where('Id',$_SESSION['searchFaceId']);
                $update = $this->db->update('searchfilterhistory',$updatedata);
                unlink($filename);
                echo json_encode($response);
            }
            if($para == 'step4')
            {
                if($_POST['state'] != 'All')
                {
                    $this->db->where('fatherstate',$_POST['state']);   
                    if($_POST['district'] != '' || $_POST['district'] != 'All')
                    {
                        $this->db->where('fatherdistrict',$_POST['district']);   
                    }
                    if($_POST['city'] != '' || $_POST['city'] != 'All')
                    {
                        $this->db->like('fathercity',$_POST['city'],'both');   
                    }
                }
                $this->db->like('missinggender',$_POST['gender'],'after');
                if($_POST['religion'] != '')
                {
                    $this->db->where('missingreligion',$_POST['religion']);
                }
                if($_POST['personName'] != '')
                {
                    $this->db->like('missingname',$_POST['personName'],'both');
                }
                $this->db->where('isFound',0);
                $this->db->where('isFinalSubmitted',1);
                $getMissingPerson = $this->db->get('missingperson')->result_array();
                $isMissing = 0;
                $personName = '';
                $gender = '';
                $address = '';
                $age = '';
                $isWanted = 0;
                $isCriminal = 0;
                $isRegistered = 0;
                $isAadharCorrect = 0;
                if(count($getMissingPerson) > 0)
                {
                    foreach($getMissingPerson as $k=>$v)
                    {
                        if($_POST['height'] != '')
                        {
                            $subcategories = array($_POST['height'],$_POST['age']);   
                        }else{
                            $subcategories = array($_POST['age']);
                        }
                        $this->db->where_in('userSubCategory',$subcategories);
                        $this->db->where('personId',$v['Id']);
                        $this->db->from('userproperty');
                        $getCategorialData = $this->db->get()->result_array();
                        if(count($getCategorialData) > 0)
                        {
                            $isMissing = 1;
                            $personName = $v['missingname'];
                            $gender = $v['missinggender'];
                            $from=new DateTime(date('Y-m-d'));
                            $to   = new DateTime($v['dob']);
                            $age = ($from->diff($to)->y);
                            $address = $v['fathercity'].','.$v['fatherstate'];
                            if($userphoto == '')
                            {
                                $userphoto = base_url().''.(($v['facematchphoto'] != NULL) ? $v['facematchphoto'] : 'assets/img/noimage.jpg');   
                            }
                        }
                    }
                }
                if($isMissing == 0)
                {
                    $this->db->where('gender',strtoupper($_POST['gender']));
                    if($_POST['religion'] != '')
                    {
                        $this->db->where('religion',$_POST['religion']);
                    }
                    if($_POST['personName'] != '')
                    {
                        $this->db->like('aadharname',$_POST['personName'],'both');
                    }
                    if($_POST['state'] != 'All')
                    {
                        $this->db->where('state',$_POST['state']);   
                        if($_POST['district'] != '' && $_POST['district'] != 'All')
                        {
                            $this->db->where('district',$_POST['district']);   
                        }
                        if($_POST['city'] != '' && $_POST['city'] != 'All')
                        {
                            $this->db->like('vtc',$_POST['city'],'both');   
                        }
                    }
                    $getUserDetail = $this->db->get('user')->result_array();
                    if(count($getUserDetail) > 0)
                    {
                        foreach($getUserDetail as $k=>$v)
                        {
                            if($_POST['height'] != '')
                            {
                                $subcategories = array($_POST['height'],$_POST['age']);   
                            }else{
                                $subcategories = array($_POST['age']);
                            }
                            $this->db->where_in('subCategoryId',$subcategories);
                            $this->db->where('userId',$v['uid']);
                            $this->db->from('userOtherInfo');
                            $getCategorialData = $this->db->get()->result_array();
                            if(count($getCategorialData) > 0)
                            {
                                $isRegistered = 1;
                                $personName = $v['aadharname'];
                                $gender = $v['gender'];
                                $from=new DateTime(date('Y-m-d'));
                                $to   = new DateTime($v['dob']);
                                $age = ($from->diff($to)->y);
                                $address = $v['city'].','.$v['state'];
                                if($userphoto == '')
                                {
                                    $userphoto = base_url().''.(($v['facematchphoto'] != NULL) ? $v['facematchphoto'] : 'assets/img/noimage.jpg');   
                                }
                            }
                        }
                    }   
                }
                if($_POST['state'] != 'All')
                {
                    $this->db->where('state',$_POST['state']);   
                    if($_POST['district'] != '' || $_POST['district'] != 'All')
                    {
                        $this->db->where('district',$_POST['district']);   
                    }
                    if($_POST['city'] != '' || $_POST['city'] != 'All')
                    {
                        $this->db->like('city',$_POST['city'],'both');   
                    }
                }
                $this->db->like('gender',$_POST['gender'],'after');
                if($_POST['personName'] != '')
                {
                    $this->db->like('personName',$_POST['personName'],'both');
                }
                $this->db->where('status','Active');
                $this->db->where('type','wanted');
                $this->db->where('isFinalSubmitted',1);
                $getIfWantedAvailable = $this->db->get('criminals')->result_array();
                if(count($getIfWantedAvailable) > 0)
                {
                    $isAadharCorrect = 1;
                    $isWanted = 1;
                    $personName = $getIfWantedAvailable[0]['personName'];
                    $gender = $getIfWantedAvailable[0]['gender'];
                    $aadhar = $getIfWantedAvailable[0]['aadharNumber'];
                    if($getIfWantedAvailable[0]['dob'] != '0000-00-00')
                    {
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfWantedAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                    }else{
                        $age = '';
                    }
                    $address = '';
                    if($getIfWantedAvailable[0]['state'] != '')
                    {
                        $address .= $getIfWantedAvailable[0]['state'];
                    }
                    if($getIfWantedAvailable[0]['district'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfWantedAvailable[0]['district'];
                        }else{
                            $address .= $getIfWantedAvailable[0]['district'];
                        }
                    }
                    if($getIfWantedAvailable[0]['city'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfWantedAvailable[0]['city'];
                        }else{
                            $address .= $getIfWantedAvailable[0]['city'];
                        }
                    }
                    $getPhotos = $this->db->query('select * from criminalphotos where crimeId='.$getIfWantedAvailable[0]['Id'])->result_array();
                    if(count($getPhotos) > 0)
                    {
                        $userphoto = base_url().''.(($getPhotos[0]['photourl'] != NULL) ? $getPhotos[0]['photourl'] : '');   
                    }
                    foreach($getIfWantedAvailable as $k=>$v)
                    {
                        array_push($wantedId,$v['Id']);
                    }
                }
                $getIfCriminalAvailable = $this->db->query('select * from criminals where aadharNumber="'.$_POST['idNumber'].'" and isFinalSubmitted=1 and type="criminal" and status="Active"')->result_array();
                if(count($getIfCriminalAvailable) > 0)
                {
                    $isAadharCorrect = 1;
                    $isCriminal = 1;
                    $personName = $getIfCriminalAvailable[0]['personName'];
                    $gender = $getIfCriminalAvailable[0]['gender'];
                    $aadhar = $getIfCriminalAvailable[0]['aadharNumber'];
                    if($getIfCriminalAvailable[0]['dob'] != '0000-00-00')
                    {
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfCriminalAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                    }else{
                        $age = '';
                    }
                    $address = '';
                    if($getIfCriminalAvailable[0]['state'] != '')
                    {
                        $address .= $getIfCriminalAvailable[0]['state'];
                    }
                    if($getIfCriminalAvailable[0]['district'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfCriminalAvailable[0]['district'];
                        }else{
                            $address .= $getIfCriminalAvailable[0]['district'];
                        }
                    }
                    if($getIfCriminalAvailable[0]['city'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfCriminalAvailable[0]['city'];
                        }else{
                            $address .= $getIfCriminalAvailable[0]['city'];
                        }
                    }
                    $getPhotos = $this->db->query('select * from criminalphotos where crimeId='.$getIfCriminalAvailable[0]['Id'])->result_array();
                    if(count($getPhotos) > 0)
                    {
                        $userphoto = base_url().''.(($getPhotos[0]['photourl'] != NULL) ? $getPhotos[0]['photourl'] : '');   
                    }
                    foreach($getIfCriminalAvailable as $k=>$v)
                    {
                        array_push($criminalId,$v['Id']);
                    }
                }
                $finalResponse = array(
                    'status' => 'success',
                    'count' => (count($userId) + count($id))
                );
                echo json_encode($finalResponse);
            }
        }
    }
    
    function checkPersonFilterDetails($para = '')
    {
        if($para == '')
        {
            $page_data['control'] = 'user';
            if(isset($_SESSION['landingMob']))
            {
                $page_data['pn'] = 2;   
                if(!isset($_SESSION['filterId']))
                {
                    $getFinalId = $this->db->query('select max(Id) as Id from searchFilterLogs')->result_array();
                    if($getFinalId[0]['Id'] != NULL)
                    {
                        $_SESSION['filterId'] = $getFinalId[0]['Id'] + 1;
                    }else{
                        $_SESSION['filterId'] = 1;
                    }
                    $insert = $this->db->insert('searchFilterLogs',array('mobile' => $_SESSION['landingMob'],'Id' => $_SESSION['filterId']));   
                }
            }else{
                $page_data['pn'] = 1;
            }
            if(isset($_GET['pn']))
            {
                $page_data['pn'] = $_GET['pn'];    
            }
            $page_data['page_name'] = 'searchFacePerson';
            $page_data['title'] = 'Search By Person';
            $this->load->view('landing_page/index', $page_data);
        }else
        {
            if($para == 'step1')
            {
                $getPreviousDetail = $this->db->query('select * from searchFilterLogs where Id='.$_SESSION['filterId'])->result_array();
                if($getPreviousDetail[0]['otp'] == $_POST['otp'])
                {
                    $_SESSION['landingMob'] = $_POST['mobileNumber'];
                    $response['status'] = 'success';
                }else{
                    $response['status'] = 'error';
                    $response['message'] = 'Invalid OTP';
                }
                echo json_encode($response);
            }
            if($para == 'step2')
            {
                $this->db->where('missingdate >=',date('Y-m-d 00:00:00',strtotime($_POST['startDate'])));
                $this->db->where('missingdate <=',date('Y-m-d 23:59:59',strtotime($_POST['endDate'])));
                if($_POST['state'] != 'All' && $_POST['state'] != '')
                {
                    $this->db->where('fatherstate',$_POST['state']);   
                    if($_POST['district'] != '' && $_POST['district'] != 'All')
                    {
                        $this->db->where('fatherdistrict',$_POST['district']);   
                    }
                    if($_POST['city'] != '' && $_POST['city'] != 'All')
                    {
                        $this->db->like('fathercity',$_POST['city'],'both');   
                    }
                }
                $this->db->like('missinggender',$_POST['gender'],'after');
                if($_POST['religion'] != '')
                {
                    $this->db->where('missingreligion',$_POST['religion']);
                }
                if($_POST['personName'] != '')
                {
                    $this->db->like('missingname',$_POST['personName'],'both');
                }
                $this->db->where('isFound',0);
                $this->db->where('isFinalSubmitted',1);
                $getMissingPerson = $this->db->get('missingperson')->result_array();
                $missingAadhar = array();
                $missingId = array();
                $lapataAadhar = array();
                $lapataId = array();
                $isAadharCorrect = 0;
                if(count($getMissingPerson) > 0)
                {
                    foreach($getMissingPerson as $k=>$v)
                    {
                        $subcategories = array();
                        if($_POST['height'] != '')
                        {
                            array_push($subcategories,$_POST['height']);
                        }
                        if($_POST['age'] != '')
                        {
                            array_push($subcategories,$_POST['age']);   
                        }
                        if(count($subcategories) > 0)
                        {
                            $this->db->where_in('userSubCategory',$subcategories);
                            $this->db->where('personId',$v['Id']);
                            $this->db->from('userproperty');
                            $getCategorialData = $this->db->get()->result_array();
                            if(count($getCategorialData) > 0)
                            {
                                array_push($missingAadhar,$v['missingaadhar']);
                                array_push($missingId,$v['Id']);
                            }
                        }else{
                            array_push($missingAadhar,$v['missingaadhar']);
                            array_push($missingId,$v['Id']);
                        }
                    }
                }
                if($_POST['state'] != 'All' && $_POST['state'] != '')
                {
                    $this->db->like('state',$_POST['state']);   
                    if($_POST['district'] != '' && $_POST['district'] != 'All')
                    {
                        $this->db->like('district',$_POST['district']);   
                    }
                    if($_POST['city'] != '' && $_POST['city'] != 'All')
                    {
                        $this->db->like('city',$_POST['city'],'both');   
                    }
                }
                $this->db->where('expiryDate >=',date('Y-m-d'));
                $this->db->where('dateCreated >=',date('Y-m-d 00:00:00',strtotime($_POST['startDate'])));
                $this->db->where('dateCreated <=',date('Y-m-d 23:59:59',strtotime($_POST['endDate'])));
                if($_POST['gender'] == 'Male')
                {
                    $this->db->like('Gender','boy','after');
                }else{
                    $this->db->like('Gender','girl','after');   
                }
                if($_POST['personName'] != '')
                {
                    $this->db->like('person_name',$_POST['personName'],'both');
                }
                if($_POST['height'] != '')
                {
                    $this->db->where('Height',$_POST['height']);   
                }
                if($_POST['age'] != '')
                {
                    $this->db->where('Age',$_POST['age']);   
                }
                if($_POST['religion'] != '')
                {
                    $this->db->where('Religion',$_POST['religion']);
                }
                $this->db->where('isFound',0);
                $this->db->where('uploaded_by','user');
                $getIfLapataAvailable = $this->db->get('unknown_person')->result_array();
                if(count($getIfLapataAvailable) > 0)
                {
                    $isAadharCorrect = 1;
                    foreach($getIfLapataAvailable as $k=>$v)
                    {
                        array_push($lapataAadhar,$v['aadharNumber']);
                        array_push($lapataId,$v['id']);
                    }
                }
                if(count($lapataAadhar) > 0)
                {
                    if(count($missingAadhar) > 0)
                    {
                        foreach($lapataAadhar as $k=>$v)
                        {
                            foreach($missingAadhar as $k1=>$v1)
                            {
                                if($v == $v1)
                                {
                                    unset($missingId[$k1]);
                                }
                            }
                        }
                    }
                }
                $updateData = array(
                    'state' => $_POST['state'],
                    'district' => $_POST['district'],
                    'city' => $_POST['city'],
                    'age' => $_POST['age'],
                    'height' => $_POST['height'],
                    'personName' => $_POST['personName'],
                    'gender' => $_POST['gender'],
                    'startDate' => $_POST['startDate'],
                    'endDate' => $_POST['endDate'],
                    'religion' => $_POST['religion'],
                    'missingIds' => implode(',',$missingId),
                    'lapataId' => implode(',',$lapataId)
                );
                $this->db->where('Id',$_SESSION['filterId']);
                $this->db->update('searchFilterLogs',$updateData);
                $finalResponse = array(
                    'count' => (count($lapataId) + count($missingId))
                );
                echo json_encode($finalResponse);
            }
        }
    }
    
    function searchByImage()
    {
        $name = $_FILES["file"]["name"];
        $ext = end((explode(".", $name)));
        $imageId = time().''.rand(0,10000);
        $fileName = $imageId.'.'.$ext; 
        $imageUploadPath = 'upload/unknownfacematch/' . $fileName; 
        $imageTemp = $_FILES["file"]["tmp_name"]; 
        $compressedImage = $this->compressImage($imageTemp, $imageUploadPath, 75); 
        if($compressedImage != '')
        {
            $curl = curl_init();
            $postdata = json_encode(array(
                "collection_id" => "shivaguptabcakhoji4",
                "image_url" => base_url().''.$compressedImage,
                "threshold" => (float)$this->getSettings('beforeLoginThreshold')
            ));
            curl_setopt_array($curl, array(
              CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
              CURLOPT_RETURNTRANSFER => true,
              CURLOPT_ENCODING => '',
              CURLOPT_MAXREDIRS => 10,
              CURLOPT_TIMEOUT => 0,
              CURLOPT_FOLLOWLOCATION => true,
              CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
              CURLOPT_CUSTOMREQUEST => 'POST',
              CURLOPT_POSTFIELDS => $postdata,
              CURLOPT_HTTPHEADER => array(
                'Content-Type: application/json',
                'Accept: application/json',
                'Authorization: '.$this->getSettings('facematchtoken'),
              ),
            ));
            $faceresponse = json_decode(curl_exec($curl),true);
            curl_close($curl);
            if(count($faceresponse) > 0)
            {
                if(count($faceresponse['output']) > 0)
                {
                    $finalresponse = array(
                        'status' => 'success',
                        'finalId' => $faceresponse['output']
                    );
                    echo json_encode($finalresponse);
                }else{
                    $finalresponse = array(
                        'status' => 'error'
                    );
                    echo json_encode($finalresponse);
                }
            }else{
                $finalresponse = array(
                    'status' => 'error'
                );
                echo json_encode($finalresponse);    
            }   
        }else{
            $finalresponse = array(
                'status' => 'error'
            );
            echo json_encode($finalresponse);
        }
        
    }
    
    function compressImage($source, $destination, $quality) { 
        // Get image info 
        $imgInfo = getimagesize($source); 
        $mime = $imgInfo['mime']; 
         
        // Create a new image from file 
        switch($mime){ 
            case 'image/jpeg': 
                $image = imagecreatefromjpeg($source); 
                break; 
            case 'image/png': 
                $image = imagecreatefrompng($source); 
                break; 
            case 'image/gif': 
                $image = imagecreatefromgif($source); 
                break; 
            case 'image/webp':
                $image = imagecreatefromwebp($source);
                break;
            default: 
                $image = imagecreatefromjpeg($source); 
        } 
         
        // Save image 
        imagejpeg($image, $destination, $quality); 
         
        // Return compressed image 
        return $destination; 
    }
    
    private function watermark($config) {
        $this->load->library('image_lib');
        $config['image_library'] = 'GD2';
        $config['wm_type'] = 'text';
        $config['wm_text'] = 'MISSING';
        $config['wm_font_path'] = './system/fonts/texb.ttf';
        $config['wm_hor_alignment'] = 'center';
        $this->image_lib->initialize($config);

        if (!$this->image_lib->watermark()) {
            echo $this->image_lib->display_errors();
            die();
        }
        $this->image_lib->clear();
        return $config;
    }

    function mahakumbhpersondetail()
    {
        $id = (isset($_GET['id']) ? $_GET['id'] : $this->uri->segment(3));
        $type = (isset($_GET['type']) ? $_GET['type'] : 0);
        $page_data['familyperson'] = $this->db->query('select * from mahakumbhMember where isFinalSubmitted=1 and id="'.$id.'"')->result_array();
        if(count($page_data['familyperson']) > 0)
        {
            $page_data['control'] = 'user';
            $page_data['title'] = 'Mahakumbh 2025 - '.($page_data['familyperson'][0]['person_name'] != '' ? $page_data['familyperson'][0]['person_name'].', ' : '').$page_data['familyperson'][0]['Gender'].', '.$page_data['familyperson'][0]['age'];   
            $page_data['id'] = $id;
            if($page_data['familyperson'][0]['activeStatus'] == 1)
            {   
                $explode = explode('/',$page_data['familyperson'][0]['Photo']);
                if($explode[2] == 'nonkyc')
                {
                    if(!file_exists('upload/mahakumbhMember/watermark/'.$explode[3]))
                    {
                        $config = array(
                            'source_image' => $page_data['familyperson'][0]['Photo'],
                            'new_image' => 'upload/mahakumbhMember/watermark/'.$explode[3],
                            'wm_font_color' => 'ff0000',
                            'wm_font_size' => '55',
                            'wm_vrt_alignment' => 'middle'
                        );
                        $data = $this->watermark($config);
                        $page_data['ogimage'] = base_url().'upload/mahakumbhMember/watermark/'.$explode[3];      
                    }else{
                        $page_data['ogimage'] = base_url().'upload/mahakumbhMember/watermark/'.$explode[3];      
                    }
                }else if($explode[2] == 'kyc')
                {
                    if(!file_exists('upload/mahakumbhMember/watermark/'.$explode[3]))
                    {
                        $config = array(
                            'source_image' => $page_data['familyperson'][0]['Photo'],
                            'new_image' => 'upload/mahakumbhMember/watermark/'.$explode[3],
                            'wm_font_color' => 'ff0000',
                            'wm_font_size' => '55',
                            'wm_vrt_alignment' => 'middle'
                        );
                        $data = $this->watermark($config);
                        $page_data['ogimage'] = base_url().'upload/mahakumbhMember/watermark/'.$explode[3];      
                    }else{
                        $page_data['ogimage'] = base_url().'upload/mahakumbhMember/watermark/'.$explode[3];      
                    }
                }else{
                    if(!file_exists('upload/mahakumbhMember/watermark/'.$explode[2]))
                    {
                        $config = array(
                            'source_image' => $page_data['familyperson'][0]['Photo'],
                            'new_image' => 'upload/mahakumbhMember/watermark/'.$explode[2],
                            'wm_font_color' => 'ff0000',
                            'wm_font_size' => '55',
                            'wm_vrt_alignment' => 'middle'
                        );
                        $data = $this->watermark($config);
                        $page_data['ogimage'] = base_url().'upload/mahakumbhMember/watermark/'.$explode[2];      
                    }else{
                        $page_data['ogimage'] = base_url().'upload/mahakumbhMember/watermark/'.$explode[2];      
                    }
                }
                $page_data['metadescription'] = ($page_data['familyperson'][0]['person_name'] != '' ? ($page_data['familyperson'][0]['person_name'].',') : '').''.($page_data['familyperson'][0]['Message'] != '' ? ($page_data['familyperson'][0]['Message'].',') : 'MISSING');     
                if($page_data['familyperson'][0]['isKyc'] == 0)
                {
                    $getUserDetail = $this->db->query('select * from nonKycUser where uid='.$page_data['familyperson'][0]['parentId'])->result_array();
                }else{
                    $getUserDetail = $this->db->query('select * from user where uid='.$page_data['familyperson'][0]['parentId'])->result_array();
                }
                $page_data['ogtitle'] = 'Mahakumbh 2025';
                $page_data['ogdescription'] = 'General Person Uploaded By:- '.$getUserDetail[0]['aadharname'].', '.$getUserDetail[0]['state'].', '.$getUserDetail[0]['district'];        
                $page_data['author'] = 'KHOJI';
                $page_data['keywords'] = 'KHOJI';
                $page_data['ogtype'] = 'General Person';
                $page_data['ogurl'] = current_url();
                $params   = $_SERVER['QUERY_STRING']; //my_id=1,3
                $page_data['ogurl'] = $page_data['ogurl'] . '?' . $params; 
            }
            if($page_data['familyperson'][0]['activeStatus'])
            {
                $isExpired = 0;
                $status = 'Inactive';
                $getLastTransaction = $this->db->query('select * from mahakumbhTransactions where userId='.$page_data['familyperson'][0]['parentId'].' and familyId="'.$page_data['familyperson'][0]['id'].'" order by Id desc')->result_array();
                if(count($getLastTransaction) > 0)
                {
                    if(strtotime(date('d-m-Y')) <= strtotime(date('d-m-Y',strtotime($page_data['familyperson'][0]['expiryDate']))))
                    {
                        $isExpired = 1;
                    }
                }
                if(($page_data['familyperson'][0]['activeStatus']))
                {
                    if($isExpired == 1)
                    {
                        $status = 'Active';
                    }
                }
                if($status == 'Active')
                {
                    $page_data['isFound'] = 1;
                    $page_data['page_name'] = 'mahakumbhpersondetail';
                    $this->load->view('landing_page/index', $page_data);   
                }else{
                    $page_data['ogtitle'] = 'General Person';
                    $page_data['author'] = 'Khoji';
                    $page_data['keywords'] = 'Khoji';
                    $page_data['ogtype'] = 'General Person';
                    $page_data['ogurl'] = current_url();
                    $params   = $_SERVER['QUERY_STRING']; //my_id=1,3
                    $page_data['ogurl'] = $page_data['ogurl'] . '?' . $params; 
                    $page_data['isFound'] = 0;
                    $page_data['page_name'] = 'mahakumbhpersondetail';
                    $this->load->view('landing_page/index', $page_data);   
                    // redirect('landing/lapatacomplaintclosed/'.$id,'refresh');
                }
            }else{
                $page_data['ogtitle'] = 'General Person';
                $page_data['isFound'] = 0;
                $page_data['author'] = 'Khoji';
                $page_data['keywords'] = 'Khoji';
                $page_data['ogtype'] = 'General Person';
                $page_data['ogurl'] = current_url();
                $params   = $_SERVER['QUERY_STRING']; //my_id=1,3
                $page_data['ogurl'] = $page_data['ogurl'] . '?' . $params; 
                $page_data['page_name'] = 'mahakumbhpersondetail';
                $this->load->view('landing_page/index', $page_data);   
                // redirect('landing/lapatacomplaintclosed/'.$id,'refresh');
            }   
        }else{
            $page_data['ogtitle'] = 'General Person';
            $page_data['isFound'] = 0;
            $page_data['author'] = 'Khoji';
            $page_data['keywords'] = 'Khoji';
            $page_data['ogtype'] = 'General Person';
            $page_data['ogurl'] = current_url();
            $params   = $_SERVER['QUERY_STRING']; //my_id=1,3
            $page_data['ogurl'] = $page_data['ogurl'] . '?' . $params; 
            $page_data['page_name'] = 'mahakumbhpersondetail';
            $this->load->view('landing_page/index', $page_data);   
        }
    }

    function findFunnelFamilyPersonDetail()
    {
        $id = (isset($_GET['id']) ? $_GET['id'] : $this->uri->segment(3));
        $type = (isset($_GET['type']) ? $_GET['type'] : 0);
        $page_data['familyperson'] = $this->db->query('select * from funnelfamily where isFinalSubmitted=1 and id="'.$id.'"')->result_array();
        if(count($page_data['familyperson']) > 0)
        {
            $page_data['control'] = 'user';
            $page_data['title'] = 'GENERAL - '.($page_data['familyperson'][0]['person_name'] != '' ? $page_data['familyperson'][0]['person_name'].', ' : '').$page_data['familyperson'][0]['Gender'].', '.$page_data['familyperson'][0]['age'];   
            $page_data['id'] = $id;
            if($page_data['familyperson'][0]['activeStatus'] == 1)
            {   
                $explode = explode('/',$page_data['familyperson'][0]['Photo']);
                if($explode[2] == 'nonkyc')
                {
                    if(!file_exists('upload/familyMember/watermark/'.$explode[3]))
                    {
                        $config = array(
                            'source_image' => $page_data['familyperson'][0]['Photo'],
                            'new_image' => 'upload/familyMember/watermark/'.$explode[3],
                            'wm_font_color' => 'ff0000',
                            'wm_font_size' => '55',
                            'wm_vrt_alignment' => 'middle'
                        );
                        $data = $this->watermark($config);
                        $page_data['ogimage'] = base_url().'upload/familyMember/watermark/'.$explode[3];      
                    }else{
                        $page_data['ogimage'] = base_url().'upload/familyMember/watermark/'.$explode[3];      
                    }
                }else if($explode[2] == 'kyc')
                {
                    if(!file_exists('upload/familyMember/watermark/'.$explode[3]))
                    {
                        $config = array(
                            'source_image' => $page_data['familyperson'][0]['Photo'],
                            'new_image' => 'upload/familyMember/watermark/'.$explode[3],
                            'wm_font_color' => 'ff0000',
                            'wm_font_size' => '55',
                            'wm_vrt_alignment' => 'middle'
                        );
                        $data = $this->watermark($config);
                        $page_data['ogimage'] = base_url().'upload/familyMember/watermark/'.$explode[3];      
                    }else{
                        $page_data['ogimage'] = base_url().'upload/familyMember/watermark/'.$explode[3];      
                    }
                }else{
                    if(!file_exists('upload/familyMember/watermark/'.$explode[2]))
                    {
                        $config = array(
                            'source_image' => $page_data['familyperson'][0]['Photo'],
                            'new_image' => 'upload/familyMember/watermark/'.$explode[2],
                            'wm_font_color' => 'ff0000',
                            'wm_font_size' => '55',
                            'wm_vrt_alignment' => 'middle'
                        );
                        $data = $this->watermark($config);
                        $page_data['ogimage'] = base_url().'upload/familyMember/watermark/'.$explode[2];      
                    }else{
                        $page_data['ogimage'] = base_url().'upload/familyMember/watermark/'.$explode[2];      
                    }
                }
                $page_data['metadescription'] = ($page_data['familyperson'][0]['person_name'] != '' ? ($page_data['familyperson'][0]['person_name'].',') : '').''.($page_data['familyperson'][0]['Message'] != '' ? ($page_data['familyperson'][0]['Message'].',') : 'MISSING');     
                if($page_data['familyperson'][0]['isKyc'] == 0)
                {
                    $getUserDetail = $this->db->query('select * from nonKycUser where uid='.$page_data['familyperson'][0]['parentId'])->result_array();
                }else{
                    $getUserDetail = $this->db->query('select * from user where uid='.$page_data['familyperson'][0]['parentId'])->result_array();
                }
                $page_data['ogtitle'] = 'Family Member';
                $page_data['ogdescription'] = 'General Person Uploaded By:- '.$getUserDetail[0]['aadharname'].', '.$getUserDetail[0]['state'].', '.$getUserDetail[0]['district'];        
                $page_data['author'] = 'KHOJI';
                $page_data['keywords'] = 'KHOJI';
                $page_data['ogtype'] = 'General Person';
                $page_data['ogurl'] = current_url();
                $params   = $_SERVER['QUERY_STRING']; //my_id=1,3
                $page_data['ogurl'] = $page_data['ogurl'] . '?' . $params; 
            }
            if($page_data['familyperson'][0]['activeStatus'])
            {
                $isExpired = 0;
                $status = 'Inactive';
                if(strtotime(date('d-m-Y')) <= strtotime(date('d-m-Y',strtotime($page_data['familyperson'][0]['expiryDate']))))
                {
                    $isExpired = 1;
                }
                if(($page_data['familyperson'][0]['activeStatus']))
                {
                    if($isExpired == 1)
                    {
                        $status = 'Active';
                    }
                }
                if($status == 'Active')
                {
                    $page_data['isFound'] = 1;
                    $page_data['page_name'] = 'findFunnelFamilyPersonDetail';
                    $this->load->view('landing_page/index', $page_data);   
                }else{
                    $page_data['ogtitle'] = 'General Person';
                    $page_data['author'] = 'Khoji';
                    $page_data['keywords'] = 'Khoji';
                    $page_data['ogtype'] = 'General Person';
                    $page_data['ogurl'] = current_url();
                    $params   = $_SERVER['QUERY_STRING']; //my_id=1,3
                    $page_data['ogurl'] = $page_data['ogurl'] . '?' . $params; 
                    $page_data['isFound'] = 0;
                    $page_data['page_name'] = 'findFunnelFamilyPersonDetail';
                    $this->load->view('landing_page/index', $page_data);   
                    // redirect('landing/lapatacomplaintclosed/'.$id,'refresh');
                }
            }else{
                $page_data['ogtitle'] = 'General Person';
                $page_data['isFound'] = 0;
                $page_data['author'] = 'Khoji';
                $page_data['keywords'] = 'Khoji';
                $page_data['ogtype'] = 'General Person';
                $page_data['ogurl'] = current_url();
                $params   = $_SERVER['QUERY_STRING']; //my_id=1,3
                $page_data['ogurl'] = $page_data['ogurl'] . '?' . $params; 
                $page_data['page_name'] = 'findFunnelFamilyPersonDetail';
                $this->load->view('landing_page/index', $page_data);   
                // redirect('landing/lapatacomplaintclosed/'.$id,'refresh');
            }   
        }else{
            $page_data['ogtitle'] = 'General Person';
            $page_data['isFound'] = 0;
            $page_data['author'] = 'Khoji';
            $page_data['keywords'] = 'Khoji';
            $page_data['ogtype'] = 'General Person';
            $page_data['ogurl'] = current_url();
            $params   = $_SERVER['QUERY_STRING']; //my_id=1,3
            $page_data['ogurl'] = $page_data['ogurl'] . '?' . $params; 
            $page_data['page_name'] = 'findFunnelFamilyPersonDetail';
            $this->load->view('landing_page/index', $page_data);   
        }
    }

    function familypersondetail()
    {
        $id = (isset($_GET['id']) ? $_GET['id'] : $this->uri->segment(3));
        $type = (isset($_GET['type']) ? $_GET['type'] : 0);
        $page_data['familyperson'] = $this->db->query('select * from familyMember where isFinalSubmitted=1 and id="'.$id.'"')->result_array();
        if(count($page_data['familyperson']) > 0)
        {
            $page_data['control'] = 'user';
            $page_data['title'] = 'GENERAL - '.($page_data['familyperson'][0]['person_name'] != '' ? $page_data['familyperson'][0]['person_name'].', ' : '').$page_data['familyperson'][0]['Gender'].', '.$page_data['familyperson'][0]['age'];   
            $page_data['id'] = $id;
            if($page_data['familyperson'][0]['activeStatus'] == 1)
            {   
                $explode = explode('/',$page_data['familyperson'][0]['Photo']);
                if($explode[2] == 'nonkyc')
                {
                    if(!file_exists('upload/familyMember/watermark/'.$explode[3]))
                    {
                        $config = array(
                            'source_image' => $page_data['familyperson'][0]['Photo'],
                            'new_image' => 'upload/familyMember/watermark/'.$explode[3],
                            'wm_font_color' => 'ff0000',
                            'wm_font_size' => '55',
                            'wm_vrt_alignment' => 'middle'
                        );
                        $data = $this->watermark($config);
                        $page_data['ogimage'] = base_url().'upload/familyMember/watermark/'.$explode[3];      
                    }else{
                        $page_data['ogimage'] = base_url().'upload/familyMember/watermark/'.$explode[3];      
                    }
                }else if($explode[2] == 'kyc')
                {
                    if(!file_exists('upload/familyMember/watermark/'.$explode[3]))
                    {
                        $config = array(
                            'source_image' => $page_data['familyperson'][0]['Photo'],
                            'new_image' => 'upload/familyMember/watermark/'.$explode[3],
                            'wm_font_color' => 'ff0000',
                            'wm_font_size' => '55',
                            'wm_vrt_alignment' => 'middle'
                        );
                        $data = $this->watermark($config);
                        $page_data['ogimage'] = base_url().'upload/familyMember/watermark/'.$explode[3];      
                    }else{
                        $page_data['ogimage'] = base_url().'upload/familyMember/watermark/'.$explode[3];      
                    }
                }else{
                    if(!file_exists('upload/familyMember/watermark/'.$explode[2]))
                    {
                        $config = array(
                            'source_image' => $page_data['familyperson'][0]['Photo'],
                            'new_image' => 'upload/familyMember/watermark/'.$explode[2],
                            'wm_font_color' => 'ff0000',
                            'wm_font_size' => '55',
                            'wm_vrt_alignment' => 'middle'
                        );
                        $data = $this->watermark($config);
                        $page_data['ogimage'] = base_url().'upload/familyMember/watermark/'.$explode[2];      
                    }else{
                        $page_data['ogimage'] = base_url().'upload/familyMember/watermark/'.$explode[2];      
                    }
                }
                $page_data['metadescription'] = ($page_data['familyperson'][0]['person_name'] != '' ? ($page_data['familyperson'][0]['person_name'].',') : '').''.($page_data['familyperson'][0]['Message'] != '' ? ($page_data['familyperson'][0]['Message'].',') : 'MISSING');     
                if($page_data['familyperson'][0]['isKyc'] == 0)
                {
                    $getUserDetail = $this->db->query('select * from nonKycUser where uid='.$page_data['familyperson'][0]['parentId'])->result_array();
                }else{
                    $getUserDetail = $this->db->query('select * from user where uid='.$page_data['familyperson'][0]['parentId'])->result_array();
                }
                $page_data['ogtitle'] = 'Family Member';
                $page_data['ogdescription'] = 'General Person Uploaded By:- '.$getUserDetail[0]['aadharname'].', '.$getUserDetail[0]['state'].', '.$getUserDetail[0]['district'];        
                $page_data['author'] = 'KHOJI';
                $page_data['keywords'] = 'KHOJI';
                $page_data['ogtype'] = 'General Person';
                $page_data['ogurl'] = current_url();
                $params   = $_SERVER['QUERY_STRING']; //my_id=1,3
                $page_data['ogurl'] = $page_data['ogurl'] . '?' . $params; 
            }
            if($page_data['familyperson'][0]['activeStatus'])
            {
                $isExpired = 0;
                $status = 'Inactive';
                $getLastTransaction = $this->db->query('select * from familyTransactions where userId='.$page_data['familyperson'][0]['parentId'].' and familyId="'.$page_data['familyperson'][0]['id'].'" order by Id desc')->result_array();
                if(count($getLastTransaction) > 0)
                {
                    if(strtotime(date('d-m-Y')) <= strtotime(date('d-m-Y',strtotime($page_data['familyperson'][0]['expiryDate']))))
                    {
                        $isExpired = 1;
                    }
                }
                if(($page_data['familyperson'][0]['activeStatus']))
                {
                    if($isExpired == 1)
                    {
                        $status = 'Active';
                    }
                }
                if($status == 'Active')
                {
                    $page_data['isFound'] = 1;
                    $page_data['page_name'] = 'familypersondetail';
                    $this->load->view('landing_page/index', $page_data);   
                }else{
                    $page_data['ogtitle'] = 'General Person';
                    $page_data['author'] = 'Khoji';
                    $page_data['keywords'] = 'Khoji';
                    $page_data['ogtype'] = 'General Person';
                    $page_data['ogurl'] = current_url();
                    $params   = $_SERVER['QUERY_STRING']; //my_id=1,3
                    $page_data['ogurl'] = $page_data['ogurl'] . '?' . $params; 
                    $page_data['isFound'] = 0;
                    $page_data['page_name'] = 'familypersondetail';
                    $this->load->view('landing_page/index', $page_data);   
                    // redirect('landing/lapatacomplaintclosed/'.$id,'refresh');
                }
            }else{
                $page_data['ogtitle'] = 'General Person';
                $page_data['isFound'] = 0;
                $page_data['author'] = 'Khoji';
                $page_data['keywords'] = 'Khoji';
                $page_data['ogtype'] = 'General Person';
                $page_data['ogurl'] = current_url();
                $params   = $_SERVER['QUERY_STRING']; //my_id=1,3
                $page_data['ogurl'] = $page_data['ogurl'] . '?' . $params; 
                $page_data['page_name'] = 'familypersondetail';
                $this->load->view('landing_page/index', $page_data);   
                // redirect('landing/lapatacomplaintclosed/'.$id,'refresh');
            }   
        }else{
            $page_data['ogtitle'] = 'General Person';
            $page_data['isFound'] = 0;
            $page_data['author'] = 'Khoji';
            $page_data['keywords'] = 'Khoji';
            $page_data['ogtype'] = 'General Person';
            $page_data['ogurl'] = current_url();
            $params   = $_SERVER['QUERY_STRING']; //my_id=1,3
            $page_data['ogurl'] = $page_data['ogurl'] . '?' . $params; 
            $page_data['page_name'] = 'familypersondetail';
            $this->load->view('landing_page/index', $page_data);   
        }
    }

    function findFunnelPersonDetail()
    {
        if(!isset($_SESSION['previousType']))
        {
            $getFinalId = $this->db->query('select max(Id) as Id from checkperson')->result_array();
            if($getFinalId[0]['Id'] != NULL)
            {
                $_SESSION['checkId'] = $getFinalId[0]['Id'] + 1;
            }else{
                $_SESSION['checkId'] = 1;
            }
            if(isset($_SESSION['landingMob']))
            {
                $insert = $this->db->insert('checkperson',array('personMob' => $_SESSION['landingMob'],'Id' => $_SESSION['checkId']));   
            }else{
                $insert = $this->db->insert('checkperson',array('Id' => $_SESSION['checkId']));
            }
            $_SESSION['previousType'] = 'identity';
        }
        $id = (isset($_GET['id']) ? $_GET['id'] : $this->uri->segment(3));
        $type = (isset($_GET['type']) ? $_GET['type'] : 0);
        $page_data['unknownperson'] = $this->db->query('select * from funnel_missing where isFinalSubmitted=1 and Application_no="'.$id.'"')->result_array();
        if(count($page_data['unknownperson']) > 0)
        {
            $page_data['control'] = 'user';
            $page_data['title'] = 'MISSING- '.($page_data['unknownperson'][0]['person_name'] != '' ? $page_data['unknownperson'][0]['person_name'].', ' : '').$page_data['unknownperson'][0]['Gender'].', '.$page_data['unknownperson'][0]['age'];   
            $page_data['id'] = $id;
            if($page_data['unknownperson'][0]['isFound'] == 0)
            {   
                if($type == 'with')
                {
                    $explode = explode('/',$page_data['unknownperson'][0]['Photo']);
                    if($explode[2] == 'nonkyc')
                    {
                        if(!file_exists('upload/lapataperson/watermark/'.$explode[3]))
                        {
                            $config = array(
                                'source_image' => $page_data['unknownperson'][0]['Photo'],
                                'new_image' => 'upload/lapataperson/watermark/'.$explode[3],
                                'wm_font_color' => 'ff0000',
                                'wm_font_size' => '55',
                                'wm_vrt_alignment' => 'middle'
                            );
                            $data = $this->watermark($config);
                            $page_data['ogimage'] = base_url().'upload/lapataperson/watermark/'.$explode[3];      
                        }else{
                            $page_data['ogimage'] = base_url().'upload/lapataperson/watermark/'.$explode[3];      
                        }
                    }else if($explode[2] == 'kyc')
                    {
                        if(!file_exists('upload/lapataperson/watermark/'.$explode[3]))
                        {
                            $config = array(
                                'source_image' => $page_data['unknownperson'][0]['Photo'],
                                'new_image' => 'upload/lapataperson/watermark/'.$explode[3],
                                'wm_font_color' => 'ff0000',
                                'wm_font_size' => '55',
                                'wm_vrt_alignment' => 'middle'
                            );
                            $data = $this->watermark($config);
                            $page_data['ogimage'] = base_url().'upload/lapataperson/watermark/'.$explode[3];      
                        }else{
                            $page_data['ogimage'] = base_url().'upload/lapataperson/watermark/'.$explode[3];      
                        }
                    }else{
                        if(!file_exists('upload/lapataperson/watermark/'.$explode[2]))
                        {
                            $config = array(
                                'source_image' => $page_data['unknownperson'][0]['Photo'],
                                'new_image' => 'upload/lapataperson/watermark/'.$explode[2],
                                'wm_font_color' => 'ff0000',
                                'wm_font_size' => '55',
                                'wm_vrt_alignment' => 'middle'
                            );
                            $data = $this->watermark($config);
                            $page_data['ogimage'] = base_url().'upload/lapataperson/watermark/'.$explode[2];      
                        }else{
                            $page_data['ogimage'] = base_url().'upload/lapataperson/watermark/'.$explode[2];      
                        }
                    }
                }else{
                    if($page_data['unknownperson'][0]['Gender'] == 'boy')
                    {
                        if(!file_exists('upload/lapataperson/watermark/male.png'))
                        {
                            $config = array(
                            'source_image' => 'assets/images/male.png',
                            'new_image' => 'upload/lapataperson/watermark/male.png',
                            'wm_font_color' => 'ff0000',
                            'wm_font_size' => '55',
                            'wm_vrt_alignment' => 'middle'
                        );
                        $data = $this->watermark($config);
                        $page_data['ogimage'] = base_url().'upload/lapataperson/watermark/male.png';      
                        }else{
                            $page_data['ogimage'] = base_url().'upload/lapataperson/watermark/male.png';      
                        }
                    }else{
                        if(!file_exists('upload/lapataperson/watermark/female.png'))
                        {
                            $config = array(
                            'source_image' => 'assets/images/girl.png',
                            'new_image' => 'upload/lapataperson/watermark/female.png',
                            'wm_font_color' => 'ff0000',
                            'wm_font_size' => '55',
                            'wm_vrt_alignment' => 'middle'
                            // 'wm_font_color' => 'fff',
                            // 'wm_shadow_color' => 'ff0000'
                        );
                        $data = $this->watermark($config);
                        $page_data['ogimage'] = base_url().'upload/lapataperson/watermark/female.png';      
                        }else{
                            $page_data['ogimage'] = base_url().'upload/lapataperson/watermark/female.png';      
                        }
                    }
                }
                $page_data['metadescription'] = ($page_data['unknownperson'][0]['person_name'] != '' ? ($page_data['unknownperson'][0]['person_name'].',') : '').''.($page_data['unknownperson'][0]['Message'] != '' ? ($page_data['unknownperson'][0]['Message'].',') : 'MISSING');     
                $getUserDetail = $this->db->query('select * from nonKycUser where uid='.$page_data['unknownperson'][0]['userId'])->result_array();
                if($page_data['unknownperson'][0]['rewardamount'] != NULL && $page_data['unknownperson'][0]['rewardamount'] != 0)
                {
                    $page_data['ogtitle'] = '   ( Reward - '.$page_data['unknownperson'][0]['rewardamount'].' )';
                    $page_data['ogdescription'] = 'Missing Uploaded By:- '.$getUserDetail[0]['aadharname'].', '.$getUserDetail[0]['state'].', '.$getUserDetail[0]['district'];        
                }else{
                    $page_data['ogtitle'] = '  ';
                    $page_data['ogdescription'] = 'Missing Uploaded By:- '.$getUserDetail[0]['aadharname'].', '.$getUserDetail[0]['state'].', '.$getUserDetail[0]['district'];        
                }
                $page_data['author'] = 'Khoji';
                $page_data['keywords'] = 'Khoji';
                $page_data['ogtype'] = 'Missing Person';
                $page_data['ogurl'] = current_url();
                $params   = $_SERVER['QUERY_STRING']; //my_id=1,3
                $page_data['ogurl'] = $page_data['ogurl'] . '?' . $params; 
            }
            if(!$page_data['unknownperson'][0]['isFound'])
            {
                $isExpired = 0;
                $status = 'Inactive';
                if(strtotime(date('d-m-Y')) <= strtotime(date('d-m-Y',strtotime($page_data['unknownperson'][0]['expiryDate']))))
                {
                    $isExpired = 1;
                }
                if((!$page_data['unknownperson'][0]['isFound']))
                {
                    if($isExpired == 1)
                    {
                        $status = 'Active';
                    }
                }
                if($status == 'Active')
                {
                    $page_data['isFound'] = 1;
                    $page_data['page_name'] = 'funnelpersondetail';
                    $this->load->view('new_landing_page/index', $page_data);   
                }else{
                    $page_data['ogtitle'] = 'Complaint Closed';
                    $page_data['ogdescription'] = 'Complaint Closed On:- '.date('d-m-Y h:i A',strtotime($page_data['unknownperson'][0]['dateCreated']));
                    $page_data['ogimage'] = base_url().'assets_landing_page/img/closedcomplaint.webp';      
                    $page_data['author'] = 'Khoji';
                    $page_data['keywords'] = 'Khoji';
                    $page_data['ogtype'] = 'Missing Person';
                    $page_data['ogurl'] = current_url();
                    $params   = $_SERVER['QUERY_STRING']; //my_id=1,3
                    $page_data['ogurl'] = $page_data['ogurl'] . '?' . $params; 
                    $page_data['isFound'] = 0;
                    $page_data['page_name'] = 'funnelpersondetail';
                    $this->load->view('new_landing_page/index', $page_data);   
                    // redirect('landing/lapatacomplaintclosed/'.$id,'refresh');
                }
            }else{
                $page_data['ogtitle'] = 'Complaint Closed';
                $page_data['ogdescription'] = 'Complaint Closed On:- '.date('d-m-Y h:i A',strtotime($page_data['unknownperson'][0]['dateCreated']));
                $page_data['ogimage'] = base_url().'assets_landing_page/img/closedcomplaint.webp';      
                $page_data['isFound'] = 0;
                $page_data['author'] = 'Khoji';
                $page_data['keywords'] = 'Khoji';
                $page_data['ogtype'] = 'Missing Person';
                $page_data['ogurl'] = current_url();
                $params   = $_SERVER['QUERY_STRING']; //my_id=1,3
                $page_data['ogurl'] = $page_data['ogurl'] . '?' . $params; 
                $page_data['page_name'] = 'funnelpersondetail';
                $this->load->view('new_landing_page/index', $page_data);   
                // redirect('landing/lapatacomplaintclosed/'.$id,'refresh');
            }   
        }else{
            $page_data['ogtitle'] = 'Complaint Closed';
            $page_data['ogdescription'] = 'Complaint Not Found';
            $page_data['ogimage'] = base_url().'assets_landing_page/img/closedcomplaint.webp';      
            $page_data['isFound'] = 0;
            $page_data['author'] = 'Khoji';
            $page_data['keywords'] = 'Khoji';
            $page_data['ogtype'] = 'Missing Person';
            $page_data['ogurl'] = current_url();
            $params   = $_SERVER['QUERY_STRING']; //my_id=1,3
            $page_data['ogurl'] = $page_data['ogurl'] . '?' . $params; 
            $page_data['page_name'] = 'funnelpersondetail';
            $this->load->view('new_landing_page/index', $page_data);   
            // redirect('landing/lapatacomplaintclosed/'.$id,'refresh');
        }
    }
    
    function lapatapersondetail()
    {
        if(!isset($_SESSION['previousType']))
        {
            $getFinalId = $this->db->query('select max(Id) as Id from checkperson')->result_array();
            if($getFinalId[0]['Id'] != NULL)
            {
                $_SESSION['checkId'] = $getFinalId[0]['Id'] + 1;
            }else{
                $_SESSION['checkId'] = 1;
            }
            if(isset($_SESSION['landingMob']))
            {
                $insert = $this->db->insert('checkperson',array('personMob' => $_SESSION['landingMob'],'Id' => $_SESSION['checkId']));   
            }else{
                $insert = $this->db->insert('checkperson',array('Id' => $_SESSION['checkId']));
            }
            $_SESSION['previousType'] = 'identity';
        }
        $id = (isset($_GET['id']) ? $_GET['id'] : $this->uri->segment(3));
        $type = (isset($_GET['type']) ? $_GET['type'] : 0);
        $page_data['unknownperson'] = $this->db->query('select * from unknown_person where isFinalSubmitted=1 and Application_no="'.$id.'"')->result_array();
        if(count($page_data['unknownperson']) > 0)
        {
            $page_data['control'] = 'user';
            $page_data['title'] = 'MISSING- '.($page_data['unknownperson'][0]['person_name'] != '' ? $page_data['unknownperson'][0]['person_name'].', ' : '').$page_data['unknownperson'][0]['Gender'].', '.$page_data['unknownperson'][0]['age'];   
            $page_data['id'] = $id;
            if($page_data['unknownperson'][0]['isFound'] == 0)
            {   
                if($type == 'with')
                {
                    $explode = explode('/',$page_data['unknownperson'][0]['Photo']);
                    if($explode[2] == 'nonkyc')
                    {
                        if(!file_exists('upload/lapataperson/watermark/'.$explode[3]))
                        {
                            $config = array(
                                'source_image' => $page_data['unknownperson'][0]['Photo'],
                                'new_image' => 'upload/lapataperson/watermark/'.$explode[3],
                                'wm_font_color' => 'ff0000',
                                'wm_font_size' => '55',
                                'wm_vrt_alignment' => 'middle'
                            );
                            $data = $this->watermark($config);
                            $page_data['ogimage'] = base_url().'upload/lapataperson/watermark/'.$explode[3];      
                        }else{
                            $page_data['ogimage'] = base_url().'upload/lapataperson/watermark/'.$explode[3];      
                        }
                    }else if($explode[2] == 'kyc')
                    {
                        if(!file_exists('upload/lapataperson/watermark/'.$explode[3]))
                        {
                            $config = array(
                                'source_image' => $page_data['unknownperson'][0]['Photo'],
                                'new_image' => 'upload/lapataperson/watermark/'.$explode[3],
                                'wm_font_color' => 'ff0000',
                                'wm_font_size' => '55',
                                'wm_vrt_alignment' => 'middle'
                            );
                            $data = $this->watermark($config);
                            $page_data['ogimage'] = base_url().'upload/lapataperson/watermark/'.$explode[3];      
                        }else{
                            $page_data['ogimage'] = base_url().'upload/lapataperson/watermark/'.$explode[3];      
                        }
                    }else{
                        if(!file_exists('upload/lapataperson/watermark/'.$explode[2]))
                        {
                            $config = array(
                                'source_image' => $page_data['unknownperson'][0]['Photo'],
                                'new_image' => 'upload/lapataperson/watermark/'.$explode[2],
                                'wm_font_color' => 'ff0000',
                                'wm_font_size' => '55',
                                'wm_vrt_alignment' => 'middle'
                            );
                            $data = $this->watermark($config);
                            $page_data['ogimage'] = base_url().'upload/lapataperson/watermark/'.$explode[2];      
                        }else{
                            $page_data['ogimage'] = base_url().'upload/lapataperson/watermark/'.$explode[2];      
                        }
                    }
                }else{
                    if($page_data['unknownperson'][0]['Gender'] == 'boy')
                    {
                        if(!file_exists('upload/lapataperson/watermark/male.png'))
                        {
                            $config = array(
                            'source_image' => 'assets/images/male.png',
                            'new_image' => 'upload/lapataperson/watermark/male.png',
                            'wm_font_color' => 'ff0000',
                            'wm_font_size' => '55',
                            'wm_vrt_alignment' => 'middle'
                        );
                        $data = $this->watermark($config);
                        $page_data['ogimage'] = base_url().'upload/lapataperson/watermark/male.png';      
                        }else{
                            $page_data['ogimage'] = base_url().'upload/lapataperson/watermark/male.png';      
                        }
                    }else{
                        if(!file_exists('upload/lapataperson/watermark/female.png'))
                        {
                            $config = array(
                            'source_image' => 'assets/images/girl.png',
                            'new_image' => 'upload/lapataperson/watermark/female.png',
                            'wm_font_color' => 'ff0000',
                            'wm_font_size' => '55',
                            'wm_vrt_alignment' => 'middle'
                            // 'wm_font_color' => 'fff',
                            // 'wm_shadow_color' => 'ff0000'
                        );
                        $data = $this->watermark($config);
                        $page_data['ogimage'] = base_url().'upload/lapataperson/watermark/female.png';      
                        }else{
                            $page_data['ogimage'] = base_url().'upload/lapataperson/watermark/female.png';      
                        }
                    }
                }
                $page_data['metadescription'] = ($page_data['unknownperson'][0]['person_name'] != '' ? ($page_data['unknownperson'][0]['person_name'].',') : '').''.($page_data['unknownperson'][0]['Message'] != '' ? ($page_data['unknownperson'][0]['Message'].',') : 'MISSING');     
                if($page_data['unknownperson'][0]['isKyc'] == 0)
                {
                    $getUserDetail = $this->db->query('select * from nonKycUser where uid='.$page_data['unknownperson'][0]['userId'])->result_array();
                }else{
                    $getUserDetail = $this->db->query('select * from user where uid='.$page_data['unknownperson'][0]['userId'])->result_array();
                }
                if($page_data['unknownperson'][0]['rewardamount'] != NULL && $page_data['unknownperson'][0]['rewardamount'] != 0)
                {
                    $page_data['ogtitle'] = '   ( Reward - '.$page_data['unknownperson'][0]['rewardamount'].' )';
                    $page_data['ogdescription'] = 'Missing Uploaded By:- '.$getUserDetail[0]['aadharname'].', '.$getUserDetail[0]['state'].', '.$getUserDetail[0]['district'];        
                }else{
                    $page_data['ogtitle'] = '  ';
                    $page_data['ogdescription'] = 'Missing Uploaded By:- '.$getUserDetail[0]['aadharname'].', '.$getUserDetail[0]['state'].', '.$getUserDetail[0]['district'];        
                }
                $page_data['author'] = 'MISSING and Alert';
                $page_data['keywords'] = 'MISSING and Alert';
                $page_data['ogtype'] = 'Missing Person';
                $page_data['ogurl'] = current_url();
                $params   = $_SERVER['QUERY_STRING']; //my_id=1,3
                $page_data['ogurl'] = $page_data['ogurl'] . '?' . $params; 
            }
            if(!$page_data['unknownperson'][0]['isFound'])
            {
                $isExpired = 0;
                $status = 'Inactive';
                if($page_data['unknownperson'][0]['aadharNumber'] != NULL)
                {
                    $getLastTransaction = $this->db->query('select * from uploadtransactions where type="lapata" and userId='.$page_data['unknownperson'][0]['userId'].' and idNumber="'.$page_data['unknownperson'][0]['aadharNumber'].'" order by Id desc')->result_array();
                    if(count($getLastTransaction) > 0)
                    {
                        if(strtotime(date('d-m-Y')) <= strtotime(date('d-m-Y',strtotime($page_data['unknownperson'][0]['expiryDate']))))
                        {
                            $isExpired = 1;
                        }
                    }
                    if((!$page_data['unknownperson'][0]['isFound']))
                    {
                        if($isExpired == 1)
                        {
                            $status = 'Active';
                        }
                    }
                }else{
                    $getLastTransaction = $this->db->query('select * from uploadWithoutTransactions where type="lapata" and userId='.$page_data['unknownperson'][0]['userId'].' and idNumber="'.$page_data['unknownperson'][0]['Application_no'].'" order by Id desc')->result_array();
                    if(count($getLastTransaction) > 0)
                    {
                        if(strtotime(date('d-m-Y')) <= strtotime(date('d-m-Y',strtotime($page_data['unknownperson'][0]['expiryDate']))))
                        {
                            $isExpired = 1;
                        }
                    }
                    if((!$page_data['unknownperson'][0]['isFound']))
                    {
                        if($isExpired == 1)
                        {
                            $status = 'Active';
                        }
                    }
                }
                if($status == 'Active')
                {
                    $page_data['isFound'] = 1;
                    $page_data['page_name'] = 'lapatapersondetail';
                    $this->load->view('landing_page/index', $page_data);   
                }else{
                    $page_data['ogtitle'] = 'Complaint Closed';
                    $page_data['ogdescription'] = 'Complaint Closed On:- '.date('d-m-Y h:i A',strtotime($page_data['unknownperson'][0]['dateCreated']));
                    $page_data['ogimage'] = base_url().'assets_landing_page/img/closedcomplaint.webp';      
                    $page_data['author'] = 'Khoji';
                    $page_data['keywords'] = 'Khoji';
                    $page_data['ogtype'] = 'Missing Person';
                    $page_data['ogurl'] = current_url();
                    $params   = $_SERVER['QUERY_STRING']; //my_id=1,3
                    $page_data['ogurl'] = $page_data['ogurl'] . '?' . $params; 
                    $page_data['isFound'] = 0;
                    $page_data['page_name'] = 'lapatapersondetail';
                    $this->load->view('landing_page/index', $page_data);   
                    // redirect('landing/lapatacomplaintclosed/'.$id,'refresh');
                }
            }else{
                $page_data['ogtitle'] = 'Complaint Closed';
                $page_data['ogdescription'] = 'Complaint Closed On:- '.date('d-m-Y h:i A',strtotime($page_data['unknownperson'][0]['dateCreated']));
                $page_data['ogimage'] = base_url().'assets_landing_page/img/closedcomplaint.webp';      
                $page_data['isFound'] = 0;
                $page_data['author'] = 'Khoji';
                $page_data['keywords'] = 'Khoji';
                $page_data['ogtype'] = 'Missing Person';
                $page_data['ogurl'] = current_url();
                $params   = $_SERVER['QUERY_STRING']; //my_id=1,3
                $page_data['ogurl'] = $page_data['ogurl'] . '?' . $params; 
                $page_data['page_name'] = 'lapatapersondetail';
                $this->load->view('landing_page/index', $page_data);   
                // redirect('landing/lapatacomplaintclosed/'.$id,'refresh');
            }   
        }else{
            $page_data['ogtitle'] = 'Complaint Closed';
            $page_data['ogdescription'] = 'Complaint Not Found';
            $page_data['ogimage'] = base_url().'assets_landing_page/img/closedcomplaint.webp';      
            $page_data['isFound'] = 0;
            $page_data['author'] = 'Khoji';
            $page_data['keywords'] = 'Khoji';
            $page_data['ogtype'] = 'Missing Person';
            $page_data['ogurl'] = current_url();
            $params   = $_SERVER['QUERY_STRING']; //my_id=1,3
            $page_data['ogurl'] = $page_data['ogurl'] . '?' . $params; 
            $page_data['page_name'] = 'lapatapersondetail';
            $this->load->view('landing_page/index', $page_data);   
            // redirect('landing/lapatacomplaintclosed/'.$id,'refresh');
        }
    }
    
    function unknownpersondetail()
    {
        if(!isset($_SESSION['previousType']))
        {
            $getFinalId = $this->db->query('select max(Id) as Id from checkperson')->result_array();
            if($getFinalId[0]['Id'] != NULL)
            {
                $_SESSION['checkId'] = $getFinalId[0]['Id'] + 1;
            }else{
                $_SESSION['checkId'] = 1;
            }
            if(isset($_SESSION['landingMob']))
            {
                $insert = $this->db->insert('checkperson',array('personMob' => $_SESSION['landingMob'],'Id' => $_SESSION['checkId']));   
            }else{
                $insert = $this->db->insert('checkperson',array('Id' => $_SESSION['checkId']));
            }
            $_SESSION['previousType'] = 'identity';
        }
        $id = (isset($_GET['id']) ? $_GET['id'] : $this->uri->segment(3));
        $page_data['unknownperson'] = $this->db->query('select * from unknown_person where isFinalSubmitted=1 and Application_no="'.$id.'"')->result_array();
        if(count($page_data['unknownperson']) > 0)
        {
            $page_data['control'] = 'user';
            $page_data['title'] = 'MISSING- '.($page_data['unknownperson'][0]['person_name'] != '' ? $page_data['unknownperson'][0]['person_name'].', ' : '').$page_data['unknownperson'][0]['gender'].', '.$page_data['unknownperson'][0]['age'];   
            $page_data['id'] = $id;
            if($page_data['unknownperson'][0]['isFound'] == 0)
            {   
                
                $page_data['metadescription'] = ($page_data['unknownperson'][0]['person_name'] != '' ? ($page_data['unknownperson'][0]['person_name'].',') : '').''.($page_data['unknownperson'][0]['Message'] != '' ? ($page_data['unknownperson'][0]['Message'].',') : 'MISSING');     
                if($page_data['unknownperson'][0]['policeId'] != NULL)
                {
                    $getPoliceDetail = $this->db->query('select * from police where police_id='.$page_data['unknownperson'][0]['policeId'])->result_array();
                    $page_data['ogdescription'] = 'Uploaded By:- '.$getPoliceDetail[0]['thanaName'].', '.$getPoliceDetail[0]['state'].', '.$getPoliceDetail[0]['district'];        
                }else{
                    if($page_data['unknownperson'][0]['userId'] != NULL)
                    {
                        if($page_data['unknownperson'][0]['isKyc'] == 0)
                        {
                            $getProfileDetail = $this->db->query('select * from nonKycUser where uid='.$page_data['unknownperson'][0]['userId'])->result_array();
                        }else{
                            $getProfileDetail = $this->db->query('select * from user where uid='.$page_data['unknownperson'][0]['userId'])->result_array();
                        }
                        $page_data['ogdescription'] = 'Uploaded By:- '.$getProfileDetail[0]['aadharname'].', '.$getProfileDetail[0]['state'].', '.$getProfileDetail[0]['district'];           
                    }else{
                        $getNgoDetail = $this->db->query('select * from ngo where Id='.$page_data['unknownperson'][0]['ngoId'])->result_array();
                        $page_data['ogdescription'] = 'Uploaded By:- '.$getNgoDetail[0]['ngoName'].', '.$getNgoDetail[0]['ngoState'].', '.$getNgoDetail[0]['ngoDistrict'];           
                    }
                }
                $page_data['author'] = 'MISSING and Alert';
                $page_data['keywords'] = 'MISSING and Alert';
                $page_data['ogtitle'] = 'APPEAL FOR IDENTIFICATION';     
                $page_data['ogimage'] = base_url().''. $page_data['unknownperson'][0]['Photo'];   
                $page_data['ogtype'] = 'MISSING Person';
                $page_data['ogurl'] = current_url();
                $params   = $_SERVER['QUERY_STRING']; //my_id=1,3
                $page_data['ogurl'] = $page_data['ogurl'] . '?' . $params; 
            }
            if(!$page_data['unknownperson'][0]['isFound'])
            {
                $page_data['isFound'] = 0;
                $page_data['page_name'] = 'unknownpersondetail';
                $this->load->view('landing_page/index', $page_data);
            }else{
                $page_data['ogtitle'] = 'Complaint Closed';
                $page_data['ogdescription'] = 'Complaint Closed On:- '.date('d-m-Y h:i A',strtotime($page_data['unknownperson'][0]['dateCreated']));
                $page_data['ogimage'] = base_url().'assets_landing_page/img/closedcomplaint.webp';      
                $page_data['author'] = 'Khoji';
                $page_data['keywords'] = 'Khoji';
                $page_data['ogtype'] = 'Missing Person';
                $page_data['ogurl'] = current_url();
                $params   = $_SERVER['QUERY_STRING']; //my_id=1,3
                $page_data['ogurl'] = $page_data['ogurl'] . '?' . $params; 
                $page_data['isFound'] = 1;
                $page_data['page_name'] = 'unknownpersondetail';
                $this->load->view('landing_page/index', $page_data);
                // redirect('landing/unknowncomplaintclosed/'.$id,'refresh');
            }   
        }else{
            $page_data['isFound'] = 1;
            $page_data['ogtitle'] = 'Complaint Closed';
            $page_data['ogdescription'] = 'Complaint Not Found';
            $page_data['ogimage'] = base_url().'assets_landing_page/img/closedcomplaint.webp';      
            $page_data['author'] = 'Khoji';
            $page_data['keywords'] = 'Khoji';
            $page_data['ogtype'] = 'Missing Person';
            $page_data['ogurl'] = current_url();
            $params   = $_SERVER['QUERY_STRING']; //my_id=1,3
            $page_data['ogurl'] = $page_data['ogurl'] . '?' . $params; 
            $page_data['page_name'] = 'unknownpersondetail';
            $this->load->view('landing_page/index', $page_data);
            // redirect('landing/unknowncomplaintclosed/'.$id,'refresh');
        }
    }
    
    function missingpersondetail()
    {
        $id = (isset($_GET['Id']) ? $_GET['Id'] : $this->uri->segment(3));
        $type = (isset($_GET['type']) ? $_GET['type'] : 0);
        $page_data['missingperson'] = $this->db->query('select * from missingperson where Id='.$id)->result_array();
        if(count($page_data['missingperson']) > 0)
        {
            $page_data['control'] = 'user';
            if($type == 0 || $type == 'without')
            {
                $page_data['title'] = 'MISSING('.date('d-m-Y',strtotime($page_data['missingperson'][0]['missingdate'])).')- '.$page_data['missingperson'][0]['fircity'].', '.$page_data['missingperson'][0]['firstate'];   
            }else{
                $page_data['title'] = 'MISSING('.date('d-m-Y',strtotime($page_data['missingperson'][0]['missingdate'])).')- '.$page_data['missingperson'][0]['missingname'].', '.$page_data['missingperson'][0]['fircity'].', '.$page_data['missingperson'][0]['firstate'];
            }
            $page_data['id'] = $id;
            if($page_data['missingperson'][0]['isFound'] == 0)
            {   
                if($page_data['missingperson'][0]['rewardamount']==0)
                {
                      $page_data['metadescription'] = '';     
                      $page_data['ogdescription'] = '';                
                }
                else{
    
                       $page_data['metadescription'] = 'Name:- '.$page_data['missingperson'][0]['missingname'].', Reward:- Rs. '.$page_data['missingperson'][0]['rewardamount'];     
                      $page_data['ogdescription'] = 'Name:- '.$page_data['missingperson'][0]['missingname'].', Reward:- Rs. '.$page_data['missingperson'][0]['rewardamount'];
                }
                $page_data['author'] = 'MISSING and Alert';
                $page_data['keywords'] = 'MISSING and Alert';
                if($type == 0 || $type == 'without')
                {
                    $page_data['ogtitle'] = 'MISSING('.date('d-m-Y',strtotime($page_data['missingperson'][0]['missingdate'])).')- '.$page_data['missingperson'][0]['fircity'].', '.$page_data['missingperson'][0]['firstate'];   
                }else{
                    $page_data['ogtitle'] = 'MISSING('.date('d-m-Y',strtotime($page_data['missingperson'][0]['missingdate'])).')- '.$page_data['missingperson'][0]['missingname'].', '.$page_data['missingperson'][0]['fircity'].', '.$page_data['missingperson'][0]['firstate'];
                }
                if($type == 'with')
                {
                    $page_data['ogimage'] = base_url().''. $page_data['missingperson'][0]['facematchphoto'];   
                }else{
                    $page_data['ogimage'] = base_url().'assets/img/logo_new.png';
                }
               
                $page_data['ogtype'] = 'MISSING Person';
                $page_data['ogurl'] = current_url();
            }
            $page_data['missingpersondetail'] = $this->db->query('select * from missingpersondetail where missingId='.$id)->result_array();
            if(!$page_data['missingperson'][0]['isFound'])
            {
                $page_data['page_name'] = 'missingpersondetail';
                $this->load->view('landing_page/index', $page_data);
            }else{
                redirect('landing/usercomplaintclosed/'.$id,'refresh');
            }   
        }else{
            redirect('landing/usercomplaintclosed/'.$id,'refresh');
        }
    }
    
    function removeMobile()
    {
        $this->session->sess_destroy();
        redirect(base_url() . 'landing', 'refresh');   
    }
    
    function lapatacomplaintclosed($id)
    {
        $page_data['control'] = 'user';
        $page_data['title'] = 'Complaint';
        $page_data['unknownperson'] = $this->db->query('select * from unknown_person where Application_no="'.$id.'"')->result_array();
        $page_data['page_name'] = 'lapatacomplaintclosed';
        $this->load->view('landing_page/index', $page_data);
    }
    
    function unknowncomplaintclosed($id)
    {
        $page_data['control'] = 'user';
        $page_data['title'] = 'Complaint';
        $page_data['unknownperson'] = $this->db->query('select * from unknown_person where Application_no="'.$id.'"')->result_array();
        $page_data['page_name'] = 'unknowncomplaintclosed';
        $this->load->view('landing_page/index', $page_data);
    }
    
    function usercomplaintclosed($id)
    {
        $page_data['control'] = 'user';
        $page_data['title'] = 'Complaint';
        $page_data['missingperson'] = $this->db->query('select * from missingperson where Id='.$id)->result_array();
        $page_data['page_name'] = 'usercomplaintclosed';
        $this->load->view('landing_page/index', $page_data);
    }
    
    function completeFaceMatchResults()
    {
        if(isset($_SESSION['searchFaceId']))
        {
            $page_data['control'] = 'user';
            $page_data['title'] = 'Face Match Results';
            $page_data['page_name'] = 'completeFaceMatchResults';
            $this->load->view('landing_page/index', $page_data);
        }else{
            redirect('landing/checkPersonFace?pn=3','refresh');
        }
    }

    function saveFunnelPayment()
    {
        $insertdata = array(
            'userId' => $_SESSION['user_id'],
            'dateCreated' => date('Y-m-d H:i:s A'),
            'amount' => $_POST['amount'],
            'duration' => $_POST['duration'],
            'paymentType' => $_POST['paymentType'],
            'expiryDate' => date('Y-m-d',strtotime('+'.$_POST['duration']))
        );
        $this->db->insert('funneltransactions', $insertdata);
    }

    function savePersonalUnknownPayment()
    {
        $insertdata = array(
            'userId' => $_SESSION['user_id'],
            'isKyc' => ($_SESSION['login_type'] == 'NonKyc' ? 0 : 1),
            'type' => 'unknown',
            'idNumber' => (isset($_SESSION['searchFaceIdAfterLogin'])) ? ($_SESSION['searchFaceIdAfterLogin']) : $_SESSION['searchFaceId'],
            'dateCreated' => date('Y-m-d H:i:s A'),
            'amount' => 49,
        );
        $this->db->insert('unknownTransactions', $insertdata);
    }

    function highFaceMatchOld($para = '')
    {
        if($para == '')
        {
            $page_data['control'] = 'user';
            $page_data['pn'] = 3;       
            $_SESSION['searchType'] = 1;
            if(isset($_SESSION['landingMob']))
            {
                $insertdata = array(
                    'mobileNumber' => $_SESSION['landingMob'],
                    'type' => 1,
                );   
            }else{
                $insertdata = array(
                    'type' => 1,
                );
            }
            $insert = $this->db->insert('searchfacehistory',$insertdata);
            $_SESSION['searchFaceId'] = $this->db->insert_id();
            $page_data['page_name'] = 'highFaceMatch';
            $page_data['title'] = 'Search By Face';
            $this->load->view('landing_page/index', $page_data);
        }else
        {
            if($para == 'step1')
            {
                // $getFinalId = $this->db->query('select max(Id) as Id from searchfacehistory')->result_array();
                // if($getFinalId[0]['Id'] != NULL)
                // {
                //     $_SESSION['searchFaceId'] = $getFinalId[0]['Id'] + 1;
                // }else{
                //     $_SESSION['searchFaceId'] = 1;
                // }
                $_SESSION['searchType'] = $_POST['type'];
                if(isset($_SESSION['landingMob']))
                {
                    $insertdata = array(
                        'mobileNumber' => $_SESSION['landingMob'],
                        'type' => $_POST['type'],
                    );   
                }else{
                    $insertdata = array(
                        'type' => $_POST['type'],
                    );
                }
                $insert = $this->db->insert('searchfacehistory',$insertdata);
                $_SESSION['searchFaceId'] = $this->db->insert_id();
                $response = array(
                    'isMobileAvailable' => (isset($_SESSION['landingMob']) ? 1 : 0)
                );
                echo json_encode($response);
            }
            if($para == 'step2')
            {
                $getPreviousDetail = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                if($getPreviousDetail[0]['otp'] == $_POST['otp'])
                {
                    $getDetail = $this->db->query('select * from nonKycUser where registration_mobile="'.$_POST['mobileNumber'].'"')->result_array();
                    if(count($getDetail) > 0)
                    {
                        if(isset($_SESSION['fcmtokenId']))
                        {
                            $update = $this->db->query('update notification_tokens_tbl set userType="guest", userId='.$getDetail[0]['uid'].' where Id='.$_SESSION['fcmtokenId']);
                        }
                        $_SESSION['landingMob'] = $_POST['mobileNumber'];
                        $_SESSION['user_id'] = $getDetail[0]['uid'];
                        $_SESSION['aadharName'] = $getDetail[0]['aadharname'];
                        $this->session->set_userdata('loginmob',$_POST['mobileNumber']);
                        $this->session->set_userdata('user_login', 'yes');
                        $this->session->set_userdata('gender', $getDetail[0]['gender']);
                        $this->session->set_userdata('login_type', 'NonKyc');
                    }else{
                        $insertdata = array(
                            'registration_mobile' => $_POST['mobileNumber']
                        );
                        $insert = $this->db->insert('nonKycUser',$insertdata);
                        $_SESSION['guestId'] = $this->db->insert_id();
                        $getDetail = $this->db->query('select * from nonKycUser where registration_mobile="'.$_POST['mobileNumber'].'"')->result_array();
                        if(isset($_SESSION['fcmtokenId']))
                        {
                            $update = $this->db->query('update notification_tokens_tbl set userType="guest", userId='.$getDetail[0]['uid'].' where Id='.$_SESSION['fcmtokenId']);
                        }
                        $_SESSION['landingMob'] = $_POST['mobileNumber'];
                        $_SESSION['user_id'] = $getDetail[0]['uid'];
                        $_SESSION['aadharName'] = $getDetail[0]['aadharname'];
                        $this->session->set_userdata('loginmob',$_POST['mobileNumber']);
                        $this->session->set_userdata('user_login', 'yes');
                        $this->session->set_userdata('gender', $getDetail[0]['gender']);
                        $this->session->set_userdata('login_type', 'NonKyc');
                    }
                    $updatedata = array(
                        'mobileNumber' => $_POST['mobileNumber'],
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$updatedata);
                    $response['status'] = 'success';
                }else{
                    $response['status'] = 'error';
                    $response['message'] = 'Invalid OTP';
                }
                echo json_encode($response);
            }
            if($para == 'step3')
            {
                $data = $_POST["mainPhotoSelected"];
                $image_array_1 = explode(";", $data);
                $split1 = explode('data:image/',$image_array_1[0]);
                $image_array_2 = explode(",", $image_array_1[1]);
                $data = base64_decode($image_array_2[1]);
                $imageId = $_SESSION['searchFaceId'];
                $newImagePath = 'upload/searchFacePerson/'.$imageId.'.'.$split1[1];
                unlink($newImagePath);
                file_put_contents($newImagePath, $data);
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                
                $faceresponse = json_decode(curl_exec($curl),true);
                curl_close($curl);
                $personName = '';
                $gender = '';
                $aadhar = '';
                $gender = '';
                $isVerified = 'No';
                $isVisible = 0;
                $age = '';
                $isWanted = 0;
                $isCriminal = 0;
                $wantedId = array();
                $criminalId = array();
                $address = '';
                $userphoto = '';
                $personId = 0;
                $isLapata = 0;
                $missingId = 0;
                $isUserFound = 0;
                $isMissing = 0;
                $isAadharCorrect = 0;
                $isGenderCorrect = 1;
                $isDobCorrect = 1;
                $familyId = array();
                $specialId = array();
                $userId = array();
                $missingId = array();
                $unknownId = array();
                $mahakumbhId = array();
                $lapataId = array();
                $wantedId = array();
                $criminalId = array();
                $finalcount = 0;
                curl_close($curl);
                if(count($faceresponse) > 0)
                {
                    if(isset($faceresponse['confidence']) && count($faceresponse['confidence']) > 0)
                    {
                        if(isset($faceresponse['confidence']['High']) && count($faceresponse['confidence']['High']) > 0)
                        {
                            foreach($faceresponse['confidence']['High'] as $k=>$v)
                            {
                                if($finalcount <= 15)
                                {
                                    $split = explode('_',$v);
                                    if($split[0] == 'GEN')
                                    {
                                        $this->db->or_where('imageId',$v);
                                        $this->db->or_where('imageId1',$v);
                                        $this->db->or_where('imageId2',$v);
                                        $user = $this->db->get('user')->result_array();
                                        if(count($user) > 0)
                                        {
                                            foreach($user as $k1=>$v1)
                                            {
                                                if(strtolower($_POST['gender']) == strtolower($v1['gender']))
                                                {
                                                    array_push($userId,$v1['uid']);
                                                    $finalcount++;   
                                                }
                                            }
                                        }else{
                                            $getAadharImageId = $this->db->query('select * from user where aadharImageId="'.$v.'"')->result_array();
                                            if(count($getAadharImageId) > 0)
                                            {
                                                foreach($getAadharImageId as $k1=>$v1)
                                                {
                                                    if(strtolower($_POST['gender']) == strtolower($v1['gender']))
                                                    {
                                                        if(strtotime($v1['aadharExpiryDate']) >= strtotime(date('Y-m-d')))
                                                        {
                                                            array_push($userId,$v1['uid']);
                                                            $finalcount++;   
                                                        }
                                                    }
                                                }   
                                            }
                                        }       
                                    }
                                    if($split[0] == 'Missing')
                                    {
                                        $this->db->where('imageId',$v);
                                        $this->db->where('isFinalSubmitted',1);
                                        $this->db->where('isFound',0);
                                        $missingperson = $this->db->get('missingperson')->result_array();
                                        if(count($missingperson) > 0)
                                        {
                                            foreach($missingperson as $k1=>$v1)
                                            {
                                                array_push($missingId,$v1['Id']);
                                                $finalcount++;
                                            }
                                        }
                                    }
                                    if($split[0] == 'LAP')
                                    {
                                        $this->db->or_where('imageId',$v);
                                        $this->db->or_where('imageId1',$v);
                                        $this->db->or_where('imageId2',$v);
                                        $lapata = $this->db->get('unknown_person')->result_array();
                                        if(count($lapata) > 0)
                                        {
                                            foreach($lapata as $k1=>$v1)
                                            {
                                                if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                                {
                                                    if($v1['isFound'] == '0')
                                                    {
                                                        if($v1['awsEventName'] == 'All')
                                                        {
                                                            $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                            if($gender == strtolower($v1['Gender']))
                                                            {
                                                                if($v1['isFinalSubmitted'] == 1)
                                                                {
                                                                    array_push($lapataId,$v1['id']);
                                                                    $finalcount++;
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    if($split[0] == 'Wanted')
                                    {
                                        $this->db->where('imageId',$v);
                                        $this->db->where('isFinalSubmitted',1);
                                        $this->db->where('status','Active');
                                        $wanted = $this->db->get('criminals')->result_array();
                                        if(count($wanted) > 0)
                                        {
                                            foreach($wanted as $k1=>$v1)
                                            {
                                                array_push($wantedId,$v1['Id']);
                                                $finalcount++;
                                            }
                                        }
                                    }
                                    if($split[0] == 'Criminal')
                                    {
                                        $this->db->where('imageId',$v);
                                        $this->db->where('isFinalSubmitted',1);
                                        $this->db->where('status','Active');
                                        $criminal = $this->db->get('criminals')->result_array();
                                        if(count($criminal) > 0)
                                        {
                                            foreach($criminal as $k1=>$v1)
                                            {
                                                array_push($criminalId,$v1['Id']);
                                                $finalcount++;
                                            }
                                        }
                                    }
                                    if($split[0] == 'FAM')
                                    {
                                        $this->db->or_where('imageId',$v);
                                        $this->db->or_where('imageId1',$v);
                                        $this->db->or_where('imageId2',$v);
                                        $familyMember = $this->db->get('familyMember')->result_array();
                                        if(count($familyMember) > 0)
                                        {
                                            foreach($familyMember as $k1=>$v1)
                                            {
                                                if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                                {
                                                    if($v1['activeStatus'] == 1)
                                                    {
                                                        $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                        if($gender == strtolower($v1['Gender']))
                                                        {
                                                            if($v1['isFinalSubmitted'] == 1)
                                                            {
                                                                array_push($familyId,$v1['id']);
                                                                $finalcount++;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    if($split[0] == 'MAH')
                                    {
                                        $this->db->or_where('imageId',$v);
                                        $this->db->or_where('imageId1',$v);
                                        $this->db->or_where('imageId2',$v);
                                        $familyMember = $this->db->get('mahakumbhMember')->result_array();
                                        if(count($familyMember) > 0)
                                        {
                                            foreach($familyMember as $k1=>$v1)
                                            {
                                                if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                                {
                                                    if($v1['activeStatus'] == 1)
                                                    {
                                                        $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                        if($gender == strtolower($v1['Gender']))
                                                        {
                                                            if($v1['isFinalSubmitted'] == 1)
                                                            {
                                                                array_push($mahakumbhId,$v1['id']);
                                                                $finalcount++;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    if($this->getSettings('mahakumbhSpecial') == 'yes')
                                    {
                                        if($split[0] == 'SPE')
                                        {
                                            $this->db->or_where('imageId',$v);
                                            $this->db->or_where('imageId1',$v);
                                            $this->db->or_where('imageId2',$v);
                                            $familyMember = $this->db->get('mahakumbhSpecial')->result_array();
                                            if(count($familyMember) > 0)
                                            {
                                                foreach($familyMember as $k1=>$v1)
                                                {
                                                    if($v1['isFound'] == 0)
                                                    {
                                                        if(strtolower($_POST['gender']) == strtolower($v1['Gender']))
                                                        {
                                                            array_push($specialId,$v1['id']);
                                                            $finalcount++;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    $this->db->or_where('imageId',$v);
                                    $this->db->or_where('imageId1',$v);
                                    $this->db->or_where('imageId2',$v);
                                    $this->db->where('isFinalSubmitted',1);
                                    $getUnknownDetail = $this->db->get('unknown_person')->result_array();
                                    if(count($getUnknownDetail) > 0)
                                    {
                                        foreach($getUnknownDetail as $k1=>$v1)
                                        {
                                            if($v1['isFound'] == '0' && $v1['awsEventName'] != 'All')
                                            {
                                                $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                if($gender == strtolower($v1['Gender']))
                                                {
                                                    if($v1['isFinalSubmitted'] == 1)
                                                    {
                                                        array_push($unknownId,$v1['id']);
                                                        $finalcount++;
                                                    }
                                                }
                                            }
                                        }
                                    }   
                                }
                            }
                        }
                    }
                }
                if($finalcount > 0)
                {
                    $insertdata = array(
                        'matchedSpecialIds' => implode(',',$specialId),
                        'matchedLapataIds' => implode(',',$lapataId),
                        'matchedWantedIds' => implode(',',$wantedId),
                        'matchedCriminalIds' => implode(',',$criminalId),
                        'matchedMissingIds' => implode(',',$missingId),
                        'matchedUserIds' => implode(',',$userId),
                        'matchedFamilyIds' => implode(',',$familyId),
                        'matchedUnknownIds' => implode(',',$unknownId),
                        'matchedMahakumbhIds' => implode(',',$mahakumbhId),
                        'mainPhoto' => $newImagePath,
                        'totalResponse' => json_encode($faceresponse),
                        'gender' => $_POST['gender'],
                        'imageId' => $imageId
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$insertdata);
                    $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                    $lapataIds = array();
                    if($getDetails[0]['matchedLapataIds'] != '')
                    {
                        $lapataIds = array_unique(explode(',',$getDetails[0]['matchedLapataIds']));   
                    }
                    $isLogin = 0;
                    if($this->session->userdata('user_login') == 'yes'){
                        $isLogin = 1;
                    }else{
                        if(isset($_SESSION['landingMob']))
                        {
                            $isLogin = 1;
                        }
                    }
                    if($isLogin == 0)
                    {
                        if(count($lapataIds) > 0)
                        {
                            $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$lapataIds[0])->result_array();
                            $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                            if($getApplicationNumber[0]['isKyc'] == 1)
                            {
                                $notifyData = array(
                                    'isLogin' => 0,
                                    'dateCreated' => date('Y-m-d H:i:s'),
                                    'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                    'searchType' => 'Lapata',
                                    'searchPhoto' => $getDetails[0]['mainPhoto'],
                                    'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                    'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                );
                                $insert = $this->db->insert('searchnotification',$notifyData);
                            }else{
                                $notifyData = array(
                                    'isLogin' => 0,
                                    'dateCreated' => date('Y-m-d H:i:s'),
                                    'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                    'searchType' => 'Lapata',
                                    'searchPhoto' => $getDetails[0]['mainPhoto'],
                                    'complainantUserType' => 'NonKyc',
                                    'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                );
                                $insert = $this->db->insert('searchnotification',$notifyData);
                            }
                        }else{
                            if(count($unknownId) > 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$unknownId[0])->result_array();
                                $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $getDetails[0]['mainPhoto'],
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $getDetails[0]['mainPhoto'],
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                }
                            }
                        }
                    }
                    $response = array(
                        'status' => 'success',
                        'personName' => $personName,
                        'isWanted' => $isWanted,
                        'isCriminal' => $isCriminal,
                        'isLapata' => $isLapata,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => $isDobCorrect,
                        'isGenderCorrect' => $isGenderCorrect,
                        'message' => 'Person Found',
                        'isMissing' => $isMissing,
                        'isRegistered' => $isUserFound,
                        'image' => $userphoto,
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }else{
                    $response = array(
                        'status' => 'success',
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }
            }
            if($para == 'step4')
            {
                $data = $_POST["mainPhotoSelected"];
                $image_array_1 = explode(";", $data);
                $split1 = explode('data:image/',$image_array_1[0]);
                $image_array_2 = explode(",", $image_array_1[1]);
                $data = base64_decode($image_array_2[1]);
                $imageId = time().''.rand(0,10000);
                $newImagePath = 'upload/searchFacePerson/'.$imageId.'.'.$split1[1];
                file_put_contents($newImagePath, $data);
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                $faceresponse = json_decode(curl_exec($curl),true);
                $personName = '';
                $gender = '';
                $aadhar = '';
                $gender = '';
                $isVerified = 'No';
                $isVisible = 0;
                $age = '';
                $isWanted = 0;
                $isCriminal = 0;
                $wantedId = array();
                $criminalId = array();
                $address = '';
                $userphoto = '';
                $personId = 0;
                $isLapata = 0;
                $missingId = 0;
                $isUserFound = 0;
                $isMissing = 0;
                $isAadharCorrect = 0;
                $isGenderCorrect = 1;
                $isDobCorrect = 1;
                $userId = array();
                $missingId = array();
                $lapataId = array();
                $wantedId = array();
                $criminalId = array();
                $finalcount = 0;
                curl_close($curl);
                if(count($faceresponse) > 0)
                {
                    if(count($faceresponse['output']) > 0)
                    {
                        foreach($faceresponse['output'] as $k=>$v)
                        {
                            $split = explode('_',$v);
                            if($split[0] == 'GEN')
                            {
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $user = $this->db->get('user')->result_array();
                                if(count($user) > 0)
                                {
                                    foreach($user as $k1=>$v1)
                                    {
                                        array_push($userId,$v1['uid']);
                                        $finalcount++;
                                    }
                                }else{
                                    $getAadharImageId = $this->db->query('select * from user where aadharImageId="'.$v.'"')->result_array();
                                    if(count($getAadharImageId) > 0)
                                    {
                                        foreach($getAadharImageId as $k1=>$v1)
                                        {
                                            if(strtolower($_POST['gender']) == strtolower($v1['gender']))
                                            {
                                                if(strtotime($v1['aadharExpiryDate']) >= strtotime(date('Y-m-d')))
                                                {
                                                    array_push($userId,$v1['uid']);
                                                    $finalcount++;   
                                                }
                                            }
                                        }   
                                    }
                                }
                            }
                            if($split[0] == 'Missing')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('isFound',0);
                                $missingperson = $this->db->get('missingperson')->result_array();
                                if(count($missingperson) > 0)
                                {
                                    foreach($missingperson as $k1=>$v1)
                                    {
                                        array_push($missingId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'LAP')
                            {
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $this->db->where('expiryDate >=',date('Y-m-d h:i:s'));
                                $this->db->where('isFound',0);
                                $lapata = $this->db->get('unknown_person')->result_array();
                                if(count($lapata) > 0)
                                {
                                    foreach($lapata as $k1=>$v1)
                                    {
                                        array_push($lapataId,$v1['id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'Wanted')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('status','Active');
                                $wanted = $this->db->get('criminals')->result_array();
                                if(count($wanted) > 0)
                                {
                                    foreach($wanted as $k1=>$v1)
                                    {
                                        array_push($wantedId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'Criminal')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('status','Active');
                                $criminal = $this->db->get('criminals')->result_array();
                                if(count($criminal) > 0)
                                {
                                    foreach($criminal as $k1=>$v1)
                                    {
                                        array_push($criminalId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                        }
                    }
                }
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Accept: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                
                $faceresponse = json_decode(curl_exec($curl),true);
                $unknownId = array();
                /* if(count($faceresponse['output']) > 0)
                {
                    foreach($faceresponse['output'] as $k1=>$v1)
                    {
                        $this->db->where('isFinalSubmitted',1);
                        $this->db->or_where('imageId',$v1);
                        $this->db->or_where('imageId1',$v1);
                        $this->db->or_where('imageId2',$v1);
                        $getUnknownDetail = $this->db->get('unknown_person')->result_array();
                        if(count($getUnknownDetail) > 0)
                        {
                            foreach($getUnknownDetail as $k=>$v)
                            {
                                if($v['isFound'] == 0)
                                {
                                    array_push($unknownId,$v1['id']);
                                    $finalcount++;
                                }
                            }
                        }   
                    }
                }*/
                if($finalcount > 0)
                {
                    if(count($lapataId) > 0)
                    {
                        foreach($lapataId as $k=>$v)
                        {
                            if($k == 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$v)->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Lapata',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Lapata',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    if(count($unknownId) > 0)
                    {
                        foreach($unknownId as $k=>$v)
                        {
                            if($k == 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$v)->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    $insertdata = array(
                        'matchedLapataIds' => implode(',',$lapataId),
                        'matchedWantedIds' => implode(',',$wantedId),
                        'matchedCriminalIds' => implode(',',$criminalId),
                        'matchedMissingIds' => implode(',',$missingId),
                        'matchedUserIds' => implode(',',$userId),
                        'matchedUnknownIds' => implode(',',$unknownId),
                        'mainPhoto' => $newImagePath
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$insertdata);
                    $response = array(
                        'status' => 'success',
                        'personName' => $personName,
                        'isWanted' => $isWanted,
                        'isCriminal' => $isCriminal,
                        'isLapata' => $isLapata,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => $isDobCorrect,
                        'isGenderCorrect' => $isGenderCorrect,
                        'message' => 'Person Found',
                        'isMissing' => $isMissing,
                        'isRegistered' => $isUserFound,
                        'image' => $userphoto,
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }else{
                    $response = array(
                        'status' => 'success',
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }
            }
            
        }
    }

    function highFaceMatch($para = '')
    {
        if($para == '')
        {
            $page_data['control'] = 'user';
            $page_data['pn'] = 3;       
            $_SESSION['searchType'] = 1;
            if(isset($_SESSION['landingMob']))
            {
                $insertdata = array(
                    'mobileNumber' => $_SESSION['landingMob'],
                    'type' => 1,
                );   
            }else{
                $insertdata = array(
                    'type' => 1,
                );
            }
            $insert = $this->db->insert('searchfacehistory',$insertdata);
            $_SESSION['searchFaceId'] = $this->db->insert_id();
            $page_data['page_name'] = 'highFaceMatch';
            $page_data['title'] = 'Search By Face';
            $this->load->view('landing_page/index', $page_data);
        }else
        {
            if($para == 'step1')
            {
                // $getFinalId = $this->db->query('select max(Id) as Id from searchfacehistory')->result_array();
                // if($getFinalId[0]['Id'] != NULL)
                // {
                //     $_SESSION['searchFaceId'] = $getFinalId[0]['Id'] + 1;
                // }else{
                //     $_SESSION['searchFaceId'] = 1;
                // }
                $_SESSION['searchType'] = $_POST['type'];
                if(isset($_SESSION['landingMob']))
                {
                    $insertdata = array(
                        'mobileNumber' => $_SESSION['landingMob'],
                        'type' => $_POST['type'],
                    );   
                }else{
                    $insertdata = array(
                        'type' => $_POST['type'],
                    );
                }
                $insert = $this->db->insert('searchfacehistory',$insertdata);
                $_SESSION['searchFaceId'] = $this->db->insert_id();
                $response = array(
                    'isMobileAvailable' => (isset($_SESSION['landingMob']) ? 1 : 0)
                );
                echo json_encode($response);
            }
            if($para == 'step2')
            {
                $getPreviousDetail = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                if($getPreviousDetail[0]['otp'] == $_POST['otp'])
                {
                    $getDetail = $this->db->query('select * from nonKycUser where registration_mobile="'.$_POST['mobileNumber'].'"')->result_array();
                    if(count($getDetail) > 0)
                    {
                        if(isset($_SESSION['fcmtokenId']))
                        {
                            $update = $this->db->query('update notification_tokens_tbl set userType="guest", userId='.$getDetail[0]['uid'].' where Id='.$_SESSION['fcmtokenId']);
                        }
                        $_SESSION['landingMob'] = $_POST['mobileNumber'];
                        $_SESSION['user_id'] = $getDetail[0]['uid'];
                        $_SESSION['aadharName'] = $getDetail[0]['aadharname'];
                        $this->session->set_userdata('loginmob',$_POST['mobileNumber']);
                        $this->session->set_userdata('user_login', 'yes');
                        $this->session->set_userdata('gender', $getDetail[0]['gender']);
                        $this->session->set_userdata('login_type', 'NonKyc');
                    }else{
                        $insertdata = array(
                            'registration_mobile' => $_POST['mobileNumber']
                        );
                        $insert = $this->db->insert('nonKycUser',$insertdata);
                        $_SESSION['guestId'] = $this->db->insert_id();
                        $getDetail = $this->db->query('select * from nonKycUser where registration_mobile="'.$_POST['mobileNumber'].'"')->result_array();
                        if(isset($_SESSION['fcmtokenId']))
                        {
                            $update = $this->db->query('update notification_tokens_tbl set userType="guest", userId='.$getDetail[0]['uid'].' where Id='.$_SESSION['fcmtokenId']);
                        }
                        $_SESSION['landingMob'] = $_POST['mobileNumber'];
                        $_SESSION['user_id'] = $getDetail[0]['uid'];
                        $_SESSION['aadharName'] = $getDetail[0]['aadharname'];
                        $this->session->set_userdata('loginmob',$_POST['mobileNumber']);
                        $this->session->set_userdata('user_login', 'yes');
                        $this->session->set_userdata('gender', $getDetail[0]['gender']);
                        $this->session->set_userdata('login_type', 'NonKyc');
                    }
                    $updatedata = array(
                        'mobileNumber' => $_POST['mobileNumber'],
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$updatedata);
                    $response['status'] = 'success';
                }else{
                    $response['status'] = 'error';
                    $response['message'] = 'Invalid OTP';
                }
                echo json_encode($response);
            }
            if($para == 'step3')
            {
                $data = $_POST["mainPhotoSelected"];
                $image_array_1 = explode(";", $data);
                $split1 = explode('data:image/',$image_array_1[0]);
                $image_array_2 = explode(",", $image_array_1[1]);
                $data = base64_decode($image_array_2[1]);
                $imageId = $_SESSION['searchFaceId'];
                $newImagePath = 'upload/searchFacePerson/'.$imageId.'.'.$split1[1];
                unlink($newImagePath);
                file_put_contents($newImagePath, $data);
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                
                $faceresponse = json_decode(curl_exec($curl),true);
                curl_close($curl);
                $personName = '';
                $gender = '';
                $aadhar = '';
                $gender = '';
                $isVerified = 'No';
                $isVisible = 0;
                $age = '';
                $isWanted = 0;
                $isCriminal = 0;
                $wantedId = array();
                $criminalId = array();
                $address = '';
                $userphoto = '';
                $personId = 0;
                $isLapata = 0;
                $missingId = 0;
                $isUserFound = 0;
                $isMissing = 0;
                $isAadharCorrect = 0;
                $isGenderCorrect = 1;
                $isDobCorrect = 1;
                $familyId = array();
                $specialId = array();
                $userId = array();
                $missingId = array();
                $unknownId = array();
                $mahakumbhId = array();
                $lapataId = array();
                $wantedId = array();
                $criminalId = array();
                $funnelFamilyId = array();
                $funnelMissingId = array();
                $finalcount = 0;
                curl_close($curl);
                if(count($faceresponse) > 0)
                {
                    if(isset($faceresponse['confidence']) && count($faceresponse['confidence']) > 0)
                    {
                        if((isset($faceresponse['confidence']['High']) && count($faceresponse['confidence']['High']) > 0) || (isset($faceresponse['confidence']['Medium']) && count($faceresponse['confidence']['Medium']) > 0) || (isset($faceresponse['confidence']['Low']) && count($faceresponse['confidence']['Low']) > 0))
                        {
                            $faceresponse['confidence']['High'] = array_unique(array_merge($faceresponse['confidence']['High'],$faceresponse['confidence']['Medium']));
                            $faceresponse['confidence']['High'] = array_unique(array_merge($faceresponse['confidence']['High'],$faceresponse['confidence']['Low']));
                            foreach($faceresponse['confidence']['High'] as $k=>$v)
                            {
                                if($finalcount <= 15)
                                {
                                    $split = explode('_',$v);
                                    if($split[0] == 'GEN')
                                    {
                                        $this->db->or_where('imageId',$v);
                                        $this->db->or_where('imageId1',$v);
                                        $this->db->or_where('imageId2',$v);
                                        $user = $this->db->get('user')->result_array();
                                        if(count($user) > 0)
                                        {
                                            foreach($user as $k1=>$v1)
                                            {
                                                if(strtolower($_POST['gender']) == strtolower($v1['gender']))
                                                {
                                                    array_push($userId,$v1['uid']);
                                                    $finalcount++;   
                                                }
                                            }
                                        }else{
                                            $getAadharImageId = $this->db->query('select * from user where aadharImageId="'.$v.'"')->result_array();
                                            if(count($getAadharImageId) > 0)
                                            {
                                                foreach($getAadharImageId as $k1=>$v1)
                                                {
                                                    if(strtolower($_POST['gender']) == strtolower($v1['gender']))
                                                    {
                                                        if(strtotime($v1['aadharExpiryDate']) >= strtotime(date('Y-m-d')))
                                                        {
                                                            array_push($userId,$v1['uid']);
                                                            $finalcount++;   
                                                        }
                                                    }
                                                }   
                                            }
                                        }       
                                    }
                                    if($split[0] == 'Missing')
                                    {
                                        $this->db->where('imageId',$v);
                                        $this->db->where('isFinalSubmitted',1);
                                        $this->db->where('isFound',0);
                                        $missingperson = $this->db->get('missingperson')->result_array();
                                        if(count($missingperson) > 0)
                                        {
                                            foreach($missingperson as $k1=>$v1)
                                            {
                                                array_push($missingId,$v1['Id']);
                                                $finalcount++;
                                            }
                                        }
                                    }
                                    if($split[0] == 'LAP')
                                    {
                                        $this->db->or_where('imageId',$v);
                                        $this->db->or_where('imageId1',$v);
                                        $this->db->or_where('imageId2',$v);
                                        $lapata = $this->db->get('unknown_person')->result_array();
                                        if(count($lapata) > 0)
                                        {
                                            foreach($lapata as $k1=>$v1)
                                            {
                                                if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                                {
                                                    if($v1['isFound'] == '0')
                                                    {
                                                        if($v1['awsEventName'] == 'All')
                                                        {
                                                            $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                            if($gender == strtolower($v1['Gender']))
                                                            {
                                                                if($v1['isFinalSubmitted'] == 1)
                                                                {
                                                                    array_push($lapataId,$v1['id']);
                                                                    $finalcount++;
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    if($split[0] == 'Wanted')
                                    {
                                        $this->db->where('imageId',$v);
                                        $this->db->where('isFinalSubmitted',1);
                                        $this->db->where('status','Active');
                                        $wanted = $this->db->get('criminals')->result_array();
                                        if(count($wanted) > 0)
                                        {
                                            foreach($wanted as $k1=>$v1)
                                            {
                                                array_push($wantedId,$v1['Id']);
                                                $finalcount++;
                                            }
                                        }
                                    }
                                    if($split[0] == 'Criminal')
                                    {
                                        $this->db->where('imageId',$v);
                                        $this->db->where('isFinalSubmitted',1);
                                        $this->db->where('status','Active');
                                        $criminal = $this->db->get('criminals')->result_array();
                                        if(count($criminal) > 0)
                                        {
                                            foreach($criminal as $k1=>$v1)
                                            {
                                                array_push($criminalId,$v1['Id']);
                                                $finalcount++;
                                            }
                                        }
                                    }
                                    if($split[0] == 'FAM')
                                    {
                                        $this->db->or_where('imageId',$v);
                                        $this->db->or_where('imageId1',$v);
                                        $this->db->or_where('imageId2',$v);
                                        $familyMember = $this->db->get('familyMember')->result_array();
                                        if(count($familyMember) > 0)
                                        {
                                            foreach($familyMember as $k1=>$v1)
                                            {
                                                if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                                {
                                                    if($v1['activeStatus'] == 1)
                                                    {
                                                        $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                        if($gender == strtolower($v1['Gender']))
                                                        {
                                                            if($v1['isFinalSubmitted'] == 1)
                                                            {
                                                                array_push($familyId,$v1['id']);
                                                                $finalcount++;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    if($this->getSettings('mahakumbhFamily') == 'yes')
                                    {
                                        if($split[0] == 'MAH')
                                        {
                                            $this->db->or_where('imageId',$v);
                                            $this->db->or_where('imageId1',$v);
                                            $this->db->or_where('imageId2',$v);
                                            $familyMember = $this->db->get('mahakumbhMember')->result_array();
                                            if(count($familyMember) > 0)
                                            {
                                                foreach($familyMember as $k1=>$v1)
                                                {
                                                    if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                                    {
                                                        if($v1['activeStatus'] == 1)
                                                        {
                                                            $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                            if($gender == strtolower($v1['Gender']))
                                                            {
                                                                if($v1['isFinalSubmitted'] == 1)
                                                                {
                                                                    array_push($mahakumbhId,$v1['id']);
                                                                    $finalcount++;
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    if($this->getSettings('mahakumbhSpecial') == 'yes')
                                    {
                                        if($split[0] == 'SPE')
                                        {
                                            $this->db->or_where('imageId',$v);
                                            $this->db->or_where('imageId1',$v);
                                            $this->db->or_where('imageId2',$v);
                                            $familyMember = $this->db->get('mahakumbhSpecial')->result_array();
                                            if(count($familyMember) > 0)
                                            {
                                                foreach($familyMember as $k1=>$v1)
                                                {
                                                    if($v1['isFound'] == 0)
                                                    {
                                                        if(strtolower($_POST['gender']) == strtolower($v1['Gender']))
                                                        {
                                                            array_push($specialId,$v1['id']);
                                                            $finalcount++;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    $this->db->or_where('imageId',$v);
                                    $this->db->or_where('imageId1',$v);
                                    $this->db->or_where('imageId2',$v);
                                    $this->db->where('isFinalSubmitted',1);
                                    $getUnknownDetail = $this->db->get('unknown_person')->result_array();
                                    if(count($getUnknownDetail) > 0)
                                    {
                                        foreach($getUnknownDetail as $k1=>$v1)
                                        {
                                            if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                            {
                                                if($v1['isFound'] == '0' && $v1['awsEventName'] != 'All')
                                                {
                                                    $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                    if($gender == strtolower($v1['Gender']))
                                                    {
                                                        if($v1['isFinalSubmitted'] == 1)
                                                        {
                                                            array_push($unknownId,$v1['id']);
                                                            $finalcount++;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }   
                                }
                            }
                        }
                    }
                }
                if($finalcount > 0)
                {
                    $insertdata = array(
                        'matchedSpecialIds' => implode(',',$specialId),
                        'matchedLapataIds' => implode(',',$lapataId),
                        'matchedWantedIds' => implode(',',$wantedId),
                        'matchedCriminalIds' => implode(',',$criminalId),
                        'matchedMissingIds' => implode(',',$missingId),
                        'matchedUserIds' => implode(',',$userId),
                        'matchedFamilyIds' => implode(',',$familyId),
                        'matchedUnknownIds' => implode(',',$unknownId),
                        'matchedMahakumbhIds' => implode(',',$mahakumbhId),
                        'mainPhoto' => $newImagePath,
                        'totalResponse' => json_encode($faceresponse),
                        'gender' => $_POST['gender'],
                        'imageId' => $imageId
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$insertdata);
                    $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                    $lapataIds = array();
                    if($getDetails[0]['matchedLapataIds'] != '')
                    {
                        $lapataIds = array_unique(explode(',',$getDetails[0]['matchedLapataIds']));   
                    }
                    $isLogin = 0;
                    if($this->session->userdata('user_login') == 'yes'){
                        $isLogin = 1;
                    }else{
                        if(isset($_SESSION['landingMob']))
                        {
                            $isLogin = 1;
                        }
                    }
                    if($isLogin == 0)
                    {
                        if(count($lapataIds) > 0)
                        {
                            $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$lapataIds[0])->result_array();
                            $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                            if($getApplicationNumber[0]['isKyc'] == 1)
                            {
                                $notifyData = array(
                                    'isLogin' => 0,
                                    'dateCreated' => date('Y-m-d H:i:s'),
                                    'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                    'searchType' => 'Lapata',
                                    'searchPhoto' => $getDetails[0]['mainPhoto'],
                                    'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                    'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                );
                                $insert = $this->db->insert('searchnotification',$notifyData);
                            }else{
                                $notifyData = array(
                                    'isLogin' => 0,
                                    'dateCreated' => date('Y-m-d H:i:s'),
                                    'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                    'searchType' => 'Lapata',
                                    'searchPhoto' => $getDetails[0]['mainPhoto'],
                                    'complainantUserType' => 'NonKyc',
                                    'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                );
                                $insert = $this->db->insert('searchnotification',$notifyData);
                            }
                        }else{
                            if(count($unknownId) > 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$unknownId[0])->result_array();
                                $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $getDetails[0]['mainPhoto'],
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $getDetails[0]['mainPhoto'],
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                }
                            }
                        }
                    }
                    $response = array(
                        'status' => 'success',
                        'personName' => $personName,
                        'isWanted' => $isWanted,
                        'isCriminal' => $isCriminal,
                        'isLapata' => $isLapata,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => $isDobCorrect,
                        'isGenderCorrect' => $isGenderCorrect,
                        'message' => 'Person Found',
                        'isMissing' => $isMissing,
                        'isRegistered' => $isUserFound,
                        'image' => $userphoto,
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }else{
                    $response = array(
                        'status' => 'success',
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }
            }
            if($para == 'step4')
            {
                $data = $_POST["mainPhotoSelected"];
                $image_array_1 = explode(";", $data);
                $split1 = explode('data:image/',$image_array_1[0]);
                $image_array_2 = explode(",", $image_array_1[1]);
                $data = base64_decode($image_array_2[1]);
                $imageId = time().''.rand(0,10000);
                $newImagePath = 'upload/searchFacePerson/'.$imageId.'.'.$split1[1];
                file_put_contents($newImagePath, $data);
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                $faceresponse = json_decode(curl_exec($curl),true);
                $personName = '';
                $gender = '';
                $aadhar = '';
                $gender = '';
                $isVerified = 'No';
                $isVisible = 0;
                $age = '';
                $isWanted = 0;
                $isCriminal = 0;
                $wantedId = array();
                $criminalId = array();
                $address = '';
                $userphoto = '';
                $personId = 0;
                $isLapata = 0;
                $missingId = 0;
                $isUserFound = 0;
                $isMissing = 0;
                $isAadharCorrect = 0;
                $isGenderCorrect = 1;
                $isDobCorrect = 1;
                $userId = array();
                $missingId = array();
                $lapataId = array();
                $wantedId = array();
                $criminalId = array();
                $finalcount = 0;
                curl_close($curl);
                if(count($faceresponse) > 0)
                {
                    if(count($faceresponse['output']) > 0)
                    {
                        foreach($faceresponse['output'] as $k=>$v)
                        {
                            $split = explode('_',$v);
                            if($split[0] == 'GEN')
                            {
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $user = $this->db->get('user')->result_array();
                                if(count($user) > 0)
                                {
                                    foreach($user as $k1=>$v1)
                                    {
                                        array_push($userId,$v1['uid']);
                                        $finalcount++;
                                    }
                                }else{
                                    $getAadharImageId = $this->db->query('select * from user where aadharImageId="'.$v.'"')->result_array();
                                    if(count($getAadharImageId) > 0)
                                    {
                                        foreach($getAadharImageId as $k1=>$v1)
                                        {
                                            if(strtolower($_POST['gender']) == strtolower($v1['gender']))
                                            {
                                                if(strtotime($v1['aadharExpiryDate']) >= strtotime(date('Y-m-d')))
                                                {
                                                    array_push($userId,$v1['uid']);
                                                    $finalcount++;   
                                                }
                                            }
                                        }   
                                    }
                                }
                            }
                            if($split[0] == 'Missing')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('isFound',0);
                                $missingperson = $this->db->get('missingperson')->result_array();
                                if(count($missingperson) > 0)
                                {
                                    foreach($missingperson as $k1=>$v1)
                                    {
                                        array_push($missingId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'LAP')
                            {
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $this->db->where('expiryDate >=',date('Y-m-d h:i:s'));
                                $this->db->where('isFound',0);
                                $lapata = $this->db->get('unknown_person')->result_array();
                                if(count($lapata) > 0)
                                {
                                    foreach($lapata as $k1=>$v1)
                                    {
                                        array_push($lapataId,$v1['id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'Wanted')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('status','Active');
                                $wanted = $this->db->get('criminals')->result_array();
                                if(count($wanted) > 0)
                                {
                                    foreach($wanted as $k1=>$v1)
                                    {
                                        array_push($wantedId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'Criminal')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('status','Active');
                                $criminal = $this->db->get('criminals')->result_array();
                                if(count($criminal) > 0)
                                {
                                    foreach($criminal as $k1=>$v1)
                                    {
                                        array_push($criminalId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                        }
                    }
                }
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Accept: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                
                $faceresponse = json_decode(curl_exec($curl),true);
                $unknownId = array();
                /* if(count($faceresponse['output']) > 0)
                {
                    foreach($faceresponse['output'] as $k1=>$v1)
                    {
                        $this->db->where('isFinalSubmitted',1);
                        $this->db->or_where('imageId',$v1);
                        $this->db->or_where('imageId1',$v1);
                        $this->db->or_where('imageId2',$v1);
                        $getUnknownDetail = $this->db->get('unknown_person')->result_array();
                        if(count($getUnknownDetail) > 0)
                        {
                            foreach($getUnknownDetail as $k=>$v)
                            {
                                if($v['isFound'] == 0)
                                {
                                    array_push($unknownId,$v1['id']);
                                    $finalcount++;
                                }
                            }
                        }   
                    }
                }*/
                if($finalcount > 0)
                {
                    if(count($lapataId) > 0)
                    {
                        foreach($lapataId as $k=>$v)
                        {
                            if($k == 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$v)->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Lapata',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Lapata',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    if(count($unknownId) > 0)
                    {
                        foreach($unknownId as $k=>$v)
                        {
                            if($k == 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$v)->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    $insertdata = array(
                        'matchedLapataIds' => implode(',',$lapataId),
                        'matchedWantedIds' => implode(',',$wantedId),
                        'matchedCriminalIds' => implode(',',$criminalId),
                        'matchedMissingIds' => implode(',',$missingId),
                        'matchedUserIds' => implode(',',$userId),
                        'matchedUnknownIds' => implode(',',$unknownId),
                        'mainPhoto' => $newImagePath
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$insertdata);
                    $response = array(
                        'status' => 'success',
                        'personName' => $personName,
                        'isWanted' => $isWanted,
                        'isCriminal' => $isCriminal,
                        'isLapata' => $isLapata,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => $isDobCorrect,
                        'isGenderCorrect' => $isGenderCorrect,
                        'message' => 'Person Found',
                        'isMissing' => $isMissing,
                        'isRegistered' => $isUserFound,
                        'image' => $userphoto,
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }else{
                    $response = array(
                        'status' => 'success',
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }
            }
            
        }
    }

    function timeFaceMatch($para = '')
    {
        if($para == '')
        {
            $page_data['control'] = 'user';
            $page_data['pn'] = 3;       
            $_SESSION['searchType'] = 1;
            if(isset($_SESSION['landingMob']))
            {
                $insertdata = array(
                    'mobileNumber' => $_SESSION['landingMob'],
                    'type' => 1,
                );   
            }else{
                $insertdata = array(
                    'type' => 1,
                );
            }
            $insert = $this->db->insert('searchfacehistory',$insertdata);
            $_SESSION['searchFaceId'] = $this->db->insert_id();
            $page_data['page_name'] = 'timeFaceMatch';
            $page_data['title'] = 'Search By Face';
            $this->load->view('landing_page/index', $page_data);
        }else
        {
            if($para == 'step1')
            {
                // $getFinalId = $this->db->query('select max(Id) as Id from searchfacehistory')->result_array();
                // if($getFinalId[0]['Id'] != NULL)
                // {
                //     $_SESSION['searchFaceId'] = $getFinalId[0]['Id'] + 1;
                // }else{
                //     $_SESSION['searchFaceId'] = 1;
                // }
                $_SESSION['searchType'] = $_POST['type'];
                if(isset($_SESSION['landingMob']))
                {
                    $insertdata = array(
                        'mobileNumber' => $_SESSION['landingMob'],
                        'type' => $_POST['type'],
                    );   
                }else{
                    $insertdata = array(
                        'type' => $_POST['type'],
                    );
                }
                $insert = $this->db->insert('searchfacehistory',$insertdata);
                $_SESSION['searchFaceId'] = $this->db->insert_id();
                $response = array(
                    'isMobileAvailable' => (isset($_SESSION['landingMob']) ? 1 : 0)
                );
                echo json_encode($response);
            }
            if($para == 'step2')
            {
                $getPreviousDetail = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                if($getPreviousDetail[0]['otp'] == $_POST['otp'])
                {
                    $getDetail = $this->db->query('select * from nonKycUser where registration_mobile="'.$_POST['mobileNumber'].'"')->result_array();
                    if(count($getDetail) > 0)
                    {
                        if(isset($_SESSION['fcmtokenId']))
                        {
                            $update = $this->db->query('update notification_tokens_tbl set userType="guest", userId='.$getDetail[0]['uid'].' where Id='.$_SESSION['fcmtokenId']);
                        }
                        $_SESSION['landingMob'] = $_POST['mobileNumber'];
                        $_SESSION['user_id'] = $getDetail[0]['uid'];
                        $_SESSION['aadharName'] = $getDetail[0]['aadharname'];
                        $this->session->set_userdata('loginmob',$_POST['mobileNumber']);
                        $this->session->set_userdata('user_login', 'yes');
                        $this->session->set_userdata('gender', $getDetail[0]['gender']);
                        $this->session->set_userdata('login_type', 'NonKyc');
                    }else{
                        $insertdata = array(
                            'registration_mobile' => $_POST['mobileNumber']
                        );
                        $insert = $this->db->insert('nonKycUser',$insertdata);
                        $_SESSION['guestId'] = $this->db->insert_id();
                        $getDetail = $this->db->query('select * from nonKycUser where registration_mobile="'.$_POST['mobileNumber'].'"')->result_array();
                        if(isset($_SESSION['fcmtokenId']))
                        {
                            $update = $this->db->query('update notification_tokens_tbl set userType="guest", userId='.$getDetail[0]['uid'].' where Id='.$_SESSION['fcmtokenId']);
                        }
                        $_SESSION['landingMob'] = $_POST['mobileNumber'];
                        $_SESSION['user_id'] = $getDetail[0]['uid'];
                        $_SESSION['aadharName'] = $getDetail[0]['aadharname'];
                        $this->session->set_userdata('loginmob',$_POST['mobileNumber']);
                        $this->session->set_userdata('user_login', 'yes');
                        $this->session->set_userdata('gender', $getDetail[0]['gender']);
                        $this->session->set_userdata('login_type', 'NonKyc');
                    }
                    $updatedata = array(
                        'mobileNumber' => $_POST['mobileNumber'],
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$updatedata);
                    $response['status'] = 'success';
                }else{
                    $response['status'] = 'error';
                    $response['message'] = 'Invalid OTP';
                }
                echo json_encode($response);
            }
            if($para == 'step3')
            {
                $data = $_POST["mainPhotoSelected"];
                $image_array_1 = explode(";", $data);
                $split1 = explode('data:image/',$image_array_1[0]);
                $image_array_2 = explode(",", $image_array_1[1]);
                $data = base64_decode($image_array_2[1]);
                $imageId = $_SESSION['searchFaceId'];
                $newImagePath = 'upload/searchFacePerson/'.$imageId.'.'.$split1[1];
                unlink($newImagePath);
                file_put_contents($newImagePath, $data);
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                
                $faceresponse = json_decode(curl_exec($curl),true);
                curl_close($curl);
                $personName = '';
                $gender = '';
                $aadhar = '';
                $gender = '';
                $isVerified = 'No';
                $isVisible = 0;
                $age = '';
                $isWanted = 0;
                $isCriminal = 0;
                $wantedId = array();
                $criminalId = array();
                $address = '';
                $userphoto = '';
                $personId = 0;
                $isLapata = 0;
                $missingId = 0;
                $isUserFound = 0;
                $isMissing = 0;
                $isAadharCorrect = 0;
                $isGenderCorrect = 1;
                $isDobCorrect = 1;
                $familyId = array();
                $specialId = array();
                $userId = array();
                $missingId = array();
                $unknownId = array();
                $mahakumbhId = array();
                $lapataId = array();
                $wantedId = array();
                $criminalId = array();
                $funnelFamilyId = array();
                $funnelMissingId = array();
                $finalcount = 0;
                curl_close($curl);
                if(count($faceresponse) > 0)
                {
                    if(isset($faceresponse['confidence']) && count($faceresponse['confidence']) > 0)
                    {
                        if((isset($faceresponse['confidence']['High']) && count($faceresponse['confidence']['High']) > 0) || (isset($faceresponse['confidence']['Medium']) && count($faceresponse['confidence']['Medium']) > 0) || (isset($faceresponse['confidence']['Low']) && count($faceresponse['confidence']['Low']) > 0))
                        {
                            $faceresponse['confidence']['High'] = array_unique(array_merge($faceresponse['confidence']['High'],$faceresponse['confidence']['Medium']));
                            $faceresponse['confidence']['High'] = array_unique(array_merge($faceresponse['confidence']['High'],$faceresponse['confidence']['Low']));
                            foreach($faceresponse['confidence']['High'] as $k=>$v)
                            {
                                if($finalcount <= 15)
                                {
                                    $split = explode('_',$v);
                                    if($split[0] == 'GEN')
                                    {
                                        $this->db->or_where('imageId',$v);
                                        $this->db->or_where('imageId1',$v);
                                        $this->db->or_where('imageId2',$v);
                                        $user = $this->db->get('user')->result_array();
                                        if(count($user) > 0)
                                        {
                                            foreach($user as $k1=>$v1)
                                            {
                                                if(strtolower($_POST['gender']) == strtolower($v1['gender']))
                                                {
                                                    array_push($userId,$v1['uid']);
                                                    $finalcount++;   
                                                }
                                            }
                                        }else{
                                            $getAadharImageId = $this->db->query('select * from user where aadharImageId="'.$v.'"')->result_array();
                                            if(count($getAadharImageId) > 0)
                                            {
                                                foreach($getAadharImageId as $k1=>$v1)
                                                {
                                                    if(strtolower($_POST['gender']) == strtolower($v1['gender']))
                                                    {
                                                        if(strtotime($v1['aadharExpiryDate']) >= strtotime(date('Y-m-d')))
                                                        {
                                                            array_push($userId,$v1['uid']);
                                                            $finalcount++;   
                                                        }
                                                    }
                                                }   
                                            }
                                        }       
                                    }
                                    if($split[0] == 'LAP')
                                    {
                                        $this->db->or_where('imageId',$v);
                                        $this->db->or_where('imageId1',$v);
                                        $this->db->or_where('imageId2',$v);
                                        $lapata = $this->db->get('unknown_person')->result_array();
                                        if(count($lapata) > 0)
                                        {
                                            foreach($lapata as $k1=>$v1)
                                            {
                                                if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                                {
                                                    if($v1['isFound'] == '0')
                                                    {
                                                        if($v1['awsEventName'] == 'All')
                                                        {
                                                            $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                            if($gender == strtolower($v1['Gender']))
                                                            {
                                                                if($v1['isFinalSubmitted'] == 1)
                                                                {
                                                                    array_push($lapataId,$v1['id']);
                                                                    $finalcount++;
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    if($split[0] == 'FAM')
                                    {
                                        $this->db->or_where('imageId',$v);
                                        $this->db->or_where('imageId1',$v);
                                        $this->db->or_where('imageId2',$v);
                                        $familyMember = $this->db->get('familyMember')->result_array();
                                        if(count($familyMember) > 0)
                                        {
                                            foreach($familyMember as $k1=>$v1)
                                            {
                                                if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                                {
                                                    if($v1['activeStatus'] == 1)
                                                    {
                                                        $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                        if($gender == strtolower($v1['Gender']))
                                                        {
                                                            if($v1['isFinalSubmitted'] == 1)
                                                            {
                                                                array_push($familyId,$v1['id']);
                                                                $finalcount++;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    $this->db->or_where('imageId',$v);
                                    $this->db->or_where('imageId1',$v);
                                    $this->db->or_where('imageId2',$v);
                                    $this->db->where('isFinalSubmitted',1);
                                    $getUnknownDetail = $this->db->get('unknown_person')->result_array();
                                    if(count($getUnknownDetail) > 0)
                                    {
                                        foreach($getUnknownDetail as $k1=>$v1)
                                        {
                                            if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                            {
                                                if($v1['isFound'] == '0' && $v1['awsEventName'] != 'All')
                                                {
                                                    $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                    if($gender == strtolower($v1['Gender']))
                                                    {
                                                        if($v1['isFinalSubmitted'] == 1)
                                                        {
                                                            array_push($unknownId,$v1['id']);
                                                            $finalcount++;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }   
                                }
                            }
                        }
                    }
                }
                if($finalcount > 0)
                {
                    $insertdata = array(
                        'matchedSpecialIds' => implode(',',$specialId),
                        'matchedLapataIds' => implode(',',$lapataId),
                        'matchedWantedIds' => implode(',',$wantedId),
                        'matchedCriminalIds' => implode(',',$criminalId),
                        'matchedMissingIds' => implode(',',$missingId),
                        'matchedUserIds' => implode(',',$userId),
                        'matchedFamilyIds' => implode(',',$familyId),
                        'matchedUnknownIds' => implode(',',$unknownId),
                        'matchedFunnelFamilyIds' => implode(',',$funnelFamilyId),
                        'matchedFunnelMissingIds' => implode(',',$funnelMissingId),
                        'matchedMahakumbhIds' => implode(',',$mahakumbhId),
                        'mainPhoto' => $newImagePath,
                        'totalResponse' => json_encode($faceresponse),
                        'gender' => $_POST['gender'],
                        'imageId' => $imageId
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$insertdata);
                    $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                    $lapataIds = array();
                    if($getDetails[0]['matchedLapataIds'] != '')
                    {
                        $lapataIds = array_unique(explode(',',$getDetails[0]['matchedLapataIds']));   
                    }
                    $isLogin = 0;
                    if($this->session->userdata('user_login') == 'yes'){
                        $isLogin = 1;
                    }else{
                        if(isset($_SESSION['landingMob']))
                        {
                            $isLogin = 1;
                        }
                    }
                    if($isLogin == 0)
                    {
                        if(count($lapataIds) > 0)
                        {
                            $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$lapataIds[0])->result_array();
                            $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                            if($getApplicationNumber[0]['isKyc'] == 1)
                            {
                                $notifyData = array(
                                    'isLogin' => 0,
                                    'dateCreated' => date('Y-m-d H:i:s'),
                                    'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                    'searchType' => 'Lapata',
                                    'searchPhoto' => $getDetails[0]['mainPhoto'],
                                    'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                    'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                );
                                $insert = $this->db->insert('searchnotification',$notifyData);
                            }else{
                                $notifyData = array(
                                    'isLogin' => 0,
                                    'dateCreated' => date('Y-m-d H:i:s'),
                                    'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                    'searchType' => 'Lapata',
                                    'searchPhoto' => $getDetails[0]['mainPhoto'],
                                    'complainantUserType' => 'NonKyc',
                                    'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                );
                                $insert = $this->db->insert('searchnotification',$notifyData);
                            }
                        }else{
                            if(count($unknownId) > 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$unknownId[0])->result_array();
                                $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $getDetails[0]['mainPhoto'],
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $getDetails[0]['mainPhoto'],
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                }
                            }
                        }
                    }
                    $response = array(
                        'status' => 'success',
                        'personName' => $personName,
                        'isWanted' => $isWanted,
                        'isCriminal' => $isCriminal,
                        'isLapata' => $isLapata,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => $isDobCorrect,
                        'isGenderCorrect' => $isGenderCorrect,
                        'message' => 'Person Found',
                        'isMissing' => $isMissing,
                        'isRegistered' => $isUserFound,
                        'image' => $userphoto,
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }else{
                    $response = array(
                        'status' => 'success',
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }
            }
            if($para == 'step4')
            {
                $data = $_POST["mainPhotoSelected"];
                $image_array_1 = explode(";", $data);
                $split1 = explode('data:image/',$image_array_1[0]);
                $image_array_2 = explode(",", $image_array_1[1]);
                $data = base64_decode($image_array_2[1]);
                $imageId = time().''.rand(0,10000);
                $newImagePath = 'upload/searchFacePerson/'.$imageId.'.'.$split1[1];
                file_put_contents($newImagePath, $data);
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                $faceresponse = json_decode(curl_exec($curl),true);
                $personName = '';
                $gender = '';
                $aadhar = '';
                $gender = '';
                $isVerified = 'No';
                $isVisible = 0;
                $age = '';
                $isWanted = 0;
                $isCriminal = 0;
                $wantedId = array();
                $criminalId = array();
                $address = '';
                $userphoto = '';
                $personId = 0;
                $isLapata = 0;
                $missingId = 0;
                $isUserFound = 0;
                $isMissing = 0;
                $isAadharCorrect = 0;
                $isGenderCorrect = 1;
                $isDobCorrect = 1;
                $userId = array();
                $missingId = array();
                $lapataId = array();
                $wantedId = array();
                $criminalId = array();
                $finalcount = 0;
                curl_close($curl);
                if(count($faceresponse) > 0)
                {
                    if(count($faceresponse['output']) > 0)
                    {
                        foreach($faceresponse['output'] as $k=>$v)
                        {
                            $split = explode('_',$v);
                            if($split[0] == 'GEN')
                            {
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $user = $this->db->get('user')->result_array();
                                if(count($user) > 0)
                                {
                                    foreach($user as $k1=>$v1)
                                    {
                                        array_push($userId,$v1['uid']);
                                        $finalcount++;
                                    }
                                }else{
                                    $getAadharImageId = $this->db->query('select * from user where aadharImageId="'.$v.'"')->result_array();
                                    if(count($getAadharImageId) > 0)
                                    {
                                        foreach($getAadharImageId as $k1=>$v1)
                                        {
                                            if(strtolower($_POST['gender']) == strtolower($v1['gender']))
                                            {
                                                if(strtotime($v1['aadharExpiryDate']) >= strtotime(date('Y-m-d')))
                                                {
                                                    array_push($userId,$v1['uid']);
                                                    $finalcount++;   
                                                }
                                            }
                                        }   
                                    }
                                }
                            }
                            if($split[0] == 'Missing')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('isFound',0);
                                $missingperson = $this->db->get('missingperson')->result_array();
                                if(count($missingperson) > 0)
                                {
                                    foreach($missingperson as $k1=>$v1)
                                    {
                                        array_push($missingId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'LAP')
                            {
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $this->db->where('expiryDate >=',date('Y-m-d h:i:s'));
                                $this->db->where('isFound',0);
                                $lapata = $this->db->get('unknown_person')->result_array();
                                if(count($lapata) > 0)
                                {
                                    foreach($lapata as $k1=>$v1)
                                    {
                                        array_push($lapataId,$v1['id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'Wanted')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('status','Active');
                                $wanted = $this->db->get('criminals')->result_array();
                                if(count($wanted) > 0)
                                {
                                    foreach($wanted as $k1=>$v1)
                                    {
                                        array_push($wantedId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'Criminal')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('status','Active');
                                $criminal = $this->db->get('criminals')->result_array();
                                if(count($criminal) > 0)
                                {
                                    foreach($criminal as $k1=>$v1)
                                    {
                                        array_push($criminalId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                        }
                    }
                }
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Accept: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                
                $faceresponse = json_decode(curl_exec($curl),true);
                $unknownId = array();
                /* if(count($faceresponse['output']) > 0)
                {
                    foreach($faceresponse['output'] as $k1=>$v1)
                    {
                        $this->db->where('isFinalSubmitted',1);
                        $this->db->or_where('imageId',$v1);
                        $this->db->or_where('imageId1',$v1);
                        $this->db->or_where('imageId2',$v1);
                        $getUnknownDetail = $this->db->get('unknown_person')->result_array();
                        if(count($getUnknownDetail) > 0)
                        {
                            foreach($getUnknownDetail as $k=>$v)
                            {
                                if($v['isFound'] == 0)
                                {
                                    array_push($unknownId,$v1['id']);
                                    $finalcount++;
                                }
                            }
                        }   
                    }
                }*/
                if($finalcount > 0)
                {
                    if(count($lapataId) > 0)
                    {
                        foreach($lapataId as $k=>$v)
                        {
                            if($k == 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$v)->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Lapata',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Lapata',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    if(count($unknownId) > 0)
                    {
                        foreach($unknownId as $k=>$v)
                        {
                            if($k == 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$v)->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    $insertdata = array(
                        'matchedLapataIds' => implode(',',$lapataId),
                        'matchedWantedIds' => implode(',',$wantedId),
                        'matchedCriminalIds' => implode(',',$criminalId),
                        'matchedMissingIds' => implode(',',$missingId),
                        'matchedUserIds' => implode(',',$userId),
                        'matchedUnknownIds' => implode(',',$unknownId),
                        'mainPhoto' => $newImagePath
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$insertdata);
                    $response = array(
                        'status' => 'success',
                        'personName' => $personName,
                        'isWanted' => $isWanted,
                        'isCriminal' => $isCriminal,
                        'isLapata' => $isLapata,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => $isDobCorrect,
                        'isGenderCorrect' => $isGenderCorrect,
                        'message' => 'Person Found',
                        'isMissing' => $isMissing,
                        'isRegistered' => $isUserFound,
                        'image' => $userphoto,
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }else{
                    $response = array(
                        'status' => 'success',
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }
            }
            
        }
    }

    function highFaceMatchFunnel($para = '')
    {
        if($para == '')
        {
            $page_data['control'] = 'user';
            $page_data['pn'] = 3;       
            $_SESSION['searchType'] = 1;
            if(isset($_SESSION['landingMob']))
            {
                $insertdata = array(
                    'mobileNumber' => $_SESSION['landingMob'],
                    'type' => 1,
                );   
            }else{
                $insertdata = array(
                    'type' => 1,
                );
            }
            $insert = $this->db->insert('searchfacehistory',$insertdata);
            $_SESSION['searchFaceId'] = $this->db->insert_id();
            $page_data['page_name'] = 'highFaceMatchFunnel';
            $page_data['title'] = 'Search By Face';
            $this->load->view('landing_page/index', $page_data);
        }else
        {
            if($para == 'step1')
            {
                // $getFinalId = $this->db->query('select max(Id) as Id from searchfacehistory')->result_array();
                // if($getFinalId[0]['Id'] != NULL)
                // {
                //     $_SESSION['searchFaceId'] = $getFinalId[0]['Id'] + 1;
                // }else{
                //     $_SESSION['searchFaceId'] = 1;
                // }
                $_SESSION['searchType'] = $_POST['type'];
                if(isset($_SESSION['landingMob']))
                {
                    $insertdata = array(
                        'mobileNumber' => $_SESSION['landingMob'],
                        'type' => $_POST['type'],
                    );   
                }else{
                    $insertdata = array(
                        'type' => $_POST['type'],
                    );
                }
                $insert = $this->db->insert('searchfacehistory',$insertdata);
                $_SESSION['searchFaceId'] = $this->db->insert_id();
                $response = array(
                    'isMobileAvailable' => (isset($_SESSION['landingMob']) ? 1 : 0)
                );
                echo json_encode($response);
            }
            if($para == 'step2')
            {
                $getPreviousDetail = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                if($getPreviousDetail[0]['otp'] == $_POST['otp'])
                {
                    $getDetail = $this->db->query('select * from nonKycUser where registration_mobile="'.$_POST['mobileNumber'].'"')->result_array();
                    if(count($getDetail) > 0)
                    {
                        if(isset($_SESSION['fcmtokenId']))
                        {
                            $update = $this->db->query('update notification_tokens_tbl set userType="guest", userId='.$getDetail[0]['uid'].' where Id='.$_SESSION['fcmtokenId']);
                        }
                        $_SESSION['landingMob'] = $_POST['mobileNumber'];
                        $_SESSION['user_id'] = $getDetail[0]['uid'];
                        $_SESSION['aadharName'] = $getDetail[0]['aadharname'];
                        $this->session->set_userdata('loginmob',$_POST['mobileNumber']);
                        $this->session->set_userdata('user_login', 'yes');
                        $this->session->set_userdata('gender', $getDetail[0]['gender']);
                        $this->session->set_userdata('login_type', 'NonKyc');
                    }else{
                        $insertdata = array(
                            'registration_mobile' => $_POST['mobileNumber']
                        );
                        $insert = $this->db->insert('nonKycUser',$insertdata);
                        $_SESSION['guestId'] = $this->db->insert_id();
                        $getDetail = $this->db->query('select * from nonKycUser where registration_mobile="'.$_POST['mobileNumber'].'"')->result_array();
                        if(isset($_SESSION['fcmtokenId']))
                        {
                            $update = $this->db->query('update notification_tokens_tbl set userType="guest", userId='.$getDetail[0]['uid'].' where Id='.$_SESSION['fcmtokenId']);
                        }
                        $_SESSION['landingMob'] = $_POST['mobileNumber'];
                        $_SESSION['user_id'] = $getDetail[0]['uid'];
                        $_SESSION['aadharName'] = $getDetail[0]['aadharname'];
                        $this->session->set_userdata('loginmob',$_POST['mobileNumber']);
                        $this->session->set_userdata('user_login', 'yes');
                        $this->session->set_userdata('gender', $getDetail[0]['gender']);
                        $this->session->set_userdata('login_type', 'NonKyc');
                    }
                    $updatedata = array(
                        'mobileNumber' => $_POST['mobileNumber'],
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$updatedata);
                    $response['status'] = 'success';
                }else{
                    $response['status'] = 'error';
                    $response['message'] = 'Invalid OTP';
                }
                echo json_encode($response);
            }
            if($para == 'step3')
            {
                $data = $_POST["mainPhotoSelected"];
                $image_array_1 = explode(";", $data);
                $split1 = explode('data:image/',$image_array_1[0]);
                $image_array_2 = explode(",", $image_array_1[1]);
                $data = base64_decode($image_array_2[1]);
                $imageId = $_SESSION['searchFaceId'];
                $newImagePath = 'upload/searchFacePerson/'.$imageId.'.'.$split1[1];
                unlink($newImagePath);
                file_put_contents($newImagePath, $data);
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                
                $faceresponse = json_decode(curl_exec($curl),true);
                curl_close($curl);
                $personName = '';
                $gender = '';
                $aadhar = '';
                $gender = '';
                $isVerified = 'No';
                $isVisible = 0;
                $age = '';
                $isWanted = 0;
                $isCriminal = 0;
                $wantedId = array();
                $criminalId = array();
                $address = '';
                $userphoto = '';
                $personId = 0;
                $isLapata = 0;
                $missingId = 0;
                $isUserFound = 0;
                $isMissing = 0;
                $isAadharCorrect = 0;
                $isGenderCorrect = 1;
                $isDobCorrect = 1;
                $familyId = array();
                $specialId = array();
                $userId = array();
                $missingId = array();
                $unknownId = array();
                $mahakumbhId = array();
                $lapataId = array();
                $wantedId = array();
                $criminalId = array();
                $funnelFamilyId = array();
                $funnelMissingId = array();
                $finalcount = 0;
                curl_close($curl);
                if(count($faceresponse) > 0)
                {
                    if(isset($faceresponse['confidence']) && count($faceresponse['confidence']) > 0)
                    {
                        if((isset($faceresponse['confidence']['High']) && count($faceresponse['confidence']['High']) > 0) || (isset($faceresponse['confidence']['Medium']) && count($faceresponse['confidence']['Medium']) > 0) || (isset($faceresponse['confidence']['Low']) && count($faceresponse['confidence']['Low']) > 0))
                        {
                            $faceresponse['confidence']['High'] = array_unique(array_merge($faceresponse['confidence']['High'],$faceresponse['confidence']['Medium']));
                            $faceresponse['confidence']['High'] = array_unique(array_merge($faceresponse['confidence']['High'],$faceresponse['confidence']['Low']));
                            foreach($faceresponse['confidence']['High'] as $k=>$v)
                            {
                                if($finalcount <= 15)
                                {
                                    $split = explode('_',$v);
                                    if($split[0] == 'GEN')
                                    {
                                        $this->db->or_where('imageId',$v);
                                        $this->db->or_where('imageId1',$v);
                                        $this->db->or_where('imageId2',$v);
                                        $user = $this->db->get('user')->result_array();
                                        if(count($user) > 0)
                                        {
                                            foreach($user as $k1=>$v1)
                                            {
                                                if(strtolower($_POST['gender']) == strtolower($v1['gender']))
                                                {
                                                    array_push($userId,$v1['uid']);
                                                    $finalcount++;   
                                                }
                                            }
                                        }else{
                                            $getAadharImageId = $this->db->query('select * from user where aadharImageId="'.$v.'"')->result_array();
                                            if(count($getAadharImageId) > 0)
                                            {
                                                foreach($getAadharImageId as $k1=>$v1)
                                                {
                                                    if(strtolower($_POST['gender']) == strtolower($v1['gender']))
                                                    {
                                                        if(strtotime($v1['aadharExpiryDate']) >= strtotime(date('Y-m-d')))
                                                        {
                                                            array_push($userId,$v1['uid']);
                                                            $finalcount++;   
                                                        }
                                                    }
                                                }   
                                            }
                                        }       
                                    }
                                    if($split[0] == 'Missing')
                                    {
                                        $this->db->where('imageId',$v);
                                        $this->db->where('isFinalSubmitted',1);
                                        $this->db->where('isFound',0);
                                        $missingperson = $this->db->get('missingperson')->result_array();
                                        if(count($missingperson) > 0)
                                        {
                                            foreach($missingperson as $k1=>$v1)
                                            {
                                                array_push($missingId,$v1['Id']);
                                                $finalcount++;
                                            }
                                        }
                                    }
                                    if($split[0] == 'LAP')
                                    {
                                        $this->db->or_where('imageId',$v);
                                        $this->db->or_where('imageId1',$v);
                                        $this->db->or_where('imageId2',$v);
                                        $lapata = $this->db->get('unknown_person')->result_array();
                                        if(count($lapata) > 0)
                                        {
                                            foreach($lapata as $k1=>$v1)
                                            {
                                                if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                                {
                                                    if($v1['isFound'] == '0')
                                                    {
                                                        if($v1['awsEventName'] == 'All')
                                                        {
                                                            $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                            if($gender == strtolower($v1['Gender']))
                                                            {
                                                                if($v1['isFinalSubmitted'] == 1)
                                                                {
                                                                    array_push($lapataId,$v1['id']);
                                                                    $finalcount++;
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    if($split[0] == 'Wanted')
                                    {
                                        $this->db->where('imageId',$v);
                                        $this->db->where('isFinalSubmitted',1);
                                        $this->db->where('status','Active');
                                        $wanted = $this->db->get('criminals')->result_array();
                                        if(count($wanted) > 0)
                                        {
                                            foreach($wanted as $k1=>$v1)
                                            {
                                                array_push($wantedId,$v1['Id']);
                                                $finalcount++;
                                            }
                                        }
                                    }
                                    if($split[0] == 'Criminal')
                                    {
                                        $this->db->where('imageId',$v);
                                        $this->db->where('isFinalSubmitted',1);
                                        $this->db->where('status','Active');
                                        $criminal = $this->db->get('criminals')->result_array();
                                        if(count($criminal) > 0)
                                        {
                                            foreach($criminal as $k1=>$v1)
                                            {
                                                array_push($criminalId,$v1['Id']);
                                                $finalcount++;
                                            }
                                        }
                                    }
                                    if($split[0] == 'FAM')
                                    {
                                        $this->db->or_where('imageId',$v);
                                        $this->db->or_where('imageId1',$v);
                                        $this->db->or_where('imageId2',$v);
                                        $familyMember = $this->db->get('familyMember')->result_array();
                                        if(count($familyMember) > 0)
                                        {
                                            foreach($familyMember as $k1=>$v1)
                                            {
                                                if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                                {
                                                    if($v1['activeStatus'] == 1)
                                                    {
                                                        $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                        if($gender == strtolower($v1['Gender']))
                                                        {
                                                            if($v1['isFinalSubmitted'] == 1)
                                                            {
                                                                array_push($familyId,$v1['id']);
                                                                $finalcount++;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    if($split[0] == 'FFU')
                                    {
                                        $this->db->or_where('imageId',$v);
                                        $this->db->or_where('imageId1',$v);
                                        $this->db->or_where('imageId2',$v);
                                        $familyMember = $this->db->get('funnelfamily')->result_array();
                                        if(count($familyMember) > 0)
                                        {
                                            foreach($familyMember as $k1=>$v1)
                                            {
                                                if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                                {
                                                    if($v1['activeStatus'] == 1)
                                                    {
                                                        $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                        if($gender == strtolower($v1['Gender']))
                                                        {
                                                            if($v1['isFinalSubmitted'] == 1)
                                                            {
                                                                array_push($funnelFamilyId,$v1['id']);
                                                                $finalcount++;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    if($split[0] == 'FUM')
                                    {
                                        $this->db->or_where('imageId',$v);
                                        $this->db->or_where('imageId1',$v);
                                        $this->db->or_where('imageId2',$v);
                                        $lapata = $this->db->get('funnel_missing')->result_array();
                                        if(count($lapata) > 0)
                                        {
                                            foreach($lapata as $k1=>$v1)
                                            {
                                                if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                                {
                                                    if($v1['isFound'] == '0')
                                                    {
                                                        $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                        if($gender == strtolower($v1['Gender']))
                                                        {
                                                            if($v1['isFinalSubmitted'] == 1)
                                                            {
                                                                array_push($funnelMissingId,$v1['id']);
                                                                $finalcount++;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    if($this->getSettings('mahakumbhFamily') == 'yes')
                                    {
                                        if($split[0] == 'MAH')
                                        {
                                            $this->db->or_where('imageId',$v);
                                            $this->db->or_where('imageId1',$v);
                                            $this->db->or_where('imageId2',$v);
                                            $familyMember = $this->db->get('mahakumbhMember')->result_array();
                                            if(count($familyMember) > 0)
                                            {
                                                foreach($familyMember as $k1=>$v1)
                                                {
                                                    if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                                    {
                                                        if($v1['activeStatus'] == 1)
                                                        {
                                                            $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                            if($gender == strtolower($v1['Gender']))
                                                            {
                                                                if($v1['isFinalSubmitted'] == 1)
                                                                {
                                                                    array_push($mahakumbhId,$v1['id']);
                                                                    $finalcount++;
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    if($this->getSettings('mahakumbhSpecial') == 'yes')
                                    {
                                        if($split[0] == 'SPE')
                                        {
                                            $this->db->or_where('imageId',$v);
                                            $this->db->or_where('imageId1',$v);
                                            $this->db->or_where('imageId2',$v);
                                            $familyMember = $this->db->get('mahakumbhSpecial')->result_array();
                                            if(count($familyMember) > 0)
                                            {
                                                foreach($familyMember as $k1=>$v1)
                                                {
                                                    if($v1['isFound'] == 0)
                                                    {
                                                        if(strtolower($_POST['gender']) == strtolower($v1['Gender']))
                                                        {
                                                            array_push($specialId,$v1['id']);
                                                            $finalcount++;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    $this->db->or_where('imageId',$v);
                                    $this->db->or_where('imageId1',$v);
                                    $this->db->or_where('imageId2',$v);
                                    $this->db->where('isFinalSubmitted',1);
                                    $getUnknownDetail = $this->db->get('unknown_person')->result_array();
                                    if(count($getUnknownDetail) > 0)
                                    {
                                        foreach($getUnknownDetail as $k1=>$v1)
                                        {
                                            if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                            {
                                                if($v1['isFound'] == '0' && $v1['awsEventName'] != 'All')
                                                {
                                                    $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                    if($gender == strtolower($v1['Gender']))
                                                    {
                                                        if($v1['isFinalSubmitted'] == 1)
                                                        {
                                                            array_push($unknownId,$v1['id']);
                                                            $finalcount++;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }   
                                }
                            }
                        }
                    }
                }
                if($finalcount > 0)
                {
                    $insertdata = array(
                        'matchedSpecialIds' => implode(',',$specialId),
                        'matchedLapataIds' => implode(',',$lapataId),
                        'matchedWantedIds' => implode(',',$wantedId),
                        'matchedCriminalIds' => implode(',',$criminalId),
                        'matchedMissingIds' => implode(',',$missingId),
                        'matchedUserIds' => implode(',',$userId),
                        'matchedFamilyIds' => implode(',',$familyId),
                        'matchedUnknownIds' => implode(',',$unknownId),
                        'matchedFunnelFamilyIds' => implode(',',$funnelFamilyId),
                        'matchedFunnelMissingIds' => implode(',',$funnelMissingId),
                        'matchedMahakumbhIds' => implode(',',$mahakumbhId),
                        'mainPhoto' => $newImagePath,
                        'totalResponse' => json_encode($faceresponse),
                        'gender' => $_POST['gender'],
                        'imageId' => $imageId
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$insertdata);
                    $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                    $lapataIds = array();
                    if($getDetails[0]['matchedLapataIds'] != '')
                    {
                        $lapataIds = array_unique(explode(',',$getDetails[0]['matchedLapataIds']));   
                    }
                    $isLogin = 0;
                    if($this->session->userdata('user_login') == 'yes'){
                        $isLogin = 1;
                    }else{
                        if(isset($_SESSION['landingMob']))
                        {
                            $isLogin = 1;
                        }
                    }
                    if($isLogin == 0)
                    {
                        if(count($lapataIds) > 0)
                        {
                            $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$lapataIds[0])->result_array();
                            $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                            if($getApplicationNumber[0]['isKyc'] == 1)
                            {
                                $notifyData = array(
                                    'isLogin' => 0,
                                    'dateCreated' => date('Y-m-d H:i:s'),
                                    'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                    'searchType' => 'Lapata',
                                    'searchPhoto' => $getDetails[0]['mainPhoto'],
                                    'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                    'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                );
                                $insert = $this->db->insert('searchnotification',$notifyData);
                            }else{
                                $notifyData = array(
                                    'isLogin' => 0,
                                    'dateCreated' => date('Y-m-d H:i:s'),
                                    'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                    'searchType' => 'Lapata',
                                    'searchPhoto' => $getDetails[0]['mainPhoto'],
                                    'complainantUserType' => 'NonKyc',
                                    'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                );
                                $insert = $this->db->insert('searchnotification',$notifyData);
                            }
                        }else{
                            if(count($unknownId) > 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$unknownId[0])->result_array();
                                $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $getDetails[0]['mainPhoto'],
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $getDetails[0]['mainPhoto'],
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                }
                            }
                        }
                    }
                    $response = array(
                        'status' => 'success',
                        'personName' => $personName,
                        'isWanted' => $isWanted,
                        'isCriminal' => $isCriminal,
                        'isLapata' => $isLapata,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => $isDobCorrect,
                        'isGenderCorrect' => $isGenderCorrect,
                        'message' => 'Person Found',
                        'isMissing' => $isMissing,
                        'isRegistered' => $isUserFound,
                        'image' => $userphoto,
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }else{
                    $response = array(
                        'status' => 'success',
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }
            }
            if($para == 'step4')
            {
                $data = $_POST["mainPhotoSelected"];
                $image_array_1 = explode(";", $data);
                $split1 = explode('data:image/',$image_array_1[0]);
                $image_array_2 = explode(",", $image_array_1[1]);
                $data = base64_decode($image_array_2[1]);
                $imageId = time().''.rand(0,10000);
                $newImagePath = 'upload/searchFacePerson/'.$imageId.'.'.$split1[1];
                file_put_contents($newImagePath, $data);
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                $faceresponse = json_decode(curl_exec($curl),true);
                $personName = '';
                $gender = '';
                $aadhar = '';
                $gender = '';
                $isVerified = 'No';
                $isVisible = 0;
                $age = '';
                $isWanted = 0;
                $isCriminal = 0;
                $wantedId = array();
                $criminalId = array();
                $address = '';
                $userphoto = '';
                $personId = 0;
                $isLapata = 0;
                $missingId = 0;
                $isUserFound = 0;
                $isMissing = 0;
                $isAadharCorrect = 0;
                $isGenderCorrect = 1;
                $isDobCorrect = 1;
                $userId = array();
                $missingId = array();
                $lapataId = array();
                $wantedId = array();
                $criminalId = array();
                $finalcount = 0;
                curl_close($curl);
                if(count($faceresponse) > 0)
                {
                    if(count($faceresponse['output']) > 0)
                    {
                        foreach($faceresponse['output'] as $k=>$v)
                        {
                            $split = explode('_',$v);
                            if($split[0] == 'GEN')
                            {
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $user = $this->db->get('user')->result_array();
                                if(count($user) > 0)
                                {
                                    foreach($user as $k1=>$v1)
                                    {
                                        array_push($userId,$v1['uid']);
                                        $finalcount++;
                                    }
                                }else{
                                    $getAadharImageId = $this->db->query('select * from user where aadharImageId="'.$v.'"')->result_array();
                                    if(count($getAadharImageId) > 0)
                                    {
                                        foreach($getAadharImageId as $k1=>$v1)
                                        {
                                            if(strtolower($_POST['gender']) == strtolower($v1['gender']))
                                            {
                                                if(strtotime($v1['aadharExpiryDate']) >= strtotime(date('Y-m-d')))
                                                {
                                                    array_push($userId,$v1['uid']);
                                                    $finalcount++;   
                                                }
                                            }
                                        }   
                                    }
                                }
                            }
                            if($split[0] == 'Missing')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('isFound',0);
                                $missingperson = $this->db->get('missingperson')->result_array();
                                if(count($missingperson) > 0)
                                {
                                    foreach($missingperson as $k1=>$v1)
                                    {
                                        array_push($missingId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'LAP')
                            {
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $this->db->where('expiryDate >=',date('Y-m-d h:i:s'));
                                $this->db->where('isFound',0);
                                $lapata = $this->db->get('unknown_person')->result_array();
                                if(count($lapata) > 0)
                                {
                                    foreach($lapata as $k1=>$v1)
                                    {
                                        array_push($lapataId,$v1['id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'Wanted')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('status','Active');
                                $wanted = $this->db->get('criminals')->result_array();
                                if(count($wanted) > 0)
                                {
                                    foreach($wanted as $k1=>$v1)
                                    {
                                        array_push($wantedId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'Criminal')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('status','Active');
                                $criminal = $this->db->get('criminals')->result_array();
                                if(count($criminal) > 0)
                                {
                                    foreach($criminal as $k1=>$v1)
                                    {
                                        array_push($criminalId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                        }
                    }
                }
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Accept: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                
                $faceresponse = json_decode(curl_exec($curl),true);
                $unknownId = array();
                /* if(count($faceresponse['output']) > 0)
                {
                    foreach($faceresponse['output'] as $k1=>$v1)
                    {
                        $this->db->where('isFinalSubmitted',1);
                        $this->db->or_where('imageId',$v1);
                        $this->db->or_where('imageId1',$v1);
                        $this->db->or_where('imageId2',$v1);
                        $getUnknownDetail = $this->db->get('unknown_person')->result_array();
                        if(count($getUnknownDetail) > 0)
                        {
                            foreach($getUnknownDetail as $k=>$v)
                            {
                                if($v['isFound'] == 0)
                                {
                                    array_push($unknownId,$v1['id']);
                                    $finalcount++;
                                }
                            }
                        }   
                    }
                }*/
                if($finalcount > 0)
                {
                    if(count($lapataId) > 0)
                    {
                        foreach($lapataId as $k=>$v)
                        {
                            if($k == 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$v)->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Lapata',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Lapata',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    if(count($unknownId) > 0)
                    {
                        foreach($unknownId as $k=>$v)
                        {
                            if($k == 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$v)->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    $insertdata = array(
                        'matchedLapataIds' => implode(',',$lapataId),
                        'matchedWantedIds' => implode(',',$wantedId),
                        'matchedCriminalIds' => implode(',',$criminalId),
                        'matchedMissingIds' => implode(',',$missingId),
                        'matchedUserIds' => implode(',',$userId),
                        'matchedUnknownIds' => implode(',',$unknownId),
                        'mainPhoto' => $newImagePath
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$insertdata);
                    $response = array(
                        'status' => 'success',
                        'personName' => $personName,
                        'isWanted' => $isWanted,
                        'isCriminal' => $isCriminal,
                        'isLapata' => $isLapata,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => $isDobCorrect,
                        'isGenderCorrect' => $isGenderCorrect,
                        'message' => 'Person Found',
                        'isMissing' => $isMissing,
                        'isRegistered' => $isUserFound,
                        'image' => $userphoto,
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }else{
                    $response = array(
                        'status' => 'success',
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }
            }
            
        }
    }

    function newFaceMatch($para = '')
    {
        if($para == '')
        {
            $page_data['control'] = 'user';
            $page_data['pn'] = 3;       
            $_SESSION['searchType'] = 1;
            if(isset($_SESSION['landingMob']))
            {
                $insertdata = array(
                    'mobileNumber' => $_SESSION['landingMob'],
                    'type' => 1,
                );   
            }else{
                $insertdata = array(
                    'type' => 1,
                );
            }
            $insert = $this->db->insert('searchfacehistory',$insertdata);
            $_SESSION['searchFaceId'] = $this->db->insert_id();
            $page_data['page_name'] = 'newFaceMatch';
            $page_data['title'] = 'Search By Face';
            $this->load->view('landing_page/index', $page_data);
        }else
        {
            if($para == 'step1')
            {
                // $getFinalId = $this->db->query('select max(Id) as Id from searchfacehistory')->result_array();
                // if($getFinalId[0]['Id'] != NULL)
                // {
                //     $_SESSION['searchFaceId'] = $getFinalId[0]['Id'] + 1;
                // }else{
                //     $_SESSION['searchFaceId'] = 1;
                // }
                $_SESSION['searchType'] = $_POST['type'];
                if(isset($_SESSION['landingMob']))
                {
                    $insertdata = array(
                        'mobileNumber' => $_SESSION['landingMob'],
                        'type' => $_POST['type'],
                    );   
                }else{
                    $insertdata = array(
                        'type' => $_POST['type'],
                    );
                }
                $insert = $this->db->insert('searchfacehistory',$insertdata);
                $_SESSION['searchFaceId'] = $this->db->insert_id();
                $response = array(
                    'isMobileAvailable' => (isset($_SESSION['landingMob']) ? 1 : 0)
                );
                echo json_encode($response);
            }
            if($para == 'step2')
            {
                $getPreviousDetail = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                if($getPreviousDetail[0]['otp'] == $_POST['otp'])
                {
                    $getDetail = $this->db->query('select * from nonKycUser where registration_mobile="'.$_POST['mobileNumber'].'"')->result_array();
                    if(count($getDetail) > 0)
                    {
                        if(isset($_SESSION['fcmtokenId']))
                        {
                            $update = $this->db->query('update notification_tokens_tbl set userType="guest", userId='.$getDetail[0]['uid'].' where Id='.$_SESSION['fcmtokenId']);
                        }
                        $_SESSION['landingMob'] = $_POST['mobileNumber'];
                        $_SESSION['user_id'] = $getDetail[0]['uid'];
                        $_SESSION['aadharName'] = $getDetail[0]['aadharname'];
                        $this->session->set_userdata('loginmob',$_POST['mobileNumber']);
                        $this->session->set_userdata('user_login', 'yes');
                        $this->session->set_userdata('gender', $getDetail[0]['gender']);
                        $this->session->set_userdata('login_type', 'NonKyc');
                    }else{
                        $insertdata = array(
                            'registration_mobile' => $_POST['mobileNumber']
                        );
                        $insert = $this->db->insert('nonKycUser',$insertdata);
                        $_SESSION['guestId'] = $this->db->insert_id();
                        $getDetail = $this->db->query('select * from nonKycUser where registration_mobile="'.$_POST['mobileNumber'].'"')->result_array();
                        if(isset($_SESSION['fcmtokenId']))
                        {
                            $update = $this->db->query('update notification_tokens_tbl set userType="guest", userId='.$getDetail[0]['uid'].' where Id='.$_SESSION['fcmtokenId']);
                        }
                        $_SESSION['landingMob'] = $_POST['mobileNumber'];
                        $_SESSION['user_id'] = $getDetail[0]['uid'];
                        $_SESSION['aadharName'] = $getDetail[0]['aadharname'];
                        $this->session->set_userdata('loginmob',$_POST['mobileNumber']);
                        $this->session->set_userdata('user_login', 'yes');
                        $this->session->set_userdata('gender', $getDetail[0]['gender']);
                        $this->session->set_userdata('login_type', 'NonKyc');
                    }
                    $updatedata = array(
                        'mobileNumber' => $_POST['mobileNumber'],
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$updatedata);
                    $response['status'] = 'success';
                }else{
                    $response['status'] = 'error';
                    $response['message'] = 'Invalid OTP';
                }
                echo json_encode($response);
            }
            if($para == 'step3')
            {
                $data = $_POST["mainPhotoSelected"];
                $image_array_1 = explode(";", $data);
                $split1 = explode('data:image/',$image_array_1[0]);
                $image_array_2 = explode(",", $image_array_1[1]);
                $data = base64_decode($image_array_2[1]);
                $imageId = $_SESSION['searchFaceId'];
                $newImagePath = 'upload/searchFacePerson/'.$imageId.'.'.$split1[1];
                unlink($newImagePath);
                file_put_contents($newImagePath, $data);
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                
                $faceresponse = json_decode(curl_exec($curl),true);
                curl_close($curl);
                $personName = '';
                $gender = '';
                $aadhar = '';
                $gender = '';
                $isVerified = 'No';
                $isVisible = 0;
                $age = '';
                $isWanted = 0;
                $isCriminal = 0;
                $wantedId = array();
                $criminalId = array();
                $address = '';
                $userphoto = '';
                $personId = 0;
                $isLapata = 0;
                $missingId = 0;
                $isUserFound = 0;
                $isMissing = 0;
                $isAadharCorrect = 0;
                $isGenderCorrect = 1;
                $isDobCorrect = 1;
                $familyId = array();
                $specialId = array();
                $userId = array();
                $missingId = array();
                $unknownId = array();
                $mahakumbhId = array();
                $lapataId = array();
                $wantedId = array();
                $criminalId = array();
                $finalcount = 0;
                curl_close($curl);
                if(count($faceresponse) > 0)
                {
                    if(isset($faceresponse['output']) && count($faceresponse['output']) > 0)
                    {
                        foreach($faceresponse['output'] as $k=>$v)
                        {
                            if($finalcount <= 15)
                            {
                                $split = explode('_',$v);
                                if($split[0] == 'GEN')
                                {
                                    $this->db->or_where('imageId',$v);
                                    $this->db->or_where('imageId1',$v);
                                    $this->db->or_where('imageId2',$v);
                                    $user = $this->db->get('user')->result_array();
                                    if(count($user) > 0)
                                    {
                                        foreach($user as $k1=>$v1)
                                        {
                                            if(strtolower($_POST['gender']) == strtolower($v1['gender']))
                                            {
                                                array_push($userId,$v1['uid']);
                                                $finalcount++;   
                                            }
                                        }
                                    }else{
                                        $getAadharImageId = $this->db->query('select * from user where aadharImageId="'.$v.'"')->result_array();
                                        if(count($getAadharImageId) > 0)
                                        {
                                            foreach($getAadharImageId as $k1=>$v1)
                                            {
                                                if(strtolower($_POST['gender']) == strtolower($v1['gender']))
                                                {
                                                    if(strtotime($v1['aadharExpiryDate']) >= strtotime(date('Y-m-d')))
                                                    {
                                                        array_push($userId,$v1['uid']);
                                                        $finalcount++;   
                                                    }
                                                }
                                            }   
                                        }
                                    }       
                                }
                                if($split[0] == 'Missing')
                                {
                                    $this->db->where('imageId',$v);
                                    $this->db->where('isFinalSubmitted',1);
                                    $this->db->where('isFound',0);
                                    $missingperson = $this->db->get('missingperson')->result_array();
                                    if(count($missingperson) > 0)
                                    {
                                        foreach($missingperson as $k1=>$v1)
                                        {
                                            array_push($missingId,$v1['Id']);
                                            $finalcount++;
                                        }
                                    }
                                }
                                if($split[0] == 'LAP')
                                {
                                    $this->db->or_where('imageId',$v);
                                    $this->db->or_where('imageId1',$v);
                                    $this->db->or_where('imageId2',$v);
                                    $lapata = $this->db->get('unknown_person')->result_array();
                                    if(count($lapata) > 0)
                                    {
                                        foreach($lapata as $k1=>$v1)
                                        {
                                            if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                            {
                                                if($v1['isFound'] == '0')
                                                {
                                                    if($v1['awsEventName'] == 'All')
                                                    {
                                                        $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                        if($gender == strtolower($v1['Gender']))
                                                        {
                                                            if($v1['isFinalSubmitted'] == 1)
                                                            {
                                                                array_push($lapataId,$v1['id']);
                                                                $finalcount++;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                                if($split[0] == 'Wanted')
                                {
                                    $this->db->where('imageId',$v);
                                    $this->db->where('isFinalSubmitted',1);
                                    $this->db->where('status','Active');
                                    $wanted = $this->db->get('criminals')->result_array();
                                    if(count($wanted) > 0)
                                    {
                                        foreach($wanted as $k1=>$v1)
                                        {
                                            array_push($wantedId,$v1['Id']);
                                            $finalcount++;
                                        }
                                    }
                                }
                                if($split[0] == 'Criminal')
                                {
                                    $this->db->where('imageId',$v);
                                    $this->db->where('isFinalSubmitted',1);
                                    $this->db->where('status','Active');
                                    $criminal = $this->db->get('criminals')->result_array();
                                    if(count($criminal) > 0)
                                    {
                                        foreach($criminal as $k1=>$v1)
                                        {
                                            array_push($criminalId,$v1['Id']);
                                            $finalcount++;
                                        }
                                    }
                                }
                                if($split[0] == 'FAM')
                                {
                                    $this->db->or_where('imageId',$v);
                                    $this->db->or_where('imageId1',$v);
                                    $this->db->or_where('imageId2',$v);
                                    $familyMember = $this->db->get('familyMember')->result_array();
                                    if(count($familyMember) > 0)
                                    {
                                        foreach($familyMember as $k1=>$v1)
                                        {
                                            if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                            {
                                                if($v1['activeStatus'] == 1)
                                                {
                                                    $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                    if($gender == strtolower($v1['Gender']))
                                                    {
                                                        if($v1['isFinalSubmitted'] == 1)
                                                        {
                                                            array_push($familyId,$v1['id']);
                                                            $finalcount++;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                                if($split[0] == 'MAH')
                                {
                                    $this->db->or_where('imageId',$v);
                                    $this->db->or_where('imageId1',$v);
                                    $this->db->or_where('imageId2',$v);
                                    $familyMember = $this->db->get('mahakumbhMember')->result_array();
                                    if(count($familyMember) > 0)
                                    {
                                        foreach($familyMember as $k1=>$v1)
                                        {
                                            if(strtotime($v1['expiryDate']) >= strtotime(date('Y-m-d')))
                                            {
                                                if($v1['activeStatus'] == 1)
                                                {
                                                    $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                                    if($gender == strtolower($v1['Gender']))
                                                    {
                                                        if($v1['isFinalSubmitted'] == 1)
                                                        {
                                                            array_push($mahakumbhId,$v1['id']);
                                                            $finalcount++;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                                if($this->getSettings('mahakumbhSpecial') == 'yes')
                                {
                                    if($split[0] == 'SPE')
                                    {
                                        $this->db->or_where('imageId',$v);
                                        $this->db->or_where('imageId1',$v);
                                        $this->db->or_where('imageId2',$v);
                                        $familyMember = $this->db->get('mahakumbhSpecial')->result_array();
                                        if(count($familyMember) > 0)
                                        {
                                            foreach($familyMember as $k1=>$v1)
                                            {
                                                if($v1['isFound'] == 0)
                                                {
                                                    if(strtolower($_POST['gender']) == strtolower($v1['Gender']))
                                                    {
                                                        array_push($specialId,$v1['id']);
                                                        $finalcount++;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $getUnknownDetail = $this->db->get('unknown_person')->result_array();
                                if(count($getUnknownDetail) > 0)
                                {
                                    foreach($getUnknownDetail as $k1=>$v1)
                                    {
                                        if($v1['isFound'] == '0' && $v1['awsEventName'] != 'All')
                                        {
                                            $gender = $_POST['gender'] == 'male' ? 'boy' : ($_POST['gender'] == 'female' ? 'girl' : 'other');
                                            if($gender == strtolower($v1['Gender']))
                                            {
                                                if($v1['isFinalSubmitted'] == 1)
                                                {
                                                    array_push($unknownId,$v1['id']);
                                                    $finalcount++;
                                                }
                                            }
                                        }
                                    }
                                }   
                            }
                        }
                    }
                }
                if($finalcount > 0)
                {
                    $insertdata = array(
                        'matchedSpecialIds' => implode(',',$specialId),
                        'matchedLapataIds' => implode(',',$lapataId),
                        'matchedWantedIds' => implode(',',$wantedId),
                        'matchedCriminalIds' => implode(',',$criminalId),
                        'matchedMissingIds' => implode(',',$missingId),
                        'matchedUserIds' => implode(',',$userId),
                        'matchedFamilyIds' => implode(',',$familyId),
                        'matchedUnknownIds' => implode(',',$unknownId),
                        'matchedMahakumbhIds' => implode(',',$mahakumbhId),
                        'mainPhoto' => $newImagePath,
                        'totalResponse' => json_encode($faceresponse),
                        'gender' => $_POST['gender'],
                        'imageId' => $imageId
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$insertdata);
                    $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                    $lapataIds = array();
                    if($getDetails[0]['matchedLapataIds'] != '')
                    {
                        $lapataIds = array_unique(explode(',',$getDetails[0]['matchedLapataIds']));   
                    }
                    $isLogin = 0;
                    if($this->session->userdata('user_login') == 'yes'){
                        $isLogin = 1;
                    }else{
                        if(isset($_SESSION['landingMob']))
                        {
                            $isLogin = 1;
                        }
                    }
                    if($isLogin == 0)
                    {
                        if(count($lapataIds) > 0)
                        {
                            $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$lapataIds[0])->result_array();
                            $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                            if($getApplicationNumber[0]['isKyc'] == 1)
                            {
                                $notifyData = array(
                                    'isLogin' => 0,
                                    'dateCreated' => date('Y-m-d H:i:s'),
                                    'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                    'searchType' => 'Lapata',
                                    'searchPhoto' => $getDetails[0]['mainPhoto'],
                                    'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                    'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                );
                                $insert = $this->db->insert('searchnotification',$notifyData);
                            }else{
                                $notifyData = array(
                                    'isLogin' => 0,
                                    'dateCreated' => date('Y-m-d H:i:s'),
                                    'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                    'searchType' => 'Lapata',
                                    'searchPhoto' => $getDetails[0]['mainPhoto'],
                                    'complainantUserType' => 'NonKyc',
                                    'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                );
                                $insert = $this->db->insert('searchnotification',$notifyData);
                            }
                        }else{
                            if(count($unknownId) > 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$unknownId[0])->result_array();
                                $getDetails = $this->db->query('select * from searchfacehistory where Id='.$_SESSION['searchFaceId'])->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $getDetails[0]['mainPhoto'],
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $getDetails[0]['mainPhoto'],
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                }
                            }
                        }
                    }
                    $response = array(
                        'status' => 'success',
                        'personName' => $personName,
                        'isWanted' => $isWanted,
                        'isCriminal' => $isCriminal,
                        'isLapata' => $isLapata,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => $isDobCorrect,
                        'isGenderCorrect' => $isGenderCorrect,
                        'message' => 'Person Found',
                        'isMissing' => $isMissing,
                        'isRegistered' => $isUserFound,
                        'image' => $userphoto,
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }else{
                    $response = array(
                        'status' => 'success',
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }
            }
            if($para == 'step4')
            {
                $data = $_POST["mainPhotoSelected"];
                $image_array_1 = explode(";", $data);
                $split1 = explode('data:image/',$image_array_1[0]);
                $image_array_2 = explode(",", $image_array_1[1]);
                $data = base64_decode($image_array_2[1]);
                $imageId = time().''.rand(0,10000);
                $newImagePath = 'upload/searchFacePerson/'.$imageId.'.'.$split1[1];
                file_put_contents($newImagePath, $data);
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                $faceresponse = json_decode(curl_exec($curl),true);
                $personName = '';
                $gender = '';
                $aadhar = '';
                $gender = '';
                $isVerified = 'No';
                $isVisible = 0;
                $age = '';
                $isWanted = 0;
                $isCriminal = 0;
                $wantedId = array();
                $criminalId = array();
                $address = '';
                $userphoto = '';
                $personId = 0;
                $isLapata = 0;
                $missingId = 0;
                $isUserFound = 0;
                $isMissing = 0;
                $isAadharCorrect = 0;
                $isGenderCorrect = 1;
                $isDobCorrect = 1;
                $userId = array();
                $missingId = array();
                $lapataId = array();
                $wantedId = array();
                $criminalId = array();
                $finalcount = 0;
                curl_close($curl);
                if(count($faceresponse) > 0)
                {
                    if(count($faceresponse['output']) > 0)
                    {
                        foreach($faceresponse['output'] as $k=>$v)
                        {
                            $split = explode('_',$v);
                            if($split[0] == 'GEN')
                            {
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $user = $this->db->get('user')->result_array();
                                if(count($user) > 0)
                                {
                                    foreach($user as $k1=>$v1)
                                    {
                                        array_push($userId,$v1['uid']);
                                        $finalcount++;
                                    }
                                }else{
                                    $getAadharImageId = $this->db->query('select * from user where aadharImageId="'.$v.'"')->result_array();
                                    if(count($getAadharImageId) > 0)
                                    {
                                        foreach($getAadharImageId as $k1=>$v1)
                                        {
                                            if(strtolower($_POST['gender']) == strtolower($v1['gender']))
                                            {
                                                if(strtotime($v1['aadharExpiryDate']) >= strtotime(date('Y-m-d')))
                                                {
                                                    array_push($userId,$v1['uid']);
                                                    $finalcount++;   
                                                }
                                            }
                                        }   
                                    }
                                }
                            }
                            if($split[0] == 'Missing')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('isFound',0);
                                $missingperson = $this->db->get('missingperson')->result_array();
                                if(count($missingperson) > 0)
                                {
                                    foreach($missingperson as $k1=>$v1)
                                    {
                                        array_push($missingId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'LAP')
                            {
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->or_where('imageId',$v);
                                $this->db->or_where('imageId1',$v);
                                $this->db->or_where('imageId2',$v);
                                $this->db->where('expiryDate >=',date('Y-m-d h:i:s'));
                                $this->db->where('isFound',0);
                                $lapata = $this->db->get('unknown_person')->result_array();
                                if(count($lapata) > 0)
                                {
                                    foreach($lapata as $k1=>$v1)
                                    {
                                        array_push($lapataId,$v1['id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'Wanted')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('status','Active');
                                $wanted = $this->db->get('criminals')->result_array();
                                if(count($wanted) > 0)
                                {
                                    foreach($wanted as $k1=>$v1)
                                    {
                                        array_push($wantedId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                            if($split[0] == 'Criminal')
                            {
                                $this->db->where('imageId',$v);
                                $this->db->where('isFinalSubmitted',1);
                                $this->db->where('status','Active');
                                $criminal = $this->db->get('criminals')->result_array();
                                if(count($criminal) > 0)
                                {
                                    foreach($criminal as $k1=>$v1)
                                    {
                                        array_push($criminalId,$v1['Id']);
                                        $finalcount++;
                                    }
                                }
                            }
                        }
                    }
                }
                $curl = curl_init();
                $postdata = json_encode(array(
                    "collection_id" => "shivaguptabcakhoji4",
                    "image_url" => base_url().''.$newImagePath,
                    "threshold" => (float)$this->getSettings('beforeLoginThreshold')
                ));
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS => $postdata,
                  CURLOPT_HTTPHEADER => array(
                    'Content-Type: application/json',
                    'Accept: application/json',
                    'Authorization: '.$this->getSettings('facematchtoken'),
                  ),
                ));
                
                $faceresponse = json_decode(curl_exec($curl),true);
                $unknownId = array();
                /* if(count($faceresponse['output']) > 0)
                {
                    foreach($faceresponse['output'] as $k1=>$v1)
                    {
                        $this->db->where('isFinalSubmitted',1);
                        $this->db->or_where('imageId',$v1);
                        $this->db->or_where('imageId1',$v1);
                        $this->db->or_where('imageId2',$v1);
                        $getUnknownDetail = $this->db->get('unknown_person')->result_array();
                        if(count($getUnknownDetail) > 0)
                        {
                            foreach($getUnknownDetail as $k=>$v)
                            {
                                if($v['isFound'] == 0)
                                {
                                    array_push($unknownId,$v1['id']);
                                    $finalcount++;
                                }
                            }
                        }   
                    }
                }*/
                if($finalcount > 0)
                {
                    if(count($lapataId) > 0)
                    {
                        foreach($lapataId as $k=>$v)
                        {
                            if($k == 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$v)->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Lapata',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Lapata',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    if(count($unknownId) > 0)
                    {
                        foreach($unknownId as $k=>$v)
                        {
                            if($k == 0)
                            {
                                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$v)->result_array();
                                if($getApplicationNumber[0]['isKyc'] == 1)
                                {
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }else{
                                    $notifyData = array(
                                        'isLogin' => 0,
                                        'dateCreated' => date('Y-m-d H:i:s'),
                                        'mobileNumber' => $_SESSION['landingMob'],
                                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                                        'searchType' => 'Unknown',
                                        'searchPhoto' => $newImagePath,
                                        'complainantUserType' => 'NonKyc',
                                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId']))
                                    );
                                    $insert = $this->db->insert('searchnotification',$notifyData);
                                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                                    {
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }else{
                                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                                        $query_res = $query->result_array();
                                        
                                        if(count($query_res) > 0)
                                        {
                                            foreach ($query_res as $query_res_data) {
                                                $registrationIds[] =$query_res_data['token'];
                                            }
                                            
                                            $url ="https://fcm.googleapis.com/fcm/send";
                                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                            $fields=array(
                                                "registration_ids"=>$registrationIds,
                                                'data' => array("msg"=>"Khoji"),
                                                'priority' => 'high',
                                                "webpush" => array(
                                                    "notification" => array(
                                                        "title" => "Khoji",
                                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - General User has searched. Click here to check your notification.",
                                                        "icon" => "assets/img/logo_new_ag.png",
                                                        "click_action" => base_url()
                                                    ),
                                                ),
                                                "notification"=>array(
                                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                                    "title"=>"Khoji",
                                                )   
                                            );
                                            $headers=array(
                                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                                'Content-Type:application/json'
                                            );
                                            $ch=curl_init();
                                            curl_setopt($ch,CURLOPT_URL,$url);
                                            curl_setopt($ch,CURLOPT_POST,true);
                                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                            curl_exec($ch);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    $insertdata = array(
                        'matchedLapataIds' => implode(',',$lapataId),
                        'matchedWantedIds' => implode(',',$wantedId),
                        'matchedCriminalIds' => implode(',',$criminalId),
                        'matchedMissingIds' => implode(',',$missingId),
                        'matchedUserIds' => implode(',',$userId),
                        'matchedUnknownIds' => implode(',',$unknownId),
                        'mainPhoto' => $newImagePath
                    );
                    $this->db->where('Id',$_SESSION['searchFaceId']);
                    $update = $this->db->update('searchfacehistory',$insertdata);
                    $response = array(
                        'status' => 'success',
                        'personName' => $personName,
                        'isWanted' => $isWanted,
                        'isCriminal' => $isCriminal,
                        'isLapata' => $isLapata,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => $isDobCorrect,
                        'isGenderCorrect' => $isGenderCorrect,
                        'message' => 'Person Found',
                        'isMissing' => $isMissing,
                        'isRegistered' => $isUserFound,
                        'image' => $userphoto,
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }else{
                    $response = array(
                        'status' => 'success',
                        'finalCount' => $finalcount
                    );
                    echo json_encode($response);     
                }
            }
            
        }
    }

    function checkPersonConfidenceResults()
    {
        if(isset($_SESSION['searchFaceId']))
        {
            $page_data['control'] = 'user';
            $page_data['title'] = 'Face Match Results';
            $page_data['page_name'] = 'checkPersonConfidenceResults';
            $this->load->view('new_landing_page/index', $page_data);
        }else{
            redirect('landing/searchByConfidence?pn=3','refresh');
        }
    }
    
    function completeFaceMatchResultsUpdated()
    {
        if(isset($_SESSION['searchFaceId']))
        {
            $page_data['control'] = 'user';
            $page_data['title'] = 'Face Match Results';
            $page_data['page_name'] = 'completeFaceMatchResultsUpdated';
            $this->load->view('landing_page/index', $page_data);
        }else{
            redirect('landing/checkPersonFaceUpdated?pn=3','refresh');
        }
    }

    function completeFaceMatchResultsFamilyUpdated()
    {
        if(isset($_SESSION['searchFaceId']))
        {
            $page_data['control'] = 'user';
            $page_data['title'] = 'Face Match Results';
            $page_data['page_name'] = 'completeFaceMatchResultsFamilyUpdated';
            $this->load->view('landing_page/index', $page_data);
        }else{
            redirect('landing/checkPersonFaceFamilyUpdated?pn=3','refresh');
        }
    }

    function completeFaceMatchResultsUpdatedNew()
    {
        if(isset($_SESSION['searchFaceId']))
        {
            $page_data['control'] = 'user';
            $page_data['title'] = 'Face Match Results';
            $page_data['page_name'] = 'completeFaceMatchResultsUpdatedNew';
            $this->load->view('landing_page/index', $page_data);
        }else{
            redirect('unknown-facematch-before?pn=3','refresh');
        }
    }

    function checkPersonHighResults()
    {
        if(isset($_SESSION['searchFaceId']))
        {
            $page_data['control'] = 'user';
            $page_data['title'] = 'Face Match Results';
            // $page_data['page_name'] = 'checkPersonHighResults';
            $page_data['page_name'] = 'checkPersonHighMediumResults';
            $this->load->view('landing_page/index', $page_data);
        }else{
            redirect('high-facematch-before?pn=3','refresh');
        }
    }

    function checkMahakumbhResults()
    {
        if(isset($_SESSION['searchFaceId']))
        {
            $page_data['control'] = 'user';
            $page_data['title'] = 'Face Match Results';
            // $page_data['page_name'] = 'checkPersonHighResults';
            $page_data['page_name'] = 'checkMahakumbhResults';
            $this->load->view('landing_page/index', $page_data);
        }else{
            redirect('mahakumbh-face-match?pn=3','refresh');
        }
    }

    function checkPersonTimeResults()
    {
        if(isset($_SESSION['searchFaceId']))
        {
            $page_data['control'] = 'user';
            $page_data['title'] = 'Face Match Results';
            // $page_data['page_name'] = 'checkPersonHighResults';
            $page_data['page_name'] = 'checkPersonTimeResults';
            $this->load->view('landing_page/index', $page_data);
        }else{
            redirect('time-face-match?pn=3','refresh');
        }
    }

    function checkPersonHighFunnelResults()
    {
        if(isset($_SESSION['searchFaceId']))
        {
            $page_data['control'] = 'user';
            $page_data['title'] = 'Face Match Results';
            // $page_data['page_name'] = 'checkPersonHighResults';
            $page_data['page_name'] = 'checkPersonHighFunnelResults';
            $this->load->view('landing_page/index', $page_data);
        }else{
            redirect('check-person-face-funnel?pn=3','refresh');
        }
    }

    function checkPersonQualityResults()
    {
        if(isset($_SESSION['searchFaceId']))
        {
            $page_data['control'] = 'user';
            $page_data['title'] = 'Face Match Results';
            // $page_data['page_name'] = 'checkPersonHighResults';
            $page_data['page_name'] = 'checkPersonQualityResults';
            $this->load->view('landing_page/index', $page_data);
        }else{
            redirect('quality-face-match?pn=3','refresh');
        }
    }
    
    function searchVehicle($para = '')
    {
        if($para == '')
        {
            $page_data['control'] = 'user';
            $page_data['title'] = 'Search Vehicle';
            if(isset($_SESSION['landingMob']))
            {
                $page_data['pn'] = 2;   
                $getFinalId = $this->db->query('select max(Id) as Id from searchVehicle')->result_array();
                if($getFinalId[0]['Id'] != NULL)
                {
                    $_SESSION['checkVehicleId'] = $getFinalId[0]['Id'] + 1;
                }else{
                    $_SESSION['checkVehicleId'] = 1;
                }
                $insert = $this->db->insert('searchVehicle',array('personMob' => $_SESSION['landingMob'],'Id' => $_SESSION['checkVehicleId']));
            }else{
                $page_data['pn'] = 1;
            }
            if(isset($_GET['pn']))
            {
                $page_data['pn'] = $_GET['pn'];    
            }
            $page_data['page_name'] = 'searchVehicle';
            $this->load->view('landing_page/index', $page_data);
        }else
        {
            if($para == 'step1')
            {
                $getPreviousDetail = $this->db->query('select * from searchVehicle where Id='.$_SESSION['checkVehicleId'])->result_array();
                if($getPreviousDetail[0]['otp'] == $_POST['otp'])
                {
                    $updatedata = array(
                        'personMob' => $_POST['mobileNumber'],
                        'otp' => NULL
                    );
                    $this->db->where('Id',$_SESSION['checkVehicleId']);
                    $update = $this->db->update('searchVehicle',$updatedata);
                    $_SESSION['landingMob'] = $_POST['mobileNumber'];
                    $response['status'] = 'success';
                }else{
                    $response['status'] = 'error';
                    $response['message'] = 'Invalid OTP';
                }
                echo json_encode($response);
            }
            if($para == 'step2')
            {
                $personName = '';
                $gender = '';
                $aadhar = '';
                $gender = '';
                $isVerified = 'No';
                $isVisible = 0;
                $age = '';
                $address = '';
                $isUserFound = 0;
                $isMissing = 0;
                $isGenderCorrect = 0;
                $isAadharCorrect = 0;
                $isDobCorrect = 0;
                $_POST['dob'] = $_POST['date'].'-'.$_POST['month'].'-'.$_POST['year'];
                $idNumber = '';
                if($_POST['idType'] == 'aadhar')
                {
                    $idNumber = $_POST['aadhar_id'];
                    if(strlen($_POST['aadhar_id']) != 12)
                    {
                        $response = array(
                            'status' => 'error',
                            'message' => 'Aadhar number must be 12 digit number'
                        );
                        echo json_encode($response);
                        return;
                    }
                    $getIfPersonAvailable = $this->db->query('select * from user where aadhar_id="'.$_POST['aadhar_id'].'" and gender="'.$_POST['gender'].'" and dob="'.date('Y-m-d',strtotime($_POST['dob'])).'"')->result_array();
                    $userphoto = '';
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $isVisible = $getIfPersonAvailable[0]['visibility'];
                        $isVerified = 1;
                        $isUserFound = 1;
                        $personName = $getIfPersonAvailable[0]['aadharname'];
                        $gender = $getIfPersonAvailable[0]['gender'];
                        $aadhar = $getIfPersonAvailable[0]['aadhar_id'];
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfPersonAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                        $userphoto = base_url().''.(($getIfPersonAvailable[0]['aadharphoto'] != NULL) ? $getIfPersonAvailable[0]['aadharphoto'] : $getIfPersonAvailable[0]['facematchphoto']);
                    }
                    $getMissingPerson = $this->db->query('select * from missingperson where missingaadhar="'.$_POST['aadhar_id'].'" and isFound != 1')->result_array();
                    if(count($getMissingPerson) > 0)
                    {
                        $isAadharCorrect = 1;
                        if($getMissingPerson[0]['missinggender'] != NULL)
                        {
                            if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getMissingPerson[0]['missinggender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 1;
                                    $personName = $getMissingPerson[0]['missingname'];
                                    $gender = $getMissingPerson[0]['missinggender'];
                                    $aadhar = $getMissingPerson[0]['missingaadhar'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                    $age = ($from->diff($to)->y);
                                    if(count($getIfPersonAvailable) > 0)
                                    {
                                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                    }else{
                                        $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                    }
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }else{
                            $getFullDetail = $this->db->query('select * from missingpersondetail where missingId='.$getMissingPerson[0]['Id'])->result_array();
                            if(count($getFullDetail) > 0)
                            {
                                if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                }
                                if(strtolower($getFullDetail[0]['gender']) == strtolower($_POST['gender']))
                                {
                                    $isGenderCorrect = 1;
                                    if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                        $isMissing = 1; 
                                        $personName = $getMissingPerson[0]['missingname'];
                                        $gender = $getMissingPerson[0]['missinggender'];
                                        $aadhar = $getMissingPerson[0]['missingaadhar'];
                                        $from=new DateTime(date('Y-m-d'));
                                        $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                        $age = ($from->diff($to)->y);
                                        if(count($getIfPersonAvailable) > 0)
                                        {
                                            $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                        }else{
                                            $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                        }
                                        if(count($getIfPersonAvailable) == 0)
                                        {
                                            $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                        }   
                                    }
                                }   
                            }else{
                                $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$_POST['aadhar_id'].'"')->result_array();
                                if(count($getUserDetail) > 0)
                                {
                                    if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                    }
                                    if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                                    {
                                        $isGenderCorrect = 1;
                                        if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                        {
                                            $isDobCorrect = 1;
                                            $isMissing = 1; 
                                            $personName = $getUserDetail[0]['aadharname'];
                                            $gender = $getUserDetail[0]['gender'];
                                            $aadhar = $getUserDetail[0]['aadhar_id'];
                                            $from=new DateTime(date('Y-m-d'));
                                            $to   = new DateTime($getUserDetail[0]['dob']);
                                            $age = ($from->diff($to)->y);
                                            $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                            if(count($getIfPersonAvailable) == 0)
                                            {
                                                $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                            }   
                                        }
                                    }
                                }
                            }
                        }
                    }else{
                        $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$_POST['aadhar_id'].'"')->result_array();
                        if(count($getUserDetail) > 0)
                        {
                            $isAadharCorrect = 1;
                            if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 0; 
                                    $personName = $getUserDetail[0]['aadharname'];
                                    $gender = $getUserDetail[0]['gender'];
                                    $aadhar = $getUserDetail[0]['aadhar_id'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getUserDetail[0]['dob']);
                                    $age = ($from->diff($to)->y);
                                    $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getUserDetail[0]['facematchphoto'] != NULL) ? $getUserDetail[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }
                    }
                    $insertdata = array(
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'gender' => $_POST['gender'],
                        'dob' => date('Y-m-d',strtotime($_POST['dob'])),
                        'idNumber' => $_POST['aadhar_id'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    if($update)
                    {
                        if($isGenderCorrect == 1 && $isDobCorrect == 1 && $isAadharCorrect == 1)
                        {
                            $response = array(
                                'status' => 'success',
                                'personName' => $personName,
                                'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                                'gender' => strtolower($gender),
                                'age' => $age,
                                'address' => $address,
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                                'message' => 'Person Found',
                                'isVisible' => $isVisible,
                                'isMissing' => $isMissing,
                                'isVerified' => $isVerified,
                                'isRegistered' => $isUserFound,
                                'image' => $userphoto
                            );
                            echo json_encode($response);   
                        }else{
                            $response = array(
                                'status' => 'incorrect',
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                            );
                            echo json_encode($response);   
                        }
                    }else{
                        $response = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                        echo json_encode($response);
                    }
                }
                if($_POST['idType'] == 'dl')
                {
                    $idNumber = $_POST['dlNumber'];
                    $getIfAlready = $this->db->query('select * from dllist where dlNumber="'.$idNumber.'"')->result_array();
                    if(count($getIfAlready) > 0)
                    {
                        $getIfPersonAvailable = $this->db->query('select * from user where uid='.$getIfAlready[0]['userId'])->result_array();   
                    }else{
                        $getIfPersonAvailable = array();
                    }
                    $userphoto = '';
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $isVisible = $getIfPersonAvailable[0]['visibility'];
                        $isVerified = 1;
                        $isUserFound = 1;
                        $personName = $getIfPersonAvailable[0]['aadharname'];
                        $gender = $getIfPersonAvailable[0]['gender'];
                        $aadhar = $getIfPersonAvailable[0]['aadhar_id'];
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfPersonAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                        $userphoto = base_url().''.(($getIfPersonAvailable[0]['aadharphoto'] != NULL) ? $getIfPersonAvailable[0]['aadharphoto'] : $getIfPersonAvailable[0]['facematchphoto']);
                    }
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $getMissingPerson = $this->db->query('select * from missingperson where missingaadhar="'.$getIfPersonAvailable[0]['aadhar_id'].'" and isFound != 1')->result_array();   
                    }else{
                        $getMissingPerson = array();
                    }
                    if(count($getMissingPerson) > 0)
                    {
                        $isAadharCorrect = 1;
                        if($getMissingPerson[0]['missinggender'] != NULL)
                        {
                            if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getMissingPerson[0]['missinggender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 1;
                                    $personName = $getMissingPerson[0]['missingname'];
                                    $gender = $getMissingPerson[0]['missinggender'];
                                    $aadhar = $getMissingPerson[0]['missingaadhar'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                    $age = ($from->diff($to)->y);
                                    if(count($getIfPersonAvailable) > 0)
                                    {
                                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                    }else{
                                        $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                    }
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }else{
                            $getFullDetail = $this->db->query('select * from missingpersondetail where missingId='.$getMissingPerson[0]['Id'])->result_array();
                            if(count($getFullDetail) > 0)
                            {
                                if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                }
                                if(strtolower($getFullDetail[0]['gender']) == strtolower($_POST['gender']))
                                {
                                    $isGenderCorrect = 1;
                                    if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                        $isMissing = 1; 
                                        $personName = $getMissingPerson[0]['missingname'];
                                        $gender = $getMissingPerson[0]['missinggender'];
                                        $aadhar = $getMissingPerson[0]['missingaadhar'];
                                        $from=new DateTime(date('Y-m-d'));
                                        $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                        $age = ($from->diff($to)->y);
                                        if(count($getIfPersonAvailable) > 0)
                                        {
                                            $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                        }else{
                                            $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                        }
                                        if(count($getIfPersonAvailable) == 0)
                                        {
                                            $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                        }   
                                    }
                                }   
                            }else{
                                $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$getIfPersonAvailable[0]['aadhar_id'].'"')->result_array();
                                if(count($getUserDetail) > 0)
                                {
                                    if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                    }
                                    if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                                    {
                                        $isGenderCorrect = 1;
                                        if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                        {
                                            $isDobCorrect = 1;
                                            $isMissing = 1; 
                                            $personName = $getUserDetail[0]['aadharname'];
                                            $gender = $getUserDetail[0]['gender'];
                                            $aadhar = $getUserDetail[0]['aadhar_id'];
                                            $from=new DateTime(date('Y-m-d'));
                                            $to   = new DateTime($getUserDetail[0]['dob']);
                                            $age = ($from->diff($to)->y);
                                            $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                            
                                            if(count($getIfPersonAvailable) == 0)
                                            {
                                                $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                            }   
                                        }
                                    }
                                }
                            }
                        }
                    }else{
                        if(count($getIfPersonAvailable) > 0)
                        {
                            $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$getIfPersonAvailable[0]['aadhar_id'].'"')->result_array();   
                        }else{
                            $getUserDetail = array();
                        }
                        if(count($getUserDetail) > 0)
                        {
                            $isAadharCorrect = 1;
                            if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 0; 
                                    $personName = $getUserDetail[0]['aadharname'];
                                    $gender = $getUserDetail[0]['gender'];
                                    $aadhar = $getUserDetail[0]['aadhar_id'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getUserDetail[0]['dob']);
                                    $age = ($from->diff($to)->y);
                                    $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getUserDetail[0]['facematchphoto'] != NULL) ? $getUserDetail[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }
                    }
                    $insertdata = array(
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'gender' => $_POST['gender'],
                        'dob' => date('Y-m-d',strtotime($_POST['dob'])),
                        'idNumber' => $_POST['dlNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    if($insert)
                    {
                        if($isGenderCorrect == 1 && $isDobCorrect == 1 && $isAadharCorrect == 1)
                        {
                            $response = array(
                                'status' => 'success',
                                'isVisible' => $isVisible,
                                'personName' => $personName,
                                'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                                'gender' => strtolower($gender),
                                'age' => $age,
                                'address' => $address,
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                                'message' => 'Person Found',
                                'isMissing' => $isMissing,
                                'isVerified' => $isVerified,
                                'isRegistered' => $isUserFound,
                                'image' => $userphoto
                            );
                            echo json_encode($response);   
                        }else{
                            $response = array(
                                'status' => 'incorrect',
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                            );
                            echo json_encode($response);   
                        }
                    }else{
                        $response = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                        echo json_encode($response);
                    }
                }
                if($_POST['idType'] == 'voter')
                {
                    $idNumber = $_POST['voterId'];
                    $getIfAlready = $this->db->query('select * from voterslist where voterNumber="'.$idNumber.'"')->result_array();
                    if(count($getIfAlready) > 0)
                    {
                        $getIfPersonAvailable = $this->db->query('select * from user where uid='.$getIfAlready[0]['userId'].' and gender="'.$_POST['gender'].'" and dob="'.date('Y-m-d',strtotime($_POST['dob'])).'"')->result_array();   
                    }else{
                        $getIfPersonAvailable = array();
                    }
                    $userphoto = '';
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $isVisible = $getIfPersonAvailable[0]['visibility'];
                        $isUserFound = 1;
                        $isVerified = 1;
                        $personName = $getIfPersonAvailable[0]['aadharname'];
                        $gender = $getIfPersonAvailable[0]['gender'];
                        $aadhar = $getIfPersonAvailable[0]['aadhar_id'];
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfPersonAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                        $userphoto = base_url().''.(($getIfPersonAvailable[0]['aadharphoto'] != NULL) ? $getIfPersonAvailable[0]['aadharphoto'] : $getIfPersonAvailable[0]['facematchphoto']);
                    }
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $getMissingPerson = $this->db->query('select * from missingperson where missingaadhar="'.$getIfPersonAvailable[0]['aadhar_id'].'" and isFound != 1')->result_array();   
                    }else{
                        $getMissingPerson = array();
                    }
                    if(count($getMissingPerson) > 0)
                    {
                        $isAadharCorrect = 1;
                        if($getMissingPerson[0]['missinggender'] != NULL)
                        {
                            if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getMissingPerson[0]['missinggender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 1;
                                    $personName = $getMissingPerson[0]['missingname'];
                                    $gender = $getMissingPerson[0]['missinggender'];
                                    $aadhar = $getMissingPerson[0]['missingaadhar'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                    $age = ($from->diff($to)->y);
                                    if(count($getIfPersonAvailable) > 0)
                                    {
                                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                    }else{
                                        $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                    }
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }else{
                            $getFullDetail = $this->db->query('select * from missingpersondetail where missingId='.$getMissingPerson[0]['Id'])->result_array();
                            if(count($getFullDetail) > 0)
                            {
                                if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                }
                                if(strtolower($getFullDetail[0]['gender']) == strtolower($_POST['gender']))
                                {
                                    $isGenderCorrect = 1;
                                    if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                        $isMissing = 1; 
                                        $personName = $getMissingPerson[0]['missingname'];
                                        $gender = $getMissingPerson[0]['missinggender'];
                                        $aadhar = $getMissingPerson[0]['missingaadhar'];
                                        $from=new DateTime(date('Y-m-d'));
                                        $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                        $age = ($from->diff($to)->y);
                                        if(count($getIfPersonAvailable) > 0)
                                        {
                                            $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                        }else{
                                            $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                        }
                                        if(count($getIfPersonAvailable) == 0)
                                        {
                                            $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                        }   
                                    }
                                }   
                            }else{
                                $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$getIfPersonAvailable[0]['aadhar_id'].'"')->result_array();
                                if(count($getUserDetail) > 0)
                                {
                                    if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                    }
                                    if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                                    {
                                        $isGenderCorrect = 1;
                                        if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                        {
                                            $isDobCorrect = 1;
                                            $isMissing = 1; 
                                            $personName = $getUserDetail[0]['aadharname'];
                                            $gender = $getUserDetail[0]['gender'];
                                            $aadhar = $getUserDetail[0]['aadhar_id'];
                                            $from=new DateTime(date('Y-m-d'));
                                            $to   = new DateTime($getUserDetail[0]['dob']);
                                            $age = ($from->diff($to)->y);
                                            $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                            if(count($getIfPersonAvailable) == 0)
                                            {
                                                $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                            }   
                                        }
                                    }
                                }
                            }
                        }
                    }else{
                        if(count($getIfPersonAvailable) > 0)
                        {
                            $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$getIfPersonAvailable[0]['aadhar_id'].'"')->result_array();   
                        }else{
                            $getUserDetail = array();
                        }
                        if(count($getUserDetail) > 0)
                        {
                            $isAadharCorrect = 1;
                            if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 0; 
                                    $personName = $getUserDetail[0]['aadharname'];
                                    $gender = $getUserDetail[0]['gender'];
                                    $aadhar = $getUserDetail[0]['aadhar_id'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getUserDetail[0]['dob']);
                                    $age = ($from->diff($to)->y);
                                    $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getUserDetail[0]['facematchphoto'] != NULL) ? $getUserDetail[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }
                    }
                    $insertdata = array(
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'gender' => $_POST['gender'],
                        'dob' => date('Y-m-d',strtotime($_POST['dob'])),
                        'idNumber' => $_POST['voterId'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    if($update)
                    {
                        if($isGenderCorrect == 1 && $isDobCorrect == 1 && $isAadharCorrect == 1)
                        {
                            $response = array(
                                'status' => 'success',
                                'isVisible'=> $isVisible,
                                'personName' => $personName,
                                'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                                'gender' => strtolower($gender),
                                'age' => $age,
                                'address' => $address,
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                                'message' => 'Person Found',
                                'isMissing' => $isMissing,
                                'isVerified' => $isVerified,
                                'isRegistered' => $isUserFound,
                                'image' => $userphoto
                            );
                            echo json_encode($response);   
                        }else{
                            $response = array(
                                'status' => 'incorrect',
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                            );
                            echo json_encode($response);   
                        }
                    }else{
                        $response = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                        echo json_encode($response);
                    }
                }
                if($_POST['idType'] == 'pan')
                {
                    $idNumber = $_POST['panNumber'];
                    $getIfAlready = $this->db->query('select * from panlist where panNumber="'.$idNumber.'"')->result_array();
                    if(count($getIfAlready) > 0)
                    {
                        $getIfPersonAvailable = $this->db->query('select * from user where uid='.$getIfAlready[0]['userId'])->result_array();   
                    }else{
                        $getIfPersonAvailable = array();
                    }
                    $userphoto = '';
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $isVisible = $getIfPersonAvailable[0]['visibility'];
                        $isUserFound = 1;
                        $isVerified = 1;
                        $personName = $getIfPersonAvailable[0]['aadharname'];
                        $gender = $getIfPersonAvailable[0]['gender'];
                        $aadhar = $getIfPersonAvailable[0]['aadhar_id'];
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfPersonAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                        $userphoto = base_url().''.(($getIfPersonAvailable[0]['aadharphoto'] != NULL) ? $getIfPersonAvailable[0]['aadharphoto'] : $getIfPersonAvailable[0]['facematchphoto']);
                    }
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $getMissingPerson = $this->db->query('select * from missingperson where missingaadhar="'.$getIfPersonAvailable[0]['aadhar_id'].'" and isFound != 1')->result_array();   
                    }else{
                        $getMissingPerson = array();
                    }
                    if(count($getMissingPerson) > 0)
                    {
                        $isAadharCorrect = 1;
                        if($getMissingPerson[0]['missinggender'] != NULL)
                        {
                            if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getMissingPerson[0]['missinggender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 1;
                                    $personName = $getMissingPerson[0]['missingname'];
                                    $gender = $getMissingPerson[0]['missinggender'];
                                    $aadhar = $getMissingPerson[0]['missingaadhar'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                    $age = ($from->diff($to)->y);
                                    if(count($getIfPersonAvailable) > 0)
                                    {
                                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                    }else{
                                        $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                    }
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }else{
                            $getFullDetail = $this->db->query('select * from missingpersondetail where missingId='.$getMissingPerson[0]['Id'])->result_array();
                            if(count($getFullDetail) > 0)
                            {
                                if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                }
                                if(strtolower($getFullDetail[0]['gender']) == strtolower($_POST['gender']))
                                {
                                    $isGenderCorrect = 1;
                                    if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                        $isMissing = 1; 
                                        $personName = $getMissingPerson[0]['missingname'];
                                        $gender = $getMissingPerson[0]['missinggender'];
                                        $aadhar = $getMissingPerson[0]['missingaadhar'];
                                        $from=new DateTime(date('Y-m-d'));
                                        $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                        $age = ($from->diff($to)->y);
                                        if(count($getIfPersonAvailable) > 0)
                                        {
                                            $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                        }else{
                                            $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                        }
                                        if(count($getIfPersonAvailable) == 0)
                                        {
                                            $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                        }   
                                    }
                                }   
                            }else{
                                $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$getIfPersonAvailable[0]['aadhar_id'].'"')->result_array();
                                if(count($getUserDetail) > 0)
                                {
                                    if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                    }
                                    if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                                    {
                                        $isGenderCorrect = 1;
                                        if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                        {
                                            $isDobCorrect = 1;
                                            $isMissing = 1; 
                                            $personName = $getUserDetail[0]['aadharname'];
                                            $gender = $getUserDetail[0]['gender'];
                                            $aadhar = $getUserDetail[0]['aadhar_id'];
                                            $from=new DateTime(date('Y-m-d'));
                                            $to   = new DateTime($getUserDetail[0]['dob']);
                                            $age = ($from->diff($to)->y);
                                            $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                            if(count($getIfPersonAvailable) == 0)
                                            {
                                                $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                            }   
                                        }
                                    }
                                }
                            }
                        }
                    }else{
                        if(count($getIfPersonAvailable) > 0)
                        {
                            $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$getIfPersonAvailable[0]['aadhar_id'].'"')->result_array();   
                        }else{
                            $getUserDetail = array();
                        }
                        if(count($getUserDetail) > 0)
                        {
                            $isAadharCorrect = 1;
                            if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 0; 
                                    $personName = $getUserDetail[0]['aadharname'];
                                    $gender = $getUserDetail[0]['gender'];
                                    $aadhar = $getUserDetail[0]['aadhar_id'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getUserDetail[0]['dob']);
                                    $age = ($from->diff($to)->y);
                                    $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getUserDetail[0]['facematchphoto'] != NULL) ? $getUserDetail[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }
                    }
                    $insertdata = array(
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'gender' => $_POST['gender'],
                        'dob' => date('Y-m-d',strtotime($_POST['dob'])),
                        'idNumber' => $_POST['panNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    if($update)
                    {
                        if($isGenderCorrect == 1 && $isDobCorrect == 1 && $isAadharCorrect == 1)
                        {
                            $response = array(
                                'status' => 'success',
                                'isVisible' => $isVisible,
                                'personName' => $personName,
                                'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                                'gender' => strtolower($gender),
                                'age' => $age,
                                'address' => $address,
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                                'message' => 'Person Found',
                                'isMissing' => $isMissing,
                                'isRegistered' => $isUserFound,
                                'isVerified' => $isVerified,
                                'image' => $userphoto
                            );
                            echo json_encode($response);   
                        }else{
                            $response = array(
                                'status' => 'incorrect',
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                            );
                            echo json_encode($response);   
                        }
                    }else{
                        $response = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                        echo json_encode($response);
                    }
                }   
            }
        }
    }
    
    // public function login()
    // {
    //      $page_data['page_name'] = 'login';
    //      $this->load->view('landing_page/index', $page_data);
    // }
    public function about()
    {
          $page_data['page_name'] = 'about';
          $this->load->view('landing_page/index', $page_data);
    }
    
    function getSettings($name='gridlineKey')
    {
        $getSettings = $this->db->query('select * from settings where name="'.$name.'"')->result_array();
        return $getSettings[0]['value'];
    }
    
    function checkVehicle2($para = '')
    {
        if($para == '')
        {
            if(isset($_SESSION['checkVehicleId']))
            {
                $page_data['checkDetail'] = $this->db->query('select * from searchVehicle where Id='.$_SESSION['checkVehicleId'])->result_array();
                if($page_data['checkDetail'][0]['searchType'] == 'vehicleNumber')
                {
                    $page_data['vehicledetail'] = $this->db->query('select * from vehicles where rcNumber="'.$page_data['checkDetail'][0]['idNumber'].'"')->result_array();   
                }
                else if($page_data['checkDetail'][0]['searchType'] == 'chassisNumber')
                {
                    $page_data['vehicledetail'] = $this->db->query('select * from vehicles where chassis_number="'.$page_data['checkDetail'][0]['idNumber'].'"')->result_array();   
                }
                else if($page_data['checkDetail'][0]['searchType'] == 'engineNumber')
                {
                    $page_data['vehicledetail'] = $this->db->query('select * from vehicles where engine_number="'.$page_data['checkDetail'][0]['idNumber'].'"')->result_array();
                }else{
                    $page_data['vehicledetail'] = array();
                }
                if(count($page_data['vehicledetail']) > 0)
                {
                    $page_data['control'] = 'user';
                    $page_data['title'] = 'Search Vehicle Detail';
                    $page_data['page_name'] = 'checkVehicle2';
                    $this->load->view('landing_page/index', $page_data);
                }else{
                    redirect($this->getSettings('noVehicleId'),'refresh');       
                }
            }else{
                redirect($this->getSettings('noVehicleId'),'refresh');
            }
        }else
        {

        }
    }
    
    function checkPerson($para = '')
    {
        if($para == '')
        {
            $page_data['control'] = 'user';
            $page_data['title'] = 'Search Person';
            if(isset($_SESSION['landingMob']))
            {
                $page_data['pn'] = 2;   
                $getFinalId = $this->db->query('select max(Id) as Id from checkperson')->result_array();
                if($getFinalId[0]['Id'] != NULL)
                {
                    $_SESSION['checkId'] = $getFinalId[0]['Id'] + 1;
                }else{
                    $_SESSION['checkId'] = 1;
                }
                $insert = $this->db->insert('checkperson',array('personMob' => $_SESSION['landingMob'],'Id' => $_SESSION['checkId']));
            }else{
                $page_data['pn'] = 1;
            }
            if(isset($_GET['pn']))
            {
                $page_data['pn'] = $_GET['pn'];    
            }
            
             $page_data['page_name'] = 'checkperson';
         $this->load->view('landing_page/index', $page_data);
            // $this->load->view('user/common/header',$page_data); 
            // $this->load->view('user/checkperson');
            // $this->load->view('user/common/footer'); 
        }else
        {
            if($para == 'step1')
            {
                $getPreviousDetail = $this->db->query('select * from checkperson where Id='.$_SESSION['checkId'])->result_array();
                if($getPreviousDetail[0]['otp'] == $_POST['otp'])
                {
                    $updatedata = array(
                        'personMob' => $_POST['mobileNumber'],
                        'otp' => NULL
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$updatedata);
                    $_SESSION['landingMob'] = $_POST['mobileNumber'];
                    $response['status'] = 'success';
                }else{
                    $response['status'] = 'error';
                    $response['message'] = 'Invalid OTP';
                }
                echo json_encode($response);
            }
            if($para == 'step2')
            {
                $personName = '';
                $gender = '';
                $aadhar = '';
                $gender = '';
                $isVerified = 'No';
                $isVisible = 0;
                $age = '';
                $address = '';
                $isUserFound = 0;
                $isWanted = 0;
                $isMissing = 0;
                $isGenderCorrect = 0;
                $isAadharCorrect = 0;
                $isDobCorrect = 0;
                $_POST['dob'] = $_POST['date'].'-'.$_POST['month'].'-'.$_POST['year'];
                $idNumber = '';
                if($_POST['idType'] == 'aadhar')
                {
                    $idNumber = $_POST['aadhar_id'];
                    if(strlen($_POST['aadhar_id']) != 12)
                    {
                        $response = array(
                            'status' => 'error',
                            'message' => 'Aadhar number must be 12 digit number'
                        );
                        echo json_encode($response);
                        return;
                    }
                    $getIfPersonAvailable = $this->db->query('select * from user where aadhar_id="'.$_POST['aadhar_id'].'" and gender="'.$_POST['gender'].'" and dob="'.date('Y-m-d',strtotime($_POST['dob'])).'"')->result_array();
                    $userphoto = '';
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $isVisible = $getIfPersonAvailable[0]['visibility'];
                        $isVerified = 1;
                        $isUserFound = 1;
                        $personName = $getIfPersonAvailable[0]['aadharname'];
                        $gender = $getIfPersonAvailable[0]['gender'];
                        $aadhar = $getIfPersonAvailable[0]['aadhar_id'];
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfPersonAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                        $userphoto = base_url().''.(($getIfPersonAvailable[0]['aadharphoto'] != NULL) ? $getIfPersonAvailable[0]['aadharphoto'] : $getIfPersonAvailable[0]['facematchphoto']);
                    }
                    $getMissingPerson = $this->db->query('select * from missingperson where missingaadhar="'.$_POST['aadhar_id'].'" and isFound != 1')->result_array();
                    if(count($getMissingPerson) > 0)
                    {
                        $isAadharCorrect = 1;
                        if($getMissingPerson[0]['missinggender'] != NULL)
                        {
                            if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getMissingPerson[0]['missinggender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 1;
                                    $personName = $getMissingPerson[0]['missingname'];
                                    $gender = $getMissingPerson[0]['missinggender'];
                                    $aadhar = $getMissingPerson[0]['missingaadhar'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                    $age = ($from->diff($to)->y);
                                    if(count($getIfPersonAvailable) > 0)
                                    {
                                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                    }else{
                                        $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                    }
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }else{
                            $getFullDetail = $this->db->query('select * from missingpersondetail where missingId='.$getMissingPerson[0]['Id'])->result_array();
                            if(count($getFullDetail) > 0)
                            {
                                if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                }
                                if(strtolower($getFullDetail[0]['gender']) == strtolower($_POST['gender']))
                                {
                                    $isGenderCorrect = 1;
                                    if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                        $isMissing = 1; 
                                        $personName = $getMissingPerson[0]['missingname'];
                                        $gender = $getMissingPerson[0]['missinggender'];
                                        $aadhar = $getMissingPerson[0]['missingaadhar'];
                                        $from=new DateTime(date('Y-m-d'));
                                        $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                        $age = ($from->diff($to)->y);
                                        if(count($getIfPersonAvailable) > 0)
                                        {
                                            $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                        }else{
                                            $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                        }
                                        if(count($getIfPersonAvailable) == 0)
                                        {
                                            $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                        }   
                                    }
                                }   
                            }else{
                                $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$_POST['aadhar_id'].'"')->result_array();
                                if(count($getUserDetail) > 0)
                                {
                                    if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                    }
                                    if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                                    {
                                        $isGenderCorrect = 1;
                                        if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                        {
                                            $isDobCorrect = 1;
                                            $isMissing = 1; 
                                            $personName = $getUserDetail[0]['aadharname'];
                                            $gender = $getUserDetail[0]['gender'];
                                            $aadhar = $getUserDetail[0]['aadhar_id'];
                                            $from=new DateTime(date('Y-m-d'));
                                            $to   = new DateTime($getUserDetail[0]['dob']);
                                            $age = ($from->diff($to)->y);
                                            $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                            if(count($getIfPersonAvailable) == 0)
                                            {
                                                $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                            }   
                                        }
                                    }
                                }
                            }
                        }
                    }else{
                        $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$_POST['aadhar_id'].'"')->result_array();
                        if(count($getUserDetail) > 0)
                        {
                            $isAadharCorrect = 1;
                            if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 0; 
                                    $personName = $getUserDetail[0]['aadharname'];
                                    $gender = $getUserDetail[0]['gender'];
                                    $aadhar = $getUserDetail[0]['aadhar_id'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getUserDetail[0]['dob']);
                                    $age = ($from->diff($to)->y);
                                    $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getUserDetail[0]['facematchphoto'] != NULL) ? $getUserDetail[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }
                    }
                    $insertdata = array(
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'gender' => $_POST['gender'],
                        'dob' => date('Y-m-d',strtotime($_POST['dob'])),
                        'idNumber' => $_POST['aadhar_id'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    if($update)
                    {
                        if($isGenderCorrect == 1 && $isDobCorrect == 1 && $isAadharCorrect == 1)
                        {
                            $response = array(
                                'status' => 'success',
                                'personName' => $personName,
                                'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                                'gender' => strtolower($gender),
                                'age' => $age,
                                'address' => $address,
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                                'message' => 'Person Found',
                                'isVisible' => $isVisible,
                                'isMissing' => $isMissing,
                                'isVerified' => $isVerified,
                                'isRegistered' => $isUserFound,
                                'image' => $userphoto
                            );
                            echo json_encode($response);   
                        }else{
                            $response = array(
                                'status' => 'incorrect',
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                            );
                            echo json_encode($response);   
                        }
                    }else{
                        $response = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                        echo json_encode($response);
                    }
                }
                if($_POST['idType'] == 'dl')
                {
                    $idNumber = $_POST['dlNumber'];
                    $getIfAlready = $this->db->query('select * from dllist where dlNumber="'.$idNumber.'"')->result_array();
                    if(count($getIfAlready) > 0)
                    {
                        $getIfPersonAvailable = $this->db->query('select * from user where uid='.$getIfAlready[0]['userId'])->result_array();   
                    }else{
                        $getIfPersonAvailable = array();
                    }
                    $userphoto = '';
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $isVisible = $getIfPersonAvailable[0]['visibility'];
                        $isVerified = 1;
                        $isUserFound = 1;
                        $personName = $getIfPersonAvailable[0]['aadharname'];
                        $gender = $getIfPersonAvailable[0]['gender'];
                        $aadhar = $getIfPersonAvailable[0]['aadhar_id'];
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfPersonAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                        $userphoto = base_url().''.(($getIfPersonAvailable[0]['aadharphoto'] != NULL) ? $getIfPersonAvailable[0]['aadharphoto'] : $getIfPersonAvailable[0]['facematchphoto']);
                    }
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $getMissingPerson = $this->db->query('select * from missingperson where missingaadhar="'.$getIfPersonAvailable[0]['aadhar_id'].'" and isFound != 1')->result_array();   
                    }else{
                        $getMissingPerson = array();
                    }
                    if(count($getMissingPerson) > 0)
                    {
                        $isAadharCorrect = 1;
                        if($getMissingPerson[0]['missinggender'] != NULL)
                        {
                            if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getMissingPerson[0]['missinggender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 1;
                                    $personName = $getMissingPerson[0]['missingname'];
                                    $gender = $getMissingPerson[0]['missinggender'];
                                    $aadhar = $getMissingPerson[0]['missingaadhar'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                    $age = ($from->diff($to)->y);
                                    if(count($getIfPersonAvailable) > 0)
                                    {
                                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                    }else{
                                        $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                    }
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }else{
                            $getFullDetail = $this->db->query('select * from missingpersondetail where missingId='.$getMissingPerson[0]['Id'])->result_array();
                            if(count($getFullDetail) > 0)
                            {
                                if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                }
                                if(strtolower($getFullDetail[0]['gender']) == strtolower($_POST['gender']))
                                {
                                    $isGenderCorrect = 1;
                                    if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                        $isMissing = 1; 
                                        $personName = $getMissingPerson[0]['missingname'];
                                        $gender = $getMissingPerson[0]['missinggender'];
                                        $aadhar = $getMissingPerson[0]['missingaadhar'];
                                        $from=new DateTime(date('Y-m-d'));
                                        $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                        $age = ($from->diff($to)->y);
                                        if(count($getIfPersonAvailable) > 0)
                                        {
                                            $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                        }else{
                                            $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                        }
                                        if(count($getIfPersonAvailable) == 0)
                                        {
                                            $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                        }   
                                    }
                                }   
                            }else{
                                $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$getIfPersonAvailable[0]['aadhar_id'].'"')->result_array();
                                if(count($getUserDetail) > 0)
                                {
                                    if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                    }
                                    if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                                    {
                                        $isGenderCorrect = 1;
                                        if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                        {
                                            $isDobCorrect = 1;
                                            $isMissing = 1; 
                                            $personName = $getUserDetail[0]['aadharname'];
                                            $gender = $getUserDetail[0]['gender'];
                                            $aadhar = $getUserDetail[0]['aadhar_id'];
                                            $from=new DateTime(date('Y-m-d'));
                                            $to   = new DateTime($getUserDetail[0]['dob']);
                                            $age = ($from->diff($to)->y);
                                            $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                            
                                            if(count($getIfPersonAvailable) == 0)
                                            {
                                                $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                            }   
                                        }
                                    }
                                }
                            }
                        }
                    }else{
                        if(count($getIfPersonAvailable) > 0)
                        {
                            $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$getIfPersonAvailable[0]['aadhar_id'].'"')->result_array();   
                        }else{
                            $getUserDetail = array();
                        }
                        if(count($getUserDetail) > 0)
                        {
                            $isAadharCorrect = 1;
                            if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 0; 
                                    $personName = $getUserDetail[0]['aadharname'];
                                    $gender = $getUserDetail[0]['gender'];
                                    $aadhar = $getUserDetail[0]['aadhar_id'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getUserDetail[0]['dob']);
                                    $age = ($from->diff($to)->y);
                                    $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getUserDetail[0]['facematchphoto'] != NULL) ? $getUserDetail[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }
                    }
                    $insertdata = array(
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'gender' => $_POST['gender'],
                        'dob' => date('Y-m-d',strtotime($_POST['dob'])),
                        'idNumber' => $_POST['dlNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    if($insert)
                    {
                        if($isGenderCorrect == 1 && $isDobCorrect == 1 && $isAadharCorrect == 1)
                        {
                            $response = array(
                                'status' => 'success',
                                'isVisible' => $isVisible,
                                'personName' => $personName,
                                'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                                'gender' => strtolower($gender),
                                'age' => $age,
                                'address' => $address,
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                                'message' => 'Person Found',
                                'isMissing' => $isMissing,
                                'isVerified' => $isVerified,
                                'isRegistered' => $isUserFound,
                                'image' => $userphoto
                            );
                            echo json_encode($response);   
                        }else{
                            $response = array(
                                'status' => 'incorrect',
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                            );
                            echo json_encode($response);   
                        }
                    }else{
                        $response = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                        echo json_encode($response);
                    }
                }
                if($_POST['idType'] == 'voter')
                {
                    $idNumber = $_POST['voterId'];
                    $getIfAlready = $this->db->query('select * from voterslist where voterNumber="'.$idNumber.'"')->result_array();
                    if(count($getIfAlready) > 0)
                    {
                        $getIfPersonAvailable = $this->db->query('select * from user where uid='.$getIfAlready[0]['userId'].' and gender="'.$_POST['gender'].'" and dob="'.date('Y-m-d',strtotime($_POST['dob'])).'"')->result_array();   
                    }else{
                        $getIfPersonAvailable = array();
                    }
                    $userphoto = '';
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $isVisible = $getIfPersonAvailable[0]['visibility'];
                        $isUserFound = 1;
                        $isVerified = 1;
                        $personName = $getIfPersonAvailable[0]['aadharname'];
                        $gender = $getIfPersonAvailable[0]['gender'];
                        $aadhar = $getIfPersonAvailable[0]['aadhar_id'];
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfPersonAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                        $userphoto = base_url().''.(($getIfPersonAvailable[0]['aadharphoto'] != NULL) ? $getIfPersonAvailable[0]['aadharphoto'] : $getIfPersonAvailable[0]['facematchphoto']);
                    }
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $getMissingPerson = $this->db->query('select * from missingperson where missingaadhar="'.$getIfPersonAvailable[0]['aadhar_id'].'" and isFound != 1')->result_array();   
                    }else{
                        $getMissingPerson = array();
                    }
                    if(count($getMissingPerson) > 0)
                    {
                        $isAadharCorrect = 1;
                        if($getMissingPerson[0]['missinggender'] != NULL)
                        {
                            if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getMissingPerson[0]['missinggender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 1;
                                    $personName = $getMissingPerson[0]['missingname'];
                                    $gender = $getMissingPerson[0]['missinggender'];
                                    $aadhar = $getMissingPerson[0]['missingaadhar'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                    $age = ($from->diff($to)->y);
                                    if(count($getIfPersonAvailable) > 0)
                                    {
                                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                    }else{
                                        $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                    }
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }else{
                            $getFullDetail = $this->db->query('select * from missingpersondetail where missingId='.$getMissingPerson[0]['Id'])->result_array();
                            if(count($getFullDetail) > 0)
                            {
                                if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                }
                                if(strtolower($getFullDetail[0]['gender']) == strtolower($_POST['gender']))
                                {
                                    $isGenderCorrect = 1;
                                    if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                        $isMissing = 1; 
                                        $personName = $getMissingPerson[0]['missingname'];
                                        $gender = $getMissingPerson[0]['missinggender'];
                                        $aadhar = $getMissingPerson[0]['missingaadhar'];
                                        $from=new DateTime(date('Y-m-d'));
                                        $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                        $age = ($from->diff($to)->y);
                                        if(count($getIfPersonAvailable) > 0)
                                        {
                                            $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                        }else{
                                            $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                        }
                                        if(count($getIfPersonAvailable) == 0)
                                        {
                                            $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                        }   
                                    }
                                }   
                            }else{
                                $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$getIfPersonAvailable[0]['aadhar_id'].'"')->result_array();
                                if(count($getUserDetail) > 0)
                                {
                                    if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                    }
                                    if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                                    {
                                        $isGenderCorrect = 1;
                                        if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                        {
                                            $isDobCorrect = 1;
                                            $isMissing = 1; 
                                            $personName = $getUserDetail[0]['aadharname'];
                                            $gender = $getUserDetail[0]['gender'];
                                            $aadhar = $getUserDetail[0]['aadhar_id'];
                                            $from=new DateTime(date('Y-m-d'));
                                            $to   = new DateTime($getUserDetail[0]['dob']);
                                            $age = ($from->diff($to)->y);
                                            $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                            if(count($getIfPersonAvailable) == 0)
                                            {
                                                $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                            }   
                                        }
                                    }
                                }
                            }
                        }
                    }else{
                        if(count($getIfPersonAvailable) > 0)
                        {
                            $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$getIfPersonAvailable[0]['aadhar_id'].'"')->result_array();   
                        }else{
                            $getUserDetail = array();
                        }
                        if(count($getUserDetail) > 0)
                        {
                            $isAadharCorrect = 1;
                            if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 0; 
                                    $personName = $getUserDetail[0]['aadharname'];
                                    $gender = $getUserDetail[0]['gender'];
                                    $aadhar = $getUserDetail[0]['aadhar_id'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getUserDetail[0]['dob']);
                                    $age = ($from->diff($to)->y);
                                    $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getUserDetail[0]['facematchphoto'] != NULL) ? $getUserDetail[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }
                    }
                    $insertdata = array(
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'gender' => $_POST['gender'],
                        'dob' => date('Y-m-d',strtotime($_POST['dob'])),
                        'idNumber' => $_POST['voterId'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    if($update)
                    {
                        if($isGenderCorrect == 1 && $isDobCorrect == 1 && $isAadharCorrect == 1)
                        {
                            $response = array(
                                'status' => 'success',
                                'isVisible'=> $isVisible,
                                'personName' => $personName,
                                'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                                'gender' => strtolower($gender),
                                'age' => $age,
                                'address' => $address,
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                                'message' => 'Person Found',
                                'isMissing' => $isMissing,
                                'isVerified' => $isVerified,
                                'isRegistered' => $isUserFound,
                                'image' => $userphoto
                            );
                            echo json_encode($response);   
                        }else{
                            $response = array(
                                'status' => 'incorrect',
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                            );
                            echo json_encode($response);   
                        }
                    }else{
                        $response = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                        echo json_encode($response);
                    }
                }
                if($_POST['idType'] == 'pan')
                {
                    $idNumber = $_POST['panNumber'];
                    $getIfAlready = $this->db->query('select * from panlist where panNumber="'.$idNumber.'"')->result_array();
                    if(count($getIfAlready) > 0)
                    {
                        $getIfPersonAvailable = $this->db->query('select * from user where uid='.$getIfAlready[0]['userId'])->result_array();   
                    }else{
                        $getIfPersonAvailable = array();
                    }
                    $userphoto = '';
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $isVisible = $getIfPersonAvailable[0]['visibility'];
                        $isUserFound = 1;
                        $isVerified = 1;
                        $personName = $getIfPersonAvailable[0]['aadharname'];
                        $gender = $getIfPersonAvailable[0]['gender'];
                        $aadhar = $getIfPersonAvailable[0]['aadhar_id'];
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfPersonAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                        $userphoto = base_url().''.(($getIfPersonAvailable[0]['aadharphoto'] != NULL) ? $getIfPersonAvailable[0]['aadharphoto'] : $getIfPersonAvailable[0]['facematchphoto']);
                    }
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $getMissingPerson = $this->db->query('select * from missingperson where missingaadhar="'.$getIfPersonAvailable[0]['aadhar_id'].'" and isFound != 1')->result_array();   
                    }else{
                        $getMissingPerson = array();
                    }
                    if(count($getMissingPerson) > 0)
                    {
                        $isAadharCorrect = 1;
                        if($getMissingPerson[0]['missinggender'] != NULL)
                        {
                            if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getMissingPerson[0]['missinggender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 1;
                                    $personName = $getMissingPerson[0]['missingname'];
                                    $gender = $getMissingPerson[0]['missinggender'];
                                    $aadhar = $getMissingPerson[0]['missingaadhar'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                    $age = ($from->diff($to)->y);
                                    if(count($getIfPersonAvailable) > 0)
                                    {
                                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                    }else{
                                        $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                    }
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }else{
                            $getFullDetail = $this->db->query('select * from missingpersondetail where missingId='.$getMissingPerson[0]['Id'])->result_array();
                            if(count($getFullDetail) > 0)
                            {
                                if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                }
                                if(strtolower($getFullDetail[0]['gender']) == strtolower($_POST['gender']))
                                {
                                    $isGenderCorrect = 1;
                                    if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                        $isMissing = 1; 
                                        $personName = $getMissingPerson[0]['missingname'];
                                        $gender = $getMissingPerson[0]['missinggender'];
                                        $aadhar = $getMissingPerson[0]['missingaadhar'];
                                        $from=new DateTime(date('Y-m-d'));
                                        $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                        $age = ($from->diff($to)->y);
                                        if(count($getIfPersonAvailable) > 0)
                                        {
                                            $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                        }else{
                                            $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                        }
                                        if(count($getIfPersonAvailable) == 0)
                                        {
                                            $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                        }   
                                    }
                                }   
                            }else{
                                $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$getIfPersonAvailable[0]['aadhar_id'].'"')->result_array();
                                if(count($getUserDetail) > 0)
                                {
                                    if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                    }
                                    if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                                    {
                                        $isGenderCorrect = 1;
                                        if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                        {
                                            $isDobCorrect = 1;
                                            $isMissing = 1; 
                                            $personName = $getUserDetail[0]['aadharname'];
                                            $gender = $getUserDetail[0]['gender'];
                                            $aadhar = $getUserDetail[0]['aadhar_id'];
                                            $from=new DateTime(date('Y-m-d'));
                                            $to   = new DateTime($getUserDetail[0]['dob']);
                                            $age = ($from->diff($to)->y);
                                            $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                            if(count($getIfPersonAvailable) == 0)
                                            {
                                                $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                            }   
                                        }
                                    }
                                }
                            }
                        }
                    }else{
                        if(count($getIfPersonAvailable) > 0)
                        {
                            $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$getIfPersonAvailable[0]['aadhar_id'].'"')->result_array();   
                        }else{
                            $getUserDetail = array();
                        }
                        if(count($getUserDetail) > 0)
                        {
                            $isAadharCorrect = 1;
                            if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 0; 
                                    $personName = $getUserDetail[0]['aadharname'];
                                    $gender = $getUserDetail[0]['gender'];
                                    $aadhar = $getUserDetail[0]['aadhar_id'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getUserDetail[0]['dob']);
                                    $age = ($from->diff($to)->y);
                                    $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getUserDetail[0]['facematchphoto'] != NULL) ? $getUserDetail[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }
                    }
                    $insertdata = array(
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'gender' => $_POST['gender'],
                        'dob' => date('Y-m-d',strtotime($_POST['dob'])),
                        'idNumber' => $_POST['panNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    if($update)
                    {
                        if($isGenderCorrect == 1 && $isDobCorrect == 1 && $isAadharCorrect == 1)
                        {
                            $response = array(
                                'status' => 'success',
                                'isVisible' => $isVisible,
                                'personName' => $personName,
                                'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                                'gender' => strtolower($gender),
                                'age' => $age,
                                'address' => $address,
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                                'message' => 'Person Found',
                                'isMissing' => $isMissing,
                                'isRegistered' => $isUserFound,
                                'isVerified' => $isVerified,
                                'image' => $userphoto
                            );
                            echo json_encode($response);   
                        }else{
                            $response = array(
                                'status' => 'incorrect',
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                            );
                            echo json_encode($response);   
                        }
                    }else{
                        $response = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                        echo json_encode($response);
                    }
                }   
            }
        }
    }
    
    function checkPersonUpdated($para = '')
    {
        if($para == '')
        {
            $page_data['control'] = 'user';
            $page_data['title'] = 'Search Person';
            $page_data['pn'] = 2;   
            $getFinalId = $this->db->query('select max(Id) as Id from checkperson')->result_array();
            if($getFinalId[0]['Id'] != NULL)
            {
                $_SESSION['checkId'] = $getFinalId[0]['Id'] + 1;
            }else{
                $_SESSION['checkId'] = 1;
            }
            if(isset($_SESSION['landingMob']))
            {
                $insert = $this->db->insert('checkperson',array('personMob' => $_SESSION['landingMob'],'Id' => $_SESSION['checkId']));   
            }else{
                $insert = $this->db->insert('checkperson',array('Id' => $_SESSION['checkId']));
            }
            if(isset($_GET['pn']))
            {
                $page_data['pn'] = $_GET['pn'];    
            }
            
             $page_data['page_name'] = 'checkPersonUpdated';
         $this->load->view('landing_page/index', $page_data);
            // $this->load->view('user/common/header',$page_data); 
            // $this->load->view('user/checkperson');
            // $this->load->view('user/common/footer'); 
        }else
        {
            if($para == 'step1')
            {
                $getPreviousDetail = $this->db->query('select * from checkperson where Id='.$_SESSION['checkId'])->result_array();
                if($getPreviousDetail[0]['otp'] == $_POST['otp'])
                {
                    $getDetail = $this->db->query('select * from nonKycUser where registration_mobile="'.$_POST['mobileNumber'].'"')->result_array();
                    if(count($getDetail) > 0)
                    {
                        if(isset($_SESSION['fcmtokenId']))
                        {
                            $update = $this->db->query('update notification_tokens_tbl set userType="guest", userId='.$getDetail[0]['uid'].' where Id='.$_SESSION['fcmtokenId']);
                        }
                        $_SESSION['landingMob'] = $_POST['mobileNumber'];
                        $_SESSION['user_id'] = $getDetail[0]['uid'];
                        $_SESSION['aadharName'] = $getDetail[0]['aadharname'];
                        $this->session->set_userdata('loginmob',$_POST['mobileNumber']);
                        $this->session->set_userdata('user_login', 'yes');
                        $this->session->set_userdata('gender', $getDetail[0]['gender']);
                        $this->session->set_userdata('login_type', 'NonKyc');
                    }else{
                        $insertdata = array(
                            'registration_mobile' => $_POST['mobileNumber']
                        );
                        $insert = $this->db->insert('nonKycUser',$insertdata);
                        $_SESSION['guestId'] = $this->db->insert_id();
                        
                        $getDetail = $this->db->query('select * from nonKycUser where registration_mobile="'.$_POST['mobileNumber'].'"')->result_array();

                        if(isset($_SESSION['fcmtokenId']))
                        {
                            $update = $this->db->query('update notification_tokens_tbl set userType="guest", userId='.$getDetail[0]['uid'].' where Id='.$_SESSION['fcmtokenId']);
                        }
                        $_SESSION['landingMob'] = $_POST['mobileNumber'];
                        $_SESSION['user_id'] = $getDetail[0]['uid'];
                        $_SESSION['aadharName'] = $getDetail[0]['aadharname'];
                        $this->session->set_userdata('loginmob',$_POST['mobileNumber']);
                        $this->session->set_userdata('user_login', 'yes');
                        $this->session->set_userdata('gender', $getDetail[0]['gender']);
                        $this->session->set_userdata('login_type', 'NonKyc');
                    }
                    $updatedata = array(
                        'personMob' => $_POST['mobileNumber'],
                        'otp' => NULL
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$updatedata);
                    $response['status'] = 'success';
                }else{
                    $response['status'] = 'error';
                    $response['message'] = 'Invalid OTP';
                }
                echo json_encode($response);
            }
            if($para == 'step2')
            {
                $personName = '';
                $gender = '';
                $aadhar = '';
                $gender = '';
                $isVerified = 'No';
                $isVisible = 0;
                $age = '';
                $address = '';
                $isUserFound = 0;
                $isWanted = 0;
                $isMissing = 0;
                $isGenderCorrect = 0;
                $isAadharCorrect = 0;
                $isDobCorrect = 0;
                $_POST['dob'] = $_POST['date'].'-'.$_POST['month'].'-'.$_POST['year'];
                $idNumber = '';
                if($_POST['idType'] == 'aadhar')
                {
                    $idNumber = $_POST['aadhar_id'];
                    if(strlen($_POST['aadhar_id']) != 12)
                    {
                        $response = array(
                            'status' => 'error',
                            'message' => 'Aadhar number must be 12 digit number'
                        );
                        echo json_encode($response);
                        return;
                    }
                    $getIfPersonAvailable = $this->db->query('select * from user where aadhar_id="'.$_POST['aadhar_id'].'" and gender="'.$_POST['gender'].'" and dob="'.date('Y-m-d',strtotime($_POST['dob'])).'"')->result_array();
                    $userphoto = '';
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $isVisible = $getIfPersonAvailable[0]['visibility'];
                        $isVerified = 1;
                        $isUserFound = 1;
                        $personName = $getIfPersonAvailable[0]['aadharname'];
                        $gender = $getIfPersonAvailable[0]['gender'];
                        $aadhar = $getIfPersonAvailable[0]['aadhar_id'];
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfPersonAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                        $userphoto = base_url().''.(($getIfPersonAvailable[0]['aadharphoto'] != NULL) ? $getIfPersonAvailable[0]['aadharphoto'] : $getIfPersonAvailable[0]['facematchphoto']);
                    }
                    $getMissingPerson = $this->db->query('select * from missingperson where missingaadhar="'.$_POST['aadhar_id'].'" and isFound != 1')->result_array();
                    if(count($getMissingPerson) > 0)
                    {
                        $isAadharCorrect = 1;
                        if($getMissingPerson[0]['missinggender'] != NULL)
                        {
                            if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getMissingPerson[0]['missinggender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 1;
                                    $personName = $getMissingPerson[0]['missingname'];
                                    $gender = $getMissingPerson[0]['missinggender'];
                                    $aadhar = $getMissingPerson[0]['missingaadhar'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                    $age = ($from->diff($to)->y);
                                    if(count($getIfPersonAvailable) > 0)
                                    {
                                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                    }else{
                                        $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                    }
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }else{
                            $getFullDetail = $this->db->query('select * from missingpersondetail where missingId='.$getMissingPerson[0]['Id'])->result_array();
                            if(count($getFullDetail) > 0)
                            {
                                if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                }
                                if(strtolower($getFullDetail[0]['gender']) == strtolower($_POST['gender']))
                                {
                                    $isGenderCorrect = 1;
                                    if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                        $isMissing = 1; 
                                        $personName = $getMissingPerson[0]['missingname'];
                                        $gender = $getMissingPerson[0]['missinggender'];
                                        $aadhar = $getMissingPerson[0]['missingaadhar'];
                                        $from=new DateTime(date('Y-m-d'));
                                        $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                        $age = ($from->diff($to)->y);
                                        if(count($getIfPersonAvailable) > 0)
                                        {
                                            $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                        }else{
                                            $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                        }
                                        if(count($getIfPersonAvailable) == 0)
                                        {
                                            $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                        }   
                                    }
                                }   
                            }else{
                                $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$_POST['aadhar_id'].'"')->result_array();
                                if(count($getUserDetail) > 0)
                                {
                                    if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                    }
                                    if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                                    {
                                        $isGenderCorrect = 1;
                                        if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                        {
                                            $isDobCorrect = 1;
                                            $isMissing = 1; 
                                            $personName = $getUserDetail[0]['aadharname'];
                                            $gender = $getUserDetail[0]['gender'];
                                            $aadhar = $getUserDetail[0]['aadhar_id'];
                                            $from=new DateTime(date('Y-m-d'));
                                            $to   = new DateTime($getUserDetail[0]['dob']);
                                            $age = ($from->diff($to)->y);
                                            $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                            if(count($getIfPersonAvailable) == 0)
                                            {
                                                $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                            }   
                                        }
                                    }
                                }
                            }
                        }
                    }else{
                        $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$_POST['aadhar_id'].'"')->result_array();
                        if(count($getUserDetail) > 0)
                        {
                            $isAadharCorrect = 1;
                            if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 0; 
                                    $personName = $getUserDetail[0]['aadharname'];
                                    $gender = $getUserDetail[0]['gender'];
                                    $aadhar = $getUserDetail[0]['aadhar_id'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getUserDetail[0]['dob']);
                                    $age = ($from->diff($to)->y);
                                    $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getUserDetail[0]['facematchphoto'] != NULL) ? $getUserDetail[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }
                    }
                    $insertdata = array(
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'gender' => $_POST['gender'],
                        'dob' => date('Y-m-d',strtotime($_POST['dob'])),
                        'idNumber' => $_POST['aadhar_id'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    if($update)
                    {
                        if($isGenderCorrect == 1 && $isDobCorrect == 1 && $isAadharCorrect == 1)
                        {
                            $response = array(
                                'status' => 'success',
                                'personName' => $personName,
                                'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                                'gender' => strtolower($gender),
                                'age' => $age,
                                'address' => $address,
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                                'message' => 'Person Found',
                                'isVisible' => $isVisible,
                                'isMissing' => $isMissing,
                                'isVerified' => $isVerified,
                                'isRegistered' => $isUserFound,
                                'image' => $userphoto
                            );
                            echo json_encode($response);   
                        }else{
                            $response = array(
                                'status' => 'incorrect',
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                            );
                            echo json_encode($response);   
                        }
                    }else{
                        $response = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                        echo json_encode($response);
                    }
                }
                if($_POST['idType'] == 'dl')
                {
                    $idNumber = $_POST['dlNumber'];
                    $getIfAlready = $this->db->query('select * from dllist where dlNumber="'.$idNumber.'"')->result_array();
                    if(count($getIfAlready) > 0)
                    {
                        $getIfPersonAvailable = $this->db->query('select * from user where uid='.$getIfAlready[0]['userId'])->result_array();   
                    }else{
                        $getIfPersonAvailable = array();
                    }
                    $userphoto = '';
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $isVisible = $getIfPersonAvailable[0]['visibility'];
                        $isVerified = 1;
                        $isUserFound = 1;
                        $personName = $getIfPersonAvailable[0]['aadharname'];
                        $gender = $getIfPersonAvailable[0]['gender'];
                        $aadhar = $getIfPersonAvailable[0]['aadhar_id'];
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfPersonAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                        $userphoto = base_url().''.(($getIfPersonAvailable[0]['aadharphoto'] != NULL) ? $getIfPersonAvailable[0]['aadharphoto'] : $getIfPersonAvailable[0]['facematchphoto']);
                    }
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $getMissingPerson = $this->db->query('select * from missingperson where missingaadhar="'.$getIfPersonAvailable[0]['aadhar_id'].'" and isFound != 1')->result_array();   
                    }else{
                        $getMissingPerson = array();
                    }
                    if(count($getMissingPerson) > 0)
                    {
                        $isAadharCorrect = 1;
                        if($getMissingPerson[0]['missinggender'] != NULL)
                        {
                            if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getMissingPerson[0]['missinggender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 1;
                                    $personName = $getMissingPerson[0]['missingname'];
                                    $gender = $getMissingPerson[0]['missinggender'];
                                    $aadhar = $getMissingPerson[0]['missingaadhar'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                    $age = ($from->diff($to)->y);
                                    if(count($getIfPersonAvailable) > 0)
                                    {
                                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                    }else{
                                        $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                    }
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }else{
                            $getFullDetail = $this->db->query('select * from missingpersondetail where missingId='.$getMissingPerson[0]['Id'])->result_array();
                            if(count($getFullDetail) > 0)
                            {
                                if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                }
                                if(strtolower($getFullDetail[0]['gender']) == strtolower($_POST['gender']))
                                {
                                    $isGenderCorrect = 1;
                                    if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                        $isMissing = 1; 
                                        $personName = $getMissingPerson[0]['missingname'];
                                        $gender = $getMissingPerson[0]['missinggender'];
                                        $aadhar = $getMissingPerson[0]['missingaadhar'];
                                        $from=new DateTime(date('Y-m-d'));
                                        $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                        $age = ($from->diff($to)->y);
                                        if(count($getIfPersonAvailable) > 0)
                                        {
                                            $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                        }else{
                                            $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                        }
                                        if(count($getIfPersonAvailable) == 0)
                                        {
                                            $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                        }   
                                    }
                                }   
                            }else{
                                $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$getIfPersonAvailable[0]['aadhar_id'].'"')->result_array();
                                if(count($getUserDetail) > 0)
                                {
                                    if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                    }
                                    if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                                    {
                                        $isGenderCorrect = 1;
                                        if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                        {
                                            $isDobCorrect = 1;
                                            $isMissing = 1; 
                                            $personName = $getUserDetail[0]['aadharname'];
                                            $gender = $getUserDetail[0]['gender'];
                                            $aadhar = $getUserDetail[0]['aadhar_id'];
                                            $from=new DateTime(date('Y-m-d'));
                                            $to   = new DateTime($getUserDetail[0]['dob']);
                                            $age = ($from->diff($to)->y);
                                            $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                            
                                            if(count($getIfPersonAvailable) == 0)
                                            {
                                                $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                            }   
                                        }
                                    }
                                }
                            }
                        }
                    }else{
                        if(count($getIfPersonAvailable) > 0)
                        {
                            $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$getIfPersonAvailable[0]['aadhar_id'].'"')->result_array();   
                        }else{
                            $getUserDetail = array();
                        }
                        if(count($getUserDetail) > 0)
                        {
                            $isAadharCorrect = 1;
                            if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 0; 
                                    $personName = $getUserDetail[0]['aadharname'];
                                    $gender = $getUserDetail[0]['gender'];
                                    $aadhar = $getUserDetail[0]['aadhar_id'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getUserDetail[0]['dob']);
                                    $age = ($from->diff($to)->y);
                                    $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getUserDetail[0]['facematchphoto'] != NULL) ? $getUserDetail[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }
                    }
                    $insertdata = array(
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'gender' => $_POST['gender'],
                        'dob' => date('Y-m-d',strtotime($_POST['dob'])),
                        'idNumber' => $_POST['dlNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    if($insert)
                    {
                        if($isGenderCorrect == 1 && $isDobCorrect == 1 && $isAadharCorrect == 1)
                        {
                            $response = array(
                                'status' => 'success',
                                'isVisible' => $isVisible,
                                'personName' => $personName,
                                'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                                'gender' => strtolower($gender),
                                'age' => $age,
                                'address' => $address,
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                                'message' => 'Person Found',
                                'isMissing' => $isMissing,
                                'isVerified' => $isVerified,
                                'isRegistered' => $isUserFound,
                                'image' => $userphoto
                            );
                            echo json_encode($response);   
                        }else{
                            $response = array(
                                'status' => 'incorrect',
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                            );
                            echo json_encode($response);   
                        }
                    }else{
                        $response = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                        echo json_encode($response);
                    }
                }
                if($_POST['idType'] == 'voter')
                {
                    $idNumber = $_POST['voterId'];
                    $getIfAlready = $this->db->query('select * from voterslist where voterNumber="'.$idNumber.'"')->result_array();
                    if(count($getIfAlready) > 0)
                    {
                        $getIfPersonAvailable = $this->db->query('select * from user where uid='.$getIfAlready[0]['userId'].' and gender="'.$_POST['gender'].'" and dob="'.date('Y-m-d',strtotime($_POST['dob'])).'"')->result_array();   
                    }else{
                        $getIfPersonAvailable = array();
                    }
                    $userphoto = '';
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $isVisible = $getIfPersonAvailable[0]['visibility'];
                        $isUserFound = 1;
                        $isVerified = 1;
                        $personName = $getIfPersonAvailable[0]['aadharname'];
                        $gender = $getIfPersonAvailable[0]['gender'];
                        $aadhar = $getIfPersonAvailable[0]['aadhar_id'];
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfPersonAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                        $userphoto = base_url().''.(($getIfPersonAvailable[0]['aadharphoto'] != NULL) ? $getIfPersonAvailable[0]['aadharphoto'] : $getIfPersonAvailable[0]['facematchphoto']);
                    }
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $getMissingPerson = $this->db->query('select * from missingperson where missingaadhar="'.$getIfPersonAvailable[0]['aadhar_id'].'" and isFound != 1')->result_array();   
                    }else{
                        $getMissingPerson = array();
                    }
                    if(count($getMissingPerson) > 0)
                    {
                        $isAadharCorrect = 1;
                        if($getMissingPerson[0]['missinggender'] != NULL)
                        {
                            if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getMissingPerson[0]['missinggender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 1;
                                    $personName = $getMissingPerson[0]['missingname'];
                                    $gender = $getMissingPerson[0]['missinggender'];
                                    $aadhar = $getMissingPerson[0]['missingaadhar'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                    $age = ($from->diff($to)->y);
                                    if(count($getIfPersonAvailable) > 0)
                                    {
                                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                    }else{
                                        $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                    }
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }else{
                            $getFullDetail = $this->db->query('select * from missingpersondetail where missingId='.$getMissingPerson[0]['Id'])->result_array();
                            if(count($getFullDetail) > 0)
                            {
                                if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                }
                                if(strtolower($getFullDetail[0]['gender']) == strtolower($_POST['gender']))
                                {
                                    $isGenderCorrect = 1;
                                    if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                        $isMissing = 1; 
                                        $personName = $getMissingPerson[0]['missingname'];
                                        $gender = $getMissingPerson[0]['missinggender'];
                                        $aadhar = $getMissingPerson[0]['missingaadhar'];
                                        $from=new DateTime(date('Y-m-d'));
                                        $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                        $age = ($from->diff($to)->y);
                                        if(count($getIfPersonAvailable) > 0)
                                        {
                                            $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                        }else{
                                            $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                        }
                                        if(count($getIfPersonAvailable) == 0)
                                        {
                                            $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                        }   
                                    }
                                }   
                            }else{
                                $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$getIfPersonAvailable[0]['aadhar_id'].'"')->result_array();
                                if(count($getUserDetail) > 0)
                                {
                                    if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                    }
                                    if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                                    {
                                        $isGenderCorrect = 1;
                                        if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                        {
                                            $isDobCorrect = 1;
                                            $isMissing = 1; 
                                            $personName = $getUserDetail[0]['aadharname'];
                                            $gender = $getUserDetail[0]['gender'];
                                            $aadhar = $getUserDetail[0]['aadhar_id'];
                                            $from=new DateTime(date('Y-m-d'));
                                            $to   = new DateTime($getUserDetail[0]['dob']);
                                            $age = ($from->diff($to)->y);
                                            $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                            if(count($getIfPersonAvailable) == 0)
                                            {
                                                $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                            }   
                                        }
                                    }
                                }
                            }
                        }
                    }else{
                        if(count($getIfPersonAvailable) > 0)
                        {
                            $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$getIfPersonAvailable[0]['aadhar_id'].'"')->result_array();   
                        }else{
                            $getUserDetail = array();
                        }
                        if(count($getUserDetail) > 0)
                        {
                            $isAadharCorrect = 1;
                            if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 0; 
                                    $personName = $getUserDetail[0]['aadharname'];
                                    $gender = $getUserDetail[0]['gender'];
                                    $aadhar = $getUserDetail[0]['aadhar_id'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getUserDetail[0]['dob']);
                                    $age = ($from->diff($to)->y);
                                    $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getUserDetail[0]['facematchphoto'] != NULL) ? $getUserDetail[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }
                    }
                    $insertdata = array(
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'gender' => $_POST['gender'],
                        'dob' => date('Y-m-d',strtotime($_POST['dob'])),
                        'idNumber' => $_POST['voterId'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    if($update)
                    {
                        if($isGenderCorrect == 1 && $isDobCorrect == 1 && $isAadharCorrect == 1)
                        {
                            $response = array(
                                'status' => 'success',
                                'isVisible'=> $isVisible,
                                'personName' => $personName,
                                'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                                'gender' => strtolower($gender),
                                'age' => $age,
                                'address' => $address,
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                                'message' => 'Person Found',
                                'isMissing' => $isMissing,
                                'isVerified' => $isVerified,
                                'isRegistered' => $isUserFound,
                                'image' => $userphoto
                            );
                            echo json_encode($response);   
                        }else{
                            $response = array(
                                'status' => 'incorrect',
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                            );
                            echo json_encode($response);   
                        }
                    }else{
                        $response = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                        echo json_encode($response);
                    }
                }
                if($_POST['idType'] == 'pan')
                {
                    $idNumber = $_POST['panNumber'];
                    $getIfAlready = $this->db->query('select * from panlist where panNumber="'.$idNumber.'"')->result_array();
                    if(count($getIfAlready) > 0)
                    {
                        $getIfPersonAvailable = $this->db->query('select * from user where uid='.$getIfAlready[0]['userId'])->result_array();   
                    }else{
                        $getIfPersonAvailable = array();
                    }
                    $userphoto = '';
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $isVisible = $getIfPersonAvailable[0]['visibility'];
                        $isUserFound = 1;
                        $isVerified = 1;
                        $personName = $getIfPersonAvailable[0]['aadharname'];
                        $gender = $getIfPersonAvailable[0]['gender'];
                        $aadhar = $getIfPersonAvailable[0]['aadhar_id'];
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfPersonAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                        $userphoto = base_url().''.(($getIfPersonAvailable[0]['aadharphoto'] != NULL) ? $getIfPersonAvailable[0]['aadharphoto'] : $getIfPersonAvailable[0]['facematchphoto']);
                    }
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $getMissingPerson = $this->db->query('select * from missingperson where missingaadhar="'.$getIfPersonAvailable[0]['aadhar_id'].'" and isFound != 1')->result_array();   
                    }else{
                        $getMissingPerson = array();
                    }
                    if(count($getMissingPerson) > 0)
                    {
                        $isAadharCorrect = 1;
                        if($getMissingPerson[0]['missinggender'] != NULL)
                        {
                            if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getMissingPerson[0]['missinggender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getMissingPerson[0]['missingdob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 1;
                                    $personName = $getMissingPerson[0]['missingname'];
                                    $gender = $getMissingPerson[0]['missinggender'];
                                    $aadhar = $getMissingPerson[0]['missingaadhar'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                    $age = ($from->diff($to)->y);
                                    if(count($getIfPersonAvailable) > 0)
                                    {
                                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                    }else{
                                        $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                    }
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }else{
                            $getFullDetail = $this->db->query('select * from missingpersondetail where missingId='.$getMissingPerson[0]['Id'])->result_array();
                            if(count($getFullDetail) > 0)
                            {
                                if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                }
                                if(strtolower($getFullDetail[0]['gender']) == strtolower($_POST['gender']))
                                {
                                    $isGenderCorrect = 1;
                                    if($getFullDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                        $isMissing = 1; 
                                        $personName = $getMissingPerson[0]['missingname'];
                                        $gender = $getMissingPerson[0]['missinggender'];
                                        $aadhar = $getMissingPerson[0]['missingaadhar'];
                                        $from=new DateTime(date('Y-m-d'));
                                        $to   = new DateTime($getMissingPerson[0]['missingdob']);
                                        $age = ($from->diff($to)->y);
                                        if(count($getIfPersonAvailable) > 0)
                                        {
                                            $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                                        }else{
                                            $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                                        }
                                        if(count($getIfPersonAvailable) == 0)
                                        {
                                            $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                        }   
                                    }
                                }   
                            }else{
                                $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$getIfPersonAvailable[0]['aadhar_id'].'"')->result_array();
                                if(count($getUserDetail) > 0)
                                {
                                    if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                    {
                                        $isDobCorrect = 1;
                                    }
                                    if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                                    {
                                        $isGenderCorrect = 1;
                                        if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                        {
                                            $isDobCorrect = 1;
                                            $isMissing = 1; 
                                            $personName = $getUserDetail[0]['aadharname'];
                                            $gender = $getUserDetail[0]['gender'];
                                            $aadhar = $getUserDetail[0]['aadhar_id'];
                                            $from=new DateTime(date('Y-m-d'));
                                            $to   = new DateTime($getUserDetail[0]['dob']);
                                            $age = ($from->diff($to)->y);
                                            $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                            if(count($getIfPersonAvailable) == 0)
                                            {
                                                $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                            }   
                                        }
                                    }
                                }
                            }
                        }
                    }else{
                        if(count($getIfPersonAvailable) > 0)
                        {
                            $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$getIfPersonAvailable[0]['aadhar_id'].'"')->result_array();   
                        }else{
                            $getUserDetail = array();
                        }
                        if(count($getUserDetail) > 0)
                        {
                            $isAadharCorrect = 1;
                            if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                            {
                                $isDobCorrect = 1;
                            }
                            if(strtolower($getUserDetail[0]['gender']) == strtolower($_POST['gender']))
                            {
                                $isGenderCorrect = 1;
                                if($getUserDetail[0]['dob'] == date('Y-m-d',strtotime($_POST['dob'])))
                                {
                                    $isDobCorrect = 1;
                                    $isMissing = 0; 
                                    $personName = $getUserDetail[0]['aadharname'];
                                    $gender = $getUserDetail[0]['gender'];
                                    $aadhar = $getUserDetail[0]['aadhar_id'];
                                    $from=new DateTime(date('Y-m-d'));
                                    $to   = new DateTime($getUserDetail[0]['dob']);
                                    $age = ($from->diff($to)->y);
                                    $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                    if(count($getIfPersonAvailable) == 0)
                                    {
                                        $userphoto = base_url().''.(($getUserDetail[0]['facematchphoto'] != NULL) ? $getUserDetail[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                    }   
                                }
                            }
                        }
                    }
                    $insertdata = array(
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'gender' => $_POST['gender'],
                        'dob' => date('Y-m-d',strtotime($_POST['dob'])),
                        'idNumber' => $_POST['panNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    if($update)
                    {
                        if($isGenderCorrect == 1 && $isDobCorrect == 1 && $isAadharCorrect == 1)
                        {
                            $response = array(
                                'status' => 'success',
                                'isVisible' => $isVisible,
                                'personName' => $personName,
                                'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                                'gender' => strtolower($gender),
                                'age' => $age,
                                'address' => $address,
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                                'message' => 'Person Found',
                                'isMissing' => $isMissing,
                                'isRegistered' => $isUserFound,
                                'isVerified' => $isVerified,
                                'image' => $userphoto
                            );
                            echo json_encode($response);   
                        }else{
                            $response = array(
                                'status' => 'incorrect',
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => $isDobCorrect,
                                'isGenderCorrect' => $isGenderCorrect,
                            );
                            echo json_encode($response);   
                        }
                    }else{
                        $response = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                        echo json_encode($response);
                    }
                }   
            }
        }
    }
    
    function checkstep2New($para = '')
    {
        if($para == '')
        {
            if(isset($_SESSION['checkId']))
            {
                $page_data['checkDetail'] = $this->db->query('select * from checkperson where Id='.$_SESSION['checkId'])->result_array();
                $page_data['control'] = 'user';
                $page_data['title'] = 'Search Person Detail';
               
                $page_data['page_name'] = 'checkstep2New';
         $this->load->view('landing_page/index', $page_data);
                // $this->load->view('user/common/header',$page_data); 
                // $this->load->view('user/checkstep2');
                // $this->load->view('user/common/footer'); 
            }else{
                redirect($this->getSettings('noVehicleId'),'refresh');
            }
        }else
        {

        }
    }
    
     function checkstep2($para = '')
    {
        if($para == '')
        {
            if(isset($_SESSION['checkId']))
            {
                $page_data['checkDetail'] = $this->db->query('select * from checkperson where Id='.$_SESSION['checkId'])->result_array();
                $page_data['control'] = 'user';
                $page_data['title'] = 'Search Person Detail';
               
                $page_data['page_name'] = 'checkstep2';

                // echo "<pre>";
                // print_r($page_data);
                // die();

                $this->load->view('landing_page/index', $page_data);
                // $this->load->view('user/common/header',$page_data); 
                // $this->load->view('user/checkstep2');
                // $this->load->view('user/common/footer'); 
            }else{
                redirect($this->getSettings('noVehicleId'),'refresh');
            }
        }else
        {

        }   
    }
    
    function checkstep2Updated($para = '')
    {
        if($para == '')
        {
            if(isset($_SESSION['checkId']))
            {
                $page_data['checkDetail'] = $this->db->query('select * from checkperson where Id='.$_SESSION['checkId'])->result_array();
                $page_data['control'] = 'user';
                $page_data['title'] = 'Search Person Detail';
               
                $page_data['page_name'] = 'checkstep2Updated';

                // echo "<pre>";
                // print_r($page_data);
                // die();

                $this->load->view('landing_page/index', $page_data);
                // $this->load->view('user/common/header',$page_data); 
                // $this->load->view('user/checkstep2');
                // $this->load->view('user/common/footer'); 
            }else{
                redirect($this->getSettings('noVehicleId'),'refresh');
            }
        }else
        {

        }   
    }
    
    function resendCheckOtp()
    {
        $string = '0123456789';
        $string_shuffled = str_shuffle($string);
        $otp = substr($string_shuffled, 1, 4);
        $sendStatus = $this->sendMessage91Otp($_POST['mobile'],$_POST['mobile'], $otp, $this->config->item('login_template_id'));
        if (!$sendStatus || (isset($sendStatus['status']) && $sendStatus['status'] == 'error')) {
            echo json_encode([
                'status' => 'error',
                'message'    => isset($sendStatus['message']) ? $sendStatus['message'] : 'Failed to send OTP. Please try again later.'
            ]);
            die();
        }
        $this->db->where('Id',$_SESSION['checkId']);
        $update = $this->db->update('checkperson',array('otp' => $otp));
        echo json_encode([
            'status' => 'success'
        ]);
        die();
    }
    
    function sendCheckOtpUpdated()
    {
        $string = '0123456789';
        $string_shuffled = str_shuffle($string);
        $otp = substr($string_shuffled, 1, 4);
        $sendStatus = $this->sendMessage91Otp($_POST['mobile'],$_POST['mobile'], $otp, $this->config->item('login_template_id'));
        if (!$sendStatus || (isset($sendStatus['status']) && $sendStatus['status'] == 'error')) {
            echo json_encode([
                'status' => 'error',
                'message'    => isset($sendStatus['message']) ? $sendStatus['message'] : 'Failed to send OTP. Please try again later.'
            ]);
            die();
        }
        $this->db->where('Id',$_SESSION['checkId']);
        $update = $this->db->update('checkperson',array('otp' => $otp));
        if($update)
        {
            $getIfRegistered = $this->db->query('select * from user where registration_mobile="'.$_POST['mobile'].'"')->result_array();
            $isRegistered = count($getIfRegistered);
            $response = array(
                'status' => 'success',
                'message' => 'OTP Sent Successfully To -'.substr_replace($_POST['mobile'],'XXXXXXX',0,7),
                'isRegistered' => $isRegistered
            );
            echo json_encode($response);
        }else{
            $response = array(
                'status' => 'error',
                'message' => 'Something Went Wrong'
            );
            echo json_encode($response);
        }
    }
    
    function sendCheckOtp()
    {
        $string = '0123456789';
        $string_shuffled = str_shuffle($string);
        $otp = substr($string_shuffled, 1, 4);
        $sendStatus = $this->sendMessage91Otp($_POST['mobile'],$_POST['mobile'], $otp, $this->config->item('login_template_id'));
        if (!$sendStatus || (isset($sendStatus['status']) && $sendStatus['status'] == 'error')) {
            echo json_encode([
                'status' => 'error',
                'message'    => isset($sendStatus['message']) ? $sendStatus['message'] : 'Failed to send OTP. Please try again later.'
            ]);
            die();
        }
        $getFinalId = $this->db->query('select max(Id) as Id from checkperson')->result_array();
        if($getFinalId[0]['Id'] != NULL)
        {
            $_SESSION['checkId'] = $getFinalId[0]['Id'] + 1;
        }else{
            $_SESSION['checkId'] = 1;
        }
        $insert = $this->db->insert('checkperson',array('otp' => $otp,'Id' => $_SESSION['checkId']));
        if($insert)
        {
            $response = array(
                'status' => 'success',
                'message' => 'OTP Sent Successfully'
            );
            echo json_encode($response);
        }else{
            $response = array(
                'status' => 'error',
                'message' => 'Something Went Wrong'
            );
            echo json_encode($response);
        }
    }
    
    function sendTextLocalOtp($username,$mob,$otp)
    {
        $message = 'Dear '.$username.', To verify your mobile number your OTP is '.$otp.'.%nKhoji.in';
        $mob = '91'.$mob;
        try {
            $apiKey = urlencode("NGQ2YzQ3NDM0MjcxNjU2YjcwNmIzOTYzMzI0ZTZkNjg=");
            $sender = urlencode('KHOJI');
            $message = rawurlencode($message);
            $data = array('apikey' => $apiKey, 'numbers' => $mob, 'sender' => $sender, 'message' => $message);
            $ch = curl_init('https://api.textlocal.in/send/');
            curl_setopt($ch, CURLOPT_POST, true);
            curl_setopt($ch, CURLOPT_POSTFIELDS, $data);
            curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
            $response = curl_exec($ch);
            curl_close($ch);
        } catch (\Throwable $th) {
            throw $th;

        }
    }

    function sendTextLocalCustomMsg($msg,$mob)
    {
        $mob = '91'.$mob;
        try {
            $apiKey = urlencode("NGQ2YzQ3NDM0MjcxNjU2YjcwNmIzOTYzMzI0ZTZkNjg=");
            $sender = urlencode('KHOJI');
            $message = rawurlencode($msg);
            $data = array('apikey' => $apiKey, 'numbers' => $mob, 'sender' => $sender, 'message' => $message);
            $ch = curl_init('https://api.textlocal.in/send/');
            curl_setopt($ch, CURLOPT_POST, true);
            curl_setopt($ch, CURLOPT_POSTFIELDS, $data);
            curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
            $response = curl_exec($ch);
            curl_close($ch);
        } catch (\Throwable $th) {
            throw $th;

        }
    }
    
    function checkInactiveFace()
    {
        $data = $_POST["photo"];
        $image_array_1 = explode(";", $data);
        $split1 = explode('data:image/',$image_array_1[0]);
        $image_array_2 = explode(",", $image_array_1[1]);
        $data = base64_decode($image_array_2[1]);
        $imageId = time().''.rand(0,10000);
        $newImagePath = 'upload/checkPerson/'.$imageId.'.'.$split1[1];
        
        file_put_contents($newImagePath, $data);
        $config['image_library'] = 'gd2';  
        $config['source_image'] = $newImagePath;  
        $config['create_thumb'] = FALSE;  
        $config['maintain_ratio'] = true;  
        $config['quality'] = '60%';  
        $config['width'] = 320;  
        $config['height'] = 240;  
        $config['new_image'] = $newImagePath;  
        $this->load->library('image_lib', $config);  
        $this->image_lib->resize(); 
        $this->load->library('Image_autorotate',$newImagePath);
        $this->image_lib->clear();
        $personName = '';
        $gender = '';
        $aadhar = '';
        $gender = '';
        $isVerified = 'No';
        $isVisible = 0;
        $age = '';
        $address = '';
        $isUserFound = 0;
        $isMissing = 0;
        $isAadharCorrect = 0;
        $idNumber = '';
        $confidence = 0;
        $faceResponse = array();
        $getIfPersonAvailable = $this->db->query('select * from user where uid='.$_SESSION['uid'])->result_array();
        $userphoto = '';
        if(count($getIfPersonAvailable) > 0)
        {
            $curl = curl_init();
            $postdata = json_encode(array(
                "collection_id" => "shivaguptabcakhoji4",
                "image_url" => base_url().''.$newImagePath,
                "threshold" => (float)$this->getSettings('beforeLoginThreshold')
            ));
            curl_setopt_array($curl, array(
              CURLOPT_URL => 'https://z4ff6xy4lixrrupnwfgetu2pye0qjzqn.lambda-url.ap-south-1.on.aws/',
              CURLOPT_RETURNTRANSFER => true,
              CURLOPT_ENCODING => '',
              CURLOPT_MAXREDIRS => 10,
              CURLOPT_TIMEOUT => 0,
              CURLOPT_FOLLOWLOCATION => true,
              CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
              CURLOPT_CUSTOMREQUEST => 'POST',
              CURLOPT_POSTFIELDS => $postdata,
              CURLOPT_HTTPHEADER => array(
                'Content-Type: application/json',
                'Authorization: '.$this->getSettings('facematchtoken'),
              ),
            ));
            $faceresponse = json_decode(curl_exec($curl),true);
            curl_close($curl);
            if(count($faceresponse) > 0)
            {
                if(count($faceresponse['output']) > 0)
                {
                    foreach($faceresponse['output'] as $k=>$v)
                    {
                        if($v == $getIfPersonAvailable[0]['imageId'])
                        {
                            $confidence = 84;
                        }
                    }
                }
            }
        }
        if($confidence > 83)
        {
            $response = array(
                'status' => 'success',
                'id' => $_SESSION['uid']
            );
            echo json_encode($response);   
        }else{
            $response = array(
                'status' => 'error',
                'message' => 'Face Not Matched'
            );
            echo json_encode($response);    
        }
    }
    
    function checkVisibility()
    {
        $getUserDetail = $this->db->query('select * from user where uid='.$_GET['Id'])->result_array();
        if($getUserDetail[0]['visibility'] == 1)
        {
            $response = array(
                'status' => 'success'    
            );
            echo json_encode($response);
        }else{
            $_SESSION['uid'] = $_GET['Id'];
            $response = array(
                'status' => 'error'    
            );
            echo json_encode($response);
        }
    }
 
    function checkPersonId()
    {
        $personName = '';
        $gender = '';
        $aadhar = '';
        $gender = '';
        $isVerified = 'No';
        $isVisible = 0;
        $age = '';
        $isWanted = 0;
        $personId = '';
        $isCriminal = 0;
        $isLapata = 0;
        $address = '';
        $lapataId = 0;
        $wantedId = array();
        $criminalId = array();
        $isUserFound = 0;
        $isMissing = 0;
        $isAadharCorrect = 0;
        $idNumber = '';
        if($_POST['idType'] == 'aadhar')
        {
            $idNumber = $_POST['idNumber'];
            if(strlen($_POST['idNumber']) != 12)
            {
                $response = array(
                    'status' => 'error',
                    'message' => 'Aadhar number must be 12 digit number'
                );
                echo json_encode($response);
                return;
            }
            $getIfPersonAvailable = $this->db->query('select * from user where aadhar_id="'.$_POST['idNumber'].'"')->result_array();
            $userphoto = '';
            if(count($getIfPersonAvailable) > 0)
            {
                $personId = $getIfPersonAvailable[0]['uid'];
                $isAadharCorrect = 1;
                $isVisible = $getIfPersonAvailable[0]['visibility'];
                $isVerified = 1;
                $isUserFound = 1;
                $personName = $getIfPersonAvailable[0]['aadharname'];
                $gender = $getIfPersonAvailable[0]['gender'];
                $aadhar = $getIfPersonAvailable[0]['aadhar_id'];
                $from=new DateTime(date('Y-m-d'));
                $to   = new DateTime($getIfPersonAvailable[0]['dob']);
                $age = ($from->diff($to)->y);
                $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                $userphoto = base_url().''.(($getIfPersonAvailable[0]['aadharphoto'] != NULL) ? $getIfPersonAvailable[0]['aadharphoto'] : $getIfPersonAvailable[0]['facematchphoto']);
            }
            $getIfWantedAvailable = $this->db->query('select * from criminals where aadharNumber="'.$_POST['idNumber'].'" and isFinalSubmitted=1 and type="wanted" and status="Active" order by dateCreated desc')->result_array();
            if(count($getIfWantedAvailable) > 0)
            {
                $isAadharCorrect = 1;
                $isWanted = 1;
                $isVisible = 1;
                if($isUserFound != 1)
                {
                    $personName = $getIfWantedAvailable[0]['personName'];
                    $gender = $getIfWantedAvailable[0]['gender'];
                    $aadhar = $getIfWantedAvailable[0]['aadharNumber'];
                    if($getIfWantedAvailable[0]['dob'] != '0000-00-00')
                    {
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfWantedAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                    }else{
                        $age = '';
                    }
                    $address = '';
                    if($getIfWantedAvailable[0]['state'] != '')
                    {
                        $address .= $getIfWantedAvailable[0]['state'];
                    }
                    if($getIfWantedAvailable[0]['district'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfWantedAvailable[0]['district'];
                        }else{
                            $address .= $getIfWantedAvailable[0]['district'];
                        }
                    }
                    if($getIfWantedAvailable[0]['city'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfWantedAvailable[0]['city'];
                        }else{
                            $address .= $getIfWantedAvailable[0]['city'];
                        }
                    }
                    $getPhotos = $this->db->query('select * from criminalphotos where crimeId='.$getIfWantedAvailable[0]['Id'])->result_array();
                    if($userphoto == '' || $userphoto == base_url())
                    {
                        $userphoto = ((count($getPhotos) > 0) ? base_url().''.$getPhotos[0]['photourl'] : base_url().''.$getIfWantedAvailable[0]['photo']);   
                    }   
                }
                foreach($getIfWantedAvailable as $k=>$v)
                {
                    array_push($wantedId,$v['Id']);
                }
            }
            $getIfCriminalAvailable = $this->db->query('select * from criminals where aadharNumber="'.$_POST['idNumber'].'" and isFinalSubmitted=1 and type="criminal" and status="Active" order by dateCreated desc')->result_array();
            if(count($getIfCriminalAvailable) > 0)
            {
                $isAadharCorrect = 1;
                $isVisible = 1;
                $isCriminal = 1;
                if($isUserFound != 1)
                {
                    $personName = $getIfCriminalAvailable[0]['personName'];
                    $gender = $getIfCriminalAvailable[0]['gender'];
                    $aadhar = $getIfCriminalAvailable[0]['aadharNumber'];
                    if($getIfCriminalAvailable[0]['dob'] != '0000-00-00')
                    {
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfCriminalAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                    }else{
                        $age = '';
                    }
                    $address = '';
                    if($getIfCriminalAvailable[0]['state'] != '')
                    {
                        $address .= $getIfCriminalAvailable[0]['state'];
                    }
                    if($getIfCriminalAvailable[0]['district'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfCriminalAvailable[0]['district'];
                        }else{
                            $address .= $getIfCriminalAvailable[0]['district'];
                        }
                    }
                    if($getIfCriminalAvailable[0]['city'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfCriminalAvailable[0]['city'];
                        }else{
                            $address .= $getIfCriminalAvailable[0]['city'];
                        }
                    }
                    $getPhotos = $this->db->query('select * from criminalphotos where crimeId='.$getIfCriminalAvailable[0]['Id'])->result_array();
                    if($userphoto == '' || $userphoto == base_url())
                    {
                        $userphoto = ((count($getPhotos) > 0) ? base_url().''.$getPhotos[0]['photourl'] : base_url().''.$getIfCriminalAvailable[0]['photo']);   
                    }
                }
                foreach($getIfCriminalAvailable as $k=>$v)
                {
                    array_push($criminalId,$v['Id']);
                }
            }
            $getMissingPerson = $this->db->query('select * from missingperson where missingaadhar="'.$_POST['idNumber'].'" and isFound !=1 order by dateCreated desc')->result_array();
            if(count($getMissingPerson) > 0)
            {
                $isVisible = 1;
                $isAadharCorrect = 1;
                if($getMissingPerson[0]['missinggender'] != NULL)
                {
                    $isMissing = 1;
                    if($isUserFound != 1)
                    {
                        $personName = $getMissingPerson[0]['missingname'];
                        $gender = $getMissingPerson[0]['missinggender'];
                        $aadhar = $getMissingPerson[0]['missingaadhar'];
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getMissingPerson[0]['missingdob']);
                        $age = ($from->diff($to)->y);
                        if(count($getIfPersonAvailable) > 0)
                        {
                            $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                        }else{
                            $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                        }
                        if(count($getIfPersonAvailable) == 0)
                        {
                            if($userphoto == '' || $userphoto == base_url())
                            {
                                $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : '');
                            }
                        }
                    }
                }else{
                    $getFullDetail = $this->db->query('select * from missingpersondetail where missingId='.$getMissingPerson[0]['Id'])->result_array();
                    if(count($getFullDetail) > 0)
                    {
                        $isMissing = 1; 
                        if($isUserFound != 1)
                        {
                            $personName = $getMissingPerson[0]['missingname'];
                            $gender = $getMissingPerson[0]['missinggender'];
                            $aadhar = $getMissingPerson[0]['missingaadhar'];
                            $from=new DateTime(date('Y-m-d'));
                            $to   = new DateTime($getMissingPerson[0]['missingdob']);
                            $age = ($from->diff($to)->y);
                            if(count($getIfPersonAvailable) > 0)
                            {
                                $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                            }else{
                                $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                            }
                            if(count($getIfPersonAvailable) == 0)
                            {
                                if($userphoto == '' || $userphoto == base_url())
                                {
                                    $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                }
                            }
                        }
                    }else{
                        $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$_POST['idNumber'].'"')->result_array();
                        if(count($getUserDetail) > 0)
                        {
                            $isMissing = 1; 
                            if($isUserFound != 1)
                            {
                                $personName = $getUserDetail[0]['aadharname'];
                                $gender = $getUserDetail[0]['gender'];
                                $aadhar = $getUserDetail[0]['aadhar_id'];
                                $from=new DateTime(date('Y-m-d'));
                                $to   = new DateTime($getUserDetail[0]['dob']);
                                $age = ($from->diff($to)->y);
                                $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                if(count($getIfPersonAvailable) == 0)
                                {
                                    if($userphoto == '' || $userphoto == base_url())
                                    {
                                        $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : '');
                                    }
                                }
                            }
                        }
                    }
                }
            }
            $getIfLapataAvailable = $this->db->query('select * from unknown_person where isFinalSubmitted=1 and awsEventName="All" and isFound=0 and aadharNumber="'.$_POST['idNumber'].'" and expiryDate >= "'.date('Y-m-d h:i:s').'" order by dateCreated desc')->result_array();
            if(count($getIfLapataAvailable) > 0)
            {
                $isAadharCorrect = 1;
                $isVisible = 1;
                $isLapata = 1;
                $lapataId = $getIfLapataAvailable[0]['id'];
                $isMissing = 0;
                $missingId = 0;
                if(!$isUserFound)
                {
                    $isVerified = 0;
                    $personName = $getIfLapataAvailable[0]['person_name'];
                    $gender = ($getIfLapataAvailable[0]['Gender'] == 'boy' ? 'MALE' : 'FEMALE');
                    $aadhar = $getIfLapataAvailable[0]['aadharNumber'];
                    $age = ($getIfLapataAvailable[0]['Age']);
                    $address = $getIfLapataAvailable[0]['city'].','.$getIfLapataAvailable[0]['state'];
                    $userphoto = base_url().''.(($getIfLapataAvailable[0]['Photo'] != NULL) ? $getIfLapataAvailable[0]['Photo'] : $userphoto);
                }
            }
            if($this->getSettings('generalNotification') == 'true')
            {
                if($personId != '')
                {
                    $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$personId);
                    $query_res = $query->result_array();
                    
                    if(count($query_res) > 0)
                    {
                        foreach ($query_res as $query_res_data) {
                            $registrationIds[] =$query_res_data['token'];
                        }
                        
                        $url ="https://fcm.googleapis.com/fcm/send";
                        $fields=array(
                            "registration_ids"=>$registrationIds,
                            'data' => array("msg"=>"Khoji"),
                            'priority' => 'high',
                            "click_action"=>base_url(),
                            "notification"=>array(
                                "body"=>"One Person has searched you",
                                "title"=>"Khoji",
                            )   
                        );
                        $headers=array(
                            'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                            'Content-Type:application/json'
                        );
                        $ch=curl_init();
                        curl_setopt($ch,CURLOPT_URL,$url);
                        curl_setopt($ch,CURLOPT_POST,true);
                        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                        curl_exec($ch);
                    }
                }   
            }
            if($isLapata != 1)
            {
                $getIfUnknownAvailable = $this->db->query('select * from unknown_person where isFinalSubmitted=1 and awsEventName !="All" and isFound=0 and aadharNumber="'.$_POST['idNumber'].'" order by dateCreated desc')->result_array();
                // $getIfUnknownAvailable = array();
                if(count($getIfUnknownAvailable) > 0)
                {
                    $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$getIfUnknownAvailable[0]['id'])->result_array();
                    if($getApplicationNumber[0]['isKyc'] == 1)
                    {
                        $notifyData = array(
                            'isLogin' => 0,
                            'dateCreated' => date('Y-m-d H:i:s'),
                            'mobileNumber' => $_SESSION['landingMob'],
                            'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                            'searchType' => 'Unknown',
                            'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                            'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                            'isIdentity' => 1,
                            'identityType' => 'aadhar',
                            'identityNumber' => $_POST['idNumber']
                        );
                        $insert = $this->db->insert('searchnotification',$notifyData);
                        if($getApplicationNumber[0]['uploaded_by'] == 'user')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else{
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }
                    }else{
                        $notifyData = array(
                            'isLogin' => 0,
                            'dateCreated' => date('Y-m-d H:i:s'),
                            'mobileNumber' => $_SESSION['landingMob'],
                            'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                            'searchType' => 'Unknown',
                            'complainantUserType' => 'NonKyc',
                            'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                            'isIdentity' => 1,
                            'identityType' => 'aadhar',
                            'identityNumber' => $_POST['idNumber']
                        );
                        $insert = $this->db->insert('searchnotification',$notifyData);
                        if($getApplicationNumber[0]['uploaded_by'] == 'user')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else{
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }
                    }
                    if($isUserFound != 1)
                    {
                        if($getIfUnknownAvailable[0]['uploaded_by'] == 'police')
                        {
                            $getPoliceDetail = $this->db->query('select * from police where police_id='.$getIfUnknownAvailable[0]['policeId'])->result_array();
                            $finalresponse = array(
                                'isUserFound' => $isUserFound,
                                'status' => 'unknown',
                                'isLapata' => $isLapata,
                                'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                'type' => 'police',
                                'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                'address' => strtoupper($getPoliceDetail[0]['thanaName'].' - '.$getPoliceDetail[0]['state'].', '.$getPoliceDetail[0]['district']),
                                'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                'age' => $getIfUnknownAvailable[0]['Age'],
                                'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                'id' => $getIfUnknownAvailable[0]['Application_no'],
                                'registration_mobile' => (($getPoliceDetail[0]['registration_mobile'] != NULL) ? $getPoliceDetail[0]['registration_mobile'] : ''),
                                'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                            );   
                        }
                        else
                        {
                            if($getIfUnknownAvailable[0]['uploaded_by']=='user')
                            {
                                $getUserDetail = $this->db->query('select * from user where uid='.$getIfUnknownAvailable[0]['userId'])->result_array();
                                $finalresponse = array(
                                    'status' => 'unknown',
                                    'isUserFound' => $isUserFound,
                                    'isLapata' => $isLapata,
                                    'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                    'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                    'type' => 'ngo',
                                    'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                    'address' => strtoupper($getUserDetail[0]['vtc'].' - '.$getUserDetail[0]['state'].', '.$getUserDetail[0]['district']),
                                    'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                    'age' => $getIfUnknownAvailable[0]['Age'],
                                    'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                    'registration_mobile' => (($getUserDetail[0]['registration_mobile'] != NULL) ? $getUserDetail[0]['registration_mobile'] : ''),
                                    'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                    'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                    'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                                    'id' => $getIfUnknownAvailable[0]['Application_no']
                                );   
                            }
                            else
                            {
                                $getNgoDetail = $this->db->query('select * from ngo where Id='.$getIfUnknownAvailable[0]['ngoId'])->result_array();
                                $finalresponse = array(
                                    'isUserFound' => $isUserFound,
                                    'status' => 'unknown',
                                    'isLapata' => $isLapata,
                                    'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                    'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                    'type' => 'ngo',
                                    'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                    'address' => strtoupper($getNgoDetail[0]['ngoName'].' - '.$getNgoDetail[0]['ngoState'].', '.$getNgoDetail[0]['ngoDistrict'].', '.$getNgoDetail[0]['ngoCity']),
                                    'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                    'age' => $getIfUnknownAvailable[0]['Age'],
                                    'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                    'registration_mobile' => (($getNgoDetail[0]['ngoRegistrationNumber'] != NULL) ? $getNgoDetail[0]['ngoRegistrationNumber'] : ''),
                                    'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                    'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                    'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                                    'id' => $getIfUnknownAvailable[0]['Application_no']
                                );   
                            }
                            
                        }
                    }else{
                        $finalresponse = array(
                            'isUserFound' => $isUserFound,
                            'status' => 'unknown',
                            'isLapata' => $isLapata,
                            'personName' => strtoupper($personName),
                            'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                            'address' => strtoupper($address),
                            'photo' => ($userphoto != '' ? $userphoto : base_url().$getIfUnknownAvailable[0]['Photo']),
                            'age' => $age,
                            'gender' => strtolower($gender),
                            'id' => $getIfUnknownAvailable[0]['Application_no']
                        );
                    }
                    $insertdata = array(
                        'lapataId' => $lapataId,
                        'isLapata' => $isLapata,
                        'wantedIds' => implode(',',$wantedId),
                        'criminalIds' => implode(',',$criminalId),
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'idNumber' => $_POST['idNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    echo json_encode($finalresponse);
                }else{
                    $insertdata = array(
                        'lapataId' => $lapataId,
                        'isLapata' => $isLapata,
                        'wantedIds' => implode(',',$wantedId),
                        'criminalIds' => implode(',',$criminalId),
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'idNumber' => $_POST['idNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    if($update)
                    {
                        if($isAadharCorrect == 1)
                        {
                            $isOnlyUser = 0;
                            if(!$isWanted && !$isLapata && !$isCriminal && !$isMissing)
                            {
                                $isOnlyUser = 1;
                            }
                            $response = array(
                                'personId' => $personId,
                                'isOnlyUser' => $isOnlyUser,
                                'status' => 'success',
                                'personName' => $personName,
                                'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                                'gender' => strtolower($gender),
                                'isWanted' => $isWanted,
                                'isLapata' => $isLapata,
                                'isCriminal' => $isCriminal,
                                'age' => $age,
                                'address' => $address,
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => 1,
                                'isGenderCorrect' => 1,
                                'message' => 'Person Found',
                                'isVisible' => $isVisible,
                                'isMissing' => $isMissing,
                                'isVerified' => $isVerified,
                                'isRegistered' => $isUserFound,
                                'image' => ($userphoto != '' ? $userphoto : base_url().'assets/img/noimage.jpg')
                            );
                            echo json_encode($response);   
                        }else{
                            $response = array(
                                'status' => 'incorrect',
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => 1,
                                'isGenderCorrect' => 1,
                            );
                            echo json_encode($response);   
                        }
                    }else{
                        $response = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                        echo json_encode($response);
                    }
                }   
            }else{
                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$lapataId)->result_array();
                if($getApplicationNumber[0]['isKyc'] == 1)
                {
                    $notifyData = array(
                        'isLogin' => 0,
                        'dateCreated' => date('Y-m-d H:i:s'),
                        'mobileNumber' => $_SESSION['landingMob'],
                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                        'searchType' => 'Lapata',
                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                        'isIdentity' => 1,
                        'identityType' => 'aadhar',
                        'identityNumber' => $_POST['idNumber']
                    );
                    $insert = $this->db->insert('searchnotification',$notifyData);
                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else{
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }
                }else{
                    $notifyData = array(
                        'isLogin' => 0,
                        'dateCreated' => date('Y-m-d H:i:s'),
                        'mobileNumber' => $_SESSION['landingMob'],
                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                        'searchType' => 'Lapata',
                        'complainantUserType' => 'NonKyc',
                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                        'isIdentity' => 1,
                        'identityType' => 'aadhar',
                        'identityNumber' => $_POST['idNumber']
                    );
                    $insert = $this->db->insert('searchnotification',$notifyData);
                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else{
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }
                }
                $insertdata = array(
                    'lapataId' => $lapataId,
                    'isLapata' => $isLapata,
                    'wantedIds' => implode(',',$wantedId),
                    'criminalIds' => implode(',',$criminalId),
                    'isPersonFound' => $isUserFound,
                    'isMissing' => $isMissing,
                    'idNumber' => $_POST['idNumber'],
                    'idType' => $_POST['idType'],
                );
                $this->db->where('Id',$_SESSION['checkId']);
                $update = $this->db->update('checkperson',$insertdata);
                if($update)
                {
                    if($isAadharCorrect == 1)
                    {
                        $isOnlyUser = 0;
                        if(!$isWanted && !$isLapata && !$isCriminal && !$isMissing)
                        {
                            $isOnlyUser = 1;
                        }
                        $response = array(
                            'personId' => $personId,
                            'isOnlyUser' => $isOnlyUser,
                            'status' => 'success',
                            'personName' => $personName,
                            'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                            'gender' => strtolower($gender),
                            'isWanted' => $isWanted,
                            'isLapata' => $isLapata,
                            'isCriminal' => $isCriminal,
                            'age' => $age,
                            'address' => $address,
                            'isAadharCorrect' => $isAadharCorrect,
                            'isDobCorrect' => 1,
                            'isGenderCorrect' => 1,
                            'message' => 'Person Found',
                            'isVisible' => $isVisible,
                            'isMissing' => $isMissing,
                            'isVerified' => $isVerified,
                            'isRegistered' => $isUserFound,
                            'image' => ($userphoto != '' ? $userphoto : base_url().'assets/img/noimage.jpg')
                        );
                        echo json_encode($response);   
                    }else{
                        $response = array(
                            'status' => 'incorrect',
                            'isAadharCorrect' => $isAadharCorrect,
                            'isDobCorrect' => 1,
                            'isGenderCorrect' => 1,
                        );
                        echo json_encode($response);   
                    }
                }else{
                    $response = array(
                        'status' => 'error',
                        'message' => 'Something Went Wrong'
                    );
                    echo json_encode($response);
                }   
            }
        }
        if($_POST['idType'] == 'dl')
        {
            $idNumber = $_POST['idNumber'];
            $getIfAlready = $this->db->query('select * from dllist where dlNumber="'.$idNumber.'"')->result_array();
            if(count($getIfAlready) > 0)
            {
                $getIfPersonAvailable = $this->db->query('select * from user where uid='.$getIfAlready[0]['userId'])->result_array();   
            }else{
                $getIfPersonAvailable = array();
            }
            $userphoto = '';
            if(count($getIfPersonAvailable) > 0)
            {
                $personId = $getIfPersonAvailable[0]['uid'];
                $isAadharCorrect = 1;
                $isVisible = $getIfPersonAvailable[0]['visibility'];
                $isVerified = 1;
                $isUserFound = 1;
                $personName = $getIfPersonAvailable[0]['aadharname'];
                $gender = $getIfPersonAvailable[0]['gender'];
                $aadhar = $getIfPersonAvailable[0]['aadhar_id'];
                $from=new DateTime(date('Y-m-d'));
                $to   = new DateTime($getIfPersonAvailable[0]['dob']);
                $age = ($from->diff($to)->y);
                $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                $userphoto = base_url().''.(($getIfPersonAvailable[0]['aadharphoto'] != NULL) ? $getIfPersonAvailable[0]['aadharphoto'] : $getIfPersonAvailable[0]['facematchphoto']);
            }
            if(count($getIfPersonAvailable) > 0)
            {
                $getIfWantedAvailable = $this->db->query('select * from criminals where aadharNumber="'.$getIfPersonAvailable[0]['aadhar_id'].'" and isFinalSubmitted=1 and type="wanted" and status="Active"')->result_array();   
            }else{
                $getIfWantedAvailable = array();
            }
            if(count($getIfWantedAvailable) > 0)
            {
                $isVisible = 1;
                $isAadharCorrect = 1;
                $isWanted = 1;
                if($isUserFound != 1)
                {
                    $personName = $getIfWantedAvailable[0]['personName'];
                    $gender = $getIfWantedAvailable[0]['gender'];
                    $aadhar = $getIfWantedAvailable[0]['aadharNumber'];
                    if($getIfWantedAvailable[0]['dob'] != '0000-00-00')
                    {
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfWantedAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                    }else{
                        $age = '';
                    }
                    $address = '';
                    if($getIfWantedAvailable[0]['state'] != '')
                    {
                        $address .= $getIfWantedAvailable[0]['state'];
                    }
                    if($getIfWantedAvailable[0]['district'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfWantedAvailable[0]['district'];
                        }else{
                            $address .= $getIfWantedAvailable[0]['district'];
                        }
                    }
                    if($getIfWantedAvailable[0]['city'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfWantedAvailable[0]['city'];
                        }else{
                            $address .= $getIfWantedAvailable[0]['city'];
                        }
                    }
                    $getPhotos = $this->db->query('select * from criminalphotos where crimeId='.$getIfWantedAvailable[0]['Id'])->result_array();
                    if($userphoto == '' || $userphoto == base_url())
                    {
                        $userphoto = ((count($getPhotos) > 0) ? base_url().''.$getPhotos[0]['photourl'] : base_url().''.$getIfWantedAvailable[0]['photo']);   
                    }
                }
                foreach($getIfWantedAvailable as $k=>$v)
                {
                    array_push($wantedId,$v['Id']);
                }
            }
            if(count($getIfPersonAvailable) > 0)
            {
                $getIfCriminalAvailable = $this->db->query('select * from criminals where aadharNumber="'.$getIfPersonAvailable[0]['aadhar_id'].'" and isFinalSubmitted=1 and type="criminal" and status="Active"')->result_array();   
            }else{
                $getIfCriminalAvailable = array();
            }
            if(count($getIfCriminalAvailable) > 0)
            {
                $isVisible = 1;
                $isAadharCorrect = 1;
                $isCriminal = 1;
                if($isUserFound != 1)
                {
                    $personName = $getIfCriminalAvailable[0]['personName'];
                    $gender = $getIfCriminalAvailable[0]['gender'];
                    $aadhar = $getIfCriminalAvailable[0]['aadharNumber'];
                    if($getIfCriminalAvailable[0]['dob'] != '0000-00-00')
                    {
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfCriminalAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                    }else{
                        $age = '';
                    }
                    $address = '';
                    if($getIfCriminalAvailable[0]['state'] != '')
                    {
                        $address .= $getIfCriminalAvailable[0]['state'];
                    }
                    if($getIfCriminalAvailable[0]['district'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfCriminalAvailable[0]['district'];
                        }else{
                            $address .= $getIfCriminalAvailable[0]['district'];
                        }
                    }
                    if($getIfCriminalAvailable[0]['city'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfCriminalAvailable[0]['city'];
                        }else{
                            $address .= $getIfCriminalAvailable[0]['city'];
                        }
                    }
                    $getPhotos = $this->db->query('select * from criminalphotos where crimeId='.$getIfCriminalAvailable[0]['Id'])->result_array();
                    if($userphoto == '' || $userphoto == base_url())
                    {
                        $userphoto = ((count($getPhotos) > 0) ? base_url().''.$getPhotos[0]['photourl'] : base_url().''.$getIfCriminalAvailable[0]['photo']);   
                    }
                }
                foreach($getIfCriminalAvailable as $k=>$v)
                {
                    array_push($criminalId,$v['Id']);
                }
            }
            if(count($getIfPersonAvailable) > 0)
            {
                $getMissingPerson = $this->db->query('select * from missingperson where missingaadhar="'.$getIfPersonAvailable[0]['aadhar_id'].'" and isFound != 1')->result_array();   
            }else{
                $getMissingPerson = array();
            }
            if(count($getMissingPerson) > 0)
            {
                $isVisible = 1;
                $isAadharCorrect = 1;
                if($getMissingPerson[0]['missinggender'] != NULL)
                {
                    $isMissing = 1;
                    if($isUserFound != 1)
                    {
                        $personName = $getMissingPerson[0]['missingname'];
                        $gender = $getMissingPerson[0]['missinggender'];
                        $aadhar = $getMissingPerson[0]['missingaadhar'];
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getMissingPerson[0]['missingdob']);
                        $age = ($from->diff($to)->y);
                        if(count($getIfPersonAvailable) > 0)
                        {
                            $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                        }else{
                            $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                        }
                        if(count($getIfPersonAvailable) == 0)
                        {
                            if($userphoto == '' || $userphoto == base_url())
                            {
                                $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : '');
                            }
                        }
                    }
                }else{
                    $getFullDetail = $this->db->query('select * from missingpersondetail where missingId='.$getMissingPerson[0]['Id'])->result_array();
                    if(count($getFullDetail) > 0)
                    {
                        $isMissing = 1; 
                        if($isUserFound != 1)
                        {
                            $personName = $getMissingPerson[0]['missingname'];
                            $gender = $getMissingPerson[0]['missinggender'];
                            $aadhar = $getMissingPerson[0]['missingaadhar'];
                            $from=new DateTime(date('Y-m-d'));
                            $to   = new DateTime($getMissingPerson[0]['missingdob']);
                            $age = ($from->diff($to)->y);
                            if(count($getIfPersonAvailable) > 0)
                            {
                                $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                            }else{
                                $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                            }
                            if(count($getIfPersonAvailable) == 0)
                            {
                                if($userphoto == '' || $userphoto == base_url())
                                {
                                    $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : '');
                                }
                            }
                        }
                    }else{
                        $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$getIfPersonAvailable[0]['aadhar_id'].'"')->result_array();
                        if(count($getUserDetail) > 0)
                        {
                            $isMissing = 1; 
                            if($isUserFound != 1)
                            {
                                $personName = $getUserDetail[0]['aadharname'];
                                $gender = $getUserDetail[0]['gender'];
                                $aadhar = $getUserDetail[0]['aadhar_id'];
                                $from=new DateTime(date('Y-m-d'));
                                $to   = new DateTime($getUserDetail[0]['dob']);
                                $age = ($from->diff($to)->y);
                                $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                if(count($getIfPersonAvailable) == 0)
                                {
                                    if($userphoto == '' || $userphoto == base_url())
                                    {
                                        $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : '');
                                    }
                                }
                            }
                        }
                    }
                }
            }
            $getIfLapataAvailable = $this->db->query('select * from unknown_person where isFinalSubmitted=1 and awsEventName="All" and isFound=0 and DL_no="'.$_POST['idNumber'].'" and expiryDate >= "'.date('Y-m-d h:i:s').'"')->result_array();
            if(count($getIfLapataAvailable) > 0)
            {
                $isAadharCorrect = 1;
                $isVisible = 1;
                $isLapata = 1;
                $lapataId = $getIfLapataAvailable[0]['id'];
                $isMissing = 0;
                $missingId = 0;
                if(!$isUserFound)
                {
                    $isVerified = 0;
                    $personName = $getIfLapataAvailable[0]['person_name'];
                    $gender = ($getIfLapataAvailable[0]['Gender'] == 'boy' ? 'MALE' : 'FEMALE');
                    $aadhar = $getIfLapataAvailable[0]['aadharNumber'];
                    $age = ($getIfLapataAvailable[0]['Age']);
                    $address = $getIfLapataAvailable[0]['city'].','.$getIfLapataAvailable[0]['state'];
                    $userphoto = base_url().''.(($getIfLapataAvailable[0]['Photo'] != NULL) ? $getIfLapataAvailable[0]['Photo'] : $userphoto);
                }
            }
            if($this->getSettings('generalNotification') == 'true')
            {
                if($personId != '')
                {
                    $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$personId);
                    $query_res = $query->result_array();
                    
                    if(count($query_res) > 0)
                    {
                        foreach ($query_res as $query_res_data) {
                            $registrationIds[] =$query_res_data['token'];
                        }
                        
                        $url ="https://fcm.googleapis.com/fcm/send";
                        $fields=array(
                            "registration_ids"=>$registrationIds,
                            'data' => array("msg"=>"Khoji"),
                            'priority' => 'high',
                            "click_action"=>base_url(),
                            "notification"=>array(
                                "body"=>"One Person has searched you",
                                "title"=>"Khoji",
                            )   
                        );
                        $headers=array(
                            'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                            'Content-Type:application/json'
                        );
                        $ch=curl_init();
                        curl_setopt($ch,CURLOPT_URL,$url);
                        curl_setopt($ch,CURLOPT_POST,true);
                        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                        curl_exec($ch);
                    }
                }   
            }
            if($isLapata != 1)
            {
                $getIfUnknownAvailable = $this->db->query('select * from unknown_person where isFinalSubmitted=1 and awsEventName !="All" and isFound=0 and DL_no="'.$_POST['idNumber'].'" order by id desc')->result_array();
                // $getIfUnknownAvailable = array();
                if(count($getIfUnknownAvailable) > 0)
                {
                    $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$getIfUnknownAvailable[0]['id'])->result_array();
                    if($getApplicationNumber[0]['isKyc'] == 1)
                    {
                        $notifyData = array(
                            'isLogin' => 0,
                            'dateCreated' => date('Y-m-d H:i:s'),
                            'mobileNumber' => $_SESSION['landingMob'],
                            'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                            'searchType' => 'Unknown',
                            'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                            'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                            'isIdentity' => 1,
                            'identityType' => 'dl',
                            'identityNumber' => $_POST['idNumber']
                        );
                        $insert = $this->db->insert('searchnotification',$notifyData);
                        if($getApplicationNumber[0]['uploaded_by'] == 'user')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else{
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }
                    }else{
                        $notifyData = array(
                            'isLogin' => 0,
                            'dateCreated' => date('Y-m-d H:i:s'),
                            'mobileNumber' => $_SESSION['landingMob'],
                            'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                            'searchType' => 'Unknown',
                            'complainantUserType' => 'NonKyc',
                            'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                            'isIdentity' => 1,
                            'identityType' => 'dl',
                            'identityNumber' => $_POST['idNumber']
                        );
                        $insert = $this->db->insert('searchnotification',$notifyData);
                        if($getApplicationNumber[0]['uploaded_by'] == 'user')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else{
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }
                    }
                    if($isUserFound != 1)
                    {
                        if($getIfUnknownAvailable[0]['uploaded_by'] == 'police')
                        {
                            $getPoliceDetail = $this->db->query('select * from police where police_id='.$getIfUnknownAvailable[0]['policeId'])->result_array();
                            $finalresponse = array(
                                'isUserFound' => $isUserFound,
                                'status' => 'unknown',
                                'isLapata' => $isLapata,
                                'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                'type' => 'police',
                                'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                'address' => strtoupper($getPoliceDetail[0]['thanaName'].' - '.$getPoliceDetail[0]['state'].', '.$getPoliceDetail[0]['district']),
                                'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                'age' => $getIfUnknownAvailable[0]['Age'],
                                'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                'id' => $getIfUnknownAvailable[0]['Application_no'],
                                'registration_mobile' => (($getPoliceDetail[0]['registration_mobile'] != NULL) ? $getPoliceDetail[0]['registration_mobile'] : ''),
                                'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                            );   
                        }
                        else
                        {
                            if($getIfUnknownAvailable[0]['uploaded_by']=='user')
                            {
                                $getUserDetail = $this->db->query('select * from user where uid='.$getIfUnknownAvailable[0]['userId'])->result_array();
                                $finalresponse = array(
                                    'status' => 'unknown',
                                    'isUserFound' => $isUserFound,
                                    'isLapata' => $isLapata,
                                    'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                    'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                    'type' => 'ngo',
                                    'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                    'address' => strtoupper($getUserDetail[0]['vtc'].' - '.$getUserDetail[0]['state'].', '.$getUserDetail[0]['district']),
                                    'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                    'age' => $getIfUnknownAvailable[0]['Age'],
                                    'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                    'registration_mobile' => (($getUserDetail[0]['registration_mobile'] != NULL) ? $getUserDetail[0]['registration_mobile'] : ''),
                                    'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                    'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                    'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                                    'id' => $getIfUnknownAvailable[0]['Application_no']
                                );   
                            }
                            else
                            {
                                $getNgoDetail = $this->db->query('select * from ngo where Id='.$getIfUnknownAvailable[0]['ngoId'])->result_array();
                                $finalresponse = array(
                                    'status' => 'unknown',
                                    'isUserFound' => $isUserFound,
                                    'isLapata' => $isLapata,
                                    'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                    'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                    'type' => 'ngo',
                                    'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                    'address' => strtoupper($getNgoDetail[0]['ngoName'].' - '.$getNgoDetail[0]['ngoState'].', '.$getNgoDetail[0]['ngoDistrict'].', '.$getNgoDetail[0]['ngoCity']),
                                    'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                    'age' => $getIfUnknownAvailable[0]['Age'],
                                    'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                    'registration_mobile' => (($getNgoDetail[0]['ngoRegistrationNumber'] != NULL) ? $getNgoDetail[0]['ngoRegistrationNumber'] : ''),
                                    'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                    'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                    'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                                    'id' => $getIfUnknownAvailable[0]['Application_no']
                                );  
                            }
                             
                        }
                    }else{
                        $finalresponse = array(
                            'isUserFound' => $isUserFound,
                            'status' => 'unknown',
                            'isLapata' => $isLapata,
                            'personName' => strtoupper($personName),
                            'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                            'address' => strtoupper($address),
                            'photo' => ($userphoto != '' ? $userphoto : base_url().$getIfUnknownAvailable[0]['Photo']),
                            'age' => $age,
                            'gender' => strtolower($gender),
                            'id' => $getIfUnknownAvailable[0]['Application_no']
                        );
                    }
                    $insertdata = array(
                        'lapataId' => $lapataId,
                        'isLapata' => $isLapata,
                        'wantedIds' => implode(',',$wantedId),
                        'criminalIds' => implode(',',$criminalId),
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'idNumber' => $_POST['idNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    echo json_encode($finalresponse);
                }else{
                    $insertdata = array(
                        'lapataId' => $lapataId,
                        'isLapata' => $isLapata,
                        'wantedIds' => implode(',',$wantedId),
                        'criminalIds' => implode(',',$criminalId),
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'idNumber' => $_POST['idNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    if($update)
                    {
                        if($isAadharCorrect == 1)
                        {
                            $isOnlyUser = 0;
                            if(!$isWanted && !$isLapata && !$isCriminal && !$isMissing)
                            {
                                $isOnlyUser = 1;
                            }
                            $response = array(
                                'personId' => $personId,
                                'isOnlyUser' => $isOnlyUser,
                                'status' => 'success',
                                'personName' => $personName,
                                'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                                'gender' => strtolower($gender),
                                'isWanted' => $isWanted,
                                'isLapata' => $isLapata,
                                'isCriminal' => $isCriminal,
                                'age' => $age,
                                'address' => $address,
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => 1,
                                'isGenderCorrect' => 1,
                                'message' => 'Person Found',
                                'isVisible' => $isVisible,
                                'isMissing' => $isMissing,
                                'isVerified' => $isVerified,
                                'isRegistered' => $isUserFound,
                                'image' => ($userphoto != '' ? $userphoto : base_url().'assets/img/noimage.jpg')
                            );
                            echo json_encode($response);   
                        }else{
                            $response = array(
                                'status' => 'incorrect',
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => 1,
                                'isGenderCorrect' => 1,
                            );
                            echo json_encode($response);   
                        }
                    }else{
                        $response = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                        echo json_encode($response);
                    }
                }   
            }else{
                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$lapataId)->result_array();
                if($getApplicationNumber[0]['isKyc'] == 1)
                {
                    $notifyData = array(
                        'isLogin' => 0,
                        'dateCreated' => date('Y-m-d H:i:s'),
                        'mobileNumber' => $_SESSION['landingMob'],
                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                        'searchType' => 'Lapata',
                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                        'isIdentity' => 1,
                        'identityType' => 'dl',
                        'identityNumber' => $_POST['idNumber']
                    );
                    $insert = $this->db->insert('searchnotification',$notifyData);
                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else{
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }
                }else{
                    $notifyData = array(
                        'isLogin' => 0,
                        'dateCreated' => date('Y-m-d H:i:s'),
                        'mobileNumber' => $_SESSION['landingMob'],
                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                        'searchType' => 'Lapata',
                        'complainantUserType' => 'NonKyc',
                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                        'isIdentity' => 1,
                        'identityType' => 'dl',
                        'identityNumber' => $_POST['idNumber']
                    );
                    $insert = $this->db->insert('searchnotification',$notifyData);
                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else{
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }
                }
                $insertdata = array(
                'lapataId' => $lapataId,
                'isLapata' => $isLapata,
                'wantedIds' => implode(',',$wantedId),
                'criminalIds' => implode(',',$criminalId),
                'isPersonFound' => $isUserFound,
                'isMissing' => $isMissing,
                'idNumber' => $_POST['idNumber'],
                'idType' => $_POST['idType'],
            );
            $this->db->where('Id',$_SESSION['checkId']);
            $update = $this->db->update('checkperson',$insertdata);
            if($update)
            {
                if($isAadharCorrect == 1)
                {
                    $isOnlyUser = 0;
                    if(!$isWanted && !$isLapata && !$isCriminal && !$isMissing)
                    {
                        $isOnlyUser = 1;
                    }
                    $response = array(
                        'personId' => $personId,
                        'isOnlyUser' => $isOnlyUser,
                        'status' => 'success',
                        'personName' => $personName,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'isWanted' => $isWanted,
                        'isLapata' => $isLapata,
                        'isCriminal' => $isCriminal,
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => 1,
                        'isGenderCorrect' => 1,
                        'message' => 'Person Found',
                        'isVisible' => $isVisible,
                        'isMissing' => $isMissing,
                        'isVerified' => $isVerified,
                        'isRegistered' => $isUserFound,
                        'image' => ($userphoto != '' ? $userphoto : base_url().'assets/img/noimage.jpg')
                    );
                    echo json_encode($response);   
                }else{
                    $response = array(
                        'status' => 'incorrect',
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => 1,
                        'isGenderCorrect' => 1,
                    );
                    echo json_encode($response);   
                }
            }else{
                $response = array(
                    'status' => 'error',
                    'message' => 'Something Went Wrong'
                );
                echo json_encode($response);
            }   
            }
        }
        if($_POST['idType'] == 'voter')
        {
            $idNumber = $_POST['idNumber'];
            $getIfAlready = $this->db->query('select * from voterslist where voterNumber="'.$idNumber.'"')->result_array();
            if(count($getIfAlready) > 0)
            {
                $getIfPersonAvailable = $this->db->query('select * from user where uid='.$getIfAlready[0]['userId'])->result_array();   
            }else{
                $getIfPersonAvailable = array();
            }
            $userphoto = '';
            if(count($getIfPersonAvailable) > 0)
            {
                $personId = $getIfPersonAvailable[0]['uid'];
                $isAadharCorrect = 1;
                $isVisible = $getIfPersonAvailable[0]['visibility'];
                $isVerified = 1;
                $isUserFound = 1;
                $personName = $getIfPersonAvailable[0]['aadharname'];
                $gender = $getIfPersonAvailable[0]['gender'];
                $aadhar = $getIfPersonAvailable[0]['aadhar_id'];
                $from=new DateTime(date('Y-m-d'));
                $to   = new DateTime($getIfPersonAvailable[0]['dob']);
                $age = ($from->diff($to)->y);
                $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                $userphoto = base_url().''.(($getIfPersonAvailable[0]['aadharphoto'] != NULL) ? $getIfPersonAvailable[0]['aadharphoto'] : $getIfPersonAvailable[0]['facematchphoto']);
            }
            if(count($getIfPersonAvailable) > 0)
            {
                $getIfWantedAvailable = $this->db->query('select * from criminals where aadharNumber="'.$getIfPersonAvailable[0]['aadhar_id'].'" and isFinalSubmitted=1 and type="wanted" and status="Active"')->result_array();   
            }else{
                $getIfWantedAvailable = array();
            }
            if(count($getIfWantedAvailable) > 0)
            {
                $isVisible = 1;
                $isAadharCorrect = 1;
                $isWanted = 1;
                if($isUserFound != 1)
                {
                    $personName = $getIfWantedAvailable[0]['personName'];
                    $gender = $getIfWantedAvailable[0]['gender'];
                    $aadhar = $getIfWantedAvailable[0]['aadharNumber'];
                    if($getIfWantedAvailable[0]['dob'] != '0000-00-00')
                    {
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfWantedAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                    }else{
                        $age = '';
                    }
                    $address = '';
                    if($getIfWantedAvailable[0]['state'] != '')
                    {
                        $address .= $getIfWantedAvailable[0]['state'];
                    }
                    if($getIfWantedAvailable[0]['district'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfWantedAvailable[0]['district'];
                        }else{
                            $address .= $getIfWantedAvailable[0]['district'];
                        }
                    }
                    if($getIfWantedAvailable[0]['city'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfWantedAvailable[0]['city'];
                        }else{
                            $address .= $getIfWantedAvailable[0]['city'];
                        }
                    }
                    $getPhotos = $this->db->query('select * from criminalphotos where crimeId='.$getIfWantedAvailable[0]['Id'])->result_array();
                    if($userphoto == '' || $userphoto == base_url())
                    {
                        $userphoto = ((count($getPhotos) > 0) ? base_url().''.$getPhotos[0]['photourl'] : base_url().''.$getIfWantedAvailable[0]['photo']);   
                    }
                }
                foreach($getIfWantedAvailable as $k=>$v)
                {
                    array_push($wantedId,$v['Id']);
                }
            }
            if(count($getIfPersonAvailable) > 0)
            {
                $getIfCriminalAvailable = $this->db->query('select * from criminals where aadharNumber="'.$getIfPersonAvailable[0]['aadhar_id'].'" and isFinalSubmitted=1 and type="criminal" and status="Active"')->result_array();   
            }else{
                $getIfCriminalAvailable = array();
            }
            if(count($getIfCriminalAvailable) > 0)
            {
                $isVisible = 1;
                $isAadharCorrect = 1;
                $isCriminal = 1;
                if($isUserFound != 1)
                {
                    $personName = $getIfCriminalAvailable[0]['personName'];
                    $gender = $getIfCriminalAvailable[0]['gender'];
                    $aadhar = $getIfCriminalAvailable[0]['aadharNumber'];
                    if($getIfCriminalAvailable[0]['dob'] != '0000-00-00')
                    {
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfCriminalAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                    }else{
                        $age = '';
                    }
                    $address = '';
                    if($getIfCriminalAvailable[0]['state'] != '')
                    {
                        $address .= $getIfCriminalAvailable[0]['state'];
                    }
                    if($getIfCriminalAvailable[0]['district'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfCriminalAvailable[0]['district'];
                        }else{
                            $address .= $getIfCriminalAvailable[0]['district'];
                        }
                    }
                    if($getIfCriminalAvailable[0]['city'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfCriminalAvailable[0]['city'];
                        }else{
                            $address .= $getIfCriminalAvailable[0]['city'];
                        }
                    }
                    $getPhotos = $this->db->query('select * from criminalphotos where crimeId='.$getIfCriminalAvailable[0]['Id'])->result_array();
                    if($userphoto == '' || $userphoto == base_url())
                    {
                        $userphoto = ((count($getPhotos) > 0) ? base_url().''.$getPhotos[0]['photourl'] : base_url().''.$getIfCriminalAvailable[0]['photo']);   
                    }
                }
                foreach($getIfCriminalAvailable as $k=>$v)
                {
                    array_push($criminalId,$v['Id']);
                }
            }
            if(count($getIfPersonAvailable) > 0)
            {
                $getMissingPerson = $this->db->query('select * from missingperson where missingaadhar="'.$getIfPersonAvailable[0]['aadhar_id'].'" and isFound != 1')->result_array();   
            }else{
                $getMissingPerson = array();
            }
            if(count($getMissingPerson) > 0)
            {
                $isVisible = 1;
                $isAadharCorrect = 1;
                if($getMissingPerson[0]['missinggender'] != NULL)
                {
                    $isMissing = 1;
                    if($isUserFound != 1)
                    {
                        $personName = $getMissingPerson[0]['missingname'];
                        $gender = $getMissingPerson[0]['missinggender'];
                        $aadhar = $getMissingPerson[0]['missingaadhar'];
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getMissingPerson[0]['missingdob']);
                        $age = ($from->diff($to)->y);
                        if(count($getIfPersonAvailable) > 0)
                        {
                            $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                        }else{
                            $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                        }
                        if(count($getIfPersonAvailable) == 0)
                        {
                            if($userphoto == '' || $userphoto == base_url())
                            {
                                $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : '');
                            }
                        }
                    }
                }else{
                    $getFullDetail = $this->db->query('select * from missingpersondetail where missingId='.$getMissingPerson[0]['Id'])->result_array();
                    if(count($getFullDetail) > 0)
                    {
                        $isMissing = 1; 
                        if($isUserFound != 1)
                        {
                            $personName = $getMissingPerson[0]['missingname'];
                            $gender = $getMissingPerson[0]['missinggender'];
                            $aadhar = $getMissingPerson[0]['missingaadhar'];
                            $from=new DateTime(date('Y-m-d'));
                            $to   = new DateTime($getMissingPerson[0]['missingdob']);
                            $age = ($from->diff($to)->y);
                            if(count($getIfPersonAvailable) > 0)
                            {
                                $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                            }else{
                                $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                            }
                            if(count($getIfPersonAvailable) == 0)
                            {
                                if($userphoto == '' || $userphoto == base_url())
                                {
                                    $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : '');
                                }
                            }
                        }
                    }else{
                        $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$getIfPersonAvailable[0]['aadhar_id'].'"')->result_array();
                        if(count($getUserDetail) > 0)
                        {
                            $isMissing = 1; 
                            if($isUserFound != 1)
                            {
                                $personName = $getUserDetail[0]['aadharname'];
                                $gender = $getUserDetail[0]['gender'];
                                $aadhar = $getUserDetail[0]['aadhar_id'];
                                $from=new DateTime(date('Y-m-d'));
                                $to   = new DateTime($getUserDetail[0]['dob']);
                                $age = ($from->diff($to)->y);
                                $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                if(count($getIfPersonAvailable) == 0)
                                {
                                    if($userphoto == '' || $userphoto == base_url())
                                    {
                                        $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : '');
                                    }
                                }
                            }
                        }
                    }
                }
            }
            $getIfLapataAvailable = $this->db->query('select * from unknown_person where isFinalSubmitted=1 and awsEventName="All" and isFound=0 and voter_id="'.$_POST['idNumber'].'" and expiryDate >= "'.date('Y-m-d h:i:s').'"')->result_array();
            if(count($getIfLapataAvailable) > 0)
            {
                $isAadharCorrect = 1;
                $isVisible = 1;
                $isLapata = 1;
                $lapataId = $getIfLapataAvailable[0]['id'];
                $isMissing = 0;
                $missingId = 0;
                if(!$isUserFound)
                {
                    $isVerified = 0;
                    $personName = $getIfLapataAvailable[0]['person_name'];
                    $gender = ($getIfLapataAvailable[0]['Gender'] == 'boy' ? 'MALE' : 'FEMALE');
                    $aadhar = $getIfLapataAvailable[0]['aadharNumber'];
                    $age = ($getIfLapataAvailable[0]['Age']);
                    $address = $getIfLapataAvailable[0]['city'].','.$getIfLapataAvailable[0]['state'];
                    $userphoto = base_url().''.(($getIfLapataAvailable[0]['Photo'] != NULL) ? $getIfLapataAvailable[0]['Photo'] : $userphoto);
                }
            }
            if($this->getSettings('generalNotification') == 'true')
            {
                if($personId != '')
                {
                    $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$personId);
                    $query_res = $query->result_array();
                    
                    if(count($query_res) > 0)
                    {
                        foreach ($query_res as $query_res_data) {
                            $registrationIds[] =$query_res_data['token'];
                        }
                        
                        $url ="https://fcm.googleapis.com/fcm/send";
                        $fields=array(
                            "registration_ids"=>$registrationIds,
                            'data' => array("msg"=>"Khoji"),
                            'priority' => 'high',
                            "click_action"=>base_url(),
                            "notification"=>array(
                                "body"=>"One Person has searched you",
                                "title"=>"Khoji",
                            )   
                        );
                        $headers=array(
                            'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                            'Content-Type:application/json'
                        );
                        $ch=curl_init();
                        curl_setopt($ch,CURLOPT_URL,$url);
                        curl_setopt($ch,CURLOPT_POST,true);
                        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                        curl_exec($ch);
                    }
                }   
            }
            if($isLapata != 1)
            {
                $getIfUnknownAvailable = $this->db->query('select * from unknown_person where isFinalSubmitted=1 and awsEventName !="All" and isFound=0 and voter_id="'.$_POST['idNumber'].'" order by id desc')->result_array();
                // $getIfUnknownAvailable = array();
                if(count($getIfUnknownAvailable) > 0)
                {
                    $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$getIfUnknownAvailable[0]['id'])->result_array();
                    if($getApplicationNumber[0]['isKyc'] == 1)
                    {
                        $notifyData = array(
                            'isLogin' => 0,
                            'dateCreated' => date('Y-m-d H:i:s'),
                            'mobileNumber' => $_SESSION['landingMob'],
                            'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                            'searchType' => 'Unknown',
                            'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                            'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                            'isIdentity' => 1,
                            'identityType' => 'voter',
                            'identityNumber' => $_POST['idNumber']
                        );
                        $insert = $this->db->insert('searchnotification',$notifyData);
                        if($getApplicationNumber[0]['uploaded_by'] == 'user')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else{
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }
                    }else{
                        $notifyData = array(
                            'isLogin' => 0,
                            'dateCreated' => date('Y-m-d H:i:s'),
                            'mobileNumber' => $_SESSION['landingMob'],
                            'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                            'searchType' => 'Unknown',
                            'complainantUserType' => 'NonKyc',
                            'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                            'isIdentity' => 1,
                            'identityType' => 'voter',
                            'identityNumber' => $_POST['idNumber']
                        );
                        $insert = $this->db->insert('searchnotification',$notifyData);
                        if($getApplicationNumber[0]['uploaded_by'] == 'user')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else{
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }
                    }
                    if($isUserFound != 1)
                    {
                        if($getIfUnknownAvailable[0]['uploaded_by'] == 'police')
                        {
                            $getPoliceDetail = $this->db->query('select * from police where police_id='.$getIfUnknownAvailable[0]['policeId'])->result_array();
                            $finalresponse = array(
                                'status' => 'unknown',
                                'isLapata' => $isLapata,
                                'isUserFound' => $isUserFound,
                                'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                'type' => 'police',
                                'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                'address' => strtoupper($getPoliceDetail[0]['thanaName'].' - '.$getPoliceDetail[0]['state'].', '.$getPoliceDetail[0]['district']),
                                'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                'age' => $getIfUnknownAvailable[0]['Age'],
                                'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                'id' => $getIfUnknownAvailable[0]['Application_no'],
                                'registration_mobile' => (($getPoliceDetail[0]['registration_mobile'] != NULL) ? $getPoliceDetail[0]['registration_mobile'] : ''),
                                'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                            );   
                        }
                        else
                        {
                            if($getIfUnknownAvailable[0]['uploaded_by']=='user')
                            {
                                $getUserDetail = $this->db->query('select * from user where uid='.$getIfUnknownAvailable[0]['userId'])->result_array();
                                $finalresponse = array(
                                    'status' => 'unknown',
                                    'isUserFound' => $isUserFound,
                                    'isLapata' => $isLapata,
                                    'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                    'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                    'type' => 'ngo',
                                    'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                    'address' => strtoupper($getUserDetail[0]['vtc'].' - '.$getUserDetail[0]['state'].', '.$getUserDetail[0]['district']),
                                    'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                    'age' => $getIfUnknownAvailable[0]['Age'],
                                    'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                    'registration_mobile' => (($getUserDetail[0]['registration_mobile'] != NULL) ? $getUserDetail[0]['registration_mobile'] : ''),
                                    'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                    'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                    'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                                    'id' => $getIfUnknownAvailable[0]['Application_no']
                                );   
                            }
                            else
                            {
                                $getNgoDetail = $this->db->query('select * from ngo where Id='.$getIfUnknownAvailable[0]['ngoId'])->result_array();
                                $finalresponse = array(
                                    'status' => 'unknown',
                                    'isLapata' => $isLapata,
                                    'isUserFound' => $isUserFound,
                                    'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                    'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                    'type' => 'ngo',
                                    'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                    'address' => strtoupper($getNgoDetail[0]['ngoName'].' - '.$getNgoDetail[0]['ngoState'].', '.$getNgoDetail[0]['ngoDistrict'].', '.$getNgoDetail[0]['ngoCity']),
                                    'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                    'age' => $getIfUnknownAvailable[0]['Age'],
                                    'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                    'registration_mobile' => (($getNgoDetail[0]['ngoRegistrationNumber'] != NULL) ? $getNgoDetail[0]['ngoRegistrationNumber'] : ''),
                                    'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                    'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                    'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                                    'id' => $getIfUnknownAvailable[0]['Application_no']
                                ); 
                            }  
                        }
                    }else{
                        $finalresponse = array(
                            'isUserFound' => $isUserFound,
                            'status' => 'unknown',
                            'isLapata' => $isLapata,
                            'personName' => strtoupper($personName),
                            'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                            'address' => strtoupper($address),
                            'photo' => ($userphoto != '' ? $userphoto : base_url().$getIfUnknownAvailable[0]['Photo']),
                            'age' => $age,
                            'gender' => strtolower($gender),
                            'id' => $getIfUnknownAvailable[0]['Application_no']
                        );
                    }
                    $insertdata = array(
                        'lapataId' => $lapataId,
                        'isLapata' => $isLapata,
                        'wantedIds' => implode(',',$wantedId),
                        'criminalIds' => implode(',',$criminalId),
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'idNumber' => $_POST['idNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    echo json_encode($finalresponse);
                }else{
                    $insertdata = array(
                        'lapataId' => $lapataId,
                        'isLapata' => $isLapata,
                        'wantedIds' => implode(',',$wantedId),
                        'criminalIds' => implode(',',$criminalId),
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'idNumber' => $_POST['idNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    if($update)
                    {
                        if($isAadharCorrect == 1)
                        {
                            $isOnlyUser = 0;
                            if(!$isWanted && !$isLapata && !$isCriminal && !$isMissing)
                            {
                                $isOnlyUser = 1;
                            }
                            $response = array(
                                'personId' => $personId,
                                'isOnlyUser' => $isOnlyUser,
                                'status' => 'success',
                                'personName' => $personName,
                                'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                                'gender' => strtolower($gender),
                                'isWanted' => $isWanted,
                                'isLapata' => $isLapata,
                                'isCriminal' => $isCriminal,
                                'age' => $age,
                                'address' => $address,
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => 1,
                                'isGenderCorrect' => 1,
                                'message' => 'Person Found',
                                'isVisible' => $isVisible,
                                'isMissing' => $isMissing,
                                'isVerified' => $isVerified,
                                'isRegistered' => $isUserFound,
                                'image' => ($userphoto != '' ? $userphoto : base_url().'assets/img/noimage.jpg')
                            );
                            echo json_encode($response);   
                        }else{
                            $response = array(
                                'status' => 'incorrect',
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => 1,
                                'isGenderCorrect' => 1,
                            );
                            echo json_encode($response);   
                        }
                    }else{
                        $response = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                        echo json_encode($response);
                    }
                }   
            }else{
                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$lapataId)->result_array();
                if($getApplicationNumber[0]['isKyc'] == 1)
                {
                    $notifyData = array(
                        'isLogin' => 0,
                        'dateCreated' => date('Y-m-d H:i:s'),
                        'mobileNumber' => $_SESSION['landingMob'],
                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                        'searchType' => 'Lapata',
                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                        'isIdentity' => 1,
                        'identityType' => 'voter',
                        'identityNumber' => $_POST['idNumber']
                    );
                    $insert = $this->db->insert('searchnotification',$notifyData);
                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else{
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }
                }else{
                    $notifyData = array(
                        'isLogin' => 0,
                        'dateCreated' => date('Y-m-d H:i:s'),
                        'mobileNumber' => $_SESSION['landingMob'],
                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                        'searchType' => 'Lapata',
                        'complainantUserType' => 'NonKyc',
                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                        'isIdentity' => 1,
                        'identityType' => 'voter',
                        'identityNumber' => $_POST['idNumber']
                    );
                    $insert = $this->db->insert('searchnotification',$notifyData);
                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else{
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }
                }
                $insertdata = array(
                'lapataId' => $lapataId,
                'isLapata' => $isLapata,
                'wantedIds' => implode(',',$wantedId),
                'criminalIds' => implode(',',$criminalId),
                'isPersonFound' => $isUserFound,
                'isMissing' => $isMissing,
                'idNumber' => $_POST['idNumber'],
                'idType' => $_POST['idType'],
            );
            $this->db->where('Id',$_SESSION['checkId']);
            $update = $this->db->update('checkperson',$insertdata);
            if($update)
            {
                if($isAadharCorrect == 1)
                {
                    $isOnlyUser = 0;
                    if(!$isWanted && !$isLapata && !$isCriminal && !$isMissing)
                    {
                        $isOnlyUser = 1;
                    }
                    $response = array(
                        'personId' => $personId,
                        'status' => 'success',
                        'isOnlyUser' => $isOnlyUser,
                        'personName' => $personName,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'isWanted' => $isWanted,
                        'isLapata' => $isLapata,
                        'isCriminal' => $isCriminal,
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => 1,
                        'isGenderCorrect' => 1,
                        'message' => 'Person Found',
                        'isVisible' => $isVisible,
                        'isMissing' => $isMissing,
                        'isVerified' => $isVerified,
                        'isRegistered' => $isUserFound,
                        'image' => ($userphoto != '' ? $userphoto : base_url().'assets/img/noimage.jpg')
                    );
                    echo json_encode($response);   
                }else{
                    $response = array(
                        'status' => 'incorrect',
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => 1,
                        'isGenderCorrect' => 1,
                    );
                    echo json_encode($response);   
                }
            }else{
                $response = array(
                    'status' => 'error',
                    'message' => 'Something Went Wrong'
                );
                echo json_encode($response);
            }   
            }
        }
        if($_POST['idType'] == 'pan')
        {
            $idNumber = $_POST['idNumber'];
            $getIfAlready = $this->db->query('select * from panlist where panNumber="'.$idNumber.'"')->result_array();
            if(count($getIfAlready) > 0)
            {
                $getIfPersonAvailable = $this->db->query('select * from user where uid='.$getIfAlready[0]['userId'])->result_array();   
            }else{
                $getIfPersonAvailable = array();
            }
            $userphoto = '';
            if(count($getIfPersonAvailable) > 0)
            {
                $personId = $getIfPersonAvailable[0]['uid'];
                $isAadharCorrect = 1;
                $isVisible = $getIfPersonAvailable[0]['visibility'];
                $isVerified = 1;
                $isUserFound = 1;
                $personName = $getIfPersonAvailable[0]['aadharname'];
                $gender = $getIfPersonAvailable[0]['gender'];
                $aadhar = $getIfPersonAvailable[0]['aadhar_id'];
                $from=new DateTime(date('Y-m-d'));
                $to   = new DateTime($getIfPersonAvailable[0]['dob']);
                $age = ($from->diff($to)->y);
                $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                $userphoto = base_url().''.(($getIfPersonAvailable[0]['aadharphoto'] != NULL) ? $getIfPersonAvailable[0]['aadharphoto'] : $getIfPersonAvailable[0]['facematchphoto']);
            }
            if(count($getIfPersonAvailable) > 0)
            {
                $getIfWantedAvailable = $this->db->query('select * from criminals where aadharNumber="'.$getIfPersonAvailable[0]['aadhar_id'].'" and isFinalSubmitted=1 and type="wanted" and status="Active"')->result_array();   
            }else{
                $getIfWantedAvailable = array();
            }
            if(count($getIfWantedAvailable) > 0)
            {
                $isVisible = 1;
                $isAadharCorrect = 1;
                $isWanted = 1;
                if($isUserFound != 1)
                {
                    $personName = $getIfWantedAvailable[0]['personName'];
                    $gender = $getIfWantedAvailable[0]['gender'];
                    $aadhar = $getIfWantedAvailable[0]['aadharNumber'];
                    if($getIfWantedAvailable[0]['dob'] != '0000-00-00')
                    {
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfWantedAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                    }else{
                        $age = '';
                    }
                    $address = '';
                    if($getIfWantedAvailable[0]['state'] != '')
                    {
                        $address .= $getIfWantedAvailable[0]['state'];
                    }
                    if($getIfWantedAvailable[0]['district'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfWantedAvailable[0]['district'];
                        }else{
                            $address .= $getIfWantedAvailable[0]['district'];
                        }
                    }
                    if($getIfWantedAvailable[0]['city'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfWantedAvailable[0]['city'];
                        }else{
                            $address .= $getIfWantedAvailable[0]['city'];
                        }
                    }
                    $getPhotos = $this->db->query('select * from criminalphotos where crimeId='.$getIfWantedAvailable[0]['Id'])->result_array();
                    if($userphoto == '' || $userphoto == base_url())
                    {
                        $userphoto = ((count($getPhotos) > 0) ? base_url().''.$getPhotos[0]['photourl'] : base_url().''.$getIfWantedAvailable[0]['photo']);   
                    }
                }
                foreach($getIfWantedAvailable as $k=>$v)
                {
                    array_push($wantedId,$v['Id']);
                }
            }
            if(count($getIfPersonAvailable) > 0)
            {
                $getIfCriminalAvailable = $this->db->query('select * from criminals where aadharNumber="'.$getIfPersonAvailable[0]['aadhar_id'].'" and isFinalSubmitted=1 and type="criminal" and status="Active"')->result_array();   
            }else{
                $getIfCriminalAvailable = array();
            }
            if(count($getIfCriminalAvailable) > 0)
            {
                $isVisible = 1;
                $isAadharCorrect = 1;
                $isCriminal = 1;
                if($isUserFound != 1)
                {
                    $personName = $getIfCriminalAvailable[0]['personName'];
                    $gender = $getIfCriminalAvailable[0]['gender'];
                    $aadhar = $getIfCriminalAvailable[0]['aadharNumber'];
                    if($getIfCriminalAvailable[0]['dob'] != '0000-00-00')
                    {
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfCriminalAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                    }else{
                        $age = '';
                    }
                    $address = '';
                    if($getIfCriminalAvailable[0]['state'] != '')
                    {
                        $address .= $getIfCriminalAvailable[0]['state'];
                    }
                    if($getIfCriminalAvailable[0]['district'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfCriminalAvailable[0]['district'];
                        }else{
                            $address .= $getIfCriminalAvailable[0]['district'];
                        }
                    }
                    if($getIfCriminalAvailable[0]['city'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfCriminalAvailable[0]['city'];
                        }else{
                            $address .= $getIfCriminalAvailable[0]['city'];
                        }
                    }
                    $getPhotos = $this->db->query('select * from criminalphotos where crimeId='.$getIfCriminalAvailable[0]['Id'])->result_array();
                    if($userphoto == '' || $userphoto == base_url())
                    {
                        $userphoto = ((count($getPhotos) > 0) ? base_url().''.$getPhotos[0]['photourl'] : base_url().''.$getIfCriminalAvailable[0]['photo']);   
                    }
                }
                foreach($getIfCriminalAvailable as $k=>$v)
                {
                    array_push($criminalId,$v['Id']);
                }
            }
            if(count($getIfPersonAvailable) > 0)
            {
                $getMissingPerson = $this->db->query('select * from missingperson where missingaadhar="'.$getIfPersonAvailable[0]['aadhar_id'].'" and isFound != 1')->result_array();   
            }else{
                $getMissingPerson = array();
            }
            if(count($getMissingPerson) > 0)
            {
                $isVisible = 1;
                $isAadharCorrect = 1;
                if($getMissingPerson[0]['missinggender'] != NULL)
                {
                    $isMissing = 1;
                    if($isUserFound != 1)
                    {
                        $personName = $getMissingPerson[0]['missingname'];
                        $gender = $getMissingPerson[0]['missinggender'];
                        $aadhar = $getMissingPerson[0]['missingaadhar'];
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getMissingPerson[0]['missingdob']);
                        $age = ($from->diff($to)->y);
                        if(count($getIfPersonAvailable) > 0)
                        {
                            $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                        }else{
                            $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                        }
                        if(count($getIfPersonAvailable) == 0)
                        {
                            if($userphoto == '' || $userphoto == base_url())
                            {
                                $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : '');
                            }
                        }
                    }
                }else{
                    $getFullDetail = $this->db->query('select * from missingpersondetail where missingId='.$getMissingPerson[0]['Id'])->result_array();
                    if(count($getFullDetail) > 0)
                    {
                        $isMissing = 1; 
                        if($isUserFound != 1)
                        {
                            $personName = $getMissingPerson[0]['missingname'];
                            $gender = $getMissingPerson[0]['missinggender'];
                            $aadhar = $getMissingPerson[0]['missingaadhar'];
                            $from=new DateTime(date('Y-m-d'));
                            $to   = new DateTime($getMissingPerson[0]['missingdob']);
                            $age = ($from->diff($to)->y);
                            if(count($getIfPersonAvailable) > 0)
                            {
                                $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                            }else{
                                $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                            }
                            if(count($getIfPersonAvailable) == 0)
                            {
                                if($userphoto == '' || $userphoto == base_url())
                                {
                                    $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : '');
                                }
                            }
                        }
                    }else{
                        $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$getIfPersonAvailable[0]['aadhar_id'].'"')->result_array();
                        if(count($getUserDetail) > 0)
                        {
                            $isMissing = 1; 
                            if($isUserFound != 1)
                            {
                                $personName = $getUserDetail[0]['aadharname'];
                                $gender = $getUserDetail[0]['gender'];
                                $aadhar = $getUserDetail[0]['aadhar_id'];
                                $from=new DateTime(date('Y-m-d'));
                                $to   = new DateTime($getUserDetail[0]['dob']);
                                $age = ($from->diff($to)->y);
                                $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                if(count($getIfPersonAvailable) == 0)
                                {
                                    if($userphoto == '' || $userphoto == base_url())
                                    {
                                        $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : '');
                                    }
                                }
                            }
                        }
                    }
                }
            }
            $getIfLapataAvailable = $this->db->query('select * from unknown_person where isFinalSubmitted=1 and awsEventName="All" and isFound=0 and PAN="'.$_POST['idNumber'].'" and expiryDate >= "'.date('Y-m-d h:i:s').'"')->result_array();
            if(count($getIfLapataAvailable) > 0)
            {
                $isAadharCorrect = 1;
                $isVisible = 1;
                $isLapata = 1;
                $lapataId = $getIfLapataAvailable[0]['id'];
                $isMissing = 0;
                $missingId = 0;
                if(!$isUserFound)
                {
                    $isVerified = 0;
                    $personName = $getIfLapataAvailable[0]['person_name'];
                    $gender = ($getIfLapataAvailable[0]['Gender'] == 'boy' ? 'MALE' : 'FEMALE');
                    $aadhar = $getIfLapataAvailable[0]['aadharNumber'];
                    $age = ($getIfLapataAvailable[0]['Age']);
                    $address = $getIfLapataAvailable[0]['city'].','.$getIfLapataAvailable[0]['state'];
                    $userphoto = base_url().''.(($getIfLapataAvailable[0]['Photo'] != NULL) ? $getIfLapataAvailable[0]['Photo'] : $userphoto);
                }
            }
            if($this->getSettings('generalNotification') == 'true')
            {
                if($personId != '')
                {
                    $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$personId);
                    $query_res = $query->result_array();
                    
                    if(count($query_res) > 0)
                    {
                        foreach ($query_res as $query_res_data) {
                            $registrationIds[] =$query_res_data['token'];
                        }
                        
                        $url ="https://fcm.googleapis.com/fcm/send";
                        $fields=array(
                            "registration_ids"=>$registrationIds,
                            'data' => array("msg"=>"Khoji"),
                            'priority' => 'high',
                            "click_action"=>base_url(),
                            "notification"=>array(
                                "body"=>"One Person has searched you",
                                "title"=>"Khoji",
                            )   
                        );
                        $headers=array(
                            'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                            'Content-Type:application/json'
                        );
                        $ch=curl_init();
                        curl_setopt($ch,CURLOPT_URL,$url);
                        curl_setopt($ch,CURLOPT_POST,true);
                        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                        curl_exec($ch);
                    }
                }   
            }
            if($isLapata != 1)
            {
                $getIfUnknownAvailable = $this->db->query('select * from unknown_person where isFinalSubmitted=1 and awsEventName !="All" and isFound=0 and PAN="'.$_POST['idNumber'].'" order by id desc')->result_array();
                // $getIfUnknownAvailable = array();
                if(count($getIfUnknownAvailable) > 0)
                {
                    $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$getIfUnknownAvailable[0]['id'])->result_array();
                    if($getApplicationNumber[0]['isKyc'] == 1)
                    {
                        $notifyData = array(
                            'isLogin' => 0,
                            'dateCreated' => date('Y-m-d H:i:s'),
                            'mobileNumber' => $_SESSION['landingMob'],
                            'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                            'searchType' => 'Unknown',
                            'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                            'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                            'isIdentity' => 1,
                            'identityType' => 'pan',
                            'identityNumber' => $_POST['idNumber']
                        );
                        $insert = $this->db->insert('searchnotification',$notifyData);
                        if($getApplicationNumber[0]['uploaded_by'] == 'user')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else{
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }
                    }else{
                        $notifyData = array(
                            'isLogin' => 0,
                            'dateCreated' => date('Y-m-d H:i:s'),
                            'mobileNumber' => $_SESSION['landingMob'],
                            'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                            'searchType' => 'Unknown',
                            'complainantUserType' => 'NonKyc',
                            'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                            'isIdentity' => 1,
                            'identityType' => 'pan',
                            'identityNumber' => $_POST['idNumber']
                        );
                        $insert = $this->db->insert('searchnotification',$notifyData);
                        if($getApplicationNumber[0]['uploaded_by'] == 'user')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else{
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }
                    }
                    if($isUserFound != 1)
                    {
                        if($getIfUnknownAvailable[0]['uploaded_by'] == 'police')
                        {
                            $getPoliceDetail = $this->db->query('select * from police where police_id='.$getIfUnknownAvailable[0]['policeId'])->result_array();
                            $finalresponse = array(
                                'isUserFound' => $isUserFound,
                                'status' => 'unknown',
                                'isLapata' => $isLapata,
                                'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                'type' => 'police',
                                'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                'address' => strtoupper($getPoliceDetail[0]['thanaName'].' - '.$getPoliceDetail[0]['state'].', '.$getPoliceDetail[0]['district']),
                                'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                'age' => $getIfUnknownAvailable[0]['Age'],
                                'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                'id' => $getIfUnknownAvailable[0]['Application_no'],
                                'registration_mobile' => (($getPoliceDetail[0]['registration_mobile'] != NULL) ? $getPoliceDetail[0]['registration_mobile'] : ''),
                                'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                            );   
                        
                        }
                        else
                        {
                            if($getIfUnknownAvailable[0]['uploaded_by']=='user')
                            {
                                $getUserDetail = $this->db->query('select * from user where uid='.$getIfUnknownAvailable[0]['userId'])->result_array();
                                $finalresponse = array(
                                    'status' => 'unknown',
                                    'isUserFound' => $isUserFound,
                                    'isLapata' => $isLapata,
                                    'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                    'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                    'type' => 'ngo',
                                    'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                    'address' => strtoupper($getUserDetail[0]['vtc'].' - '.$getUserDetail[0]['state'].', '.$getUserDetail[0]['district']),
                                    'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                    'age' => $getIfUnknownAvailable[0]['Age'],
                                    'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                    'registration_mobile' => (($getUserDetail[0]['registration_mobile'] != NULL) ? $getUserDetail[0]['registration_mobile'] : ''),
                                    'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                    'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                    'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                                    'id' => $getIfUnknownAvailable[0]['Application_no']
                                );   
                            }
                            else
                            {
                                $getNgoDetail = $this->db->query('select * from ngo where Id='.$getIfUnknownAvailable[0]['ngoId'])->result_array();
                                $finalresponse = array(
                                    'status' => 'unknown',
                                    'isUserFound' => $isUserFound,
                                    'isLapata' => $isLapata,
                                    'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                    'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                    'type' => 'ngo',
                                    'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                    'address' => strtoupper($getNgoDetail[0]['ngoName'].' - '.$getNgoDetail[0]['ngoState'].', '.$getNgoDetail[0]['ngoDistrict'].', '.$getNgoDetail[0]['ngoCity']),
                                    'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                    'age' => $getIfUnknownAvailable[0]['Age'],
                                    'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                    'registration_mobile' => (($getNgoDetail[0]['ngoRegistrationNumber'] != NULL) ? $getNgoDetail[0]['ngoRegistrationNumber'] : ''),
                                    'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                    'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                    'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                                    'id' => $getIfUnknownAvailable[0]['Application_no']
                                );   
                            }
                            
                        }
                    }else{
                        $finalresponse = array(
                            'isUserFound' => $isUserFound,
                            'status' => 'unknown',
                            'isLapata' => $isLapata,
                            'personName' => strtoupper($personName),
                            'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                            'address' => strtoupper($address),
                            'photo' => ($userphoto != '' ? $userphoto : base_url().$getIfUnknownAvailable[0]['Photo']),
                            'age' => $age,
                            'gender' => strtolower($gender),
                            'id' => $getIfUnknownAvailable[0]['Application_no']
                        );
                    }
                    $insertdata = array(
                        'lapataId' => $lapataId,
                        'isLapata' => $isLapata,
                        'wantedIds' => implode(',',$wantedId),
                        'criminalIds' => implode(',',$criminalId),
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'idNumber' => $_POST['idNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    echo json_encode($finalresponse);
                }else{
                    $insertdata = array(
                        'lapataId' => $lapataId,
                        'isLapata' => $isLapata,
                        'wantedIds' => implode(',',$wantedId),
                        'criminalIds' => implode(',',$criminalId),
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'idNumber' => $_POST['idNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    if($update)
                    {
                        if($isAadharCorrect == 1)
                        {
                            $isOnlyUser = 0;
                            if(!$isWanted && !$isLapata && !$isCriminal && !$isMissing)
                            {
                                $isOnlyUser = 1;
                            }
                            $response = array(
                                'personId' => $personId,
                                'isOnlyUser' => $isOnlyUser,
                                'status' => 'success',
                                'personName' => $personName,
                                'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                                'gender' => strtolower($gender),
                                'isWanted' => $isWanted,
                                'isLapata' => $isLapata,
                                'isCriminal' => $isCriminal,
                                'age' => $age,
                                'address' => $address,
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => 1,
                                'isGenderCorrect' => 1,
                                'message' => 'Person Found',
                                'isVisible' => $isVisible,
                                'isMissing' => $isMissing,
                                'isVerified' => $isVerified,
                                'isRegistered' => $isUserFound,
                                'image' => ($userphoto != '' ? $userphoto : base_url().'assets/img/noimage.jpg')
                            );
                            echo json_encode($response);   
                        }else{
                            $response = array(
                                'status' => 'incorrect',
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => 1,
                                'isGenderCorrect' => 1,
                            );
                            echo json_encode($response);   
                        }
                    }else{
                        $response = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                        echo json_encode($response);
                    }
                }   
            }else{
                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$lapataId)->result_array();
                if($getApplicationNumber[0]['isKyc'] == 1)
                {
                    $notifyData = array(
                        'isLogin' => 0,
                        'dateCreated' => date('Y-m-d H:i:s'),
                        'mobileNumber' => $_SESSION['landingMob'],
                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                        'searchType' => 'Lapata',
                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                        'isIdentity' => 1,
                        'identityType' => 'pan',
                        'identityNumber' => $_POST['idNumber']
                    );
                    $insert = $this->db->insert('searchnotification',$notifyData);
                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else{
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }
                }else{
                    $notifyData = array(
                        'isLogin' => 0,
                        'dateCreated' => date('Y-m-d H:i:s'),
                        'mobileNumber' => $_SESSION['landingMob'],
                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                        'searchType' => 'Lapata',
                        'complainantUserType' => 'NonKyc',
                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                        'isIdentity' => 1,
                        'identityType' => 'pan',
                        'identityNumber' => $_POST['idNumber']
                    );
                    $insert = $this->db->insert('searchnotification',$notifyData);
                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else{
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }
                }
                $insertdata = array(
                'lapataId' => $lapataId,
                'isLapata' => $isLapata,
                'wantedIds' => implode(',',$wantedId),
                'criminalIds' => implode(',',$criminalId),
                'isPersonFound' => $isUserFound,
                'isMissing' => $isMissing,
                'idNumber' => $_POST['idNumber'],
                'idType' => $_POST['idType'],
            );
            $this->db->where('Id',$_SESSION['checkId']);
            $update = $this->db->update('checkperson',$insertdata);
            if($update)
            {
                if($isAadharCorrect == 1)
                {
                    $isOnlyUser = 0;
                    if(!$isWanted && !$isLapata && !$isCriminal && !$isMissing)
                    {
                        $isOnlyUser = 1;
                    }
                    $response = array(
                        'personId' => $personId,
                        'isOnlyUser' => $isOnlyUser,
                        'status' => 'success',
                        'personName' => $personName,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'isWanted' => $isWanted,
                        'isLapata' => $isLapata,
                        'isCriminal' => $isCriminal,
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => 1,
                        'isGenderCorrect' => 1,
                        'message' => 'Person Found',
                        'isVisible' => $isVisible,
                        'isMissing' => $isMissing,
                        'isVerified' => $isVerified,
                        'isRegistered' => $isUserFound,
                        'image' => ($userphoto != '' ? $userphoto : base_url().'assets/img/noimage.jpg')
                    );
                    echo json_encode($response);   
                }else{
                    $response = array(
                        'status' => 'incorrect',
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => 1,
                        'isGenderCorrect' => 1,
                    );
                    echo json_encode($response);   
                }
            }else{
                $response = array(
                    'status' => 'error',
                    'message' => 'Something Went Wrong'
                );
                echo json_encode($response);
            }   
            }
        }
        if($_POST['idType'] == 'gold')
        {
            $idNumber = $_POST['idNumber'];
            if(strlen($_POST['idNumber']) != 6)
            {
                $response = array(
                    'status' => 'error',
                    'message' => 'Gold HUID number must be of 6 characters'
                );
                echo json_encode($response);
                return;
            }
            $personCount = 1;
            $this->db->where('goldHUIDNumber1', $_POST['idNumber']);
            $this->db->or_where('goldHUIDNumber2', $_POST['idNumber']);
            $this->db->or_where('goldHUIDNumber3', $_POST['idNumber']);
            $getIfPersonAvailable = $this->db->get('user')->result_array();
            $userphoto = '';
            if(count($getIfPersonAvailable) > 0)
            {
                foreach($getIfPersonAvailable as $k=>$v)
                {
                    $personCount++;
                }
                $personId = $getIfPersonAvailable[0]['uid'];
                $isAadharCorrect = 1;
                $isVisible = $getIfPersonAvailable[0]['visibility'];
                $isVerified = 1;
                $isUserFound = 1;
                $personName = $getIfPersonAvailable[0]['aadharname'];
                $gender = $getIfPersonAvailable[0]['gender'];
                $aadhar = $getIfPersonAvailable[0]['aadhar_id'];
                $from=new DateTime(date('Y-m-d'));
                $to   = new DateTime($getIfPersonAvailable[0]['dob']);
                $age = ($from->diff($to)->y);
                $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                $userphoto = base_url().''.(($getIfPersonAvailable[0]['aadharphoto'] != NULL) ? $getIfPersonAvailable[0]['aadharphoto'] : $getIfPersonAvailable[0]['facematchphoto']);
            }
            $getMissingPerson = $this->db->query('select * from missingperson where goldId="'.$_POST['idNumber'].'" and isFound !=1 and isFinalSubmitted = 1')->result_array();
            if(count($getMissingPerson) > 0)
            {
                $isVisible = 1;
                $isMissing = 1;
                if($isUserFound != 1)
                {
                    $personName = $getMissingPerson[0]['missingname'];
                    if($gender == '')
                    {
                        $gender = $getMissingPerson[0]['missinggender'];
                    }
                    $aadhar = $getMissingPerson[0]['missingaadhar'];
                    $from=new DateTime(date('Y-m-d'));
                    $to   = new DateTime($getMissingPerson[0]['missingdob']);
                    if($age == '')
                    {
                        $age = ($from->diff($to)->y);
                    }
                    $missingId = $getMissingPerson[0]['Id'];
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                    }else{
                        $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                    }
                    if(count($getIfPersonAvailable) == 0)
                    {
                        if($userphoto == '' || $userphoto == base_url())
                        {
                            $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : '');
                        }
                    }
                }
            }
            $this->db->like('goldHUID',$_POST['idNumber'],'both');
            $getIfAlready = $this->db->get('unknownPersonGold')->result_array();
            if(count($getIfAlready) > 0)
            {   
                $getIfLapataAvailable = $this->db->query('select * from unknown_person where isFinalSubmitted=1 and awsEventName="All" and isFound=0 and id='.$getIfAlready[(count($getIfAlready) - 1)]['unknownId'].' and expiryDate >= "'.date('Y-m-d h:i:s').'" order by dateCreated desc')->result_array();
            }else{
                $getIfLapataAvailable = array();
            }
            if(count($getIfLapataAvailable) > 0)
            {
                $personCount = 1;
                $isAadharCorrect = 1;
                $isVisible = 1;
                $isLapata = 1;
                $lapataId = $getIfLapataAvailable[0]['id'];
                $isMissing = 0;
                $missingId = 0;
                if(!$isUserFound)
                {
                    $isVerified = 0;
                    $personName = $getIfLapataAvailable[0]['person_name'];
                    $gender = ($getIfLapataAvailable[0]['Gender'] == 'boy' ? 'MALE' : 'FEMALE');
                    $aadhar = $getIfLapataAvailable[0]['aadharNumber'];
                    $age = ($getIfLapataAvailable[0]['Age']);
                    $address = $getIfLapataAvailable[0]['city'].','.$getIfLapataAvailable[0]['state'];
                    $userphoto = base_url().''.(($getIfLapataAvailable[0]['Photo'] != NULL) ? $getIfLapataAvailable[0]['Photo'] : $userphoto);
                }
            }
            if($this->getSettings('generalNotification') == 'true')
            {
                if($personId != '')
                {
                    $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$personId);
                    $query_res = $query->result_array();
                    
                    if(count($query_res) > 0)
                    {
                        foreach ($query_res as $query_res_data) {
                            $registrationIds[] =$query_res_data['token'];
                        }
                        
                        $url ="https://fcm.googleapis.com/fcm/send";
                        $fields=array(
                            "registration_ids"=>$registrationIds,
                            'data' => array("msg"=>"Khoji"),
                            'priority' => 'high',
                            "click_action"=>base_url(),
                            "notification"=>array(
                                "body"=>"One Person has searched you",
                                "title"=>"Khoji",
                            )   
                        );
                        $headers=array(
                            'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                            'Content-Type:application/json'
                        );
                        $ch=curl_init();
                        curl_setopt($ch,CURLOPT_URL,$url);
                        curl_setopt($ch,CURLOPT_POST,true);
                        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                        curl_exec($ch);
                    }
                }   
            }
            if($isLapata != 1)
            {
                $getIfUnknownGold = $this->db->query('select * from unknownPersonGold where goldHUID ="'.$_POST['idNumber'].'" order by Id desc')->result_array();
                if(count($getIfUnknownGold) > 0)
                {
                    $id = array();
                    foreach($getIfUnknownGold as $k=>$v)
                    {
                        $getIfUnknownAvailable = $this->db->query('select * from unknown_person where isFinalSubmitted=1 and awsEventName !="All" and isFound=0 and id='.$v['unknownId'].' order by id desc')->result_array();      
                        if(count($getIfUnknownAvailable) > 0)
                        {
                            array_push($id,$getIfUnknownAvailable[0]['id']);
                            break;
                        }
                    }
                    if(count($id) > 0)
                    {
                        $getIfUnknownAvailable = $this->db->query('select * from unknown_person where id='.$id[0])->result_array();      
                    }else{
                        $getIfUnknownAvailable = array();    
                    }
                }else{
                    $getIfUnknownAvailable = array();
                }
                // $getIfUnknownAvailable = array();
                if(count($getIfUnknownAvailable) > 0)
                {
                    $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$getIfUnknownAvailable[0]['id'])->result_array();
                    if($getApplicationNumber[0]['isKyc'] == 1)
                    {
                        $notifyData = array(
                            'isLogin' => 0,
                            'dateCreated' => date('Y-m-d H:i:s'),
                            'mobileNumber' => $_SESSION['landingMob'],
                            'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                            'searchType' => 'Unknown',
                            'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                            'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                            'isIdentity' => 1,
                            'identityType' => 'gold',
                            'identityNumber' => $_POST['idNumber']
                        );
                        $insert = $this->db->insert('searchnotification',$notifyData);
                        if($getApplicationNumber[0]['uploaded_by'] == 'user')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else{
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }
                    }else{
                        $notifyData = array(
                            'isLogin' => 0,
                            'dateCreated' => date('Y-m-d H:i:s'),
                            'mobileNumber' => $_SESSION['landingMob'],
                            'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                            'searchType' => 'Unknown',
                            'complainantUserType' => 'NonKyc',
                            'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                            'isIdentity' => 1,
                            'identityType' => 'gold',
                            'identityNumber' => $_POST['idNumber']
                        );
                        $insert = $this->db->insert('searchnotification',$notifyData);
                        if($getApplicationNumber[0]['uploaded_by'] == 'user')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else{
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }
                    }
                    if($isUserFound != 1)
                    {
                        if($getIfUnknownAvailable[0]['uploaded_by'] == 'police')
                        {
                            $getPoliceDetail = $this->db->query('select * from police where police_id='.$getIfUnknownAvailable[0]['policeId'])->result_array();
                            $finalresponse = array(
                                'isUserFound' => $isUserFound,
                                'status' => 'unknown',
                                'isLapata' => $isLapata,
                                'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                'type' => 'police',
                                'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                'address' => strtoupper($getPoliceDetail[0]['thanaName'].' - '.$getPoliceDetail[0]['state'].', '.$getPoliceDetail[0]['district']),
                                'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                'age' => $getIfUnknownAvailable[0]['Age'],
                                'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                'id' => $getIfUnknownAvailable[0]['Application_no'],
                                'registration_mobile' => (($getPoliceDetail[0]['registration_mobile'] != NULL) ? $getPoliceDetail[0]['registration_mobile'] : ''),
                                'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                            );   
                        }
                        else
                        {
                            if($getIfUnknownAvailable[0]['uploaded_by']=='user')
                            {
                                $getUserDetail = $this->db->query('select * from user where uid='.$getIfUnknownAvailable[0]['userId'])->result_array();
                                $finalresponse = array(
                                    'status' => 'unknown',
                                    'isUserFound' => $isUserFound,
                                    'isLapata' => $isLapata,
                                    'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                    'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                    'type' => 'ngo',
                                    'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                    'address' => strtoupper($getUserDetail[0]['vtc'].' - '.$getUserDetail[0]['state'].', '.$getUserDetail[0]['district']),
                                    'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                    'age' => $getIfUnknownAvailable[0]['Age'],
                                    'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                    'registration_mobile' => (($getUserDetail[0]['registration_mobile'] != NULL) ? $getUserDetail[0]['registration_mobile'] : ''),
                                    'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                    'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                    'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                                    'id' => $getIfUnknownAvailable[0]['Application_no']
                                );   
                            }
                            else
                            {
                                $getNgoDetail = $this->db->query('select * from ngo where Id='.$getIfUnknownAvailable[0]['ngoId'])->result_array();
                                $finalresponse = array(
                                    'status' => 'unknown',
                                    'isLapata' => $isLapata,
                                    'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                    'isUserFound' => $isUserFound,
                                    'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                    'type' => 'ngo',
                                    'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                    'address' => strtoupper($getNgoDetail[0]['ngoName'].' - '.$getNgoDetail[0]['ngoState'].', '.$getNgoDetail[0]['ngoDistrict'].', '.$getNgoDetail[0]['ngoCity']),
                                    'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                    'age' => $getIfUnknownAvailable[0]['Age'],
                                    'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                    'registration_mobile' => (($getNgoDetail[0]['ngoRegistrationNumber'] != NULL) ? $getNgoDetail[0]['ngoRegistrationNumber'] : ''),
                                    'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                    'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                    'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                                    'id' => $getIfUnknownAvailable[0]['Application_no']
                                );
                            }
                               
                        }
                    }else{
                        $finalresponse = array(
                            'isUserFound' => $isUserFound,
                            'status' => 'unknown',
                            'isLapata' => $isLapata,
                            'personName' => strtoupper($personName),
                            'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                            'address' => strtoupper($address),
                            'photo' => ($userphoto != '' ? $userphoto : base_url().$getIfUnknownAvailable[0]['Photo']),
                            'age' => $age,
                            'gender' => strtolower($gender),
                            'id' => $getIfUnknownAvailable[0]['Application_no']
                        );
                    }
                    $insertdata = array(
                        'lapataId' => $lapataId,
                        'isLapata' => $isLapata,
                        'wantedIds' => implode(',',$wantedId),
                        'criminalIds' => implode(',',$criminalId),
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'idNumber' => $_POST['idNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    echo json_encode($finalresponse);
                }else{
                    $insertdata = array(
                        'lapataId' => $lapataId,
                        'isLapata' => $isLapata,
                        'wantedIds' => implode(',',$wantedId),
                        'criminalIds' => implode(',',$criminalId),
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'idNumber' => $_POST['idNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    if($update)
                    {
                        if($isAadharCorrect == 1)
                        {
                            $isOnlyUser = 0;
                            if(!$isWanted && !$isLapata && !$isCriminal && !$isMissing)
                            {
                                $isOnlyUser = 1;
                            }
                            $response = array(
                                'personId' => $personId,
                                'isOnlyUser' => $isOnlyUser,
                                'status' => 'success',
                                'personName' => $personName,
                                'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                                'gender' => strtolower($gender),
                                'isWanted' => $isWanted,
                                'isLapata' => $isLapata,
                                'isCriminal' => $isCriminal,
                                'age' => $age,
                                'address' => $address,
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => 1,
                                'isGenderCorrect' => 1,
                                'message' => 'Person Found',
                                'isVisible' => $isVisible,
                                'isMissing' => $isMissing,
                                'isVerified' => $isVerified,
                                'isRegistered' => $isUserFound,
                                'image' => ($userphoto != '' ? $userphoto : base_url().'assets/img/noimage.jpg')
                            );
                            echo json_encode($response);   
                        }else{
                            $response = array(
                                'status' => 'incorrect',
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => 1,
                                'isGenderCorrect' => 1,
                            );
                            echo json_encode($response);   
                        }
                    }else{
                        $response = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                        echo json_encode($response);
                    }
                }   
            }else{
                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$lapataId)->result_array();
                if($getApplicationNumber[0]['isKyc'] == 1)
                {   
                    $notifyData = array(
                        'isLogin' => 0,
                        'dateCreated' => date('Y-m-d H:i:s'),
                        'mobileNumber' => $_SESSION['landingMob'],
                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                        'searchType' => 'Lapata',
                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                        'isIdentity' => 1,
                        'identityType' => 'gold',
                        'identityNumber' => $_POST['idNumber']
                    );
                    $insert = $this->db->insert('searchnotification',$notifyData);
                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else{
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }
                }else{
                    $notifyData = array(
                        'isLogin' => 0,
                        'dateCreated' => date('Y-m-d H:i:s'),
                        'mobileNumber' => $_SESSION['landingMob'],
                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                        'searchType' => 'Lapata',
                        'complainantUserType' => 'NonKyc',
                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                        'isIdentity' => 1,
                        'identityType' => 'gold',
                        'identityNumber' => $_POST['idNumber']
                    );
                    $insert = $this->db->insert('searchnotification',$notifyData);
                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else{
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }
                }
                $insertdata = array(
                'lapataId' => $lapataId,
                'isLapata' => $isLapata,
                'wantedIds' => implode(',',$wantedId),
                'criminalIds' => implode(',',$criminalId),
                'isPersonFound' => $isUserFound,
                'isMissing' => $isMissing,
                'idNumber' => $_POST['idNumber'],
                'idType' => $_POST['idType'],
            );
            $this->db->where('Id',$_SESSION['checkId']);
            $update = $this->db->update('checkperson',$insertdata);
            if($update)
            {
                if($isAadharCorrect == 1)
                {
                    $isOnlyUser = 0;
                    if(!$isWanted && !$isLapata && !$isCriminal && !$isMissing)
                    {
                        $isOnlyUser = 1;
                    }
                    $response = array(
                        'personId' => $personId,
                        'isOnlyUser' => $isOnlyUser,
                        'status' => 'success',
                        'personName' => $personName,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'isWanted' => $isWanted,
                        'isLapata' => $isLapata,
                        'isCriminal' => $isCriminal,
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => 1,
                        'isGenderCorrect' => 1,
                        'message' => 'Person Found',
                        'isVisible' => $isVisible,
                        'isMissing' => $isMissing,
                        'isVerified' => $isVerified,
                        'isRegistered' => $isUserFound,
                        'image' => ($userphoto != '' ? $userphoto : base_url().'assets/img/noimage.jpg')
                    );
                    echo json_encode($response);   
                }else{
                    $response = array(
                        'status' => 'incorrect',
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => 1,
                        'isGenderCorrect' => 1,
                    );
                    echo json_encode($response);   
                }
            }else{
                $response = array(
                    'status' => 'error',
                    'message' => 'Something Went Wrong'
                );
                echo json_encode($response);
            }   
            }
        }
        if($_POST['idType'] == 'vehicle')
        {
            $idNumber = $_POST['idNumber'];
            $personCount = 1;
            $this->db->where('vehicleNumber1', $_POST['idNumber']);
            $this->db->or_where('vehicleNumber2', $_POST['idNumber']);
            $this->db->or_where('vehicleNumber3', $_POST['idNumber']);
            $getIfPersonAvailable = $this->db->get('user')->result_array();
            $userphoto = '';
            if(count($getIfPersonAvailable) > 0)
            {
                foreach($getIfPersonAvailable as $k=>$v)
                {
                    $personCount++;
                }
                $personId = $getIfPersonAvailable[0]['uid'];
                $isAadharCorrect = 1;
                $isVisible = $getIfPersonAvailable[0]['visibility'];
                $isVerified = 1;
                $isUserFound = 1;
                $personName = $getIfPersonAvailable[0]['aadharname'];
                $gender = $getIfPersonAvailable[0]['gender'];
                $aadhar = $getIfPersonAvailable[0]['aadhar_id'];
                $from=new DateTime(date('Y-m-d'));
                $to   = new DateTime($getIfPersonAvailable[0]['dob']);
                $age = ($from->diff($to)->y);
                $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                $userphoto = base_url().''.(($getIfPersonAvailable[0]['aadharphoto'] != NULL) ? $getIfPersonAvailable[0]['aadharphoto'] : $getIfPersonAvailable[0]['facematchphoto']);
            }
            $getMissingPerson = $this->db->query('select * from missingperson where vehicleNumber like "%'.$_POST['idNumber'].'%" and isFound !=1 and isFinalSubmitted = 1')->result_array();
            if(count($getMissingPerson) > 0)
            {
                $isVisible = 1;
                $isMissing = 1;
                $missingId = $getMissingPerson[0]['Id'];
                if($isUserFound != 1)
                {
                    $personName = $getMissingPerson[0]['missingname'];
                    if($gender == '')
                    {
                        $gender = $getMissingPerson[0]['missinggender'];
                    }
                    $aadhar = $getMissingPerson[0]['missingaadhar'];
                    $from=new DateTime(date('Y-m-d'));
                    $to   = new DateTime($getMissingPerson[0]['missingdob']);
                    if($age == '')
                    {
                        $age = ($from->diff($to)->y);
                    }
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                    }else{
                        $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                    }
                    if(count($getIfPersonAvailable) == 0)
                    {
                        if($userphoto == '' || $userphoto == base_url())
                        {
                            $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : '');
                        }
                    }
                }
            }
            $getIfLapataAvailable = $this->db->query('select * from unknown_person where isFinalSubmitted=1 and uploaded_by = "user" and isFound=0 and vehicle_no like "%'.$_POST['idNumber'].'%" and expiryDate >= "'.date('Y-m-d h:i:s').'" order by id desc')->result_array();   
            if(count($getIfLapataAvailable) > 0)
            {
                $personCount = 1;
                $isAadharCorrect = 1;
                $isVisible = 1;
                $isLapata = 1;
                $lapataId = $getIfLapataAvailable[0]['id'];
                $isMissing = 0;
                $missingId = 0;
                if(!$isUserFound)
                {
                    $isVerified = 0;
                    $personName = $getIfLapataAvailable[0]['person_name'];
                    $gender = ($getIfLapataAvailable[0]['Gender'] == 'boy' ? 'MALE' : 'FEMALE');
                    $aadhar = $getIfLapataAvailable[0]['aadharNumber'];
                    $age = ($getIfLapataAvailable[0]['Age']);
                    $address = $getIfLapataAvailable[0]['city'].','.$getIfLapataAvailable[0]['state'];
                    $userphoto = base_url().''.(($getIfLapataAvailable[0]['Photo'] != NULL) ? $getIfLapataAvailable[0]['Photo'] : $userphoto);
                }
            }
            if($this->getSettings('generalNotification') == 'true')
            {
                if($personId != '')
                {
                    $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$personId);
                    $query_res = $query->result_array();
                    
                    if(count($query_res) > 0)
                    {
                        foreach ($query_res as $query_res_data) {
                            $registrationIds[] =$query_res_data['token'];
                        }
                        
                        $url ="https://fcm.googleapis.com/fcm/send";
                        $fields=array(
                            "registration_ids"=>$registrationIds,
                            'data' => array("msg"=>"Khoji"),
                            'priority' => 'high',
                            "click_action"=>base_url(),
                            "notification"=>array(
                                "body"=>"One Person has searched you",
                                "title"=>"Khoji",
                            )   
                        );
                        $headers=array(
                            'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                            'Content-Type:application/json'
                        );
                        $ch=curl_init();
                        curl_setopt($ch,CURLOPT_URL,$url);
                        curl_setopt($ch,CURLOPT_POST,true);
                        curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                        curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                        curl_exec($ch);
                    }
                }   
            }
            if($isLapata != 1)
            {
                $getIfUnknownAvailable = $this->db->query('select * from unknown_person where isFinalSubmitted=1 and awsEventName !="All" and isFound=0 and vehicle_no="'.$_POST['idNumber'].'" order by id desc')->result_array();
                // $getIfUnknownAvailable = array();
                if(count($getIfUnknownAvailable) > 0)
                {
                    $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$getIfUnknownAvailable[0]['id'])->result_array();
                    if($getApplicationNumber[0]['isKyc'] == 1)
                    {
                        $notifyData = array(
                            'isLogin' => 0,
                            'dateCreated' => date('Y-m-d H:i:s'),
                            'mobileNumber' => $_SESSION['landingMob'],
                            'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                            'searchType' => 'Unknown',
                            'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                            'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                            'isIdentity' => 1,
                            'identityType' => 'vehicle',
                            'identityNumber' => $_POST['idNumber']
                        );
                        $insert = $this->db->insert('searchnotification',$notifyData);
                        if($getApplicationNumber[0]['uploaded_by'] == 'user')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else{
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }
                    }else{
                        $notifyData = array(
                            'isLogin' => 0,
                            'dateCreated' => date('Y-m-d H:i:s'),
                            'mobileNumber' => $_SESSION['landingMob'],
                            'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                            'searchType' => 'Unknown',
                            'complainantUserType' => 'NonKyc',
                            'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                            'isIdentity' => 1,
                            'identityType' => 'vehicle',
                            'identityNumber' => $_POST['idNumber']
                        );
                        $insert = $this->db->insert('searchnotification',$notifyData);
                        if($getApplicationNumber[0]['uploaded_by'] == 'user')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                        {
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }else{
                            $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                            $query_res = $query->result_array();
                            
                            if(count($query_res) > 0)
                            {
                                foreach ($query_res as $query_res_data) {
                                    $registrationIds[] =$query_res_data['token'];
                                }
                                
                                $url ="https://fcm.googleapis.com/fcm/send";
                                $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                                $fields=array(
                                    "registration_ids"=>$registrationIds,
                                    'data' => array("msg"=>"Khoji"),
                                    'priority' => 'high',
                                    "click_action"=>base_url(),
                                    "notification"=>array(
                                        "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                        "title"=>"Khoji",
                                    )   
                                );
                                $headers=array(
                                    'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                    'Content-Type:application/json'
                                );
                                $ch=curl_init();
                                curl_setopt($ch,CURLOPT_URL,$url);
                                curl_setopt($ch,CURLOPT_POST,true);
                                curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                                curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                                curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                                curl_exec($ch);
                            }
                        }
                    }
                    if($isUserFound != 1)
                    {
                        if($getIfUnknownAvailable[0]['uploaded_by'] == 'police')
                        {
                            $getPoliceDetail = $this->db->query('select * from police where police_id='.$getIfUnknownAvailable[0]['policeId'])->result_array();
                            $finalresponse = array(
                                'isUserFound' => $isUserFound,
                                'status' => 'unknown',
                                'isLapata' => $isLapata,
                                'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                'type' => 'police',
                                'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                'address' => strtoupper($getPoliceDetail[0]['thanaName'].' - '.$getPoliceDetail[0]['state'].', '.$getPoliceDetail[0]['district']),
                                'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                'age' => $getIfUnknownAvailable[0]['Age'],
                                'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                'id' => $getIfUnknownAvailable[0]['Application_no'],
                                'registration_mobile' => (($getPoliceDetail[0]['registration_mobile'] != NULL) ? $getPoliceDetail[0]['registration_mobile'] : ''),
                                'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                            );   
                        }
                        else
                        {
                            if($getIfUnknownAvailable[0]['uploaded_by']=='user')
                            {
                                $getUserDetail = $this->db->query('select * from user where uid='.$getIfUnknownAvailable[0]['userId'])->result_array();
                                $finalresponse = array(
                                    'status' => 'unknown',
                                    'isUserFound' => $isUserFound,
                                    'isLapata' => $isLapata,
                                    'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                    'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                    'type' => 'ngo',
                                    'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                    'address' => strtoupper($getUserDetail[0]['vtc'].' - '.$getUserDetail[0]['state'].', '.$getUserDetail[0]['district']),
                                    'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                    'age' => $getIfUnknownAvailable[0]['Age'],
                                    'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                    'registration_mobile' => (($getUserDetail[0]['registration_mobile'] != NULL) ? $getUserDetail[0]['registration_mobile'] : ''),
                                    'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                    'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                    'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                                    'id' => $getIfUnknownAvailable[0]['Application_no']
                                );   
                            }
                            else
                            {
                                $getNgoDetail = $this->db->query('select * from ngo where Id='.$getIfUnknownAvailable[0]['ngoId'])->result_array();
                                $finalresponse = array(
                                    'status' => 'unknown',
                                    'isLapata' => $isLapata,
                                    'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                    'isUserFound' => $isUserFound,
                                    'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                    'type' => 'ngo',
                                    'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                    'address' => strtoupper($getNgoDetail[0]['ngoName'].' - '.$getNgoDetail[0]['ngoState'].', '.$getNgoDetail[0]['ngoDistrict'].', '.$getNgoDetail[0]['ngoCity']),
                                    'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                    'age' => $getIfUnknownAvailable[0]['Age'],
                                    'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                    'registration_mobile' => (($getNgoDetail[0]['ngoRegistrationNumber'] != NULL) ? $getNgoDetail[0]['ngoRegistrationNumber'] : ''),
                                    'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                    'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                    'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                                    'id' => $getIfUnknownAvailable[0]['Application_no']
                                );  
                            }
                             
                        }
                    }else{
                        $finalresponse = array(
                            'isUserFound' => $isUserFound,
                            'status' => 'unknown',
                            'isLapata' => $isLapata,
                            'personName' => strtoupper($personName),
                            'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                            'address' => strtoupper($address),
                            'photo' => ($userphoto != '' ? $userphoto : base_url().$getIfUnknownAvailable[0]['Photo']),
                            'age' => $age,
                            'gender' => strtolower($gender),
                            'id' => $getIfUnknownAvailable[0]['Application_no']
                        );
                    }
                    $insertdata = array(
                        'lapataId' => $lapataId,
                        'isLapata' => $isLapata,
                        'wantedIds' => implode(',',$wantedId),
                        'criminalIds' => implode(',',$criminalId),
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'idNumber' => $_POST['idNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    echo json_encode($finalresponse);
                }else{
                    $insertdata = array(
                        'lapataId' => $lapataId,
                        'isLapata' => $isLapata,
                        'wantedIds' => implode(',',$wantedId),
                        'criminalIds' => implode(',',$criminalId),
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'idNumber' => $_POST['idNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    if($update)
                    {
                        if($isAadharCorrect == 1)
                        {
                            $isOnlyUser = 0;
                            if(!$isWanted && !$isLapata && !$isCriminal && !$isMissing)
                            {
                                $isOnlyUser = 1;
                            }
                            $response = array(
                                'personId' => $personId,
                                'isOnlyUser' => $isOnlyUser,
                                'status' => 'success',
                                'personName' => $personName,
                                'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                                'gender' => strtolower($gender),
                                'isWanted' => $isWanted,
                                'isLapata' => $isLapata,
                                'isCriminal' => $isCriminal,
                                'age' => $age,
                                'address' => $address,
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => 1,
                                'isGenderCorrect' => 1,
                                'message' => 'Person Found',
                                'isVisible' => $isVisible,
                                'isMissing' => $isMissing,
                                'isVerified' => $isVerified,
                                'isRegistered' => $isUserFound,
                                'image' => ($userphoto != '' ? $userphoto : base_url().'assets/img/noimage.jpg')
                            );
                            echo json_encode($response);   
                        }else{
                            $response = array(
                                'status' => 'incorrect',
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => 1,
                                'isGenderCorrect' => 1,
                            );
                            echo json_encode($response);   
                        }
                    }else{
                        $response = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                        echo json_encode($response);
                    }
                }   
            }else{
                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$lapataId)->result_array();
                if($getApplicationNumber[0]['isKyc'] == 1)
                {
                    $notifyData = array(
                        'isLogin' => 0,
                        'dateCreated' => date('Y-m-d H:i:s'),
                        'mobileNumber' => $_SESSION['landingMob'],
                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                        'searchType' => 'Lapata',
                        'complainantUserType' => $getApplicationNumber[0]['uploaded_by'],
                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                        'isIdentity' => 1,
                        'identityType' => 'vehicle',
                        'identityNumber' => $_POST['idNumber']
                    );
                    $insert = $this->db->insert('searchnotification',$notifyData);
                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='user' and userId=".$getApplicationNumber[0]['userId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from user where uid='.$getApplicationNumber[0]['userId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else{
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }
                }else{
                    $notifyData = array(
                        'isLogin' => 0,
                        'dateCreated' => date('Y-m-d H:i:s'),
                        'mobileNumber' => $_SESSION['landingMob'],
                        'searchedAppNumber' => $getApplicationNumber[0]['Application_no'],
                        'searchType' => 'Lapata',
                        'complainantUserType' => 'NonKyc',
                        'complainantUserId' => ($getApplicationNumber[0]['uploaded_by'] == 'police' ? $getApplicationNumber[0]['policeId'] : ($getApplicationNumber[0]['uploaded_by'] == 'ngo' ? $getApplicationNumber[0]['ngoId'] : $getApplicationNumber[0]['userId'])),
                        'isIdentity' => 1,
                        'identityType' => 'vehicle',
                        'identityNumber' => $_POST['idNumber']
                    );
                    $insert = $this->db->insert('searchnotification',$notifyData);
                    if($getApplicationNumber[0]['uploaded_by'] == 'user')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='guest' and userId=".$getApplicationNumber[0]['userId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from nonKycUser where uid='.$getApplicationNumber[0]['userId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['aadharname'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else if($getApplicationNumber[0]['uploaded_by'] == 'police')
                    {
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='police' and userId=".$getApplicationNumber[0]['policeId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from police where police_id='.$getApplicationNumber[0]['policeId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['thanaName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }else{
                        $query = $this->db->query("SELECT distinct token FROM `notification_tokens_tbl` where delete_status='N' and userType='ngo' and userId=".$getApplicationNumber[0]['ngoId']);
                        $query_res = $query->result_array();
                        
                        if(count($query_res) > 0)
                        {
                            foreach ($query_res as $query_res_data) {
                                $registrationIds[] =$query_res_data['token'];
                            }
                            
                            $url ="https://fcm.googleapis.com/fcm/send";
                            $getReceiverUserDetail = $this->db->query('select * from ngo where Id='.$getApplicationNumber[0]['ngoId'])->result_array();
                            $fields=array(
                                "registration_ids"=>$registrationIds,
                                'data' => array("msg"=>"Khoji"),
                                'priority' => 'high',
                                "click_action"=>base_url(),
                                "notification"=>array(
                                    "body"=>"MATCH FOUND ALERT !!- PLEASE CHECK YOUR NOTIFICATION - GENERAL USER -".$_SESSION['landingMob']." has searched. Click here to check your notification  at ".$getReceiverUserDetail[0]['ngoName'].".",
                                    "title"=>"Khoji",
                                )   
                            );
                            $headers=array(
                                'Authorization: key=AAAAMgP8g1s:APA91bGPX21cquVsh3YdNZwFhl3us2Mq5p5vjHOf39HF8NK2H0WJvNn8zqlE_jSnhViSCYgmcNmeF_Ekuu8-nsRiFTBP2GNfLwEVH7MTIss8M5sB7rVOZySL3FWFfbVRx5HvUWuTMMtG',
                                'Content-Type:application/json'
                            );
                            $ch=curl_init();
                            curl_setopt($ch,CURLOPT_URL,$url);
                            curl_setopt($ch,CURLOPT_POST,true);
                            curl_setopt($ch,CURLOPT_HTTPHEADER,$headers);
                            curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
                            curl_setopt($ch,CURLOPT_POSTFIELDS,json_encode($fields));
                            curl_exec($ch);
                        }
                    }
                }   
                $insertdata = array(
                    'lapataId' => $lapataId,
                    'isLapata' => $isLapata,
                    'wantedIds' => implode(',',$wantedId),
                    'criminalIds' => implode(',',$criminalId),
                    'isPersonFound' => $isUserFound,
                    'isMissing' => $isMissing,
                    'idNumber' => $_POST['idNumber'],
                    'idType' => $_POST['idType'],
                );
                $this->db->where('Id',$_SESSION['checkId']);
                $update = $this->db->update('checkperson',$insertdata);
                if($update)
                {
                    if($isAadharCorrect == 1)
                    {
                        $isOnlyUser = 0;
                        if(!$isWanted && !$isLapata && !$isCriminal && !$isMissing)
                        {
                            $isOnlyUser = 1;
                        }
                        $response = array(
                            'personId' => $personId,
                            'isOnlyUser' => $isOnlyUser,
                            'status' => 'success',
                            'personName' => $personName,
                            'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                            'gender' => strtolower($gender),
                            'isWanted' => $isWanted,
                            'isLapata' => $isLapata,
                            'isCriminal' => $isCriminal,
                            'age' => $age,
                            'address' => $address,
                            'isAadharCorrect' => $isAadharCorrect,
                            'isDobCorrect' => 1,
                            'isGenderCorrect' => 1,
                            'message' => 'Person Found',
                            'isVisible' => $isVisible,
                            'isMissing' => $isMissing,
                            'isVerified' => $isVerified,
                            'isRegistered' => $isUserFound,
                            'image' => ($userphoto != '' ? $userphoto : base_url().'assets/img/noimage.jpg')
                        );
                        echo json_encode($response);   
                    }else{
                        $response = array(
                            'status' => 'incorrect',
                            'isAadharCorrect' => $isAadharCorrect,
                            'isDobCorrect' => 1,
                            'isGenderCorrect' => 1,
                        );
                        echo json_encode($response);   
                    }
                }else{
                    $response = array(
                        'status' => 'error',
                        'message' => 'Something Went Wrong'
                    );
                    echo json_encode($response);
                }   
            }
        }
    }
    
    function checkPersonIdUpdated()
    {
        $personName = '';
        $gender = '';
        $aadhar = '';
        $gender = '';
        $isVerified = 'No';
        $isVisible = 0;
        $age = '';
        $isWanted = 0;
        $personId = '';
        $isCriminal = 0;
        $isLapata = 0;
        $address = '';
        $lapataId = 0;
        $isKhoya = 0;
        $khoyaId = 0;
        $wantedId = array();
        $criminalId = array();
        $isUserFound = 0;
        $isMissing = 0;
        $isAadharCorrect = 0;
        $idNumber = '';
        if($_POST['idType'] == 'aadhar')
        {
            $idNumber = $_POST['idNumber'];
            if(strlen($_POST['idNumber']) != 12)
            {
                $response = array(
                    'status' => 'error',
                    'message' => 'Aadhar number must be 12 digit number'
                );
                echo json_encode($response);
                return;
            }
            $getIfPersonAvailable = $this->db->query('select * from user where aadhar_id="'.$_POST['idNumber'].'"')->result_array();
            $userphoto = '';
            if(count($getIfPersonAvailable) > 0)
            {
                $personId = $getIfPersonAvailable[0]['uid'];
                $isAadharCorrect = 1;
                $isVisible = $getIfPersonAvailable[0]['visibility'];
                $isVerified = 1;
                $isUserFound = 1;
                $personName = $getIfPersonAvailable[0]['aadharname'];
                $gender = $getIfPersonAvailable[0]['gender'];
                $aadhar = $getIfPersonAvailable[0]['aadhar_id'];
                $from=new DateTime(date('Y-m-d'));
                $to   = new DateTime($getIfPersonAvailable[0]['dob']);
                $age = ($from->diff($to)->y);
                $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                $userphoto = base_url().''.(($getIfPersonAvailable[0]['aadharphoto'] != NULL) ? $getIfPersonAvailable[0]['aadharphoto'] : $getIfPersonAvailable[0]['facematchphoto']);
            }
            $getIfWantedAvailable = $this->db->query('select * from criminals where aadharNumber="'.$_POST['idNumber'].'" and isFinalSubmitted=1 and type="wanted" and status="Active" order by dateCreated desc')->result_array();
            if(count($getIfWantedAvailable) > 0)
            {
                $isAadharCorrect = 1;
                $isWanted = 1;
                $isVisible = 1;
                if($isUserFound != 1)
                {
                    $personName = $getIfWantedAvailable[0]['personName'];
                    $gender = $getIfWantedAvailable[0]['gender'];
                    $aadhar = $getIfWantedAvailable[0]['aadharNumber'];
                    if($getIfWantedAvailable[0]['dob'] != '0000-00-00')
                    {
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfWantedAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                    }else{
                        $age = '';
                    }
                    $address = '';
                    if($getIfWantedAvailable[0]['state'] != '')
                    {
                        $address .= $getIfWantedAvailable[0]['state'];
                    }
                    if($getIfWantedAvailable[0]['district'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfWantedAvailable[0]['district'];
                        }else{
                            $address .= $getIfWantedAvailable[0]['district'];
                        }
                    }
                    if($getIfWantedAvailable[0]['city'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfWantedAvailable[0]['city'];
                        }else{
                            $address .= $getIfWantedAvailable[0]['city'];
                        }
                    }
                    $getPhotos = $this->db->query('select * from criminalphotos where crimeId='.$getIfWantedAvailable[0]['Id'])->result_array();
                    if($userphoto == '' || $userphoto == base_url())
                    {
                        $userphoto = ((count($getPhotos) > 0) ? base_url().''.$getPhotos[0]['photourl'] : base_url().''.$getIfWantedAvailable[0]['photo']);   
                    }   
                }
                foreach($getIfWantedAvailable as $k=>$v)
                {
                    array_push($wantedId,$v['Id']);
                }
            }
            $getIfCriminalAvailable = $this->db->query('select * from criminals where aadharNumber="'.$_POST['idNumber'].'" and isFinalSubmitted=1 and type="criminal" and status="Active" order by dateCreated desc')->result_array();
            if(count($getIfCriminalAvailable) > 0)
            {
                $isAadharCorrect = 1;
                $isVisible = 1;
                $isCriminal = 1;
                if($isUserFound != 1)
                {
                    $personName = $getIfCriminalAvailable[0]['personName'];
                    $gender = $getIfCriminalAvailable[0]['gender'];
                    $aadhar = $getIfCriminalAvailable[0]['aadharNumber'];
                    if($getIfCriminalAvailable[0]['dob'] != '0000-00-00')
                    {
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfCriminalAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                    }else{
                        $age = '';
                    }
                    $address = '';
                    if($getIfCriminalAvailable[0]['state'] != '')
                    {
                        $address .= $getIfCriminalAvailable[0]['state'];
                    }
                    if($getIfCriminalAvailable[0]['district'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfCriminalAvailable[0]['district'];
                        }else{
                            $address .= $getIfCriminalAvailable[0]['district'];
                        }
                    }
                    if($getIfCriminalAvailable[0]['city'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfCriminalAvailable[0]['city'];
                        }else{
                            $address .= $getIfCriminalAvailable[0]['city'];
                        }
                    }
                    $getPhotos = $this->db->query('select * from criminalphotos where crimeId='.$getIfCriminalAvailable[0]['Id'])->result_array();
                    if($userphoto == '' || $userphoto == base_url())
                    {
                        $userphoto = ((count($getPhotos) > 0) ? base_url().''.$getPhotos[0]['photourl'] : base_url().''.$getIfCriminalAvailable[0]['photo']);   
                    }
                }
                foreach($getIfCriminalAvailable as $k=>$v)
                {
                    array_push($criminalId,$v['Id']);
                }
            }
            $getMissingPerson = $this->db->query('select * from missingperson where missingaadhar="'.$_POST['idNumber'].'" and isFound !=1 order by dateCreated desc')->result_array();
            if(count($getMissingPerson) > 0)
            {
                $isVisible = 1;
                $isAadharCorrect = 1;
                if($getMissingPerson[0]['missinggender'] != NULL)
                {
                    $isMissing = 1;
                    if($isUserFound != 1)
                    {
                        $personName = $getMissingPerson[0]['missingname'];
                        $gender = $getMissingPerson[0]['missinggender'];
                        $aadhar = $getMissingPerson[0]['missingaadhar'];
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getMissingPerson[0]['missingdob']);
                        $age = ($from->diff($to)->y);
                        if(count($getIfPersonAvailable) > 0)
                        {
                            $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                        }else{
                            $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                        }
                        if(count($getIfPersonAvailable) == 0)
                        {
                            if($userphoto == '' || $userphoto == base_url())
                            {
                                $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : '');
                            }
                        }
                    }
                }else{
                    $getFullDetail = $this->db->query('select * from missingpersondetail where missingId='.$getMissingPerson[0]['Id'])->result_array();
                    if(count($getFullDetail) > 0)
                    {
                        $isMissing = 1; 
                        if($isUserFound != 1)
                        {
                            $personName = $getMissingPerson[0]['missingname'];
                            $gender = $getMissingPerson[0]['missinggender'];
                            $aadhar = $getMissingPerson[0]['missingaadhar'];
                            $from=new DateTime(date('Y-m-d'));
                            $to   = new DateTime($getMissingPerson[0]['missingdob']);
                            $age = ($from->diff($to)->y);
                            if(count($getIfPersonAvailable) > 0)
                            {
                                $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                            }else{
                                $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                            }
                            if(count($getIfPersonAvailable) == 0)
                            {
                                if($userphoto == '' || $userphoto == base_url())
                                {
                                    $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : 'assets/img/noimage.jpg');
                                }
                            }
                        }
                    }else{
                        $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$_POST['idNumber'].'"')->result_array();
                        if(count($getUserDetail) > 0)
                        {
                            $isMissing = 1; 
                            if($isUserFound != 1)
                            {
                                $personName = $getUserDetail[0]['aadharname'];
                                $gender = $getUserDetail[0]['gender'];
                                $aadhar = $getUserDetail[0]['aadhar_id'];
                                $from=new DateTime(date('Y-m-d'));
                                $to   = new DateTime($getUserDetail[0]['dob']);
                                $age = ($from->diff($to)->y);
                                $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                if(count($getIfPersonAvailable) == 0)
                                {
                                    if($userphoto == '' || $userphoto == base_url())
                                    {
                                        $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : '');
                                    }
                                }
                            }
                        }
                    }
                }
            }
            $getIfLapataAvailable = $this->db->query('select * from unknown_person where isFinalSubmitted=1 and awsEventName="All" and isFound=0 and aadharNumber="'.$_POST['idNumber'].'" and expiryDate >= "'.date('Y-m-d h:i:s').'" order by dateCreated desc')->result_array();
            if(count($getIfLapataAvailable) > 0)
            {
                $isAadharCorrect = 1;
                $isVisible = 1;
                $isLapata = 1;
                $lapataId = $getIfLapataAvailable[0]['id'];
                $isMissing = 0;
                $missingId = 0;
                if(!$isUserFound)
                {
                    $isVerified = 0;
                    $personName = $getIfLapataAvailable[0]['person_name'];
                    $gender = ($getIfLapataAvailable[0]['Gender'] == 'boy' ? 'MALE' : 'FEMALE');
                    $aadhar = $getIfLapataAvailable[0]['aadharNumber'];
                    $age = ($getIfLapataAvailable[0]['Age']);
                    $address = $getIfLapataAvailable[0]['city'].','.$getIfLapataAvailable[0]['state'];
                    $userphoto = base_url().''.(($getIfLapataAvailable[0]['Photo'] != NULL) ? $getIfLapataAvailable[0]['Photo'] : $userphoto);
                }
            }

            if($this->getSettings('mahakumbhIdentity') == 'Yes')
            {
                $getIfKhoyaPayaAvailable = $this->db->query('select * from mahakumbhSpecial where isFound=0 and aadharNumber="'.$_POST['idNumber'].'" order by dateCreated desc')->result_array();
                if(count($getIfKhoyaPayaAvailable) > 0)
                {
                    $isAadharCorrect = 1;
                    $isVisible = 1;
                    $isKhoya = 1;
                    $khoyaId = $getIfKhoyaPayaAvailable[0]['id'];
                    $isMissing = 0;
                    $missingId = 0;
                    if(!$isUserFound)
                    {
                        $isVerified = 0;
                        $personName = $getIfKhoyaPayaAvailable[0]['person_name'];
                        $gender = ($getIfKhoyaPayaAvailable[0]['Gender'] == 'Male' ? 'MALE' : 'FEMALE');
                        $aadhar = $getIfKhoyaPayaAvailable[0]['aadharNumber'];
                        $age = ($getIfKhoyaPayaAvailable[0]['AgeBand']);
                        $address = $getIfKhoyaPayaAvailable[0]['district'].','.$getIfKhoyaPayaAvailable[0]['state'];
                        $userphoto = base_url().''.(($getIfKhoyaPayaAvailable[0]['Photo'] != NULL) ? $getIfKhoyaPayaAvailable[0]['Photo'] : $userphoto);
                    }
                }
            }

            if($isLapata != 1)
            {
                $getIfUnknownAvailable = $this->db->query('select * from unknown_person where isFinalSubmitted=1 and awsEventName !="All" and isFound=0 and aadharNumber="'.$_POST['idNumber'].'" order by dateCreated desc')->result_array();
                // $getIfUnknownAvailable = array();
                if(count($getIfUnknownAvailable) > 0)
                {
                    $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$getIfUnknownAvailable[0]['id'])->result_array();
                    if($isUserFound != 1)
                    {
                        if($getIfUnknownAvailable[0]['uploaded_by'] == 'police')
                        {
                            $getPoliceDetail = $this->db->query('select * from police where police_id='.$getIfUnknownAvailable[0]['policeId'])->result_array();
                            $finalresponse = array(
                                'isUserFound' => $isUserFound,
                                'status' => 'unknown',
                                'isLapata' => $isLapata,
                                'isKhoya' => $isKhoya,
                                'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                'type' => 'police',
                                'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                'address' => strtoupper($getPoliceDetail[0]['thanaName'].' - '.$getPoliceDetail[0]['state'].', '.$getPoliceDetail[0]['district']),
                                'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                'age' => $getIfUnknownAvailable[0]['Age'],
                                'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                'id' => $getIfUnknownAvailable[0]['Application_no'],
                                'registration_mobile' => (($getPoliceDetail[0]['registration_mobile'] != NULL) ? $getPoliceDetail[0]['registration_mobile'] : ''),
                                'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                            );   
                        }
                        else
                        {
                            if($getIfUnknownAvailable[0]['uploaded_by']=='user')
                            {
                                $getUserDetail = $this->db->query('select * from user where uid='.$getIfUnknownAvailable[0]['userId'])->result_array();
                                $finalresponse = array(
                                    'status' => 'unknown',
                                    'isUserFound' => $isUserFound,
                                    'isLapata' => $isLapata,
                                    'isKhoya' => $isKhoya,
                                    'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                    'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                    'type' => 'ngo',
                                    'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                    'address' => strtoupper($getUserDetail[0]['vtc'].' - '.$getUserDetail[0]['state'].', '.$getUserDetail[0]['district']),
                                    'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                    'age' => $getIfUnknownAvailable[0]['Age'],
                                    'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                    'registration_mobile' => (($getUserDetail[0]['registration_mobile'] != NULL) ? $getUserDetail[0]['registration_mobile'] : ''),
                                    'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                    'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                    'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                                    'id' => $getIfUnknownAvailable[0]['Application_no']
                                );   
                            }
                            else
                            {
                                $getNgoDetail = $this->db->query('select * from ngo where Id='.$getIfUnknownAvailable[0]['ngoId'])->result_array();
                                $finalresponse = array(
                                    'isUserFound' => $isUserFound,
                                    'status' => 'unknown',
                                    'isLapata' => $isLapata,
                                    'isKhoya' => $isKhoya,
                                    'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                    'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                    'type' => 'ngo',
                                    'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                    'address' => strtoupper($getNgoDetail[0]['ngoName'].' - '.$getNgoDetail[0]['ngoState'].', '.$getNgoDetail[0]['ngoDistrict'].', '.$getNgoDetail[0]['ngoCity']),
                                    'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                    'age' => $getIfUnknownAvailable[0]['Age'],
                                    'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                    'registration_mobile' => (($getNgoDetail[0]['ngoRegistrationNumber'] != NULL) ? $getNgoDetail[0]['ngoRegistrationNumber'] : ''),
                                    'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                    'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                    'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                                    'id' => $getIfUnknownAvailable[0]['Application_no']
                                );   
                            }
                            
                        }
                    }else{
                        $finalresponse = array(
                            'isUserFound' => $isUserFound,
                            'status' => 'unknown',
                            'isLapata' => $isLapata,
                            'isKhoya' => $isKhoya,
                            'personName' => strtoupper($personName),
                            'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                            'address' => strtoupper($address),
                            'photo' => ($userphoto != '' ? $userphoto : base_url().$getIfUnknownAvailable[0]['Photo']),
                            'age' => $age,
                            'gender' => strtolower($gender),
                            'id' => $getIfUnknownAvailable[0]['Application_no']
                        );
                    }
                    $insertdata = array(
                        'lapataId' => $lapataId,
                        'isLapata' => $isLapata,
                        'khoyaId' => $khoyaId,
                        'isKhoya' => $isKhoya,
                        'wantedIds' => implode(',',$wantedId),
                        'criminalIds' => implode(',',$criminalId),
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'idNumber' => $_POST['idNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    echo json_encode($finalresponse);
                }else{
                    $insertdata = array(
                        'lapataId' => $lapataId,
                        'isLapata' => $isLapata,
                        'khoyaId' => $khoyaId,
                        'isKhoya' => $isKhoya,
                        'wantedIds' => implode(',',$wantedId),
                        'criminalIds' => implode(',',$criminalId),
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'idNumber' => $_POST['idNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    if($update)
                    {
                        if($isAadharCorrect == 1)
                        {
                            $isOnlyUser = 0;
                            if(!$isWanted && !$isLapata && !$isCriminal && !$isMissing)
                            {
                                $isOnlyUser = 1;
                            }
                            $response = array(
                                'personId' => $personId,
                                'isOnlyUser' => $isOnlyUser,
                                'status' => 'success',
                                'personName' => $personName,
                                'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                                'gender' => strtolower($gender),
                                'isWanted' => $isWanted,
                                'isLapata' => $isLapata,
                                'isKhoya' => $isKhoya,
                                'isCriminal' => $isCriminal,
                                'age' => $age,
                                'address' => $address,
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => 1,
                                'isGenderCorrect' => 1,
                                'message' => 'Person Found',
                                'isVisible' => $isVisible,
                                'isMissing' => $isMissing,
                                'isVerified' => $isVerified,
                                'isRegistered' => $isUserFound,
                                'image' => ($userphoto != '' ? $userphoto : base_url().'assets/img/noimage.jpg')
                            );
                            echo json_encode($response);   
                        }else{
                            $response = array(
                                'status' => 'incorrect',
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => 1,
                                'isGenderCorrect' => 1,
                            );
                            echo json_encode($response);   
                        }
                    }else{
                        $response = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                        echo json_encode($response);
                    }
                }   
            }else{
                $getApplicationNumber = $this->db->query('select * from unknown_person where id='.$lapataId)->result_array();
                $insertdata = array(
                    'khoyaId' => $khoyaId,
                    'isKhoya' => $isKhoya,
                    'lapataId' => $lapataId,
                    'isLapata' => $isLapata,
                    'wantedIds' => implode(',',$wantedId),
                    'criminalIds' => implode(',',$criminalId),
                    'isPersonFound' => $isUserFound,
                    'isMissing' => $isMissing,
                    'idNumber' => $_POST['idNumber'],
                    'idType' => $_POST['idType'],
                );
                $this->db->where('Id',$_SESSION['checkId']);
                $update = $this->db->update('checkperson',$insertdata);
                if($update)
                {
                    if($isAadharCorrect == 1)
                    {
                        $isOnlyUser = 0;
                        if(!$isWanted && !$isLapata && !$isCriminal && !$isMissing)
                        {
                            $isOnlyUser = 1;
                        }
                        $response = array(
                            'personId' => $personId,
                            'isOnlyUser' => $isOnlyUser,
                            'status' => 'success',
                            'personName' => $personName,
                            'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                            'gender' => strtolower($gender),
                            'isWanted' => $isWanted,
                            'isLapata' => $isLapata,
                            'isKhoya' => $isKhoya,
                            'isCriminal' => $isCriminal,
                            'age' => $age,
                            'address' => $address,
                            'isAadharCorrect' => $isAadharCorrect,
                            'isDobCorrect' => 1,
                            'isGenderCorrect' => 1,
                            'message' => 'Person Found',
                            'isVisible' => $isVisible,
                            'isMissing' => $isMissing,
                            'isVerified' => $isVerified,
                            'isRegistered' => $isUserFound,
                            'image' => ($userphoto != '' ? $userphoto : base_url().'assets/img/noimage.jpg')
                        );
                        echo json_encode($response);   
                    }else{
                        $response = array(
                            'status' => 'incorrect',
                            'isAadharCorrect' => $isAadharCorrect,
                            'isDobCorrect' => 1,
                            'isGenderCorrect' => 1,
                        );
                        echo json_encode($response);   
                    }
                }else{
                    $response = array(
                        'status' => 'error',
                        'message' => 'Something Went Wrong'
                    );
                    echo json_encode($response);
                }   
            }
        }
        if($_POST['idType'] == 'dl')
        {
            $idNumber = $_POST['idNumber'];
            $getIfAlready = $this->db->query('select * from dllist where dlNumber="'.$idNumber.'"')->result_array();
            if(count($getIfAlready) > 0)
            {
                $getIfPersonAvailable = $this->db->query('select * from user where uid='.$getIfAlready[0]['userId'])->result_array();   
            }else{
                $getIfPersonAvailable = array();
            }
            $userphoto = '';
            if(count($getIfPersonAvailable) > 0)
            {
                $personId = $getIfPersonAvailable[0]['uid'];
                $isAadharCorrect = 1;
                $isVisible = $getIfPersonAvailable[0]['visibility'];
                $isVerified = 1;
                $isUserFound = 1;
                $personName = $getIfPersonAvailable[0]['aadharname'];
                $gender = $getIfPersonAvailable[0]['gender'];
                $aadhar = $getIfPersonAvailable[0]['aadhar_id'];
                $from=new DateTime(date('Y-m-d'));
                $to   = new DateTime($getIfPersonAvailable[0]['dob']);
                $age = ($from->diff($to)->y);
                $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                $userphoto = base_url().''.(($getIfPersonAvailable[0]['aadharphoto'] != NULL) ? $getIfPersonAvailable[0]['aadharphoto'] : $getIfPersonAvailable[0]['facematchphoto']);
            }
            if(count($getIfPersonAvailable) > 0)
            {
                $getIfWantedAvailable = $this->db->query('select * from criminals where aadharNumber="'.$getIfPersonAvailable[0]['aadhar_id'].'" and isFinalSubmitted=1 and type="wanted" and status="Active"')->result_array();   
            }else{
                $getIfWantedAvailable = array();
            }
            if(count($getIfWantedAvailable) > 0)
            {
                $isVisible = 1;
                $isAadharCorrect = 1;
                $isWanted = 1;
                if($isUserFound != 1)
                {
                    $personName = $getIfWantedAvailable[0]['personName'];
                    $gender = $getIfWantedAvailable[0]['gender'];
                    $aadhar = $getIfWantedAvailable[0]['aadharNumber'];
                    if($getIfWantedAvailable[0]['dob'] != '0000-00-00')
                    {
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfWantedAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                    }else{
                        $age = '';
                    }
                    $address = '';
                    if($getIfWantedAvailable[0]['state'] != '')
                    {
                        $address .= $getIfWantedAvailable[0]['state'];
                    }
                    if($getIfWantedAvailable[0]['district'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfWantedAvailable[0]['district'];
                        }else{
                            $address .= $getIfWantedAvailable[0]['district'];
                        }
                    }
                    if($getIfWantedAvailable[0]['city'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfWantedAvailable[0]['city'];
                        }else{
                            $address .= $getIfWantedAvailable[0]['city'];
                        }
                    }
                    $getPhotos = $this->db->query('select * from criminalphotos where crimeId='.$getIfWantedAvailable[0]['Id'])->result_array();
                    if($userphoto == '' || $userphoto == base_url())
                    {
                        $userphoto = ((count($getPhotos) > 0) ? base_url().''.$getPhotos[0]['photourl'] : base_url().''.$getIfWantedAvailable[0]['photo']);   
                    }
                }
                foreach($getIfWantedAvailable as $k=>$v)
                {
                    array_push($wantedId,$v['Id']);
                }
            }
            if(count($getIfPersonAvailable) > 0)
            {
                $getIfCriminalAvailable = $this->db->query('select * from criminals where aadharNumber="'.$getIfPersonAvailable[0]['aadhar_id'].'" and isFinalSubmitted=1 and type="criminal" and status="Active"')->result_array();   
            }else{
                $getIfCriminalAvailable = array();
            }
            if(count($getIfCriminalAvailable) > 0)
            {
                $isVisible = 1;
                $isAadharCorrect = 1;
                $isCriminal = 1;
                if($isUserFound != 1)
                {
                    $personName = $getIfCriminalAvailable[0]['personName'];
                    $gender = $getIfCriminalAvailable[0]['gender'];
                    $aadhar = $getIfCriminalAvailable[0]['aadharNumber'];
                    if($getIfCriminalAvailable[0]['dob'] != '0000-00-00')
                    {
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfCriminalAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                    }else{
                        $age = '';
                    }
                    $address = '';
                    if($getIfCriminalAvailable[0]['state'] != '')
                    {
                        $address .= $getIfCriminalAvailable[0]['state'];
                    }
                    if($getIfCriminalAvailable[0]['district'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfCriminalAvailable[0]['district'];
                        }else{
                            $address .= $getIfCriminalAvailable[0]['district'];
                        }
                    }
                    if($getIfCriminalAvailable[0]['city'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfCriminalAvailable[0]['city'];
                        }else{
                            $address .= $getIfCriminalAvailable[0]['city'];
                        }
                    }
                    $getPhotos = $this->db->query('select * from criminalphotos where crimeId='.$getIfCriminalAvailable[0]['Id'])->result_array();
                    if($userphoto == '' || $userphoto == base_url())
                    {
                        $userphoto = ((count($getPhotos) > 0) ? base_url().''.$getPhotos[0]['photourl'] : base_url().''.$getIfCriminalAvailable[0]['photo']);   
                    }
                }
                foreach($getIfCriminalAvailable as $k=>$v)
                {
                    array_push($criminalId,$v['Id']);
                }
            }
            if(count($getIfPersonAvailable) > 0)
            {
                $getMissingPerson = $this->db->query('select * from missingperson where missingaadhar="'.$getIfPersonAvailable[0]['aadhar_id'].'" and isFound != 1')->result_array();   
            }else{
                $getMissingPerson = array();
            }
            if(count($getMissingPerson) > 0)
            {
                $isVisible = 1;
                $isAadharCorrect = 1;
                if($getMissingPerson[0]['missinggender'] != NULL)
                {
                    $isMissing = 1;
                    if($isUserFound != 1)
                    {
                        $personName = $getMissingPerson[0]['missingname'];
                        $gender = $getMissingPerson[0]['missinggender'];
                        $aadhar = $getMissingPerson[0]['missingaadhar'];
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getMissingPerson[0]['missingdob']);
                        $age = ($from->diff($to)->y);
                        if(count($getIfPersonAvailable) > 0)
                        {
                            $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                        }else{
                            $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                        }
                        if(count($getIfPersonAvailable) == 0)
                        {
                            if($userphoto == '' || $userphoto == base_url())
                            {
                                $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : '');
                            }
                        }
                    }
                }else{
                    $getFullDetail = $this->db->query('select * from missingpersondetail where missingId='.$getMissingPerson[0]['Id'])->result_array();
                    if(count($getFullDetail) > 0)
                    {
                        $isMissing = 1; 
                        if($isUserFound != 1)
                        {
                            $personName = $getMissingPerson[0]['missingname'];
                            $gender = $getMissingPerson[0]['missinggender'];
                            $aadhar = $getMissingPerson[0]['missingaadhar'];
                            $from=new DateTime(date('Y-m-d'));
                            $to   = new DateTime($getMissingPerson[0]['missingdob']);
                            $age = ($from->diff($to)->y);
                            if(count($getIfPersonAvailable) > 0)
                            {
                                $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                            }else{
                                $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                            }
                            if(count($getIfPersonAvailable) == 0)
                            {
                                if($userphoto == '' || $userphoto == base_url())
                                {
                                    $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : '');
                                }
                            }
                        }
                    }else{
                        $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$getIfPersonAvailable[0]['aadhar_id'].'"')->result_array();
                        if(count($getUserDetail) > 0)
                        {
                            $isMissing = 1; 
                            if($isUserFound != 1)
                            {
                                $personName = $getUserDetail[0]['aadharname'];
                                $gender = $getUserDetail[0]['gender'];
                                $aadhar = $getUserDetail[0]['aadhar_id'];
                                $from=new DateTime(date('Y-m-d'));
                                $to   = new DateTime($getUserDetail[0]['dob']);
                                $age = ($from->diff($to)->y);
                                $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                if(count($getIfPersonAvailable) == 0)
                                {
                                    if($userphoto == '' || $userphoto == base_url())
                                    {
                                        $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : '');
                                    }
                                }
                            }
                        }
                    }
                }
            }
            $getIfLapataAvailable = $this->db->query('select * from unknown_person where isFinalSubmitted=1 and awsEventName="All" and isFound=0 and DL_no="'.$_POST['idNumber'].'" and expiryDate >= "'.date('Y-m-d h:i:s').'"')->result_array();
            if(count($getIfLapataAvailable) > 0)
            {
                $isAadharCorrect = 1;
                $isVisible = 1;
                $isLapata = 1;
                $lapataId = $getIfLapataAvailable[0]['id'];
                $isMissing = 0;
                $missingId = 0;
                if(!$isUserFound)
                {
                    $isVerified = 0;
                    $personName = $getIfLapataAvailable[0]['person_name'];
                    $gender = ($getIfLapataAvailable[0]['Gender'] == 'boy' ? 'MALE' : 'FEMALE');
                    $aadhar = $getIfLapataAvailable[0]['aadharNumber'];
                    $age = ($getIfLapataAvailable[0]['Age']);
                    $address = $getIfLapataAvailable[0]['city'].','.$getIfLapataAvailable[0]['state'];
                    $userphoto = base_url().''.(($getIfLapataAvailable[0]['Photo'] != NULL) ? $getIfLapataAvailable[0]['Photo'] : $userphoto);
                }
            }
            if($this->getSettings('mahakumbhIdentity') == 'Yes')
            {
                $getIfKhoyaPayaAvailable = $this->db->query('select * from mahakumbhSpecial where isFound=0 and DL_no="'.$_POST['idNumber'].'" order by dateCreated desc')->result_array();
                if(count($getIfKhoyaPayaAvailable) > 0)
                {
                    $isAadharCorrect = 1;
                    $isVisible = 1;
                    $isKhoya = 1;
                    $khoyaId = $getIfKhoyaPayaAvailable[0]['id'];
                    $isMissing = 0;
                    $missingId = 0;
                    if(!$isUserFound)
                    {
                        $isVerified = 0;
                        $personName = $getIfKhoyaPayaAvailable[0]['person_name'];
                        $gender = ($getIfKhoyaPayaAvailable[0]['Gender'] == 'Male' ? 'MALE' : 'FEMALE');
                        $aadhar = $getIfKhoyaPayaAvailable[0]['aadharNumber'];
                        $age = ($getIfKhoyaPayaAvailable[0]['AgeBand']);
                        $address = $getIfKhoyaPayaAvailable[0]['district'].','.$getIfKhoyaPayaAvailable[0]['state'];
                        $userphoto = base_url().''.(($getIfKhoyaPayaAvailable[0]['Photo'] != NULL) ? $getIfKhoyaPayaAvailable[0]['Photo'] : $userphoto);
                    }
                }
            }
            if($isLapata != 1)
            {
                $getIfUnknownAvailable = $this->db->query('select * from unknown_person where isFinalSubmitted=1 and awsEventName !="All" and isFound=0 and DL_no="'.$_POST['idNumber'].'" order by id desc')->result_array();
                // $getIfUnknownAvailable = array();
                if(count($getIfUnknownAvailable) > 0)
                {
                    if($isUserFound != 1)
                    {
                        if($getIfUnknownAvailable[0]['uploaded_by'] == 'police')
                        {
                            $getPoliceDetail = $this->db->query('select * from police where police_id='.$getIfUnknownAvailable[0]['policeId'])->result_array();
                            $finalresponse = array(
                                'isUserFound' => $isUserFound,
                                'status' => 'unknown',
                                'isKhoya' => $isKhoya,
                                'isLapata' => $isLapata,
                                'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                'type' => 'police',
                                'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                'address' => strtoupper($getPoliceDetail[0]['thanaName'].' - '.$getPoliceDetail[0]['state'].', '.$getPoliceDetail[0]['district']),
                                'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                'age' => $getIfUnknownAvailable[0]['Age'],
                                'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                'id' => $getIfUnknownAvailable[0]['Application_no'],
                                'registration_mobile' => (($getPoliceDetail[0]['registration_mobile'] != NULL) ? $getPoliceDetail[0]['registration_mobile'] : ''),
                                'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                            );   
                        }
                        else
                        {
                            if($getIfUnknownAvailable[0]['uploaded_by']=='user')
                            {
                                $getUserDetail = $this->db->query('select * from user where uid='.$getIfUnknownAvailable[0]['userId'])->result_array();
                                $finalresponse = array(
                                    'status' => 'unknown',
                                    'isUserFound' => $isUserFound,
                                    'isLapata' => $isLapata,
                                    'isKhoya' => $isKhoya,
                                    'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                    'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                    'type' => 'ngo',
                                    'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                    'address' => strtoupper($getUserDetail[0]['vtc'].' - '.$getUserDetail[0]['state'].', '.$getUserDetail[0]['district']),
                                    'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                    'age' => $getIfUnknownAvailable[0]['Age'],
                                    'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                    'registration_mobile' => (($getUserDetail[0]['registration_mobile'] != NULL) ? $getUserDetail[0]['registration_mobile'] : ''),
                                    'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                    'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                    'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                                    'id' => $getIfUnknownAvailable[0]['Application_no']
                                );   
                            }
                            else
                            {
                                $getNgoDetail = $this->db->query('select * from ngo where Id='.$getIfUnknownAvailable[0]['ngoId'])->result_array();
                                $finalresponse = array(
                                    'status' => 'unknown',
                                    'isUserFound' => $isUserFound,
                                    'isKhoya' => $isKhoya,
                                    'isLapata' => $isLapata,
                                    'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                    'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                    'type' => 'ngo',
                                    'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                    'address' => strtoupper($getNgoDetail[0]['ngoName'].' - '.$getNgoDetail[0]['ngoState'].', '.$getNgoDetail[0]['ngoDistrict'].', '.$getNgoDetail[0]['ngoCity']),
                                    'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                    'age' => $getIfUnknownAvailable[0]['Age'],
                                    'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                    'registration_mobile' => (($getNgoDetail[0]['ngoRegistrationNumber'] != NULL) ? $getNgoDetail[0]['ngoRegistrationNumber'] : ''),
                                    'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                    'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                    'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                                    'id' => $getIfUnknownAvailable[0]['Application_no']
                                );  
                            }
                             
                        }
                    }else{
                        $finalresponse = array(
                            'isUserFound' => $isUserFound,
                            'status' => 'unknown',
                            'isKhoya' => $isKhoya,
                            'isLapata' => $isLapata,
                            'personName' => strtoupper($personName),
                            'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                            'address' => strtoupper($address),
                            'photo' => ($userphoto != '' ? $userphoto : base_url().$getIfUnknownAvailable[0]['Photo']),
                            'age' => $age,
                            'gender' => strtolower($gender),
                            'id' => $getIfUnknownAvailable[0]['Application_no']
                        );
                    }
                    $insertdata = array(
                        'lapataId' => $lapataId,
                        'isLapata' => $isLapata,
                        'khoyaId' => $khoyaId,
                        'isKhoya' => $isKhoya,
                        'wantedIds' => implode(',',$wantedId),
                        'criminalIds' => implode(',',$criminalId),
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'idNumber' => $_POST['idNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    echo json_encode($finalresponse);
                }else{
                    $insertdata = array(
                        'lapataId' => $lapataId,
                        'khoyaId' => $khoyaId,
                        'isKhoya' => $isKhoya,
                        'isLapata' => $isLapata,
                        'wantedIds' => implode(',',$wantedId),
                        'criminalIds' => implode(',',$criminalId),
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'idNumber' => $_POST['idNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    if($update)
                    {
                        if($isAadharCorrect == 1)
                        {
                            $isOnlyUser = 0;
                            if(!$isWanted && !$isLapata && !$isCriminal && !$isMissing)
                            {
                                $isOnlyUser = 1;
                            }
                            $response = array(
                                'personId' => $personId,
                                'isOnlyUser' => $isOnlyUser,
                                'status' => 'success',
                                'personName' => $personName,
                                'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                                'gender' => strtolower($gender),
                                'isWanted' => $isWanted,
                                'isLapata' => $isLapata,
                                'isKhoya' => $isKhoya,
                                'isCriminal' => $isCriminal,
                                'age' => $age,
                                'address' => $address,
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => 1,
                                'isGenderCorrect' => 1,
                                'message' => 'Person Found',
                                'isVisible' => $isVisible,
                                'isMissing' => $isMissing,
                                'isVerified' => $isVerified,
                                'isRegistered' => $isUserFound,
                                'image' => ($userphoto != '' ? $userphoto : base_url().'assets/img/noimage.jpg')
                            );
                            echo json_encode($response);   
                        }else{
                            $response = array(
                                'status' => 'incorrect',
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => 1,
                                'isGenderCorrect' => 1,
                            );
                            echo json_encode($response);   
                        }
                    }else{
                        $response = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                        echo json_encode($response);
                    }
                }   
            }else{
                $insertdata = array(
                'khoyaId' => $khoyaId,
                'isKhoya' => $isKhoya,
                'lapataId' => $lapataId,
                'isLapata' => $isLapata,
                'wantedIds' => implode(',',$wantedId),
                'criminalIds' => implode(',',$criminalId),
                'isPersonFound' => $isUserFound,
                'isMissing' => $isMissing,
                'idNumber' => $_POST['idNumber'],
                'idType' => $_POST['idType'],
            );
            $this->db->where('Id',$_SESSION['checkId']);
            $update = $this->db->update('checkperson',$insertdata);
            if($update)
            {
                if($isAadharCorrect == 1)
                {
                    $isOnlyUser = 0;
                    if(!$isWanted && !$isLapata && !$isCriminal && !$isMissing)
                    {
                        $isOnlyUser = 1;
                    }
                    $response = array(
                        'personId' => $personId,
                        'isOnlyUser' => $isOnlyUser,
                        'status' => 'success',
                        'personName' => $personName,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'isWanted' => $isWanted,
                        'isKhoya' => $isKhoya,
                        'isLapata' => $isLapata,
                        'isCriminal' => $isCriminal,
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => 1,
                        'isGenderCorrect' => 1,
                        'message' => 'Person Found',
                        'isVisible' => $isVisible,
                        'isMissing' => $isMissing,
                        'isVerified' => $isVerified,
                        'isRegistered' => $isUserFound,
                        'image' => ($userphoto != '' ? $userphoto : base_url().'assets/img/noimage.jpg')
                    );
                    echo json_encode($response);   
                }else{
                    $response = array(
                        'status' => 'incorrect',
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => 1,
                        'isGenderCorrect' => 1,
                    );
                    echo json_encode($response);   
                }
            }else{
                $response = array(
                    'status' => 'error',
                    'message' => 'Something Went Wrong'
                );
                echo json_encode($response);
            }   
            }
        }
        if($_POST['idType'] == 'voter')
        {
            $idNumber = $_POST['idNumber'];
            $getIfAlready = $this->db->query('select * from voterslist where voterNumber="'.$idNumber.'"')->result_array();
            if(count($getIfAlready) > 0)
            {
                $getIfPersonAvailable = $this->db->query('select * from user where uid='.$getIfAlready[0]['userId'])->result_array();   
            }else{
                $getIfPersonAvailable = array();
            }
            $userphoto = '';
            if(count($getIfPersonAvailable) > 0)
            {
                $personId = $getIfPersonAvailable[0]['uid'];
                $isAadharCorrect = 1;
                $isVisible = $getIfPersonAvailable[0]['visibility'];
                $isVerified = 1;
                $isUserFound = 1;
                $personName = $getIfPersonAvailable[0]['aadharname'];
                $gender = $getIfPersonAvailable[0]['gender'];
                $aadhar = $getIfPersonAvailable[0]['aadhar_id'];
                $from=new DateTime(date('Y-m-d'));
                $to   = new DateTime($getIfPersonAvailable[0]['dob']);
                $age = ($from->diff($to)->y);
                $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                $userphoto = base_url().''.(($getIfPersonAvailable[0]['aadharphoto'] != NULL) ? $getIfPersonAvailable[0]['aadharphoto'] : $getIfPersonAvailable[0]['facematchphoto']);
            }
            if(count($getIfPersonAvailable) > 0)
            {
                $getIfWantedAvailable = $this->db->query('select * from criminals where aadharNumber="'.$getIfPersonAvailable[0]['aadhar_id'].'" and isFinalSubmitted=1 and type="wanted" and status="Active"')->result_array();   
            }else{
                $getIfWantedAvailable = array();
            }
            if(count($getIfWantedAvailable) > 0)
            {
                $isVisible = 1;
                $isAadharCorrect = 1;
                $isWanted = 1;
                if($isUserFound != 1)
                {
                    $personName = $getIfWantedAvailable[0]['personName'];
                    $gender = $getIfWantedAvailable[0]['gender'];
                    $aadhar = $getIfWantedAvailable[0]['aadharNumber'];
                    if($getIfWantedAvailable[0]['dob'] != '0000-00-00')
                    {
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfWantedAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                    }else{
                        $age = '';
                    }
                    $address = '';
                    if($getIfWantedAvailable[0]['state'] != '')
                    {
                        $address .= $getIfWantedAvailable[0]['state'];
                    }
                    if($getIfWantedAvailable[0]['district'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfWantedAvailable[0]['district'];
                        }else{
                            $address .= $getIfWantedAvailable[0]['district'];
                        }
                    }
                    if($getIfWantedAvailable[0]['city'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfWantedAvailable[0]['city'];
                        }else{
                            $address .= $getIfWantedAvailable[0]['city'];
                        }
                    }
                    $getPhotos = $this->db->query('select * from criminalphotos where crimeId='.$getIfWantedAvailable[0]['Id'])->result_array();
                    if($userphoto == '' || $userphoto == base_url())
                    {
                        $userphoto = ((count($getPhotos) > 0) ? base_url().''.$getPhotos[0]['photourl'] : base_url().''.$getIfWantedAvailable[0]['photo']);   
                    }
                }
                foreach($getIfWantedAvailable as $k=>$v)
                {
                    array_push($wantedId,$v['Id']);
                }
            }
            if(count($getIfPersonAvailable) > 0)
            {
                $getIfCriminalAvailable = $this->db->query('select * from criminals where aadharNumber="'.$getIfPersonAvailable[0]['aadhar_id'].'" and isFinalSubmitted=1 and type="criminal" and status="Active"')->result_array();   
            }else{
                $getIfCriminalAvailable = array();
            }
            if(count($getIfCriminalAvailable) > 0)
            {
                $isVisible = 1;
                $isAadharCorrect = 1;
                $isCriminal = 1;
                if($isUserFound != 1)
                {
                    $personName = $getIfCriminalAvailable[0]['personName'];
                    $gender = $getIfCriminalAvailable[0]['gender'];
                    $aadhar = $getIfCriminalAvailable[0]['aadharNumber'];
                    if($getIfCriminalAvailable[0]['dob'] != '0000-00-00')
                    {
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfCriminalAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                    }else{
                        $age = '';
                    }
                    $address = '';
                    if($getIfCriminalAvailable[0]['state'] != '')
                    {
                        $address .= $getIfCriminalAvailable[0]['state'];
                    }
                    if($getIfCriminalAvailable[0]['district'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfCriminalAvailable[0]['district'];
                        }else{
                            $address .= $getIfCriminalAvailable[0]['district'];
                        }
                    }
                    if($getIfCriminalAvailable[0]['city'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfCriminalAvailable[0]['city'];
                        }else{
                            $address .= $getIfCriminalAvailable[0]['city'];
                        }
                    }
                    $getPhotos = $this->db->query('select * from criminalphotos where crimeId='.$getIfCriminalAvailable[0]['Id'])->result_array();
                    if($userphoto == '' || $userphoto == base_url())
                    {
                        $userphoto = ((count($getPhotos) > 0) ? base_url().''.$getPhotos[0]['photourl'] : base_url().''.$getIfCriminalAvailable[0]['photo']);   
                    }
                }
                foreach($getIfCriminalAvailable as $k=>$v)
                {
                    array_push($criminalId,$v['Id']);
                }
            }
            if(count($getIfPersonAvailable) > 0)
            {
                $getMissingPerson = $this->db->query('select * from missingperson where missingaadhar="'.$getIfPersonAvailable[0]['aadhar_id'].'" and isFound != 1')->result_array();   
            }else{
                $getMissingPerson = array();
            }
            if(count($getMissingPerson) > 0)
            {
                $isVisible = 1;
                $isAadharCorrect = 1;
                if($getMissingPerson[0]['missinggender'] != NULL)
                {
                    $isMissing = 1;
                    if($isUserFound != 1)
                    {
                        $personName = $getMissingPerson[0]['missingname'];
                        $gender = $getMissingPerson[0]['missinggender'];
                        $aadhar = $getMissingPerson[0]['missingaadhar'];
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getMissingPerson[0]['missingdob']);
                        $age = ($from->diff($to)->y);
                        if(count($getIfPersonAvailable) > 0)
                        {
                            $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                        }else{
                            $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                        }
                        if(count($getIfPersonAvailable) == 0)
                        {
                            if($userphoto == '' || $userphoto == base_url())
                            {
                                $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : '');
                            }
                        }
                    }
                }else{
                    $getFullDetail = $this->db->query('select * from missingpersondetail where missingId='.$getMissingPerson[0]['Id'])->result_array();
                    if(count($getFullDetail) > 0)
                    {
                        $isMissing = 1; 
                        if($isUserFound != 1)
                        {
                            $personName = $getMissingPerson[0]['missingname'];
                            $gender = $getMissingPerson[0]['missinggender'];
                            $aadhar = $getMissingPerson[0]['missingaadhar'];
                            $from=new DateTime(date('Y-m-d'));
                            $to   = new DateTime($getMissingPerson[0]['missingdob']);
                            $age = ($from->diff($to)->y);
                            if(count($getIfPersonAvailable) > 0)
                            {
                                $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                            }else{
                                $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                            }
                            if(count($getIfPersonAvailable) == 0)
                            {
                                if($userphoto == '' || $userphoto == base_url())
                                {
                                    $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : '');
                                }
                            }
                        }
                    }else{
                        $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$getIfPersonAvailable[0]['aadhar_id'].'"')->result_array();
                        if(count($getUserDetail) > 0)
                        {
                            $isMissing = 1; 
                            if($isUserFound != 1)
                            {
                                $personName = $getUserDetail[0]['aadharname'];
                                $gender = $getUserDetail[0]['gender'];
                                $aadhar = $getUserDetail[0]['aadhar_id'];
                                $from=new DateTime(date('Y-m-d'));
                                $to   = new DateTime($getUserDetail[0]['dob']);
                                $age = ($from->diff($to)->y);
                                $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                if(count($getIfPersonAvailable) == 0)
                                {
                                    if($userphoto == '' || $userphoto == base_url())
                                    {
                                        $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : '');
                                    }
                                }
                            }
                        }
                    }
                }
            }
            $getIfLapataAvailable = $this->db->query('select * from unknown_person where isFinalSubmitted=1 and awsEventName="All" and isFound=0 and voter_id="'.$_POST['idNumber'].'" and expiryDate >= "'.date('Y-m-d h:i:s').'"')->result_array();
            if(count($getIfLapataAvailable) > 0)
            {
                $isAadharCorrect = 1;
                $isVisible = 1;
                $isLapata = 1;
                $lapataId = $getIfLapataAvailable[0]['id'];
                $isMissing = 0;
                $missingId = 0;
                if(!$isUserFound)
                {
                    $isVerified = 0;
                    $personName = $getIfLapataAvailable[0]['person_name'];
                    $gender = ($getIfLapataAvailable[0]['Gender'] == 'boy' ? 'MALE' : 'FEMALE');
                    $aadhar = $getIfLapataAvailable[0]['aadharNumber'];
                    $age = ($getIfLapataAvailable[0]['Age']);
                    $address = $getIfLapataAvailable[0]['city'].','.$getIfLapataAvailable[0]['state'];
                    $userphoto = base_url().''.(($getIfLapataAvailable[0]['Photo'] != NULL) ? $getIfLapataAvailable[0]['Photo'] : $userphoto);
                }
            }
            if($this->getSettings('mahakumbhIdentity') == 'Yes')
            {
                $getIfKhoyaPayaAvailable = $this->db->query('select * from mahakumbhSpecial where isFound=0 and voter_id="'.$_POST['idNumber'].'" order by dateCreated desc')->result_array();
                if(count($getIfKhoyaPayaAvailable) > 0)
                {
                    $isAadharCorrect = 1;
                    $isVisible = 1;
                    $isKhoya = 1;
                    $khoyaId = $getIfKhoyaPayaAvailable[0]['id'];
                    $isMissing = 0;
                    $missingId = 0;
                    if(!$isUserFound)
                    {
                        $isVerified = 0;
                        $personName = $getIfKhoyaPayaAvailable[0]['person_name'];
                        $gender = ($getIfKhoyaPayaAvailable[0]['Gender'] == 'Male' ? 'MALE' : 'FEMALE');
                        $aadhar = $getIfKhoyaPayaAvailable[0]['aadharNumber'];
                        $age = ($getIfKhoyaPayaAvailable[0]['AgeBand']);
                        $address = $getIfKhoyaPayaAvailable[0]['district'].','.$getIfKhoyaPayaAvailable[0]['state'];
                        $userphoto = base_url().''.(($getIfKhoyaPayaAvailable[0]['Photo'] != NULL) ? $getIfKhoyaPayaAvailable[0]['Photo'] : $userphoto);
                    }
                }
            }
            if($isLapata != 1)
            {
                $getIfUnknownAvailable = $this->db->query('select * from unknown_person where isFinalSubmitted=1 and awsEventName !="All" and isFound=0 and voter_id="'.$_POST['idNumber'].'" order by id desc')->result_array();
                // $getIfUnknownAvailable = array();
                if(count($getIfUnknownAvailable) > 0)
                {
                    if($isUserFound != 1)
                    {
                        if($getIfUnknownAvailable[0]['uploaded_by'] == 'police')
                        {
                            $getPoliceDetail = $this->db->query('select * from police where police_id='.$getIfUnknownAvailable[0]['policeId'])->result_array();
                            $finalresponse = array(
                                'status' => 'unknown',
                                'isLapata' => $isLapata,
                                'isKhoya' => $isKhoya,
                                'isUserFound' => $isUserFound,
                                'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                'type' => 'police',
                                'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                'address' => strtoupper($getPoliceDetail[0]['thanaName'].' - '.$getPoliceDetail[0]['state'].', '.$getPoliceDetail[0]['district']),
                                'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                'age' => $getIfUnknownAvailable[0]['Age'],
                                'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                'id' => $getIfUnknownAvailable[0]['Application_no'],
                                'registration_mobile' => (($getPoliceDetail[0]['registration_mobile'] != NULL) ? $getPoliceDetail[0]['registration_mobile'] : ''),
                                'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                            );   
                        }
                        else
                        {
                            if($getIfUnknownAvailable[0]['uploaded_by']=='user')
                            {
                                $getUserDetail = $this->db->query('select * from user where uid='.$getIfUnknownAvailable[0]['userId'])->result_array();
                                $finalresponse = array(
                                    'status' => 'unknown',
                                    'isKhoya' => $isKhoya,
                                    'isUserFound' => $isUserFound,
                                    'isLapata' => $isLapata,
                                    'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                    'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                    'type' => 'ngo',
                                    'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                    'address' => strtoupper($getUserDetail[0]['vtc'].' - '.$getUserDetail[0]['state'].', '.$getUserDetail[0]['district']),
                                    'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                    'age' => $getIfUnknownAvailable[0]['Age'],
                                    'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                    'registration_mobile' => (($getUserDetail[0]['registration_mobile'] != NULL) ? $getUserDetail[0]['registration_mobile'] : ''),
                                    'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                    'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                    'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                                    'id' => $getIfUnknownAvailable[0]['Application_no']
                                );   
                            }
                            else
                            {
                                $getNgoDetail = $this->db->query('select * from ngo where Id='.$getIfUnknownAvailable[0]['ngoId'])->result_array();
                                $finalresponse = array(
                                    'status' => 'unknown',
                                    'isLapata' => $isLapata,
                                    'isKhoya' => $isKhoya,
                                    'isUserFound' => $isUserFound,
                                    'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                    'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                    'type' => 'ngo',
                                    'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                    'address' => strtoupper($getNgoDetail[0]['ngoName'].' - '.$getNgoDetail[0]['ngoState'].', '.$getNgoDetail[0]['ngoDistrict'].', '.$getNgoDetail[0]['ngoCity']),
                                    'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                    'age' => $getIfUnknownAvailable[0]['Age'],
                                    'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                    'registration_mobile' => (($getNgoDetail[0]['ngoRegistrationNumber'] != NULL) ? $getNgoDetail[0]['ngoRegistrationNumber'] : ''),
                                    'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                    'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                    'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                                    'id' => $getIfUnknownAvailable[0]['Application_no']
                                ); 
                            }  
                        }
                    }else{
                        $finalresponse = array(
                            'isUserFound' => $isUserFound,
                            'status' => 'unknown',
                            'isLapata' => $isLapata,
                            'isKhoya' => $isKhoya,
                            'personName' => strtoupper($personName),
                            'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                            'address' => strtoupper($address),
                            'photo' => ($userphoto != '' ? $userphoto : base_url().$getIfUnknownAvailable[0]['Photo']),
                            'age' => $age,
                            'gender' => strtolower($gender),
                            'id' => $getIfUnknownAvailable[0]['Application_no']
                        );
                    }
                    $insertdata = array(
                        'lapataId' => $lapataId,
                        'khoyaId' => $khoyaId,
                        'isKhoya' => $isKhoya,
                        'isLapata' => $isLapata,
                        'wantedIds' => implode(',',$wantedId),
                        'criminalIds' => implode(',',$criminalId),
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'idNumber' => $_POST['idNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    echo json_encode($finalresponse);
                }else{
                    $insertdata = array(
                        'khoyaId' => $khoyaId,
                        'isKhoya' => $isKhoya,
                        'lapataId' => $lapataId,
                        'isLapata' => $isLapata,
                        'wantedIds' => implode(',',$wantedId),
                        'criminalIds' => implode(',',$criminalId),
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'idNumber' => $_POST['idNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    if($update)
                    {
                        if($isAadharCorrect == 1)
                        {
                            $isOnlyUser = 0;
                            if(!$isWanted && !$isLapata && !$isCriminal && !$isMissing)
                            {
                                $isOnlyUser = 1;
                            }
                            $response = array(
                                'personId' => $personId,
                                'isOnlyUser' => $isOnlyUser,
                                'status' => 'success',
                                'personName' => $personName,
                                'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                                'gender' => strtolower($gender),
                                'isWanted' => $isWanted,
                                'isLapata' => $isLapata,
                                'isCriminal' => $isCriminal,
                                'age' => $age,
                                'isKhoya' => $isKhoya,
                                'address' => $address,
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => 1,
                                'isGenderCorrect' => 1,
                                'message' => 'Person Found',
                                'isVisible' => $isVisible,
                                'isMissing' => $isMissing,
                                'isVerified' => $isVerified,
                                'isRegistered' => $isUserFound,
                                'image' => ($userphoto != '' ? $userphoto : base_url().'assets/img/noimage.jpg')
                            );
                            echo json_encode($response);   
                        }else{
                            $response = array(
                                'status' => 'incorrect',
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => 1,
                                'isGenderCorrect' => 1,
                            );
                            echo json_encode($response);   
                        }
                    }else{
                        $response = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                        echo json_encode($response);
                    }
                }   
            }else{
                $insertdata = array(
                    'khoyaId' => $khoyaId,
                    'isKhoya' => $isKhoya,
                    'lapataId' => $lapataId,
                    'isLapata' => $isLapata,
                    'wantedIds' => implode(',',$wantedId),
                    'criminalIds' => implode(',',$criminalId),
                    'isPersonFound' => $isUserFound,
                    'isMissing' => $isMissing,
                    'idNumber' => $_POST['idNumber'],
                    'idType' => $_POST['idType'],
                );
            $this->db->where('Id',$_SESSION['checkId']);
            $update = $this->db->update('checkperson',$insertdata);
            if($update)
            {
                if($isAadharCorrect == 1)
                {
                    $isOnlyUser = 0;
                    if(!$isWanted && !$isLapata && !$isCriminal && !$isMissing)
                    {
                        $isOnlyUser = 1;
                    }
                    $response = array(
                        'personId' => $personId,
                        'status' => 'success',
                        'isKhoya' => $isKhoya,
                        'isOnlyUser' => $isOnlyUser,
                        'personName' => $personName,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'isWanted' => $isWanted,
                        'isLapata' => $isLapata,
                        'isCriminal' => $isCriminal,
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => 1,
                        'isGenderCorrect' => 1,
                        'message' => 'Person Found',
                        'isVisible' => $isVisible,
                        'isMissing' => $isMissing,
                        'isVerified' => $isVerified,
                        'isRegistered' => $isUserFound,
                        'image' => ($userphoto != '' ? $userphoto : base_url().'assets/img/noimage.jpg')
                    );
                    echo json_encode($response);   
                }else{
                    $response = array(
                        'status' => 'incorrect',
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => 1,
                        'isGenderCorrect' => 1,
                    );
                    echo json_encode($response);   
                }
            }else{
                $response = array(
                    'status' => 'error',
                    'message' => 'Something Went Wrong'
                );
                echo json_encode($response);
            }   
            }
        }
        if($_POST['idType'] == 'pan')
        {
            $idNumber = $_POST['idNumber'];
            $getIfAlready = $this->db->query('select * from panlist where panNumber="'.$idNumber.'"')->result_array();
            if(count($getIfAlready) > 0)
            {
                $getIfPersonAvailable = $this->db->query('select * from user where uid='.$getIfAlready[0]['userId'])->result_array();   
            }else{
                $getIfPersonAvailable = array();
            }
            $userphoto = '';
            if(count($getIfPersonAvailable) > 0)
            {
                $personId = $getIfPersonAvailable[0]['uid'];
                $isAadharCorrect = 1;
                $isVisible = $getIfPersonAvailable[0]['visibility'];
                $isVerified = 1;
                $isUserFound = 1;
                $personName = $getIfPersonAvailable[0]['aadharname'];
                $gender = $getIfPersonAvailable[0]['gender'];
                $aadhar = $getIfPersonAvailable[0]['aadhar_id'];
                $from=new DateTime(date('Y-m-d'));
                $to   = new DateTime($getIfPersonAvailable[0]['dob']);
                $age = ($from->diff($to)->y);
                $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                $userphoto = base_url().''.(($getIfPersonAvailable[0]['aadharphoto'] != NULL) ? $getIfPersonAvailable[0]['aadharphoto'] : $getIfPersonAvailable[0]['facematchphoto']);
            }
            if(count($getIfPersonAvailable) > 0)
            {
                $getIfWantedAvailable = $this->db->query('select * from criminals where aadharNumber="'.$getIfPersonAvailable[0]['aadhar_id'].'" and isFinalSubmitted=1 and type="wanted" and status="Active"')->result_array();   
            }else{
                $getIfWantedAvailable = array();
            }
            if(count($getIfWantedAvailable) > 0)
            {
                $isVisible = 1;
                $isAadharCorrect = 1;
                $isWanted = 1;
                if($isUserFound != 1)
                {
                    $personName = $getIfWantedAvailable[0]['personName'];
                    $gender = $getIfWantedAvailable[0]['gender'];
                    $aadhar = $getIfWantedAvailable[0]['aadharNumber'];
                    if($getIfWantedAvailable[0]['dob'] != '0000-00-00')
                    {
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfWantedAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                    }else{
                        $age = '';
                    }
                    $address = '';
                    if($getIfWantedAvailable[0]['state'] != '')
                    {
                        $address .= $getIfWantedAvailable[0]['state'];
                    }
                    if($getIfWantedAvailable[0]['district'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfWantedAvailable[0]['district'];
                        }else{
                            $address .= $getIfWantedAvailable[0]['district'];
                        }
                    }
                    if($getIfWantedAvailable[0]['city'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfWantedAvailable[0]['city'];
                        }else{
                            $address .= $getIfWantedAvailable[0]['city'];
                        }
                    }
                    $getPhotos = $this->db->query('select * from criminalphotos where crimeId='.$getIfWantedAvailable[0]['Id'])->result_array();
                    if($userphoto == '' || $userphoto == base_url())
                    {
                        $userphoto = ((count($getPhotos) > 0) ? base_url().''.$getPhotos[0]['photourl'] : base_url().''.$getIfWantedAvailable[0]['photo']);   
                    }
                }
                foreach($getIfWantedAvailable as $k=>$v)
                {
                    array_push($wantedId,$v['Id']);
                }
            }
            if(count($getIfPersonAvailable) > 0)
            {
                $getIfCriminalAvailable = $this->db->query('select * from criminals where aadharNumber="'.$getIfPersonAvailable[0]['aadhar_id'].'" and isFinalSubmitted=1 and type="criminal" and status="Active"')->result_array();   
            }else{
                $getIfCriminalAvailable = array();
            }
            if(count($getIfCriminalAvailable) > 0)
            {
                $isVisible = 1;
                $isAadharCorrect = 1;
                $isCriminal = 1;
                if($isUserFound != 1)
                {
                    $personName = $getIfCriminalAvailable[0]['personName'];
                    $gender = $getIfCriminalAvailable[0]['gender'];
                    $aadhar = $getIfCriminalAvailable[0]['aadharNumber'];
                    if($getIfCriminalAvailable[0]['dob'] != '0000-00-00')
                    {
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getIfCriminalAvailable[0]['dob']);
                        $age = ($from->diff($to)->y);
                    }else{
                        $age = '';
                    }
                    $address = '';
                    if($getIfCriminalAvailable[0]['state'] != '')
                    {
                        $address .= $getIfCriminalAvailable[0]['state'];
                    }
                    if($getIfCriminalAvailable[0]['district'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfCriminalAvailable[0]['district'];
                        }else{
                            $address .= $getIfCriminalAvailable[0]['district'];
                        }
                    }
                    if($getIfCriminalAvailable[0]['city'] != '')
                    {
                        if($address != '')
                        {
                            $address .= ' , '.$getIfCriminalAvailable[0]['city'];
                        }else{
                            $address .= $getIfCriminalAvailable[0]['city'];
                        }
                    }
                    $getPhotos = $this->db->query('select * from criminalphotos where crimeId='.$getIfCriminalAvailable[0]['Id'])->result_array();
                    if($userphoto == '' || $userphoto == base_url())
                    {
                        $userphoto = ((count($getPhotos) > 0) ? base_url().''.$getPhotos[0]['photourl'] : base_url().''.$getIfCriminalAvailable[0]['photo']);   
                    }
                }
                foreach($getIfCriminalAvailable as $k=>$v)
                {
                    array_push($criminalId,$v['Id']);
                }
            }
            if(count($getIfPersonAvailable) > 0)
            {
                $getMissingPerson = $this->db->query('select * from missingperson where missingaadhar="'.$getIfPersonAvailable[0]['aadhar_id'].'" and isFound != 1')->result_array();   
            }else{
                $getMissingPerson = array();
            }
            if(count($getMissingPerson) > 0)
            {
                $isVisible = 1;
                $isAadharCorrect = 1;
                if($getMissingPerson[0]['missinggender'] != NULL)
                {
                    $isMissing = 1;
                    if($isUserFound != 1)
                    {
                        $personName = $getMissingPerson[0]['missingname'];
                        $gender = $getMissingPerson[0]['missinggender'];
                        $aadhar = $getMissingPerson[0]['missingaadhar'];
                        $from=new DateTime(date('Y-m-d'));
                        $to   = new DateTime($getMissingPerson[0]['missingdob']);
                        $age = ($from->diff($to)->y);
                        if(count($getIfPersonAvailable) > 0)
                        {
                            $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                        }else{
                            $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                        }
                        if(count($getIfPersonAvailable) == 0)
                        {
                            if($userphoto == '' || $userphoto == base_url())
                            {
                                $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : '');
                            }
                        }
                    }
                }else{
                    $getFullDetail = $this->db->query('select * from missingpersondetail where missingId='.$getMissingPerson[0]['Id'])->result_array();
                    if(count($getFullDetail) > 0)
                    {
                        $isMissing = 1; 
                        if($isUserFound != 1)
                        {
                            $personName = $getMissingPerson[0]['missingname'];
                            $gender = $getMissingPerson[0]['missinggender'];
                            $aadhar = $getMissingPerson[0]['missingaadhar'];
                            $from=new DateTime(date('Y-m-d'));
                            $to   = new DateTime($getMissingPerson[0]['missingdob']);
                            $age = ($from->diff($to)->y);
                            if(count($getIfPersonAvailable) > 0)
                            {
                                $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                            }else{
                                $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                            }
                            if(count($getIfPersonAvailable) == 0)
                            {
                                if($userphoto == '' || $userphoto == base_url())
                                {
                                    $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : '');
                                }
                            }
                        }
                    }else{
                        $getUserDetail = $this->db->query('select * from user where aadhar_id="'.$getIfPersonAvailable[0]['aadhar_id'].'"')->result_array();
                        if(count($getUserDetail) > 0)
                        {
                            $isMissing = 1; 
                            if($isUserFound != 1)
                            {
                                $personName = $getUserDetail[0]['aadharname'];
                                $gender = $getUserDetail[0]['gender'];
                                $aadhar = $getUserDetail[0]['aadhar_id'];
                                $from=new DateTime(date('Y-m-d'));
                                $to   = new DateTime($getUserDetail[0]['dob']);
                                $age = ($from->diff($to)->y);
                                $address = $getUserDetail[0]['vtc'].','.$getUserDetail[0]['state'];
                                if(count($getIfPersonAvailable) == 0)
                                {
                                    if($userphoto == '' || $userphoto == base_url())
                                    {
                                        $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : '');
                                    }
                                }
                            }
                        }
                    }
                }
            }
            $getIfLapataAvailable = $this->db->query('select * from unknown_person where isFinalSubmitted=1 and awsEventName="All" and isFound=0 and PAN="'.$_POST['idNumber'].'" and expiryDate >= "'.date('Y-m-d h:i:s').'"')->result_array();
            if(count($getIfLapataAvailable) > 0)
            {
                $isAadharCorrect = 1;
                $isVisible = 1;
                $isLapata = 1;
                $lapataId = $getIfLapataAvailable[0]['id'];
                $isMissing = 0;
                $missingId = 0;
                if(!$isUserFound)
                {
                    $isVerified = 0;
                    $personName = $getIfLapataAvailable[0]['person_name'];
                    $gender = ($getIfLapataAvailable[0]['Gender'] == 'boy' ? 'MALE' : 'FEMALE');
                    $aadhar = $getIfLapataAvailable[0]['aadharNumber'];
                    $age = ($getIfLapataAvailable[0]['Age']);
                    $address = $getIfLapataAvailable[0]['city'].','.$getIfLapataAvailable[0]['state'];
                    $userphoto = base_url().''.(($getIfLapataAvailable[0]['Photo'] != NULL) ? $getIfLapataAvailable[0]['Photo'] : $userphoto);
                }
            }
            if($this->getSettings('mahakumbhIdentity') == 'Yes')
            {
                $getIfKhoyaPayaAvailable = $this->db->query('select * from mahakumbhSpecial where isFound=0 and PAN="'.$_POST['idNumber'].'" order by dateCreated desc')->result_array();
                if(count($getIfKhoyaPayaAvailable) > 0)
                {
                    $isAadharCorrect = 1;
                    $isVisible = 1;
                    $isKhoya = 1;
                    $khoyaId = $getIfKhoyaPayaAvailable[0]['id'];
                    $isMissing = 0;
                    $missingId = 0;
                    if(!$isUserFound)
                    {
                        $isVerified = 0;
                        $personName = $getIfKhoyaPayaAvailable[0]['person_name'];
                        $gender = ($getIfKhoyaPayaAvailable[0]['Gender'] == 'Male' ? 'MALE' : 'FEMALE');
                        $aadhar = $getIfKhoyaPayaAvailable[0]['aadharNumber'];
                        $age = ($getIfKhoyaPayaAvailable[0]['AgeBand']);
                        $address = $getIfKhoyaPayaAvailable[0]['district'].','.$getIfKhoyaPayaAvailable[0]['state'];
                        $userphoto = base_url().''.(($getIfKhoyaPayaAvailable[0]['Photo'] != NULL) ? $getIfKhoyaPayaAvailable[0]['Photo'] : $userphoto);
                    }
                }
            }
            if($isLapata != 1)
            {
                $getIfUnknownAvailable = $this->db->query('select * from unknown_person where isFinalSubmitted=1 and awsEventName !="All" and isFound=0 and PAN="'.$_POST['idNumber'].'" order by id desc')->result_array();
                // $getIfUnknownAvailable = array();
                if(count($getIfUnknownAvailable) > 0)
                {
                    if($isUserFound != 1)
                    {
                        if($getIfUnknownAvailable[0]['uploaded_by'] == 'police')
                        {
                            $getPoliceDetail = $this->db->query('select * from police where police_id='.$getIfUnknownAvailable[0]['policeId'])->result_array();
                            $finalresponse = array(
                                'isUserFound' => $isUserFound,
                                'isKhoya' => $isKhoya,
                                'status' => 'unknown',
                                'isLapata' => $isLapata,
                                'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                'type' => 'police',
                                'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                'address' => strtoupper($getPoliceDetail[0]['thanaName'].' - '.$getPoliceDetail[0]['state'].', '.$getPoliceDetail[0]['district']),
                                'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                'age' => $getIfUnknownAvailable[0]['Age'],
                                'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                'id' => $getIfUnknownAvailable[0]['Application_no'],
                                'registration_mobile' => (($getPoliceDetail[0]['registration_mobile'] != NULL) ? $getPoliceDetail[0]['registration_mobile'] : ''),
                                'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                            );   
                        
                        }
                        else
                        {
                            if($getIfUnknownAvailable[0]['uploaded_by']=='user')
                            {
                                $getUserDetail = $this->db->query('select * from user where uid='.$getIfUnknownAvailable[0]['userId'])->result_array();
                                $finalresponse = array(
                                    'status' => 'unknown',
                                    'isKhoya' => $isKhoya,
                                    'isUserFound' => $isUserFound,
                                    'isLapata' => $isLapata,
                                    'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                    'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                    'type' => 'ngo',
                                    'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                    'address' => strtoupper($getUserDetail[0]['vtc'].' - '.$getUserDetail[0]['state'].', '.$getUserDetail[0]['district']),
                                    'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                    'age' => $getIfUnknownAvailable[0]['Age'],
                                    'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                    'registration_mobile' => (($getUserDetail[0]['registration_mobile'] != NULL) ? $getUserDetail[0]['registration_mobile'] : ''),
                                    'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                    'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                    'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                                    'id' => $getIfUnknownAvailable[0]['Application_no']
                                );   
                            }
                            else
                            {
                                $getNgoDetail = $this->db->query('select * from ngo where Id='.$getIfUnknownAvailable[0]['ngoId'])->result_array();
                                $finalresponse = array(
                                    'status' => 'unknown',
                                    'isKhoya' => $isKhoya,
                                    'isUserFound' => $isUserFound,
                                    'isLapata' => $isLapata,
                                    'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                    'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                    'type' => 'ngo',
                                    'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                    'address' => strtoupper($getNgoDetail[0]['ngoName'].' - '.$getNgoDetail[0]['ngoState'].', '.$getNgoDetail[0]['ngoDistrict'].', '.$getNgoDetail[0]['ngoCity']),
                                    'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                    'age' => $getIfUnknownAvailable[0]['Age'],
                                    'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                    'registration_mobile' => (($getNgoDetail[0]['ngoRegistrationNumber'] != NULL) ? $getNgoDetail[0]['ngoRegistrationNumber'] : ''),
                                    'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                    'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                    'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                                    'id' => $getIfUnknownAvailable[0]['Application_no']
                                );   
                            }
                            
                        }
                    }else{
                        $finalresponse = array(
                            'isUserFound' => $isUserFound,
                            'isKhoya' => $isKhoya,
                            'status' => 'unknown',
                            'isLapata' => $isLapata,
                            'personName' => strtoupper($personName),
                            'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                            'address' => strtoupper($address),
                            'photo' => ($userphoto != '' ? $userphoto : base_url().$getIfUnknownAvailable[0]['Photo']),
                            'age' => $age,
                            'gender' => strtolower($gender),
                            'id' => $getIfUnknownAvailable[0]['Application_no']
                        );
                    }
                    $insertdata = array(
                        'khoyaId' => $khoyaId,
                        'isKhoya' => $isKhoya,
                        'lapataId' => $lapataId,
                        'isLapata' => $isLapata,
                        'wantedIds' => implode(',',$wantedId),
                        'criminalIds' => implode(',',$criminalId),
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'idNumber' => $_POST['idNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    echo json_encode($finalresponse);
                }else{
                    $insertdata = array(
                        'khoyaId' => $khoyaId,
                        'isKhoya' => $isKhoya,
                        'lapataId' => $lapataId,
                        'isLapata' => $isLapata,
                        'wantedIds' => implode(',',$wantedId),
                        'criminalIds' => implode(',',$criminalId),
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'idNumber' => $_POST['idNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    if($update)
                    {
                        if($isAadharCorrect == 1)
                        {
                            $isOnlyUser = 0;
                            if(!$isWanted && !$isLapata && !$isCriminal && !$isMissing)
                            {
                                $isOnlyUser = 1;
                            }
                            $response = array(
                                'personId' => $personId,
                                'isOnlyUser' => $isOnlyUser,
                                'isKhoya' => $isKhoya,
                                'status' => 'success',
                                'personName' => $personName,
                                'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                                'gender' => strtolower($gender),
                                'isWanted' => $isWanted,
                                'isLapata' => $isLapata,
                                'isCriminal' => $isCriminal,
                                'age' => $age,
                                'address' => $address,
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => 1,
                                'isGenderCorrect' => 1,
                                'message' => 'Person Found',
                                'isVisible' => $isVisible,
                                'isMissing' => $isMissing,
                                'isVerified' => $isVerified,
                                'isRegistered' => $isUserFound,
                                'image' => ($userphoto != '' ? $userphoto : base_url().'assets/img/noimage.jpg')
                            );
                            echo json_encode($response);   
                        }else{
                            $response = array(
                                'status' => 'incorrect',
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => 1,
                                'isGenderCorrect' => 1,
                            );
                            echo json_encode($response);   
                        }
                    }else{
                        $response = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                        echo json_encode($response);
                    }
                }   
            }else{
                $insertdata = array(
                'khoyaId' => $khoyaId,
                'isKhoya' => $isKhoya,
                'lapataId' => $lapataId,
                'isLapata' => $isLapata,
                'wantedIds' => implode(',',$wantedId),
                'criminalIds' => implode(',',$criminalId),
                'isPersonFound' => $isUserFound,
                'isMissing' => $isMissing,
                'idNumber' => $_POST['idNumber'],
                'idType' => $_POST['idType'],
            );
            $this->db->where('Id',$_SESSION['checkId']);
            $update = $this->db->update('checkperson',$insertdata);
            if($update)
            {
                if($isAadharCorrect == 1)
                {
                    $isOnlyUser = 0;
                    if(!$isWanted && !$isLapata && !$isCriminal && !$isMissing)
                    {
                        $isOnlyUser = 1;
                    }
                    $response = array(
                        'personId' => $personId,
                        'isKhoya' => $isKhoya,
                        'isOnlyUser' => $isOnlyUser,
                        'status' => 'success',
                        'personName' => $personName,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'isWanted' => $isWanted,
                        'isLapata' => $isLapata,
                        'isCriminal' => $isCriminal,
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => 1,
                        'isGenderCorrect' => 1,
                        'message' => 'Person Found',
                        'isVisible' => $isVisible,
                        'isMissing' => $isMissing,
                        'isVerified' => $isVerified,
                        'isRegistered' => $isUserFound,
                        'image' => ($userphoto != '' ? $userphoto : base_url().'assets/img/noimage.jpg')
                    );
                    echo json_encode($response);   
                }else{
                    $response = array(
                        'status' => 'incorrect',
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => 1,
                        'isGenderCorrect' => 1,
                    );
                    echo json_encode($response);   
                }
            }else{
                $response = array(
                    'status' => 'error',
                    'message' => 'Something Went Wrong'
                );
                echo json_encode($response);
            }   
            }
        }
        if($_POST['idType'] == 'gold')
        {
            $idNumber = $_POST['idNumber'];
            if(strlen($_POST['idNumber']) != 6)
            {
                $response = array(
                    'status' => 'error',
                    'message' => 'Gold HUID number must be of 6 characters'
                );
                echo json_encode($response);
                return;
            }
            $personCount = 1;
            $this->db->where('goldHUIDNumber1', $_POST['idNumber']);
            $this->db->or_where('goldHUIDNumber2', $_POST['idNumber']);
            $this->db->or_where('goldHUIDNumber3', $_POST['idNumber']);
            $getIfPersonAvailable = $this->db->get('user')->result_array();
            $userphoto = '';
            if(count($getIfPersonAvailable) > 0)
            {
                foreach($getIfPersonAvailable as $k=>$v)
                {
                    $personCount++;
                }
                $personId = $getIfPersonAvailable[0]['uid'];
                $isAadharCorrect = 1;
                $isVisible = $getIfPersonAvailable[0]['visibility'];
                $isVerified = 1;
                $isUserFound = 1;
                $personName = $getIfPersonAvailable[0]['aadharname'];
                $gender = $getIfPersonAvailable[0]['gender'];
                $aadhar = $getIfPersonAvailable[0]['aadhar_id'];
                $from=new DateTime(date('Y-m-d'));
                $to   = new DateTime($getIfPersonAvailable[0]['dob']);
                $age = ($from->diff($to)->y);
                $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                $userphoto = base_url().''.(($getIfPersonAvailable[0]['aadharphoto'] != NULL) ? $getIfPersonAvailable[0]['aadharphoto'] : $getIfPersonAvailable[0]['facematchphoto']);
            }
            $getMissingPerson = $this->db->query('select * from missingperson where goldId="'.$_POST['idNumber'].'" and isFound !=1 and isFinalSubmitted = 1')->result_array();
            if(count($getMissingPerson) > 0)
            {
                $isVisible = 1;
                $isMissing = 1;
                if($isUserFound != 1)
                {
                    $personName = $getMissingPerson[0]['missingname'];
                    if($gender == '')
                    {
                        $gender = $getMissingPerson[0]['missinggender'];
                    }
                    $aadhar = $getMissingPerson[0]['missingaadhar'];
                    $from=new DateTime(date('Y-m-d'));
                    $to   = new DateTime($getMissingPerson[0]['missingdob']);
                    if($age == '')
                    {
                        $age = ($from->diff($to)->y);
                    }
                    $missingId = $getMissingPerson[0]['Id'];
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                    }else{
                        $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                    }
                    if(count($getIfPersonAvailable) == 0)
                    {
                        if($userphoto == '' || $userphoto == base_url())
                        {
                            $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : '');
                        }
                    }
                }
            }
            $this->db->like('goldHUID',$_POST['idNumber'],'both');
            $getIfAlready = $this->db->get('unknownPersonGold')->result_array();
            if(count($getIfAlready) > 0)
            {   
                $getIfLapataAvailable = $this->db->query('select * from unknown_person where isFinalSubmitted=1 and awsEventName="All" and isFound=0 and id='.$getIfAlready[(count($getIfAlready) - 1)]['unknownId'].' and expiryDate >= "'.date('Y-m-d h:i:s').'" order by dateCreated desc')->result_array();
            }else{
                $getIfLapataAvailable = array();
            }
            if(count($getIfLapataAvailable) > 0)
            {
                $personCount = 1;
                $isAadharCorrect = 1;
                $isVisible = 1;
                $isLapata = 1;
                $lapataId = $getIfLapataAvailable[0]['id'];
                $isMissing = 0;
                $missingId = 0;
                if(!$isUserFound)
                {
                    $isVerified = 0;
                    $personName = $getIfLapataAvailable[0]['person_name'];
                    $gender = ($getIfLapataAvailable[0]['Gender'] == 'boy' ? 'MALE' : 'FEMALE');
                    $aadhar = $getIfLapataAvailable[0]['aadharNumber'];
                    $age = ($getIfLapataAvailable[0]['Age']);
                    $address = $getIfLapataAvailable[0]['city'].','.$getIfLapataAvailable[0]['state'];
                    $userphoto = base_url().''.(($getIfLapataAvailable[0]['Photo'] != NULL) ? $getIfLapataAvailable[0]['Photo'] : $userphoto);
                }
            }
            if($isLapata != 1)
            {
                $getIfUnknownGold = $this->db->query('select * from unknownPersonGold where goldHUID ="'.$_POST['idNumber'].'" order by Id desc')->result_array();
                if(count($getIfUnknownGold) > 0)
                {
                    $id = array();
                    foreach($getIfUnknownGold as $k=>$v)
                    {
                        $getIfUnknownAvailable = $this->db->query('select * from unknown_person where isFinalSubmitted=1 and awsEventName !="All" and isFound=0 and id='.$v['unknownId'].' order by id desc')->result_array();      
                        if(count($getIfUnknownAvailable) > 0)
                        {
                            array_push($id,$getIfUnknownAvailable[0]['id']);
                            break;
                        }
                    }
                    if(count($id) > 0)
                    {
                        $getIfUnknownAvailable = $this->db->query('select * from unknown_person where id='.$id[0])->result_array();      
                    }else{
                        $getIfUnknownAvailable = array();    
                    }
                }else{
                    $getIfUnknownAvailable = array();
                }
                // $getIfUnknownAvailable = array();
                if(count($getIfUnknownAvailable) > 0)
                {
                    if($isUserFound != 1)
                    {
                        if($getIfUnknownAvailable[0]['uploaded_by'] == 'police')
                        {
                            $getPoliceDetail = $this->db->query('select * from police where police_id='.$getIfUnknownAvailable[0]['policeId'])->result_array();
                            $finalresponse = array(
                                'isUserFound' => $isUserFound,
                                'status' => 'unknown',
                                'isLapata' => $isLapata,
                                'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                'type' => 'police',
                                'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                'address' => strtoupper($getPoliceDetail[0]['thanaName'].' - '.$getPoliceDetail[0]['state'].', '.$getPoliceDetail[0]['district']),
                                'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                'age' => $getIfUnknownAvailable[0]['Age'],
                                'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                'id' => $getIfUnknownAvailable[0]['Application_no'],
                                'registration_mobile' => (($getPoliceDetail[0]['registration_mobile'] != NULL) ? $getPoliceDetail[0]['registration_mobile'] : ''),
                                'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                            );   
                        }
                        else
                        {
                            if($getIfUnknownAvailable[0]['uploaded_by']=='user')
                            {
                                $getUserDetail = $this->db->query('select * from user where uid='.$getIfUnknownAvailable[0]['userId'])->result_array();
                                $finalresponse = array(
                                    'status' => 'unknown',
                                    'isUserFound' => $isUserFound,
                                    'isLapata' => $isLapata,
                                    'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                    'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                    'type' => 'ngo',
                                    'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                    'address' => strtoupper($getUserDetail[0]['vtc'].' - '.$getUserDetail[0]['state'].', '.$getUserDetail[0]['district']),
                                    'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                    'age' => $getIfUnknownAvailable[0]['Age'],
                                    'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                    'registration_mobile' => (($getUserDetail[0]['registration_mobile'] != NULL) ? $getUserDetail[0]['registration_mobile'] : ''),
                                    'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                    'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                    'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                                    'id' => $getIfUnknownAvailable[0]['Application_no']
                                );   
                            }
                            else
                            {
                                $getNgoDetail = $this->db->query('select * from ngo where Id='.$getIfUnknownAvailable[0]['ngoId'])->result_array();
                                $finalresponse = array(
                                    'status' => 'unknown',
                                    'isLapata' => $isLapata,
                                    'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                    'isUserFound' => $isUserFound,
                                    'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                    'type' => 'ngo',
                                    'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                    'address' => strtoupper($getNgoDetail[0]['ngoName'].' - '.$getNgoDetail[0]['ngoState'].', '.$getNgoDetail[0]['ngoDistrict'].', '.$getNgoDetail[0]['ngoCity']),
                                    'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                    'age' => $getIfUnknownAvailable[0]['Age'],
                                    'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                    'registration_mobile' => (($getNgoDetail[0]['ngoRegistrationNumber'] != NULL) ? $getNgoDetail[0]['ngoRegistrationNumber'] : ''),
                                    'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                    'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                    'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                                    'id' => $getIfUnknownAvailable[0]['Application_no']
                                );
                            }
                               
                        }
                    }else{
                        $finalresponse = array(
                            'isUserFound' => $isUserFound,
                            'status' => 'unknown',
                            'isLapata' => $isLapata,
                            'personName' => strtoupper($personName),
                            'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                            'address' => strtoupper($address),
                            'photo' => ($userphoto != '' ? $userphoto : base_url().$getIfUnknownAvailable[0]['Photo']),
                            'age' => $age,
                            'gender' => strtolower($gender),
                            'id' => $getIfUnknownAvailable[0]['Application_no']
                        );
                    }
                    $insertdata = array(
                        'lapataId' => $lapataId,
                        'isLapata' => $isLapata,
                        'wantedIds' => implode(',',$wantedId),
                        'criminalIds' => implode(',',$criminalId),
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'idNumber' => $_POST['idNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    echo json_encode($finalresponse);
                }else{
                    $insertdata = array(
                        'lapataId' => $lapataId,
                        'isLapata' => $isLapata,
                        'wantedIds' => implode(',',$wantedId),
                        'criminalIds' => implode(',',$criminalId),
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'idNumber' => $_POST['idNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    if($update)
                    {
                        if($isAadharCorrect == 1)
                        {
                            $isOnlyUser = 0;
                            if(!$isWanted && !$isLapata && !$isCriminal && !$isMissing)
                            {
                                $isOnlyUser = 1;
                            }
                            $response = array(
                                'personId' => $personId,
                                'isOnlyUser' => $isOnlyUser,
                                'status' => 'success',
                                'personName' => $personName,
                                'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                                'gender' => strtolower($gender),
                                'isWanted' => $isWanted,
                                'isLapata' => $isLapata,
                                'isCriminal' => $isCriminal,
                                'age' => $age,
                                'address' => $address,
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => 1,
                                'isGenderCorrect' => 1,
                                'message' => 'Person Found',
                                'isVisible' => $isVisible,
                                'isMissing' => $isMissing,
                                'isVerified' => $isVerified,
                                'isRegistered' => $isUserFound,
                                'image' => ($userphoto != '' ? $userphoto : base_url().'assets/img/noimage.jpg')
                            );
                            echo json_encode($response);   
                        }else{
                            $response = array(
                                'status' => 'incorrect',
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => 1,
                                'isGenderCorrect' => 1,
                            );
                            echo json_encode($response);   
                        }
                    }else{
                        $response = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                        echo json_encode($response);
                    }
                }   
            }else{
                $insertdata = array(
                'lapataId' => $lapataId,
                'isLapata' => $isLapata,
                'wantedIds' => implode(',',$wantedId),
                'criminalIds' => implode(',',$criminalId),
                'isPersonFound' => $isUserFound,
                'isMissing' => $isMissing,
                'idNumber' => $_POST['idNumber'],
                'idType' => $_POST['idType'],
            );
            $this->db->where('Id',$_SESSION['checkId']);
            $update = $this->db->update('checkperson',$insertdata);
            if($update)
            {
                if($isAadharCorrect == 1)
                {
                    $isOnlyUser = 0;
                    if(!$isWanted && !$isLapata && !$isCriminal && !$isMissing)
                    {
                        $isOnlyUser = 1;
                    }
                    $response = array(
                        'personId' => $personId,
                        'isOnlyUser' => $isOnlyUser,
                        'status' => 'success',
                        'personName' => $personName,
                        'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                        'gender' => strtolower($gender),
                        'isWanted' => $isWanted,
                        'isLapata' => $isLapata,
                        'isCriminal' => $isCriminal,
                        'age' => $age,
                        'address' => $address,
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => 1,
                        'isGenderCorrect' => 1,
                        'message' => 'Person Found',
                        'isVisible' => $isVisible,
                        'isMissing' => $isMissing,
                        'isVerified' => $isVerified,
                        'isRegistered' => $isUserFound,
                        'image' => ($userphoto != '' ? $userphoto : base_url().'assets/img/noimage.jpg')
                    );
                    echo json_encode($response);   
                }else{
                    $response = array(
                        'status' => 'incorrect',
                        'isAadharCorrect' => $isAadharCorrect,
                        'isDobCorrect' => 1,
                        'isGenderCorrect' => 1,
                    );
                    echo json_encode($response);   
                }
            }else{
                $response = array(
                    'status' => 'error',
                    'message' => 'Something Went Wrong'
                );
                echo json_encode($response);
            }   
            }
        }
        if($_POST['idType'] == 'vehicle')
        {
            $idNumber = $_POST['idNumber'];
            $personCount = 1;
            $this->db->where('vehicleNumber1', $_POST['idNumber']);
            $this->db->or_where('vehicleNumber2', $_POST['idNumber']);
            $this->db->or_where('vehicleNumber3', $_POST['idNumber']);
            $getIfPersonAvailable = $this->db->get('user')->result_array();
            $userphoto = '';
            if(count($getIfPersonAvailable) > 0)
            {
                foreach($getIfPersonAvailable as $k=>$v)
                {
                    $personCount++;
                }
                $personId = $getIfPersonAvailable[0]['uid'];
                $isAadharCorrect = 1;
                $isVisible = $getIfPersonAvailable[0]['visibility'];
                $isVerified = 1;
                $isUserFound = 1;
                $personName = $getIfPersonAvailable[0]['aadharname'];
                $gender = $getIfPersonAvailable[0]['gender'];
                $aadhar = $getIfPersonAvailable[0]['aadhar_id'];
                $from=new DateTime(date('Y-m-d'));
                $to   = new DateTime($getIfPersonAvailable[0]['dob']);
                $age = ($from->diff($to)->y);
                $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                $userphoto = base_url().''.(($getIfPersonAvailable[0]['aadharphoto'] != NULL) ? $getIfPersonAvailable[0]['aadharphoto'] : $getIfPersonAvailable[0]['facematchphoto']);
            }
            $getMissingPerson = $this->db->query('select * from missingperson where vehicleNumber like "%'.$_POST['idNumber'].'%" and isFound !=1 and isFinalSubmitted = 1')->result_array();
            if(count($getMissingPerson) > 0)
            {
                $isVisible = 1;
                $isMissing = 1;
                $missingId = $getMissingPerson[0]['Id'];
                if($isUserFound != 1)
                {
                    $personName = $getMissingPerson[0]['missingname'];
                    if($gender == '')
                    {
                        $gender = $getMissingPerson[0]['missinggender'];
                    }
                    $aadhar = $getMissingPerson[0]['missingaadhar'];
                    $from=new DateTime(date('Y-m-d'));
                    $to   = new DateTime($getMissingPerson[0]['missingdob']);
                    if($age == '')
                    {
                        $age = ($from->diff($to)->y);
                    }
                    if(count($getIfPersonAvailable) > 0)
                    {
                        $address = $getIfPersonAvailable[0]['vtc'].','.$getIfPersonAvailable[0]['state'];
                    }else{
                        $address = $getMissingPerson[0]['fathercity'].','.$getMissingPerson[0]['fatherstate'];
                    }
                    if(count($getIfPersonAvailable) == 0)
                    {
                        if($userphoto == '' || $userphoto == base_url())
                        {
                            $userphoto = base_url().''.(($getMissingPerson[0]['facematchphoto'] != NULL) ? $getMissingPerson[0]['facematchphoto'] : '');
                        }
                    }
                }
            }
            $getIfLapataAvailable = $this->db->query('select * from unknown_person where isFinalSubmitted=1 and uploaded_by = "user" and isFound=0 and vehicle_no like "%'.$_POST['idNumber'].'%" and expiryDate >= "'.date('Y-m-d h:i:s').'" order by id desc')->result_array();   
            if(count($getIfLapataAvailable) > 0)
            {
                $personCount = 1;
                $isAadharCorrect = 1;
                $isVisible = 1;
                $isLapata = 1;
                $lapataId = $getIfLapataAvailable[0]['id'];
                $isMissing = 0;
                $missingId = 0;
                if(!$isUserFound)
                {
                    $isVerified = 0;
                    $personName = $getIfLapataAvailable[0]['person_name'];
                    $gender = ($getIfLapataAvailable[0]['Gender'] == 'boy' ? 'MALE' : 'FEMALE');
                    $aadhar = $getIfLapataAvailable[0]['aadharNumber'];
                    $age = ($getIfLapataAvailable[0]['Age']);
                    $address = $getIfLapataAvailable[0]['city'].','.$getIfLapataAvailable[0]['state'];
                    $userphoto = base_url().''.(($getIfLapataAvailable[0]['Photo'] != NULL) ? $getIfLapataAvailable[0]['Photo'] : $userphoto);
                }
            }
            if($this->getSettings('mahakumbhIdentity') == 'Yes')
            {
                $getIfKhoyaPayaAvailable = $this->db->query('select * from mahakumbhSpecial where isFound=0 and vehicle_no="'.$_POST['idNumber'].'" order by dateCreated desc')->result_array();
                if(count($getIfKhoyaPayaAvailable) > 0)
                {
                    $isAadharCorrect = 1;
                    $isVisible = 1;
                    $isKhoya = 1;
                    $khoyaId = $getIfKhoyaPayaAvailable[0]['id'];
                    $isMissing = 0;
                    $missingId = 0;
                    if(!$isUserFound)
                    {
                        $isVerified = 0;
                        $personName = $getIfKhoyaPayaAvailable[0]['person_name'];
                        $gender = ($getIfKhoyaPayaAvailable[0]['Gender'] == 'Male' ? 'MALE' : 'FEMALE');
                        $aadhar = $getIfKhoyaPayaAvailable[0]['aadharNumber'];
                        $age = ($getIfKhoyaPayaAvailable[0]['AgeBand']);
                        $address = $getIfKhoyaPayaAvailable[0]['district'].','.$getIfKhoyaPayaAvailable[0]['state'];
                        $userphoto = base_url().''.(($getIfKhoyaPayaAvailable[0]['Photo'] != NULL) ? $getIfKhoyaPayaAvailable[0]['Photo'] : $userphoto);
                    }
                }
            }
            if($isLapata != 1)
            {
                $getIfUnknownAvailable = $this->db->query('select * from unknown_person where isFinalSubmitted=1 and awsEventName !="All" and isFound=0 and vehicle_no="'.$_POST['idNumber'].'" order by id desc')->result_array();
                // $getIfUnknownAvailable = array();
                if(count($getIfUnknownAvailable) > 0)
                {
                    if($isUserFound != 1)
                    {
                        if($getIfUnknownAvailable[0]['uploaded_by'] == 'police')
                        {
                            $getPoliceDetail = $this->db->query('select * from police where police_id='.$getIfUnknownAvailable[0]['policeId'])->result_array();
                            $finalresponse = array(
                                'isKhoya' => $isKhoya,
                                'isUserFound' => $isUserFound,
                                'status' => 'unknown',
                                'isLapata' => $isLapata,
                                'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                'type' => 'police',
                                'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                'address' => strtoupper($getPoliceDetail[0]['thanaName'].' - '.$getPoliceDetail[0]['state'].', '.$getPoliceDetail[0]['district']),
                                'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                'age' => $getIfUnknownAvailable[0]['Age'],
                                'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                'id' => $getIfUnknownAvailable[0]['Application_no'],
                                'registration_mobile' => (($getPoliceDetail[0]['registration_mobile'] != NULL) ? $getPoliceDetail[0]['registration_mobile'] : ''),
                                'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                            );   
                        }
                        else
                        {
                            if($getIfUnknownAvailable[0]['uploaded_by']=='user')
                            {
                                $getUserDetail = $this->db->query('select * from user where uid='.$getIfUnknownAvailable[0]['userId'])->result_array();
                                $finalresponse = array(
                                    'isKhoya' => $isKhoya,
                                    'status' => 'unknown',
                                    'isUserFound' => $isUserFound,
                                    'isLapata' => $isLapata,
                                    'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                    'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                    'type' => 'ngo',
                                    'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                    'address' => strtoupper($getUserDetail[0]['vtc'].' - '.$getUserDetail[0]['state'].', '.$getUserDetail[0]['district']),
                                    'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                    'age' => $getIfUnknownAvailable[0]['Age'],
                                    'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                    'registration_mobile' => (($getUserDetail[0]['registration_mobile'] != NULL) ? $getUserDetail[0]['registration_mobile'] : ''),
                                    'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                    'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                    'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                                    'id' => $getIfUnknownAvailable[0]['Application_no']
                                );   
                            }
                            else
                            {
                                $getNgoDetail = $this->db->query('select * from ngo where Id='.$getIfUnknownAvailable[0]['ngoId'])->result_array();
                                $finalresponse = array(
                                    'isKhoya' => $isKhoya,
                                    'status' => 'unknown',
                                    'isLapata' => $isLapata,
                                    'personName' => strtoupper($getIfUnknownAvailable[0]['person_name']),
                                    'isUserFound' => $isUserFound,
                                    'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                                    'type' => 'ngo',
                                    'date' => date('d-m-Y h:i A',strtotime($getIfUnknownAvailable[0]['dateCreated'])),
                                    'address' => strtoupper($getNgoDetail[0]['ngoName'].' - '.$getNgoDetail[0]['ngoState'].', '.$getNgoDetail[0]['ngoDistrict'].', '.$getNgoDetail[0]['ngoCity']),
                                    'photo' => base_url().''.$getIfUnknownAvailable[0]['Photo'],
                                    'age' => $getIfUnknownAvailable[0]['Age'],
                                    'gender' => ($getIfUnknownAvailable[0]['Gender'] == 'boy' ? 'Male' : 'Female'),
                                    'registration_mobile' => (($getNgoDetail[0]['ngoRegistrationNumber'] != NULL) ? $getNgoDetail[0]['ngoRegistrationNumber'] : ''),
                                    'mobile1' => (($getIfUnknownAvailable[0]['well1'] != NULL) ? $getIfUnknownAvailable[0]['well1'] : ''),
                                    'mobile2' => (($getIfUnknownAvailable[0]['well2'] != NULL) ? $getIfUnknownAvailable[0]['well2'] : ''),
                                    'mobile3' => (($getIfUnknownAvailable[0]['well3'] != NULL) ? $getIfUnknownAvailable[0]['well3'] : ''),
                                    'id' => $getIfUnknownAvailable[0]['Application_no']
                                );  
                            }
                             
                        }
                    }else{
                        $finalresponse = array(
                            'isKhoya' => $isKhoya,
                            'isUserFound' => $isUserFound,
                            'status' => 'unknown',
                            'isLapata' => $isLapata,
                            'personName' => strtoupper($personName),
                            'aadharNumber' => substr_replace((($getIfUnknownAvailable[0]['aadharNumber'] != '') ? $getIfUnknownAvailable[0]['aadharNumber'] : $aadhar),'xxxxxxxx',0,8),
                            'address' => strtoupper($address),
                            'photo' => ($userphoto != '' ? $userphoto : base_url().$getIfUnknownAvailable[0]['Photo']),
                            'age' => $age,
                            'gender' => strtolower($gender),
                            'id' => $getIfUnknownAvailable[0]['Application_no']
                        );
                    }
                    $insertdata = array(
                        'khoyaId' => $khoyaId,
                        'isKhoya' => $isKhoya,
                        'lapataId' => $lapataId,
                        'isLapata' => $isLapata,
                        'wantedIds' => implode(',',$wantedId),
                        'criminalIds' => implode(',',$criminalId),
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'idNumber' => $_POST['idNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    echo json_encode($finalresponse);
                }else{
                    $insertdata = array(
                        'khoyaId' => $khoyaId,
                        'isKhoya' => $isKhoya,
                        'lapataId' => $lapataId,
                        'isLapata' => $isLapata,
                        'wantedIds' => implode(',',$wantedId),
                        'criminalIds' => implode(',',$criminalId),
                        'isPersonFound' => $isUserFound,
                        'isMissing' => $isMissing,
                        'idNumber' => $_POST['idNumber'],
                        'idType' => $_POST['idType'],
                    );
                    $this->db->where('Id',$_SESSION['checkId']);
                    $update = $this->db->update('checkperson',$insertdata);
                    if($update)
                    {
                        if($isAadharCorrect == 1)
                        {
                            $isOnlyUser = 0;
                            if(!$isWanted && !$isLapata && !$isCriminal && !$isMissing)
                            {
                                $isOnlyUser = 1;
                            }
                            $response = array(
                                'personId' => $personId,
                                'isOnlyUser' => $isOnlyUser,
                                'status' => 'success',
                                'isKhoya' => $isKhoya,
                                'personName' => $personName,
                                'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                                'gender' => strtolower($gender),
                                'isWanted' => $isWanted,
                                'isLapata' => $isLapata,
                                'isCriminal' => $isCriminal,
                                'age' => $age,
                                'address' => $address,
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => 1,
                                'isGenderCorrect' => 1,
                                'message' => 'Person Found',
                                'isVisible' => $isVisible,
                                'isMissing' => $isMissing,
                                'isVerified' => $isVerified,
                                'isRegistered' => $isUserFound,
                                'image' => ($userphoto != '' ? $userphoto : base_url().'assets/img/noimage.jpg')
                            );
                            echo json_encode($response);   
                        }else{
                            $response = array(
                                'status' => 'incorrect',
                                'isAadharCorrect' => $isAadharCorrect,
                                'isDobCorrect' => 1,
                                'isGenderCorrect' => 1,
                            );
                            echo json_encode($response);   
                        }
                    }else{
                        $response = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                        echo json_encode($response);
                    }
                }   
            }else{
                $insertdata = array(
                    'khoyaId' => $khoyaId,
                    'isKhoya' => $isKhoya,
                    'lapataId' => $lapataId,
                    'isLapata' => $isLapata,
                    'wantedIds' => implode(',',$wantedId),
                    'criminalIds' => implode(',',$criminalId),
                    'isPersonFound' => $isUserFound,
                    'isMissing' => $isMissing,
                    'idNumber' => $_POST['idNumber'],
                    'idType' => $_POST['idType'],
                );
                $this->db->where('Id',$_SESSION['checkId']);
                $update = $this->db->update('checkperson',$insertdata);
                if($update)
                {
                    if($isAadharCorrect == 1)
                    {
                        $isOnlyUser = 0;
                        if(!$isWanted && !$isLapata && !$isCriminal && !$isMissing)
                        {
                            $isOnlyUser = 1;
                        }
                        $response = array(
                            'isKhoya' => $isKhoya,
                            'personId' => $personId,
                            'isOnlyUser' => $isOnlyUser,
                            'status' => 'success',
                            'personName' => $personName,
                            'aadhar' => substr_replace($aadhar,'xxxxxxxx',0,8),
                            'gender' => strtolower($gender),
                            'isWanted' => $isWanted,
                            'isLapata' => $isLapata,
                            'isCriminal' => $isCriminal,
                            'age' => $age,
                            'address' => $address,
                            'isAadharCorrect' => $isAadharCorrect,
                            'isDobCorrect' => 1,
                            'isGenderCorrect' => 1,
                            'message' => 'Person Found',
                            'isVisible' => $isVisible,
                            'isMissing' => $isMissing,
                            'isVerified' => $isVerified,
                            'isRegistered' => $isUserFound,
                            'image' => ($userphoto != '' ? $userphoto : base_url().'assets/img/noimage.jpg')
                        );
                        echo json_encode($response);   
                    }else{
                        $response = array(
                            'status' => 'incorrect',
                            'isAadharCorrect' => $isAadharCorrect,
                            'isDobCorrect' => 1,
                            'isGenderCorrect' => 1,
                        );
                        echo json_encode($response);   
                    }
                }else{
                    $response = array(
                        'status' => 'error',
                        'message' => 'Something Went Wrong'
                    );
                    echo json_encode($response);
                }   
            }
        }
    }
    
    function criminalpersondetail()
    {
        $page_data['criminalDetail'] = $this->db->query('select * from criminals where Id In('.$_GET['Id'].')')->result_array();
        $page_data['control'] = 'user';
        $page_data['title'] = 'Criminal Records';
        $page_data['page_name'] = 'criminalSeparateRecord';
        $this->load->view('landing_page/index', $page_data);
    }
    
    function wantedpersondetail()
    {
        $page_data['wantedDetail'] = $this->db->query('select * from criminals where Id In('.$_GET['Id'].')')->result_array();
        $page_data['control'] = 'user';
        $page_data['title'] = 'Wanted Records';
        $page_data['page_name'] = 'wantedSeparateRecord';
        $this->load->view('landing_page/index', $page_data);
    }
    
    function generalpersondetail()
    {
        if(!isset($_SESSION['previousType']))
        {
            $getFinalId = $this->db->query('select max(Id) as Id from checkperson')->result_array();
            if($getFinalId[0]['Id'] != NULL)
            {
                $_SESSION['checkId'] = $getFinalId[0]['Id'] + 1;
            }else{
                $_SESSION['checkId'] = 1;
            }
            if(isset($_SESSION['landingMob']))
            {
                $insert = $this->db->insert('checkperson',array('personMob' => $_SESSION['landingMob'],'Id' => $_SESSION['checkId']));   
            }else{
                $insert = $this->db->insert('checkperson',array('Id' => $_SESSION['checkId']));
            }
            $_SESSION['previousType'] = 'identity';
        }
        $page_data['persondetail'] = $this->db->query('select * from user where uid In('.$_GET['Id'].')')->result_array();
        $page_data['control'] = 'user';
        $page_data['title'] = 'General User Records';
        $page_data['page_name'] = 'generalUserRecord';
        $this->load->view('landing_page/index', $page_data);
    }

    function criminalRecord()
    {
        if(isset($_SESSION['checkId']))
        {
            $page_data['checkDetail'] = $this->db->query('select * from checkperson where Id='.$_SESSION['checkId'])->result_array();
            if($page_data['checkDetail'][0]['criminalIds'] != NULL)
            {
                $page_data['criminalDetail'] = $this->db->query('select * from criminals where Id In('.$page_data['checkDetail'][0]['criminalIds'].')')->result_array();
            }else{
                $page_data['criminalDetail'] = array();
            }
            if($page_data['checkDetail'][0]['wantedIds'] != NULL)
            {
                $page_data['wantedDetail'] = $this->db->query('select * from criminals where Id In('.$page_data['checkDetail'][0]['wantedIds'].')')->result_array();
            }else{
                $page_data['wantedDetail'] = array();
            }
            $page_data['control'] = 'user';
            $page_data['title'] = 'Criminal Records';
            $page_data['page_name'] = 'criminalRecord';
            $this->load->view('landing_page/index', $page_data);
        }else{
            redirect($this->getSettings('noVehicleId'),'refresh');
        }   
    }
    
    function wantedRecord()
    {
        if(isset($_SESSION['checkId']))
        {
            $page_data['checkDetail'] = $this->db->query('select * from checkperson where Id='.$_SESSION['checkId'])->result_array();
            if($page_data['checkDetail'][0]['criminalIds'] != NULL)
            {
                $page_data['criminalDetail'] = $this->db->query('select * from criminals where Id In('.$page_data['checkDetail'][0]['criminalIds'].')')->result_array();
            }else{
                $page_data['criminalDetail'] = array();
            }
            if($page_data['checkDetail'][0]['wantedIds'] != NULL)
            {
                $page_data['wantedDetail'] = $this->db->query('select * from criminals where Id In('.$page_data['checkDetail'][0]['wantedIds'].')')->result_array();
            }else{
                $page_data['wantedDetail'] = array();
            }
            $page_data['control'] = 'user';
            $page_data['title'] = 'Wanted Records';
            $page_data['page_name'] = 'wantedRecord';
            $this->load->view('landing_page/index', $page_data);
        }else{
            redirect($this->getSettings('noVehicleId'),'refresh');
        }   
    }
    
   public function newregister($para1 = ''){
      if($para1 == 'do_register'){
        unset($_POST['_token']);
        $aadhar = $this->input->post('aadhar_id');
        $credential = array('aadhar_id' => $aadhar);
        $query = $this->db->get_where('user', $credential);
        if ($query->num_rows() > 0) {
            $row = $query->row();
            if($row->final_mobile_verification == 'success')
            {
                $response = array(
                    'status' => 'error',
                    'message' => 'Already Verified'
                );
                echo json_encode($response);
            }else
            {
                $curl = curl_init();
                curl_setopt_array($curl, [
                  CURLOPT_URL => "https://api.gridlines.io/aadhaar-api/boson/generate-otp",
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => "",
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 30,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => "POST",
                  CURLOPT_POSTFIELDS => '{"aadhaar_number": '.$_POST['aadhar_id'].',  "consent": "Y"}',
                  CURLOPT_HTTPHEADER => [
                    "Content-Type: application/json",
                    "X-API-Key: ".$this->getSettings(),
                    "X-Auth-Type: API-Key"
                  ],
                ]);

                $response = json_decode(curl_exec($curl),true);
                if($response['status'] == 200)
                {
                    $this->db->where('uid',$row->uid);
                    $this->db->update('user',array('registration_mobile' => $_POST['registration_mobile']));
                    $_SESSION['aadharId'] = $_POST['aadhar_id'];
                    $_SESSION['mob'] = $_POST['registration_mobile'];
                    $_SESSION['transactionId'] = $response['data']['transaction_id'];
                    $response = array(
                        'status' => 'success',
                        'message' => $response['data']['message']
                    );
                    echo json_encode($response);
                }else
                {
                    $curl = curl_init();
                    curl_setopt_array($curl, array(
                      CURLOPT_URL => 'https://api.sandbox.co.in/authenticate',
                      CURLOPT_RETURNTRANSFER => true,
                      CURLOPT_ENCODING => '',
                      CURLOPT_MAXREDIRS => 10,
                      CURLOPT_TIMEOUT => 0,
                      CURLOPT_FOLLOWLOCATION => true,
                      CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                      CURLOPT_CUSTOMREQUEST => 'POST',
                      CURLOPT_HTTPHEADER => array(
                        'x-api-key: key_live_7HUx4cSqzOZH78eml6w9G5E0hFU4VdRU',
                        'x-api-secret: secret_live_mi53PMvzGyngSI1QF7vusJrSUkpv6lbi',
                        'x-api-version: 1.0'
                      ),
                    ));
                    
                    $tokenResponse = json_decode(curl_exec($curl),true);
                    curl_close($curl);
                    if($tokenResponse['access_token'])
                    {
                        $_SESSION['access_token'] = $tokenResponse['access_token'];
                        $curl = curl_init();
                        curl_setopt_array($curl, array(
                          CURLOPT_URL => 'https://api.sandbox.co.in/kyc/aadhaar/okyc/otp',
                          CURLOPT_RETURNTRANSFER => true,
                          CURLOPT_ENCODING => '',
                          CURLOPT_MAXREDIRS => 10,
                          CURLOPT_TIMEOUT => 0,
                          CURLOPT_FOLLOWLOCATION => true,
                          CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                          CURLOPT_CUSTOMREQUEST => 'POST',
                          CURLOPT_POSTFIELDS =>'{
                          "aadhaar_number": '.$_POST['aadhar_id'].'
                        }',
                          CURLOPT_HTTPHEADER => array(
                            'Authorization: '.$tokenResponse['access_token'],
                            'x-api-key: key_live_7HUx4cSqzOZH78eml6w9G5E0hFU4VdRU',
                            'x-api-version: 1.0',
                            'Content-Type: application/json'
                          ),
                        ));
                        
                        $otpResponse = json_decode(curl_exec($curl),true);
                        curl_close($curl);
                        if(count($otpResponse) > 0)
                        {
                            if($otpResponse['code'] == 200)
                            {
                                $_SESSION['ref_id'] = $otpResponse['data']['ref_id'];
                                $this->db->where('uid',$row->uid);
                                $this->db->update('user',array('registration_mobile' => $_POST['registration_mobile']));
                                $_SESSION['aadharId'] = $_POST['aadhar_id'];
                                $_SESSION['type'] = 'sandbox';
                                $_SESSION['mob'] = $_POST['registration_mobile'];
                                $response = array(
                                    'status' => 'success',
                                    'message' => $otpResponse['data']['message']
                                );
                                echo json_encode($response);
                            }else{
                                $finalResponse = array(
                                    'status' => 'error',
                                    'message' => $otpResponse['data']['message']
                                );
                                echo json_encode($finalResponse);        
                            }
                        }else{
                            $finalResponse = array(
                                'status' => 'error',
                                'message' => $otpResponse['data']['message']
                            );
                            echo json_encode($finalResponse);        
                        }
                    }else{
                        $finalResponse = array(
                            'status' => 'error',
                            'message' => $tokenResponse['message']
                        );
                        echo json_encode($finalResponse);
                    }
                }
            }
        } else {
            $curl = curl_init();
            $postfields = json_encode(array(
                'aadhaar_number' => $_POST['aadhar_id'],
                'consent' => 'Y'
            ));
            curl_setopt_array($curl, [
              CURLOPT_URL => "https://api.gridlines.io/aadhaar-api/boson/generate-otp",
              CURLOPT_RETURNTRANSFER => true,
              CURLOPT_ENCODING => "",
              CURLOPT_MAXREDIRS => 10,
              CURLOPT_TIMEOUT => 30,
              CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
              CURLOPT_CUSTOMREQUEST => "POST",
              CURLOPT_POSTFIELDS => '{"aadhaar_number": '.$_POST['aadhar_id'].',  "consent": "Y"}',
              CURLOPT_HTTPHEADER => [
                "Content-Type: application/json",
                "X-API-Key: ".$this->getSettings(),
                "X-Auth-Type: API-Key"
              ],
            ]);

            $response = json_decode(curl_exec($curl),true);
            if($response['status'] == 200)
            {
                unset($_POST['consent']);
                $insert = $this->db->insert('user',$_POST) ;
                $_SESSION['aadharId'] = $_POST['aadhar_id'];
                $_SESSION['mob'] = $_POST['registration_mobile'];
                $_SESSION['transactionId'] = $response['data']['transaction_id'];
                $response = array(
                    'status' => 'success',
                    'message' => $response['data']['message']
                );
                echo json_encode($response);
            }else
            {
                $curl = curl_init();
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://api.sandbox.co.in/authenticate',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_HTTPHEADER => array(
                    'x-api-key: key_live_7HUx4cSqzOZH78eml6w9G5E0hFU4VdRU',
                    'x-api-secret: secret_live_mi53PMvzGyngSI1QF7vusJrSUkpv6lbi',
                    'x-api-version: 1.0'
                  ),
                ));
                
                $tokenResponse = json_decode(curl_exec($curl),true);
                curl_close($curl);
                if($tokenResponse['access_token'])
                {
                    $_SESSION['access_token'] = $tokenResponse['access_token'];
                    $curl = curl_init();
                    curl_setopt_array($curl, array(
                      CURLOPT_URL => 'https://api.sandbox.co.in/kyc/aadhaar/okyc/otp',
                      CURLOPT_RETURNTRANSFER => true,
                      CURLOPT_ENCODING => '',
                      CURLOPT_MAXREDIRS => 10,
                      CURLOPT_TIMEOUT => 0,
                      CURLOPT_FOLLOWLOCATION => true,
                      CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                      CURLOPT_CUSTOMREQUEST => 'POST',
                      CURLOPT_POSTFIELDS =>'{
                      "aadhaar_number": '.$_POST['aadhar_id'].'
                    }',
                      CURLOPT_HTTPHEADER => array(
                        'Authorization: '.$tokenResponse['access_token'],
                        'x-api-key: key_live_7HUx4cSqzOZH78eml6w9G5E0hFU4VdRU',
                        'x-api-version: 1.0',
                        'Content-Type: application/json'
                      ),
                    ));
                    
                    $otpResponse = json_decode(curl_exec($curl),true);
                    curl_close($curl);
                    if(count($otpResponse) > 0)
                    {
                        if($otpResponse['code'] == 200)
                        {
                            $_SESSION['ref_id'] = $otpResponse['data']['ref_id'];
                            $this->db->where('uid',$row->uid);
                            $this->db->update('user',array('registration_mobile' => $_POST['registration_mobile']));
                            $_SESSION['aadharId'] = $_POST['aadhar_id'];
                            $_SESSION['type'] = 'sandbox';
                            $_SESSION['mob'] = $_POST['registration_mobile'];
                            $response = array(
                                'status' => 'success',
                                'message' => $otpResponse['data']['message']
                            );
                            echo json_encode($response);
                        }else{
                            $finalResponse = array(
                                'status' => 'error',
                                'message' => $otpResponse['data']['message']
                            );
                            echo json_encode($finalResponse);        
                        }
                    }else{
                        $finalResponse = array(
                            'status' => 'error',
                            'message' => $otpResponse['data']['message']
                        );
                        echo json_encode($finalResponse);        
                    }
                }else{
                    $finalResponse = array(
                        'status' => 'error',
                        'message' => $tokenResponse['message']
                    );
                    echo json_encode($finalResponse);
                }
            }
        }
      } else {
          $page_data['lasturl'] = basename($_SERVER['HTTP_REFERER']);
        $page_data['title'] = 'Register';
        $page_data['control'] = 'user';
        $page_data['page_name'] = 'newregister';
         $this->load->view('landing_page/index', $page_data);
        // $this->load->view('user/common/header',$page_data); 
        // $this->load->view('user/newregister');
        // $this->load->view('user/common/footer'); 
      }
    }
    public function login($para1 = ''){
        // Agar `return_url` query parameter diya gaya ho
        if ($this->input->get('return_url')) {
            // 404 error dikhao
            $this->show404();
            return;
        }
      if($para1 == 'do_login'){
        if($_POST['type'] == 'aadhar')
        {
            $getDetail = $this->db->query('select * from user where aadhar_id="'.$_POST['typeval'].'"')->result_array();
        }else{
            $getDetail = $this->db->query('select * from user where username="'.$_POST['typeval'].'"')->result_array();
        }
        if($getDetail[0]['otp'] == $_POST['otp'])
        {
            $this->session->set_userdata('loginmob',$_POST['mobile']);
            $this->session->set_userdata('user_login', 'yes');
            $this->session->set_userdata('user_id', $getDetail[0]['uid']);
            $this->session->set_userdata('aadhar_id', $getDetail[0]['aadhar_id']);
            $this->session->set_userdata('username', $getDetail[0]['username']);
            $this->session->set_userdata('aadharName', $getDetail[0]['aadharname']);
            $this->session->set_userdata('login_type', 'user');
            $response = array(
                'status' => 'success',
                'message' => 'Login Successful',
                'lasturl' => $_POST['basename'],
                'finalverification' => ($getDetail[0]['final_mobile_verification'] == 'success' ? 'success' : 'failed')
            );
            echo json_encode($response);
        }else{
            $response = array(
                'status' => 'error',
                'message' => 'Invalid Otp'
            );
            echo json_encode($response);
        }
      } else {
        if($_SESSION['user_login'] == 'yes')
        {
            redirect(base_url(),'refresh');
        }
        $page_data['lasturl'] = basename($_SERVER['HTTP_REFERER']);
        $page_data['title'] = 'Login';
        $page_data['control'] = 'user';
        $page_data['page_name'] = 'login-new';
         $this->load->view('landing_page/index', $page_data);
        
      }
    }

    public function loginNew($para1 = ''){
      if($para1 == 'do_login'){
        if($_POST['type'] == 'aadhar')
        {
            $getDetail = $this->db->query('select * from user where aadhar_id="'.$_POST['typeval'].'"')->result_array();
        }else{
            $getDetail = $this->db->query('select * from user where username="'.$_POST['typeval'].'"')->result_array();
        }
        if($getDetail[0]['otp'] == $_POST['otp'])
        {
            $this->session->set_userdata('loginmob',$_POST['mobile']);
            $this->session->set_userdata('user_login', 'yes');
            $this->session->set_userdata('user_id', $getDetail[0]['uid']);
            $this->session->set_userdata('aadhar_id', $getDetail[0]['aadhar_id']);
            $this->session->set_userdata('username', $getDetail[0]['username']);
            $this->session->set_userdata('aadharName', $getDetail[0]['aadharname']);
            $this->session->set_userdata('login_type', 'user');
            $response = array(
                'status' => 'success',
                'message' => 'Login Successful',
                'lasturl' => $_POST['basename'],
                'finalverification' => ($getDetail[0]['final_mobile_verification'] == 'success' ? 'success' : 'failed')
            );
            echo json_encode($response);
        }else{
            $response = array(
                'status' => 'error',
                'message' => 'Invalid Otp'
            );
            echo json_encode($response);
        }
      } else {
        $page_data['lasturl'] = basename($_SERVER['HTTP_REFERER']);
        $page_data['title'] = 'Login';
        $page_data['control'] = 'user';
        $page_data['page_name'] = 'login-new';
         $this->load->view('landing_page/index', $page_data);
        
      }
    }
    
    function unknownregister($para1 = ''){
        if($para1 == 'do_register'){
        unset($_POST['_token']);
        $aadhar = $this->input->post('aadhar_id');
        $credential = array('aadhar_id' => $aadhar);
        $query = $this->db->get_where('user', $credential);
        if ($query->num_rows() > 0) {
            $row = $query->row();
            if($row->final_mobile_verification == 'success')
            {
                $response = array(
                    'status' => 'error',
                    'message' => 'Already Verified'
                );
                echo json_encode($response);
            }else
            {
                $curl = curl_init();
                curl_setopt_array($curl, [
                  CURLOPT_URL => "https://api.gridlines.io/aadhaar-api/boson/generate-otp",
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => "",
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 30,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => "POST",
                  CURLOPT_POSTFIELDS => '{"aadhaar_number": '.$_POST['aadhar_id'].',  "consent": "Y"}',
                  CURLOPT_HTTPHEADER => [
                    "Content-Type: application/json",
                    "X-API-Key: ".$this->getSettings(),
                    "X-Auth-Type: API-Key"
                  ],
                ]);

                $response = json_decode(curl_exec($curl),true);
                if($response['status'] == 200)
                {
                    $this->db->where('uid',$row->uid);
                    $this->db->update('user',array('registration_mobile' => $_POST['registration_mobile']));
                    $_SESSION['aadharId'] = $_POST['aadhar_id'];
                    $_SESSION['mob'] = $_POST['registration_mobile'];
                    $_SESSION['transactionId'] = $response['data']['transaction_id'];
                    $response = array(
                        'status' => 'success',
                        'message' => $response['data']['message']
                    );
                    echo json_encode($response);
                }else
                {
                    $response = array(
                        'status' => 'error',
                        'message' => $response['error']['message']
                    );
                    echo json_encode($response);
                }
            }
        } else {
            $curl = curl_init();
            $postfields = json_encode(array(
                'aadhaar_number' => $_POST['aadhar_id'],
                'consent' => 'Y'
            ));
            curl_setopt_array($curl, [
              CURLOPT_URL => "https://api.gridlines.io/aadhaar-api/boson/generate-otp",
              CURLOPT_RETURNTRANSFER => true,
              CURLOPT_ENCODING => "",
              CURLOPT_MAXREDIRS => 10,
              CURLOPT_TIMEOUT => 30,
              CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
              CURLOPT_CUSTOMREQUEST => "POST",
              CURLOPT_POSTFIELDS => '{"aadhaar_number": '.$_POST['aadhar_id'].',  "consent": "Y"}',
              CURLOPT_HTTPHEADER => [
                "Content-Type: application/json",
                "X-API-Key: ".$this->getSettings(),
                "X-Auth-Type: API-Key"
              ],
            ]);

            $response = json_decode(curl_exec($curl),true);
            if($response['status'] == 200)
            {
                unset($_POST['consent']);
                $insert = $this->db->insert('user',$_POST) ;
                $_SESSION['aadharId'] = $_POST['aadhar_id'];
                $_SESSION['mob'] = $_POST['registration_mobile'];
                $_SESSION['transactionId'] = $response['data']['transaction_id'];
                $response = array(
                    'status' => 'success',
                    'message' => $response['data']['message']
                );
                echo json_encode($response);
            }else
            {
                $response = array(
                    'status' => 'error',
                    'message' => $response['error']['message']
                );
                echo json_encode($response);
            }
        }
      } else {
        $page_data['title'] = 'Register';
        $page_data['control'] = 'user';
        $page_data['page_name'] = 'unknownregister';
        $this->load->view('landing_page/index', $page_data);
      }  
    }
    
    public function checkregister($para1 = ''){
      if($para1 == 'do_register'){
        unset($_POST['_token']);
        $aadhar = $this->input->post('aadhar_id');
        $credential = array('aadhar_id' => $aadhar);
        $query = $this->db->get_where('user', $credential);
        if ($query->num_rows() > 0) {
            $row = $query->row();
            if($row->final_mobile_verification == 'success')
            {
                $response = array(
                    'status' => 'error',
                    'message' => 'Already Verified'
                );
                echo json_encode($response);
            }else
            {
                $curl = curl_init();
                curl_setopt_array($curl, [
                  CURLOPT_URL => "https://api.gridlines.io/aadhaar-api/boson/generate-otp",
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => "",
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 30,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => "POST",
                  CURLOPT_POSTFIELDS => '{"aadhaar_number": '.$_POST['aadhar_id'].',  "consent": "Y"}',
                  CURLOPT_HTTPHEADER => [
                    "Content-Type: application/json",
                    "X-API-Key: ".$this->getSettings(),
                    "X-Auth-Type: API-Key"
                  ],
                ]);

                $response = json_decode(curl_exec($curl),true);
                if($response['status'] == 200)
                {
                    $this->db->where('uid',$row->uid);
                    $this->db->update('user',array('registration_mobile' => $_POST['registration_mobile']));
                    $_SESSION['aadharId'] = $_POST['aadhar_id'];
                    $_SESSION['mob'] = $_POST['registration_mobile'];
                    $_SESSION['transactionId'] = $response['data']['transaction_id'];
                    $response = array(
                        'status' => 'success',
                        'message' => $response['data']['message']
                    );
                    echo json_encode($response);
                }else
                {
                    $response = array(
                        'status' => 'error',
                        'message' => $response['error']['message']
                    );
                    echo json_encode($response);
                }
            }
        } else {
            $curl = curl_init();
            $postfields = json_encode(array(
                'aadhaar_number' => $_POST['aadhar_id'],
                'consent' => 'Y'
            ));
            curl_setopt_array($curl, [
              CURLOPT_URL => "https://api.gridlines.io/aadhaar-api/boson/generate-otp",
              CURLOPT_RETURNTRANSFER => true,
              CURLOPT_ENCODING => "",
              CURLOPT_MAXREDIRS => 10,
              CURLOPT_TIMEOUT => 30,
              CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
              CURLOPT_CUSTOMREQUEST => "POST",
              CURLOPT_POSTFIELDS => '{"aadhaar_number": '.$_POST['aadhar_id'].',  "consent": "Y"}',
              CURLOPT_HTTPHEADER => [
                "Content-Type: application/json",
                "X-API-Key: ".$this->getSettings(),
                "X-Auth-Type: API-Key"
              ],
            ]);

            $response = json_decode(curl_exec($curl),true);
            if($response['status'] == 200)
            {
                unset($_POST['consent']);
                $insert = $this->db->insert('user',$_POST) ;
                $_SESSION['aadharId'] = $_POST['aadhar_id'];
                $_SESSION['mob'] = $_POST['registration_mobile'];
                $_SESSION['transactionId'] = $response['data']['transaction_id'];
                $response = array(
                    'status' => 'success',
                    'message' => $response['data']['message']
                );
                echo json_encode($response);
            }else
            {
                $response = array(
                    'status' => 'error',
                    'message' => $response['error']['message']
                );
                echo json_encode($response);
            }
        }
      } else {
        $page_data['lasturl'] = basename($_SERVER['HTTP_REFERER']);
        $page_data['title'] = 'Register';
        $page_data['control'] = 'user';
        $page_data['page_name'] = 'checkregister';
        $this->load->view('landing_page/index', $page_data);
      }
    }
    
    function search_person_details()
    {
        if($this->session->userdata('user_login') == 'yes'){
            $page_data['pn'] = 1;
            if(isset($_GET['pn']))
            {
                $page_data['pn'] = $_GET['pn'];    
            }
            $page_data['page_name'] = 'search_person_details';
            $this->load->view('landing_page/index', $page_data);
        }else 
        {
            redirect('landing/login','refresh');
        }
    }
    
    function resendRegisterOtp()
    {
        if(isset($_SESSION['type']))
        {
            if($_SESSION['type'] == 'gridline')
            {
                $curl = curl_init();
                curl_setopt_array($curl, [
                  CURLOPT_URL => "https://api.gridlines.io/aadhaar-api/boson/generate-otp",
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => "",
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 30,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => "POST",
                  CURLOPT_POSTFIELDS => '{"aadhaar_number": '.$_POST['aadharNumber'].',  "consent": "Y"}',
                  CURLOPT_HTTPHEADER => [
                    "Content-Type: application/json",
                    "X-API-Key: ".$this->getSettings(),
                    "X-Auth-Type: API-Key"
                  ],
                ]);
        
                $response = json_decode(curl_exec($curl),true);
                if($response['status'] == 200)
                {
                    $_SESSION['transactionId'] = $response['data']['transaction_id'];
                    $response = array(
                        'status' => 'success',
                        'message' => $response['data']['message']
                    );
                    echo json_encode($response);
                }else
                {
                    $response = array(
                        'status' => 'error',
                        'message' => $response['error']['message']
                    );
                    echo json_encode($response);
                }
            }else{
                $curl = curl_init();
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://api.sandbox.co.in/authenticate',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_HTTPHEADER => array(
                    'x-api-key: key_live_7HUx4cSqzOZH78eml6w9G5E0hFU4VdRU',
                    'x-api-secret: secret_live_mi53PMvzGyngSI1QF7vusJrSUkpv6lbi',
                    'x-api-version: 1.0'
                  ),
                ));
                
                $tokenResponse = json_decode(curl_exec($curl),true);
                curl_close($curl);
                if($tokenResponse['access_token'])
                {
                    $_SESSION['access_token'] = $tokenResponse['access_token'];
                    $curl = curl_init();
                    curl_setopt_array($curl, array(
                      CURLOPT_URL => 'https://api.sandbox.co.in/kyc/aadhaar/okyc/otp',
                      CURLOPT_RETURNTRANSFER => true,
                      CURLOPT_ENCODING => '',
                      CURLOPT_MAXREDIRS => 10,
                      CURLOPT_TIMEOUT => 0,
                      CURLOPT_FOLLOWLOCATION => true,
                      CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                      CURLOPT_CUSTOMREQUEST => 'POST',
                      CURLOPT_POSTFIELDS =>'{
                      "aadhaar_number": '.$_POST['aadharNumber'].'
                    }',
                      CURLOPT_HTTPHEADER => array(
                        'Authorization: '.$tokenResponse['access_token'],
                        'x-api-key: key_live_7HUx4cSqzOZH78eml6w9G5E0hFU4VdRU',
                        'x-api-version: 1.0',
                        'Content-Type: application/json'
                      ),
                    ));
                    
                    $otpResponse = json_decode(curl_exec($curl),true);
                    curl_close($curl);
                    if(count($otpResponse) > 0)
                    {
                        if($otpResponse['code'] == 200)
                        {
                            $_SESSION['ref_id'] = $otpResponse['data']['ref_id'];
                            $_SESSION['type'] = 'sandbox';
                            $response = array(
                                'status' => 'success',
                                'message' => $otpResponse['data']['message']
                            );
                            echo json_encode($response);
                        }else{
                            $finalResponse = array(
                                'status' => 'error',
                                'message' => $otpResponse['data']['message']
                            );
                            echo json_encode($finalResponse);        
                        }
                    }else{
                        $finalResponse = array(
                            'status' => 'error',
                            'message' => $otpResponse['data']['message']
                        );
                        echo json_encode($finalResponse);        
                    }
                }else{
                    $finalResponse = array(
                        'status' => 'error',
                        'message' => $tokenResponse['message']
                    );
                    echo json_encode($finalResponse);
                }
            }
        }else{
            $curl = curl_init();
            curl_setopt_array($curl, [
              CURLOPT_URL => "https://api.gridlines.io/aadhaar-api/boson/generate-otp",
              CURLOPT_RETURNTRANSFER => true,
              CURLOPT_ENCODING => "",
              CURLOPT_MAXREDIRS => 10,
              CURLOPT_TIMEOUT => 30,
              CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
              CURLOPT_CUSTOMREQUEST => "POST",
              CURLOPT_POSTFIELDS => '{"aadhaar_number": '.$_POST['aadharNumber'].',  "consent": "Y"}',
              CURLOPT_HTTPHEADER => [
                "Content-Type: application/json",
                "X-API-Key: ".$this->getSettings(),
                "X-Auth-Type: API-Key"
              ],
            ]);
    
            $response = json_decode(curl_exec($curl),true);
            if($response['status'] == 200)
            {
                $_SESSION['transactionId'] = $response['data']['transaction_id'];
                $response = array(
                    'status' => 'success',
                    'message' => $response['data']['message']
                );
                echo json_encode($response);
            }else
            {
                $response = array(
                    'status' => 'error',
                    'message' => $response['error']['message']
                );
                echo json_encode($response);
            }   
        }
    }
    
    function createNewAccount()
    {
        if(isset($_SESSION['type']))
        {
            if($_SESSION['type'] == 'gridline')
            {
                $curl = curl_init();
                curl_setopt_array($curl, [
                  CURLOPT_URL => "https://api.gridlines.io/aadhaar-api/boson/submit-otp",
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => "",
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 30,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => "POST",
                  CURLOPT_POSTFIELDS => '{"otp": '.$_POST['otp'].'}',
                  CURLOPT_HTTPHEADER => [
                    "Content-Type: application/json",
                    "X-API-Key: ".$this->getSettings(),
                    "X-Auth-Type: API-Key",
                    "X-Transaction-ID: ".$_SESSION['transactionId']
                  ]
                ]);
        
                $response = JSON_decode(curl_exec($curl),true);
                if(isset($response['status']))
                {
                    if($response['status'] == 200)
                    {
                        if($response['data']['code'] == 1002)
                        {
                            if(!empty($response['data']['aadhaar_data']['photo_base64']) && !empty($response['data']['aadhaar_data']['name']) && !empty($response['data']['aadhaar_data']['gender']) && !empty($response['data']['aadhaar_data']['date_of_birth']))
                            {
                                $aadharphoto = '';
                                $imageId = '';
                                if(isset($response['data']['aadhaar_data']['photo_base64']))
                                {
                                    $decoded=base64_decode($response['data']['aadhaar_data']['photo_base64']);
                                    $aadharphoto = 'upload/aadhar/'.time().'.JPG';
                                    file_put_contents($aadharphoto,$decoded);
                                    $imageId = 'GEN_'.time().''.rand(0,10000);
                                }
                                $getPreviousDetail = $this->db->query('select * from user where aadhar_id="'.$_SESSION['aadharId'].'"')->result_array();
                                $username = '';
                                if(isset($response['data']['aadhaar_data']['name']))
                                {
                                    $explode = explode(' ',$response['data']['aadhaar_data']['name']);
                                    $username = strtolower($explode[0].''.$getPreviousDetail[0]['uid']);
                                }
                                $updatedata = array(
                                    'final_mobile_verification' => 'success',
                                    'username' => (isset($response['data']['aadhaar_data']['name']) ? ($username) : NULL),
                                    'dob' => (isset($response['data']['aadhaar_data']['date_of_birth']) ? $response['data']['aadhaar_data']['date_of_birth'] : NULL),
                                    'gender' => (isset($response['data']['aadhaar_data']['gender']) ? $response['data']['aadhaar_data']['gender'] : NULL),
                                    'mobile_hash' => (isset($response['data']['aadhaar_data']['mobile']) ? $response['data']['aadhaar_data']['mobile'] : NULL),
                                    'aadharname' => (isset($response['data']['aadhaar_data']['name']) ? $response['data']['aadhaar_data']['name'] : NULL),
                                    'careof' => (isset($response['data']['aadhaar_data']['care_of']) ? $response['data']['aadhaar_data']['care_of'] : NULL),
                                    'country' => (isset($response['data']['aadhaar_data']['country']) ? $response['data']['aadhaar_data']['country'] : NULL),
                                    'district' => (isset($response['data']['aadhaar_data']['district']) ? $response['data']['aadhaar_data']['district'] : NULL),
                                    'landmark' => (isset($response['data']['aadhaar_data']['landmark']) ? $response['data']['aadhaar_data']['landmark'] : NULL),
                                    'locality' => (isset($response['data']['aadhaar_data']['locality']) ? $response['data']['aadhaar_data']['locality'] : NULL),
                                    'pincode' => (isset($response['data']['aadhaar_data']['pincode']) ? $response['data']['aadhaar_data']['pincode'] : NULL),
                                    'state' => (isset($response['data']['aadhaar_data']['state']) ? $response['data']['aadhaar_data']['state'] : NULL),
                                    'vtc' => (isset($response['data']['aadhaar_data']['vtc_name']) ? $response['data']['aadhaar_data']['vtc_name'] : NULL),
                                    'aadharphoto' => $aadharphoto,
                                    'aadharImageId' => $imageId,
                                    'aadharExpiryDate' => date('Y-m-d',strtotime('+1 month'))
                                );
                                $curl = curl_init();
                                $postdata = json_encode(array(
                                    "collection_id" => "shivaguptabcakhoji4",
                                    "image_id" => $imageId,
                                    "image_url" => base_url().''.$aadharphoto
                                ));
                                curl_setopt_array($curl, array(
                                    CURLOPT_URL => 'https://wtlpo2vyxzv4ncm7lhgielfwnm0ivuex.lambda-url.ap-south-1.on.aws/',
                                    CURLOPT_RETURNTRANSFER => true,
                                    CURLOPT_ENCODING => '',
                                    CURLOPT_MAXREDIRS => 10,
                                    CURLOPT_TIMEOUT => 0,
                                    CURLOPT_FOLLOWLOCATION => true,
                                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                                    CURLOPT_CUSTOMREQUEST => 'POST',
                                    CURLOPT_POSTFIELDS => $postdata,
                                    CURLOPT_HTTPHEADER => array(
                                        'Content-Type: application/json',
                                        'Authorization: '.$this->getSettings('facematchtoken')
                                    ),
                                ));
                                
                                $response = json_decode(curl_exec($curl),true);
                                $this->db->where('aadhar_id',$_SESSION['aadharId']);
                                if($this->db->update('user',$updatedata))
                                {
                                    $getPreviousDetail = $this->db->query('select * from user where aadhar_id="'.$_SESSION['aadharId'].'"')->result_array();
                                    $this->session->set_userdata('user_login', 'yes');
                                    $this->session->set_userdata('loginmob',$getPreviousDetail[0]['registration_mobile']);
                                    $this->session->set_userdata('user_id', $getPreviousDetail[0]['uid']);
                                    $this->session->set_userdata('aadhar_id', $getPreviousDetail[0]['aadhar_id']);
                                    $this->session->set_userdata('username', $getPreviousDetail[0]['username']);
                                    $this->session->set_userdata('aadharName', $getPreviousDetail[0]['aadharname']);
                                    $this->session->set_userdata('login_type', 'user');
                                    $finalresponse = array(
                                        'status' => 'success',
                                        'aadharname' => $response['data']['aadhaar_data']['name'],
                                        'username' => $username,
                                    );
                                }else{
                                    $finalresponse = array(
                                        'status' => 'error',
                                        'message' => 'Something Went Wrong'
                                    );
                                }
                                echo json_encode($finalresponse);   
                            }else{
                                $finalresponse = array(
                                    'status' => 'error',
                                    'message' => 'Some problem is there please try again'
                                );
                                echo json_encode($finalresponse);
                            }
                        }else{
                            $finalresponse = array(
                                'status' => 'error',
                                'message' => $response['data']['message'],
                            );
                            echo json_encode($finalresponse);
                        }
            
                    }else{
                        $finalresponse = array(
                            'status' => 'error',
                            'message' => $response['error']['message'],
                        );
                        echo json_encode($finalresponse);
                    }   
                }else{
                    $finalresponse = array(
                        'status' => 'error',
                        'message' => $response['message'],
                    );
                    echo json_encode($finalresponse);
                }
            }else{
                $curl = curl_init();
                curl_setopt_array($curl, array(
                  CURLOPT_URL => 'https://api.sandbox.co.in/kyc/aadhaar/okyc/otp/verify',
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => '',
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 0,
                  CURLOPT_FOLLOWLOCATION => true,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => 'POST',
                  CURLOPT_POSTFIELDS =>'{
                  "otp": "'.$_POST['otp'].'",
                  "ref_id": "'.$_SESSION['ref_id'].'"
                }',
                  CURLOPT_HTTPHEADER => array(
                    'Authorization: '.$_SESSION['access_token'],
                    'x-api-key: key_live_7HUx4cSqzOZH78eml6w9G5E0hFU4VdRU',
                    'x-api-version: 1.0',
                    'Content-Type: application/json'
                  ),
                ));
                
                $verifyResponse = json_decode(curl_exec($curl),true);
                if($verifyResponse['code'] == 200)
                {
                    $aadharphoto = '';
                    $imageId = '';
                    if(isset($verifyResponse['data']['photo_link']))
                    {
                        $decoded=base64_decode($verifyResponse['data']['photo_link']);
                        $aadharphoto = 'upload/aadhar/'.time().'.JPG';
                        file_put_contents($aadharphoto,$decoded);
                        $imageId = 'GEN_'.time().''.rand(0,10000);
                    }
                    $getPreviousDetail = $this->db->query('select * from user where aadhar_id="'.$_SESSION['aadharId'].'"')->result_array();
                    $username = '';
                    if(isset($verifyResponse['data']['name']))
                    {
                        $explode = explode(' ',$verifyResponse['data']['name']);
                        $username = strtolower($explode[0].''.$getPreviousDetail[0]['uid']);
                    }
                    $updatedata = array(
                        'final_mobile_verification' => 'success',
                        'username' => (isset($verifyResponse['data']['name']) ? ($username) : NULL),
                        'dob' => (isset($verifyResponse['data']['dob']) ? $verifyResponse['data']['dob'] : NULL),
                        'gender' => (isset($verifyResponse['data']['gender']) ? ($verifyResponse['data']['gender'] == 'M' ? 'Male': 'Female') : NULL),
                        'mobile_hash' => (isset($verifyResponse['data']['mobile_hash']) ? $verifyResponse['data']['mobile_hash'] : NULL),
                        'aadharname' => (isset($verifyResponse['data']['name']) ? $verifyResponse['data']['name'] : NULL),
                        'careof' => (isset($verifyResponse['data']['care_of']) ? $verifyResponse['data']['care_of'] : NULL),
                        'country' => (isset($verifyResponse['split_address']['country']) ? $verifyResponse['split_address']['country'] : NULL),
                        'district' => (isset($verifyResponse['split_address']['dist']) ? $verifyResponse['split_address']['dist'] : NULL),
                        'landmark' => (isset($verifyResponse['split_address']['landmark']) ? $verifyResponse['split_address']['landmark'] : NULL),
                        'locality' => (isset($verifyResponse['split_address']['street']) ? $verifyResponse['split_address']['street'] : NULL),
                        'pincode' => (isset($verifyResponse['split_address']['pincode']) ? $verifyResponse['split_address']['pincode'] : NULL),
                        'state' => (isset($verifyResponse['split_address']['state']) ? $verifyResponse['split_address']['state'] : NULL),
                        'vtc' => (isset($verifyResponse['split_address']['vtc']) ? $verifyResponse['split_address']['vtc'] : NULL),
                        'aadharphoto' => $aadharphoto,
                        'aadharImageId' => $imageId,
                        'aadharExpiryDate' => date('Y-m-d',strtotime('+1 month'))
                    );
                    $curl = curl_init();
                    $postdata = json_encode(array(
                        "collection_id" => "shivaguptabcakhoji4",
                        "image_id" => $imageId,
                        "image_url" => base_url().''.$aadharphoto
                    ));
                    curl_setopt_array($curl, array(
                        CURLOPT_URL => 'https://wtlpo2vyxzv4ncm7lhgielfwnm0ivuex.lambda-url.ap-south-1.on.aws/',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => $postdata,
                        CURLOPT_HTTPHEADER => array(
                            'Content-Type: application/json',
                            'Authorization: '.$this->getSettings('facematchtoken')
                        ),
                    ));
                    
                    $response = json_decode(curl_exec($curl),true);
                    $this->db->where('aadhar_id',$_SESSION['aadharId']);
                    if($this->db->update('user',$updatedata))
                    {
                        $getPreviousDetail = $this->db->query('select * from user where aadhar_id="'.$_SESSION['aadharId'].'"')->result_array();
                        $this->session->set_userdata('user_login', 'yes');
                        $this->session->set_userdata('loginmob',$getPreviousDetail[0]['registration_mobile']);
                        $this->session->set_userdata('user_id', $getPreviousDetail[0]['uid']);
                        $this->session->set_userdata('aadhar_id', $getPreviousDetail[0]['aadhar_id']);
                        $this->session->set_userdata('username', $getPreviousDetail[0]['username']);
                        $this->session->set_userdata('aadharName', $getPreviousDetail[0]['aadharname']);
                        $this->session->set_userdata('login_type', 'user');
                        $finalresponse = array(
                            'status' => 'success',
                            'aadharname' => $verifyResponse['data']['name'],
                            'username' => $username,
                        );
                    }else{
                        $finalresponse = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                    }
                    echo json_encode($finalresponse);
                }else{
                    $finalresponse = array(
                        'status' => 'error',
                        'message' => $verifyResponse['data']['message'],
                    );
                    echo json_encode($finalresponse);
                }
                curl_close($curl);
            }
        }else{
            $curl = curl_init();
            curl_setopt_array($curl, [
              CURLOPT_URL => "https://api.gridlines.io/aadhaar-api/boson/submit-otp",
              CURLOPT_RETURNTRANSFER => true,
              CURLOPT_ENCODING => "",
              CURLOPT_MAXREDIRS => 10,
              CURLOPT_TIMEOUT => 30,
              CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
              CURLOPT_CUSTOMREQUEST => "POST",
              CURLOPT_POSTFIELDS => '{"otp": '.$_POST['otp'].'}',
              CURLOPT_HTTPHEADER => [
                "Content-Type: application/json",
                "X-API-Key: ".$this->getSettings(),
                "X-Auth-Type: API-Key",
                "X-Transaction-ID: ".$_SESSION['transactionId']
              ]
            ]);
    
            $response = JSON_decode(curl_exec($curl),true);
            if($response['status'] == 200)
            {
                if($response['data']['code'] == 1002)
                {
                    $aadharphoto = '';
                    $imageId = '';
                    if(isset($response['data']['aadhaar_data']['photo_base64']))
                    {
                        $decoded=base64_decode($response['data']['aadhaar_data']['photo_base64']);
                        $aadharphoto = 'upload/aadhar/'.time().'.JPG';
                        file_put_contents($aadharphoto,$decoded);
                        $imageId = 'GEN_'.time().''.rand(0,10000);
                    }
                    $getPreviousDetail = $this->db->query('select * from user where aadhar_id="'.$_SESSION['aadharId'].'"')->result_array();
                    $username = '';
                    if(isset($response['data']['aadhaar_data']['name']))
                    {
                        $explode = explode(' ',$response['data']['aadhaar_data']['name']);
                        $username = strtolower($explode[0].''.$getPreviousDetail[0]['uid']);
                    }
                    $updatedata = array(
                        'final_mobile_verification' => 'success',
                        'username' => (isset($response['data']['aadhaar_data']['name']) ? ($username) : NULL),
                        'dob' => (isset($response['data']['aadhaar_data']['date_of_birth']) ? $response['data']['aadhaar_data']['date_of_birth'] : NULL),
                        'gender' => (isset($response['data']['aadhaar_data']['gender']) ? $response['data']['aadhaar_data']['gender'] : NULL),
                        'mobile_hash' => (isset($response['data']['aadhaar_data']['mobile']) ? $response['data']['aadhaar_data']['mobile'] : NULL),
                        'aadharname' => (isset($response['data']['aadhaar_data']['name']) ? $response['data']['aadhaar_data']['name'] : NULL),
                        'careof' => (isset($response['data']['aadhaar_data']['care_of']) ? $response['data']['aadhaar_data']['care_of'] : NULL),
                        'country' => (isset($response['data']['aadhaar_data']['country']) ? $response['data']['aadhaar_data']['country'] : NULL),
                        'district' => (isset($response['data']['aadhaar_data']['district']) ? $response['data']['aadhaar_data']['district'] : NULL),
                        'landmark' => (isset($response['data']['aadhaar_data']['landmark']) ? $response['data']['aadhaar_data']['landmark'] : NULL),
                        'locality' => (isset($response['data']['aadhaar_data']['locality']) ? $response['data']['aadhaar_data']['locality'] : NULL),
                        'pincode' => (isset($response['data']['aadhaar_data']['pincode']) ? $response['data']['aadhaar_data']['pincode'] : NULL),
                        'state' => (isset($response['data']['aadhaar_data']['state']) ? $response['data']['aadhaar_data']['state'] : NULL),
                        'vtc' => (isset($response['data']['aadhaar_data']['vtc_name']) ? $response['data']['aadhaar_data']['vtc_name'] : NULL),
                        'aadharphoto' => $aadharphoto,
                        'aadharImageId' => $imageId,
                        'aadharExpiryDate' => date('Y-m-d',strtotime('+1 month'))
                    );
                    $curl = curl_init();
                    $postdata = json_encode(array(
                        "collection_id" => "shivaguptabcakhoji4",
                        "image_id" => $imageId,
                        "image_url" => base_url().''.$aadharphoto
                    ));
                    curl_setopt_array($curl, array(
                        CURLOPT_URL => 'https://wtlpo2vyxzv4ncm7lhgielfwnm0ivuex.lambda-url.ap-south-1.on.aws/',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => $postdata,
                        CURLOPT_HTTPHEADER => array(
                            'Content-Type: application/json',
                            'Authorization: '.$this->getSettings('facematchtoken')
                        ),
                    ));
                    
                    $response = json_decode(curl_exec($curl),true);
                    $this->db->where('aadhar_id',$_SESSION['aadharId']);
                    if($this->db->update('user',$updatedata))
                    {
                        $getPreviousDetail = $this->db->query('select * from user where aadhar_id="'.$_SESSION['aadharId'].'"')->result_array();
                        $this->session->set_userdata('user_login', 'yes');
                        $this->session->set_userdata('loginmob',$getPreviousDetail[0]['registration_mobile']);
                        $this->session->set_userdata('user_id', $getPreviousDetail[0]['uid']);
                        $this->session->set_userdata('aadhar_id', $getPreviousDetail[0]['aadhar_id']);
                        $this->session->set_userdata('username', $getPreviousDetail[0]['username']);
                        $this->session->set_userdata('aadharName', $getPreviousDetail[0]['aadharname']);
                        $this->session->set_userdata('login_type', 'user');
                        $finalresponse = array(
                            'status' => 'success',
                            'aadharname' => $response['data']['aadhaar_data']['name'],
                            'username' => $username,
                        );
                    }else{
                        $finalresponse = array(
                            'status' => 'error',
                            'message' => 'Something Went Wrong'
                        );
                    }
                    echo json_encode($finalresponse);
                }else{
                    $finalresponse = array(
                        'status' => 'error',
                        'message' => $response['data']['message'],
                    );
                    echo json_encode($finalresponse);
                }
    
            }else{
                $finalresponse = array(
                    'status' => 'error',
                    'message' => $response['error']['message'],
                );
                echo json_encode($finalresponse);
            }      
        }
    }
 function profile($para = '')
    {
        if($para == '')
        {
            if($this->session->userdata('user_login') == 'yes'){
                $page_data['title'] = 'Profile';
                $page_data['page_name'] = 'profile';
                $this->load->view('user/index', $page_data);
              } else {
                 redirect('landing/login','refresh');
              }
        }else{
        }
    }
       
    function matchregisternew($para1 = '')
    {
        if($para1 == 'do_register')
        {
            unset($_POST['_token']);
            $aadhar = $this->input->post('aadhar_id');
            $credential = array('aadhar_id' => $aadhar,'final_mobile_verification'=>'success');
            $query = $this->db->get_where('user', $credential);
            $result = $query->result_array();
            if ($query->num_rows() > 0) {
                $split = explode(' ', $result[0]['aadharname']);
                $finalName = '';
                if(count($split) > 2)
                {
                    $finalName = $split[0] . ' ' . $split[count($split) - 1];
                }else{
                    $finalName = $result[0]['aadharname'];
                }
                $finalresponse = array(
                    'status' => 'error',
                    'message' => 'Aadhar number already registered in our website',
                    'aadharPhoto' => base_url().''.$result[0]['aadharphoto'],
                    'name' => $finalName,
                );
                echo json_encode($finalresponse);
            } else {
                $curl = curl_init();
                curl_setopt_array($curl, [
                  CURLOPT_URL => "https://api.gridlines.io/aadhaar-api/verify",
                  CURLOPT_RETURNTRANSFER => true,
                  CURLOPT_ENCODING => "",
                  CURLOPT_MAXREDIRS => 10,
                  CURLOPT_TIMEOUT => 30,
                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                  CURLOPT_CUSTOMREQUEST => "POST",
                  CURLOPT_POSTFIELDS => '{"aadhaar_number": '.$_POST['aadhar_id'].',  "consent": "Y"}',
                  CURLOPT_HTTPHEADER => [
                    "Content-Type: application/json",
                    "X-API-Key: ".$this->getSettings(),
                    "X-Auth-Type: API-Key"
                  ],
                ]);
                
                $response1 = json_decode(curl_exec($curl),true);
                curl_close($curl);
                if(isset($response1['status']))
                {
                    if($response1['status'] == 200)
                    {
                        if($response1['data']['code'] == 1018)
                        {
                            if(substr($response1['data']['aadhaar_data']['mobile'] , -3) == substr($_POST['registration_mobile'] , -3))
                            {
                                $curl = curl_init();
                                $postfields = json_encode(array(
                                    'aadhaar_number' => $_POST['aadhar_id'],
                                    'consent' => 'Y'
                                ));
                                curl_setopt_array($curl, [
                                  CURLOPT_URL => "https://api.gridlines.io/aadhaar-api/boson/generate-otp",
                                  CURLOPT_RETURNTRANSFER => true,
                                  CURLOPT_ENCODING => "",
                                  CURLOPT_MAXREDIRS => 10,
                                  CURLOPT_TIMEOUT => 30,
                                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                                  CURLOPT_CUSTOMREQUEST => "POST",
                                  CURLOPT_POSTFIELDS => '{"aadhaar_number": '.$_POST['aadhar_id'].',  "consent": "Y"}',
                                  CURLOPT_HTTPHEADER => [
                                    "Content-Type: application/json",
                                    "X-API-Key: ".$this->getSettings(),
                                    "X-Auth-Type: API-Key"
                                  ],
                                ]);
                    
                                $response2 = json_decode(curl_exec($curl),true);
                                if(isset($response2['status']))
                                {
                                    if($response2['status'] == 200)
                                    {
                                        unset($_POST['consent']);
                                        $getIfAlready = $this->db->query('select * from user where aadhar_id="'.$_POST['aadhar_id'].'"')->result_array();
                                        if(count($getIfAlready) > 0)
                                        {
                                            $this->db->where('aadhar_id',$_POST['aadhar_id']);
                                            $update = $this->db->update('user',$_POST) ;
                                        }else{
                                            $insert = $this->db->insert('user',$_POST) ;   
                                        }
                                        $_SESSION['type'] = 'gridline';
                                        $_SESSION['aadharId'] = $_POST['aadhar_id'];
                                        $_SESSION['mob'] = $_POST['registration_mobile'];
                                        $_SESSION['transactionId'] = $response2['data']['transaction_id'];
                                        $finalresponse = array(
                                            'status' => 'success',
                                            'message' => $response2['data']['message']
                                        );
                                        echo json_encode($finalresponse);
                                    }else
                                    {
                                        $finalresponse = array(
                                            'status' => 'error',
                                            'message' => $response2['error']['message']
                                        );
                                        echo json_encode($finalresponse);
                                    }
                                }else{
                                    $finalresponse = array(
                                        'status' => 'error',
                                        'message' => 'Some problem is there please try again'
                                    );
                                    echo json_encode($finalresponse);
                                }
                            }else{
                                $finalresponse = array(
                                    'status' => 'error',
                                    'message' => 'The Mobile number you have entered does not match with our records.'
                                );
                                echo json_encode($finalresponse);
                            }   
                        }else{
                            $finalresponse = array(
                                'status' => 'error',
                                'message' => $response1['data']['message']
                            );
                            echo json_encode($finalresponse);
                        }
                    }else{
                        if($response1['status'] == 400)
                        {
                            $finalResponse = array(
                                'status' => 'error',
                                'message' => $response1['error']['message']
                            );
                            echo json_encode($finalResponse);
                        }else{
                            $curl = curl_init();
                            curl_setopt_array($curl, array(
                              CURLOPT_URL => 'https://api.sandbox.co.in/authenticate',
                              CURLOPT_RETURNTRANSFER => true,
                              CURLOPT_ENCODING => '',
                              CURLOPT_MAXREDIRS => 10,
                              CURLOPT_TIMEOUT => 0,
                              CURLOPT_FOLLOWLOCATION => true,
                              CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                              CURLOPT_CUSTOMREQUEST => 'POST',
                              CURLOPT_HTTPHEADER => array(
                                'x-api-key: key_live_7HUx4cSqzOZH78eml6w9G5E0hFU4VdRU',
                                'x-api-secret: secret_live_mi53PMvzGyngSI1QF7vusJrSUkpv6lbi',
                                'x-api-version: 1.0'
                              ),
                            ));
                            
                            $tokenResponse = json_decode(curl_exec($curl),true);
                            curl_close($curl);
                            if($tokenResponse['access_token'])
                            {
                                $_SESSION['access_token'] = $tokenResponse['access_token'];
                                $curl = curl_init();
                                curl_setopt_array($curl, array(
                                  CURLOPT_URL => 'https://api.sandbox.co.in/kyc/aadhaar/okyc/otp',
                                  CURLOPT_RETURNTRANSFER => true,
                                  CURLOPT_ENCODING => '',
                                  CURLOPT_MAXREDIRS => 10,
                                  CURLOPT_TIMEOUT => 0,
                                  CURLOPT_FOLLOWLOCATION => true,
                                  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                                  CURLOPT_CUSTOMREQUEST => 'POST',
                                  CURLOPT_POSTFIELDS =>'{
                                  "aadhaar_number": '.$_POST['aadhar_id'].'
                                }',
                                  CURLOPT_HTTPHEADER => array(
                                    'Authorization: '.$tokenResponse['access_token'],
                                    'x-api-key: key_live_7HUx4cSqzOZH78eml6w9G5E0hFU4VdRU',
                                    'x-api-version: 1.0',
                                    'Content-Type: application/json'
                                  ),
                                ));
                                
                                $otpResponse = json_decode(curl_exec($curl),true);
                                curl_close($curl);
                                if(count($otpResponse) > 0)
                                {
                                    if($otpResponse['code'] == 200)
                                    {
                                        $getIfAlready = $this->db->query('select * from user where aadhar_id="'.$_POST['aadhar_id'].'"')->result_array();
                                        if(count($getIfAlready) > 0)
                                        {
                                            $this->db->where('aadhar_id',$_POST['aadhar_id']);
                                            $update = $this->db->update('user',$_POST) ;
                                        }else{
                                            $insert = $this->db->insert('user',$_POST) ;   
                                        }
                                        $_SESSION['ref_id'] = $otpResponse['data']['ref_id'];
                                        $_SESSION['type'] = 'sandbox';
                                        $_SESSION['aadharId'] = $_POST['aadhar_id'];
                                        $_SESSION['mob'] = $_POST['registration_mobile'];
                                        $response = array(
                                            'status' => 'success',
                                            'message' => $otpResponse['data']['message']
                                        );
                                        echo json_encode($response);
                                    }else{
                                        $finalResponse = array(
                                            'status' => 'error',
                                            'message' => $otpResponse['data']['message']
                                        );
                                        echo json_encode($finalResponse);        
                                    }
                                }else{
                                    $finalResponse = array(
                                        'status' => 'error',
                                        'message' => $otpResponse['data']['message']
                                    );
                                    echo json_encode($finalResponse);        
                                }
                            }else{
                                $finalResponse = array(
                                    'status' => 'error',
                                    'message' => $tokenResponse['message']
                                );
                                echo json_encode($finalResponse);
                            }   
                        }
                    }   
                }else{
                    $finalResponse = array(
                        'status' => 'error',
                        'message' => $response1['message']
                    );
                    echo json_encode($finalResponse);
                    // $curl = curl_init();
                    // curl_setopt_array($curl, array(
                    //   CURLOPT_URL => 'https://api.sandbox.co.in/authenticate',
                    //   CURLOPT_RETURNTRANSFER => true,
                    //   CURLOPT_ENCODING => '',
                    //   CURLOPT_MAXREDIRS => 10,
                    //   CURLOPT_TIMEOUT => 0,
                    //   CURLOPT_FOLLOWLOCATION => true,
                    //   CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    //   CURLOPT_CUSTOMREQUEST => 'POST',
                    //   CURLOPT_HTTPHEADER => array(
                    //     'x-api-key: key_live_7HUx4cSqzOZH78eml6w9G5E0hFU4VdRU',
                    //     'x-api-secret: secret_live_mi53PMvzGyngSI1QF7vusJrSUkpv6lbi',
                    //     'x-api-version: 1.0'
                    //   ),
                    // ));
                    
                    // $tokenResponse = json_decode(curl_exec($curl),true);
                    // curl_close($curl);
                    // if($tokenResponse['access_token'])
                    // {
                    //     $_SESSION['access_token'] = $tokenResponse['access_token'];
                    //     $curl = curl_init();
                    //     curl_setopt_array($curl, array(
                    //       CURLOPT_URL => 'https://api.sandbox.co.in/kyc/aadhaar/okyc/otp',
                    //       CURLOPT_RETURNTRANSFER => true,
                    //       CURLOPT_ENCODING => '',
                    //       CURLOPT_MAXREDIRS => 10,
                    //       CURLOPT_TIMEOUT => 0,
                    //       CURLOPT_FOLLOWLOCATION => true,
                    //       CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    //       CURLOPT_CUSTOMREQUEST => 'POST',
                    //       CURLOPT_POSTFIELDS =>'{
                    //       "aadhaar_number": '.$_POST['aadhar_id'].'
                    //     }',
                    //       CURLOPT_HTTPHEADER => array(
                    //         'Authorization: '.$tokenResponse['access_token'],
                    //         'x-api-key: key_live_7HUx4cSqzOZH78eml6w9G5E0hFU4VdRU',
                    //         'x-api-version: 1.0',
                    //         'Content-Type: application/json'
                    //       ),
                    //     ));
                        
                    //     $otpResponse = json_decode(curl_exec($curl),true);
                    //     curl_close($curl);
                    //     if(count($otpResponse) > 0)
                    //     {
                    //         if($otpResponse['code'] == 200)
                    //         {
                    //             $getIfAlready = $this->db->query('select * from user where aadhar_id="'.$_POST['aadhar_id'].'"')->result_array();
                    //             if(count($getIfAlready) > 0)
                    //             {
                    //                 $this->db->where('aadhar_id',$_POST['aadhar_id']);
                    //                 $update = $this->db->update('user',$_POST) ;
                    //             }else{
                    //                 $insert = $this->db->insert('user',$_POST) ;   
                    //             }
                    //             $_SESSION['ref_id'] = $otpResponse['data']['ref_id'];
                    //             $_SESSION['type'] = 'sandbox';
                    //             $_SESSION['aadharId'] = $_POST['aadhar_id'];
                    //             $_SESSION['mob'] = $_POST['registration_mobile'];
                    //             $response = array(
                    //                 'status' => 'success',
                    //                 'message' => $otpResponse['data']['message']
                    //             );
                    //             echo json_encode($response);
                    //         }else{
                    //             $finalResponse = array(
                    //                 'status' => 'error',
                    //                 'message' => $otpResponse['data']['message']
                    //             );
                    //             echo json_encode($finalResponse);        
                    //         }
                    //     }else{
                    //         $finalResponse = array(
                    //             'status' => 'error',
                    //             'message' => $otpResponse['data']['message']
                    //         );
                    //         echo json_encode($finalResponse);        
                    //     }
                    // }else{
                    //     $finalResponse = array(
                    //         'status' => 'error',
                    //         'message' => $tokenResponse['message']
                    //     );
                    //     echo json_encode($finalResponse);
                    // }
                }
            }
        }
    }
          
  
}
